"use strict";(self.webpackChunkbackoffice=self.webpackChunkbackoffice||[]).push([[206],{2206:(Tt,R,c)=>{c.r(R),c.d(R,{AppSystemsModule:()=>St});var p=c(6814),M=c(285),b=c(4641),C=c(4423),m=c(5861),d=c(2866),A=c(5125),E=c(2994),I=c(6776),y=c(5222),h=c(6124),P=c(9185),U=c(8419),L=c(2941),$=c(4424),k=c(5375),Z=c(3759),w=c(3540),u=c(9928),V=c(9134),W=c(8510),ee=c(3174),e=c(2948),B=c(7700);let x=(()=>{class o extends $.c{get active_item(){return this._state.active_item||{}}constructor(t,n,i){var s;super(),s=this,this._state=t,this._debug=n,this._dialog=i,this.item=this._state.item,this._loading=new A.X({}),this._modules=new A.X([]),this._change=new A.X(0),this.associated_settings=this._state.active_item$.pipe((0,I.b)(300),(0,y.w)(_=>_&&_ instanceof d.G6j?(0,d.aPQ)(_.id):[])),this.counts=(0,E.aj)([this._state.active_item$,this._change]).pipe((0,I.b)(300),(0,y.w)(function(){var _=(0,m.Z)(function*(l){const[r]=l;if(!(r&&r instanceof d.G6j))return{};s._loading.next({...s._loading.getValue(),settings:!0});const g=yield Promise.all([(0,d.vNE)(r.id).pipe((0,h.U)(f=>f.total)).toPromise().catch(f=>0),(0,d.Eio)(r.id).pipe((0,h.U)(f=>f.length)).toPromise().catch(f=>0)]),[S,v]=g;return s._loading.next({...s._loading.getValue(),settings:!1}),{devices:r.modules.length,zones:r.zones.length,triggers:S,metadata:v}});return function(l){return _.apply(this,arguments)}}())),this.modules=(0,E.aj)([this.item,this._change]).pipe((0,I.b)(500),(0,y.w)(function(){var _=(0,m.Z)(function*([l]){if(!(l&&l instanceof d.G6j))return[];s._loading.next({...s._loading.getValue(),modules:!0});const r=yield(0,d.Ne_)({control_system_id:l.id,complete:!0,limit:200}).pipe((0,h.U)(g=>g.data)).toPromise();return r.forEach(g=>g.connected=void 0),s._loading.next({...s._loading.getValue(),modules:!1}),r.sort((g,S)=>(l.modules.indexOf(g.id)>-1?l.modules.indexOf(g.id):9999)-(l.modules.indexOf(S.id)>-1?l.modules.indexOf(S.id):9999)),s._modules.next(r),r});return function(l){return _.apply(this,arguments)}}()),(0,P.d)(1)),this.debug_state=(0,E.aj)([this.modules,this._debug.changed]).pipe((0,h.U)(([_])=>_.reduce((l,r)=>(l[r.id]=this._debug.isListening(r),l),{}))),this.module_bindings=this.modules.pipe((0,h.U)(_=>_.map(l=>`${l.custom_name||l.name||"Blank"}_${(0,L.U0)(_,l)}`)),(0,P.d)()),this.zones=this._state.item.pipe((0,y.w)(function(){var _=(0,m.Z)(function*(l){if(!(l&&l instanceof d.G6j))return[];s._loading.next({...s._loading.getValue(),zones:!0});const r=yield(0,d.Lx_)(l.id).pipe((0,h.U)(g=>g.data)).toPromise();return r.sort((g,S)=>l.zones.indexOf(g.id)-l.zones.indexOf(S.id)),s._loading.next({...s._loading.getValue(),zones:!1}),r});return function(l){return _.apply(this,arguments)}}()),(0,P.d)()),this.triggers=(0,E.aj)([this.item,this._change]).pipe((0,y.w)(function(){var _=(0,m.Z)(function*(l){const[r]=l;if(!(r&&r instanceof d.G6j))return[];s._loading.next({...s._loading.getValue(),triggers:!0});const g=yield(0,d.vNE)(r.id).pipe((0,h.U)(S=>S.data)).toPromise();return s._loading.next({...s._loading.getValue(),triggers:!1}),g});return function(l){return _.apply(this,arguments)}}()),(0,P.d)()),this.loading=this._loading.asObservable(),this.getModules=()=>this._modules.getValue()}startSystem(){var t=this;return(0,m.Z)(function*(){const n=yield t.confirm({title:"Start system?",content:"Are you sure you want to start this system?<br>All stopped modules within the system will boot up.",icon:{type:"icon",class:"backoffice-controller-play"}});n&&n.reason&&(n.loading("Starting system..."),(yield(0,d.igg)(t.active_item.id).toPromise().catch(s=>((0,u.cB)(`Failed to start system: ${JSON.stringify(s.response||s.message||s)}`),s)))||(0,u.t5)("Successfully started system"),n.close())})()}stopSystem(){var t=this;return(0,m.Z)(function*(){const n=yield t.confirm({title:"Stop system?",content:"Are you sure you want to stop this system?<br>All modules will be immediately stopped regardless of any other systems they may be in.",icon:{type:"icon",class:"backoffice-controller-stop"}});n&&n.reason&&(n.loading("Stopping system..."),(yield(0,d.edN)(t.active_item.id).toPromise().catch(s=>((0,u.cB)(`Failed to stop system: ${JSON.stringify(s.response||s.message||s)}`),s)))||(0,u.t5)("Successfully stopped system"),n.close())})()}toggleModuleDebug(t){t&&(this._debug.isListening(t)?this._debug.unbind(t):this._debug.bind(t,`${t.custom_name||t.name||"Blank"}_${(0,L.U0)(this._modules.getValue(),t)}`))}newModule(){var t=this;return(0,m.Z)(function*(){const n=yield t._state.edit(new d.SQz({system:t.active_item,control_system_id:t.active_item.id})).catch(i=>null);n&&t.joinModule(n.id)})()}editModule(t){var n=this;return(0,m.Z)(function*(){yield n._state.edit(t).catch(i=>null),n._change.next(Date.now())})()}selectTrigger(){var t=this;return(0,m.Z)(function*(){const n=t._dialog.open(W.f,{data:{service_name:"Triggers",query_fn:_=>(0,d.$Um)({q:_}).pipe((0,h.U)(l=>l.data))}}),i=yield Promise.race([n.componentInstance.event.pipe((0,U.P)(_=>"action"===_.reason)).toPromise(),n.afterClosed().toPromise()]);if(!i||!i.reason)return n.close();const s=yield t.addTrigger(n.componentInstance.item);return n.close(),t._change.next(Date.now()),s})()}addTrigger(t){var n=this;return(0,m.Z)(function*(){const i=yield(0,d.nq4)(n.active_item.id,{control_system_id:n.active_item.id,enabled:!0,important:!1,trigger_id:t.id}).toPromise();return n.timeout("change",()=>n._change.next(Date.now())),i})()}editTrigger(t){var n=this;return(0,m.Z)(function*(){if(n.item&&t){const i=n._dialog.open(V.K,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:t,name:"Trigger",save:r=>(0,d.dqJ)(r.id,r),external_save:!0}}),s=yield Promise.race([i.componentInstance.event.pipe((0,U.P)(r=>"action"===r.reason)).toPromise(),i.afterClosed().toPromise()]);if(!s||!s.reason)return;i.componentInstance.loading="Saving trigger settings...";const _=`${(0,d._ds)()}/systems/${n.active_item.id}/triggers/${t.id}`,l=yield(0,d.gzd)(_,s.metadata).toPromise().catch(r=>{throw(0,u.cB)(`Error updating trigger settings. Error: ${JSON.stringify(r.response||r.message||r)}`),r});return i.close(),l?((0,u.t5)("Successfully updated trigger settings."),n.timeout("change",()=>n._change.next(Date.now())),l):t}})()}removeTrigger(t){var n=this;return(0,m.Z)(function*(){const i=yield n.confirm({title:"Remove trigger",content:`<p>Are you sure you want remove trigger "${t.name}"?</p><p>Configuration will be updated <strong>immediately</strong>.</p>`,icon:{type:"icon",class:"backoffice-trash"}});!i||!i.reason||(yield(0,d.LfU)(n.active_item.id,t.id).toPromise().catch(s=>{throw i.close(),(0,u.cB)(`Error removing trigger ${t.id} from system. Error: ${s.statusText||s.message||s}`),s}),i.close(),(0,u.t5)("Successfully removed trigger from system."),n._change.next(Date.now()))})()}reorderModules(t,n){var i=this;return(0,m.Z)(function*(){const s=yield i.confirm({title:"Change order?",content:"Are you sure you want to change the module priority?<br>Settings will be updated immediately for the system.",icon:{type:"icon",class:"backoffice-layers"}});if(!s||!s.reason)return;s.loading("Updating module order...");const _=[...i.active_item.modules];(0,C.bA)(_,t,n);const l=yield(0,d.EQg)(i.active_item.id,{...i.active_item,modules:_}).toPromise().catch(r=>((0,u.cB)(`Failed to reorder system modules: ${JSON.stringify(r.response||r.message||r)}`),r));s.close(),l instanceof d.G6j&&((0,u.t5)("Successfully reordered system modules."),i._state.replaceItem(l))})()}reorderZones(t){var n=this;return(0,m.Z)(function*(){if(t.length!==n.active_item.zones.length)return;const i=yield n.confirm({title:"Change order?",content:"Are you sure you want to change the zone priority?<br>Settings will be updated immediately for the system.",icon:{type:"icon",class:"backoffice-layers"}});if(!i||!i.reason)return;i.loading("Updating zone order...");const s=yield(0,d.EQg)(n.active_item.id,{...n.active_item,zones:t}).toPromise().catch(_=>((0,u.cB)(`Failed to reorder system zones: ${JSON.stringify(_.response||_.message||_)}`),_));s instanceof d.G6j&&((0,u.t5)("Successfully reordered system zones."),n._state.replaceItem(s)),i.close()})()}joinModule(t){var n=this;return(0,m.Z)(function*(){yield(0,d.y_E)(n.active_item.id,t).toPromise().catch(i=>{(0,u.cB)(`Error adding module ${t} to system. Error: ${i.statusText||i.message||i}`)}),n.timeout("join",(0,m.Z)(function*(){const i=yield(0,d.hMA)(n.active_item.id).toPromise();i&&(n._state.replaceItem(i),(0,u.t5)("Successfully added module to system."),n._change.next(Date.now()))}))})()}removeModule(t){var n=this;return(0,m.Z)(function*(){const i=yield n.confirm({title:"Remove module?",content:`Remove ${t.driver_id} from this system?<br>If this is not used elsewhere the associated data will be removed immediately.`,icon:{type:"icon",class:"backoffice-trash"}});if(!i||!i.reason)return;const s=yield(0,d.zed)(n.active_item.id,t.id).toPromise().catch(_=>{(0,u.cB)(`Error removing module ${t.id} from system. Error: ${_.statusText||_.message||_}`)});i.close(),s&&(n._state.replaceItem(s),(0,u.t5)("Successfully removed module from system."))})()}reloadModule(t){var n=this;return(0,m.Z)(function*(){const i=yield n.confirm({title:"Recompile module?",content:"New driver code will be loaded and the device settings will be reloaded.",icon:{type:"icon",class:"backoffice-install"}});!i||!i.reason||(i.loading("Recompiling and reloading driver..."),yield(0,d.qEr)(t.driver?.id||t.driver_id).toPromise().catch(s=>{throw(0,u.cB)(`Error removing module ${t.id} from system. Error: ${s.statusText||s.message||s}`),s}),(0,u.t5)("Successfully removed module from system."),i.close())})()}addZones(t){var n=this;return(0,m.Z)(function*(){const i=(0,Z.Tw)([...n.active_item.zones,...t.map(_=>_.id)]),s=yield(0,d.EQg)(n.active_item.id,{...n.active_item,zones:i}).toPromise().catch(_=>{(0,u.cB)(`Error adding ${t.length} zone(s) to system. Error: ${_.statusText||_.message||_}`)});s&&(n._state.replaceItem(s),(0,u.t5)("Successfully added zone to system."))})()}removeZone(t){var n=this;return(0,m.Z)(function*(){const i=yield n.confirm({title:"Remove zone?",content:`<p>Are you sure you want remove zone "${t.name}" from the system?</p>Configuration will be updated immediately.`,icon:{type:"icon",class:"backoffice-trash"}});if(!i||!i.reason)return;const s=n.active_item.zones.filter(l=>l!==t.id),_=yield(0,d.EQg)(n.active_item.id,{...n.active_item,zones:s}).toPromise().catch(l=>{(0,u.cB)(`Error removing zone ${t.id} from system. Error: ${l.statusText||l.message||l}`)});i.close(),_&&(n._state.replaceItem(_),(0,u.t5)("Successfully removed zone from system."))})()}toggleModulePower(t){var n=this;return(0,m.Z)(function*(){yield(t.running?d.iAP:d.Dqv)(t.id).toPromise().catch(s=>{throw"string"==typeof s&&s.length<64?(0,u.cB)(s):(0,u.cB)(`Failed to ${t.running?"stop":"start"} module '${t.id}'.\nView Error?`,"View",()=>n.viewDetails(s)),s}),(0,u.t5)("Module successfully "+(t.running?"stopped":"started")),t.running=!t.running})()}viewDetails(t){this._dialog.open(ee.a,{data:{content:t}})}confirm(t){var n=this;return(0,m.Z)(function*(){return(0,Z._5)(t,n._dialog)})()}static#e=this.\u0275fac=function(n){return new(n||o)(e.LFG(w.L),e.LFG(k.i),e.LFG(B.uw))};static#t=this.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var te=c(7330),O=c(5940),G=c(8902);function ne(o,a){if(1&o&&(e.TgZ(0,"div",13)(1,"label",14),e.SDv(2,15),e.qZA(),e.TgZ(3,"div",16)(4,"a",17),e._uU(5),e.qZA()()()),2&o){const t=e.oxw();e.xp6(4),e.Q6J("href",null==t.item?null:t.item.support_url,e.LSH),e.xp6(1),e.Oqu(null==t.item?null:t.item.support_url)}}function ie(o,a){if(1&o&&(e.TgZ(0,"div",13)(1,"label",14),e.SDv(2,18),e.qZA(),e.TgZ(3,"div",16),e._uU(4),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.Oqu(null!=t.item&&t.item.bookable?"Yes":"No")}}function oe(o,a){if(1&o&&(e.TgZ(0,"div",13)(1,"label",14),e.SDv(2,19),e.qZA(),e.TgZ(3,"div",16),e._uU(4),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.Oqu(null!=t.item&&t.item.public?"Yes":"No")}}function se(o,a){if(1&o&&(e.TgZ(0,"div",13)(1,"label"),e.SDv(2,20),e.qZA(),e.TgZ(3,"p"),e._uU(4),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.Oqu(null==t.item?null:t.item.code)}}function _e(o,a){if(1&o&&(e.TgZ(0,"a",23),e._uU(1),e.qZA()),2&o){const t=e.oxw(2);e.Q6J("href","mailto:"+(null==t.item?null:t.item.email),e.LSH),e.xp6(1),e.Oqu(null==t.item?null:t.item.email)}}function le(o,a){if(1&o&&(e.TgZ(0,"div",13)(1,"label",14),e.SDv(2,21),e.qZA(),e.YNc(3,_e,2,2,"a",22),e.qZA()),2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",null==t.item?null:t.item.email)}}function ce(o,a){if(1&o&&(e.TgZ(0,"div",13)(1,"label",14),e.SDv(2,24),e.qZA(),e.TgZ(3,"div",16),e._uU(4),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.Oqu(null==t.item?null:t.item.capacity)}}function re(o,a){if(1&o&&(e.TgZ(0,"div",13)(1,"label",14),e.SDv(2,25),e.qZA(),e.TgZ(3,"div",26),e._uU(4),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.Oqu(null==t.item?null:t.item.map_id)}}function ae(o,a){if(1&o&&(e.TgZ(0,"div",13)(1,"label",14),e.SDv(2,27),e.qZA(),e.TgZ(3,"div",16),e._uU(4),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.Oqu(null==t.item?null:t.item.installed_ui_devices)}}function de(o,a){if(1&o&&(e.TgZ(0,"div",13)(1,"label",14),e.SDv(2,28),e.qZA(),e.TgZ(3,"div",16),e._uU(4),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.Oqu(null==t.item?null:t.item.timezone)}}function me(o,a){if(1&o&&(e.TgZ(0,"div",13)(1,"label",14),e.SDv(2,29),e.qZA(),e.TgZ(3,"div",16),e._uU(4),e.ALo(5,"dateFrom"),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,1,1e3*(null==t.item?null:t.item.created_at))," ")}}function ue(o,a){if(1&o&&(e.TgZ(0,"div",13)(1,"label",14),e.SDv(2,30),e.qZA(),e.TgZ(3,"div",16),e._uU(4),e.ALo(5,"dateFrom"),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,1,1e3*(null==t.item?null:t.item.updated_at))," ")}}const ge=function(){return[]};function fe(o,a){if(1&o&&(e.TgZ(0,"section"),e._UZ(1,"a-settings-form",31),e.ALo(2,"async"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("id",null==t.item?null:t.item.id)("merge",!0)("settings",null==t.item?null:t.item.settings)("merge_settings",e.lcZ(2,4,t.other_settings)||e.DdM(6,ge))}}function pe(o,a){1&o&&(e.TgZ(0,"div",32),e._UZ(1,"mat-spinner",33),e.TgZ(2,"p"),e.SDv(3,34),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("diameter",32))}let Se=(()=>{class o{get item(){return this._service.active_item}constructor(t){this._service=t,this.other_settings=this._service.associated_settings,this.start=()=>this._service.startSystem(),this.stop=()=>this._service.stopSystem()}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(x))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["system-about"]],decls:26,vars:13,consts:function(){let t,n,i,s,_,l,r,g,S,v,f,Q,X,j,H;return t=$localize`:@@systemStartAction␟6b6a1db08fff3d2c62a69b58ade857ec837f953b␟8326158329170011500: Start System `,n=$localize`:@@systemStopAction␟75a9ceef1582a4e9c9319f147e7f0a42614b28d8␟958300794550458513: Stop System `,i=$localize`:@@settingsLabel␟5ba97a3f90a79c4d7720b941ae416c8c84337e38␟180274732945114229: Settings `,s=$localize`:@@systemUrlLabel␟7e26fea74dd85099364f23205324001d5f08d729␟206794270698958656:Support URL:`,_=$localize`:@@systemBookableLabel␟1729892dec33ddc3daf35f197b6882eb1c4a8a1b␟238801422848943760:Bookable Room:`,l=$localize`:@@systemPublicLabel␟6bb1db1f75fec3ab16a8519bfe5eaddb028f4c52␟2060162734446671516: Publicly Available: `,r=$localize`:@@codeLabel␟fdf79b76d13d7126facf3298d1e42cabfe5a7d47␟5734456666160779353:Code: `,g=$localize`:@@emailLabel␟31703f614ddd8547d63317830a59c0a7b935778e␟8507709425849513695:Email: `,S=$localize`:@@capacityLabel␟a1170e85d1897210d5fe03d1f363587de15d02cd␟8062822823331512246:Capacity:`,v=$localize`:@@mapIdLabel␟46a8087017d0d929ed6d398ba5d3a5ea1be7ab9b␟1613414518051599973:Map ID:`,f=$localize`:@@systemPanelCountLabel␟5cf12a795ad8decfc24b29d3b113348999440cae␟2611788356172400384: Installed Touch Panels: `,Q=$localize`:@@systemTimezoneLabel␟4d15ec9bcee7912778cc7c832495e498486039dd␟4001106038907918008:Timezone:`,X=$localize`:@@systemCreatedAtLabel␟a5ed099ffc9e96f6970df843289ade8a7d20ab9f␟1616250945945379783:Created:`,j=$localize`:@systemUpdatedAtLabel␟f94240161f912dbd8758b858877cddeab80f36cb␟1116759395536210856:Updated:`,H=$localize`:@@systemLoadingLabel␟12761354f7c79edc553ff408524f5b791cd54481␟3385246531183416995:Loading system settings...`,[[1,"flex","items-center","space-x-2","mb-4"],[1,"rounded","p-2","border","border-base-200","space-y-2","w-1/3","flex-1","flex","flex-col"],["class","flex items-center space-x-2",4,"ngIf"],[1,"w-full","text-center"],["btn","","start","",1,"w-full",3,"click"],t,["btn","","stop","",1,"w-full",3,"click"],n,[1,"my-4"],[1,"font-medium","text-lg"],i,[4,"ngIf","ngIfElse"],["load_state",""],[1,"flex","items-center","space-x-2"],[1,"w-24"],s,[1,"value"],["target","_blank",1,"underline",3,"href"],_,l,r,g,["class","underline select-all truncate","target","_blank",3,"href",4,"ngIf"],["target","_blank",1,"underline","select-all","truncate",3,"href"],S,v,[1,"value","mono"],f,Q,X,j,[3,"id","merge","settings","merge_settings"],[1,"flex","flex-col","p-8","items-center","justify-center"],[1,"mb-4",3,"diameter"],H]},template:function(n,i){if(1&n&&(e.TgZ(0,"section",0)(1,"div",1),e.YNc(2,ne,6,2,"div",2),e.YNc(3,ie,5,1,"div",2),e.YNc(4,oe,5,1,"div",2),e.YNc(5,se,5,1,"div",2),e.YNc(6,le,4,1,"div",2),e.YNc(7,ce,5,1,"div",2),e.YNc(8,re,5,1,"div",2),e.YNc(9,ae,5,1,"div",2),e.YNc(10,de,5,1,"div",2),e.YNc(11,me,6,3,"div",2),e.YNc(12,ue,6,3,"div",2),e.qZA(),e.TgZ(13,"div",1)(14,"h3",3),e._uU(15,"System Controls"),e.qZA(),e.TgZ(16,"button",4),e.NdJ("click",function(){return i.start()}),e.SDv(17,5),e.qZA(),e.TgZ(18,"button",6),e.NdJ("click",function(){return i.stop()}),e.SDv(19,7),e.qZA()()(),e._UZ(20,"hr",8),e.TgZ(21,"header",9),e.SDv(22,10),e.qZA(),e.YNc(23,fe,3,7,"section",11),e.YNc(24,pe,4,1,"ng-template",null,12,e.W1O)),2&n){const s=e.MAs(25);e.xp6(2),e.Q6J("ngIf",null==i.item?null:i.item.support_url),e.xp6(1),e.Q6J("ngIf",null==i.item?null:i.item.bookable),e.xp6(1),e.Q6J("ngIf",null==i.item?null:i.item.bookable),e.xp6(1),e.Q6J("ngIf",null==i.item?null:i.item.code),e.xp6(1),e.Q6J("ngIf",null==i.item?null:i.item.email),e.xp6(1),e.Q6J("ngIf",null==i.item?null:i.item.capacity),e.xp6(1),e.Q6J("ngIf",null==i.item?null:i.item.map_id),e.xp6(1),e.Q6J("ngIf",null==i.item?null:i.item.installed_ui_devices),e.xp6(1),e.Q6J("ngIf",null==i.item?null:i.item.timezone),e.xp6(1),e.Q6J("ngIf",null==i.item?null:i.item.created_at),e.xp6(1),e.Q6J("ngIf",null==i.item?null:i.item.updated_at),e.xp6(11),e.Q6J("ngIf",(null==i.item?null:i.item.settings)&&i.other_settings)("ngIfElse",s)}},dependencies:[p.O5,te.v,O.Ou,p.Ov,G.R],styles:["[_nghost-%COMP%]{height:100%;width:100%}button[_ngcontent-%COMP%]{min-width:8rem}"]})}return o})();var Te=c(5775),N=c(5997),he=c(6702),z=c(3720),J=c(3992),Ce=c(5712),Y=c(2596),F=c(7988),Me=c(5986),D=c(3680);function ve(o,a){if(1&o&&(e.TgZ(0,"section",14)(1,"h3",11),e.SDv(2,15),e.qZA(),e._UZ(3,"execute-method-field",16),e.ALo(4,"async"),e.qZA()),2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("system",e.lcZ(4,1,t.item$))}}function Ae(o,a){1&o&&e._UZ(0,"div",60)}function Ee(o,a){1&o&&e._UZ(0,"mat-spinner",61)}function be(o,a){if(1&o&&(e.TgZ(0,"div",62),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.notes," ")}}const ye=function(o){return["/admin","edge",o]};function xe(o,a){if(1&o&&(e.TgZ(0,"a",63),e._uU(1," E "),e.qZA()),2&o){const t=e.oxw().$implicit;e.Q6J("matTooltip",t.edge_id)("routerLink",e.VKq(2,ye,t.edge_id))}}function Pe(o,a){1&o&&e._UZ(0,"app-icon",64)}function Ze(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",65),e.NdJ("click",function(){const s=e.CHM(t).$implicit,_=e.oxw().$implicit,l=e.oxw(4);return e.KtG(l.handleContextEvent(s,_))}),e.TgZ(1,"div",66),e._UZ(2,"app-icon",67),e.TgZ(3,"div",68),e._uU(4),e.qZA()()()}if(2&o){const t=a.$implicit;e.xp6(2),e.Q6J("icon",t.icon),e.xp6(2),e.hij(" ",t.name," ")}}const Oe=function(o){return["/modules",o]};function Ne(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",35),e.NdJ("contextAction",function(i){const _=e.CHM(t).$implicit,l=e.oxw(4);return e.KtG(l.handleContextEvent(i,_))}),e.YNc(1,Ae,1,0,"div",36),e.TgZ(2,"div",37),e._UZ(3,"app-icon",38),e.qZA(),e.TgZ(4,"div",39)(5,"div",40),e.NdJ("modelChange",function(i){const _=e.CHM(t).$implicit;return e.KtG(_.connected=i)})("click",function(){const s=e.CHM(t).$implicit,_=e.oxw(4);return e.KtG(_.power(s))}),e.ALo(6,"async"),e.qZA(),e.YNc(7,Ee,1,0,"mat-spinner",41),e.qZA(),e.TgZ(8,"div",42)(9,"div",43)(10,"a",44),e.NdJ("contextmenu",function(i){return i.stopPropagation()}),e._uU(11),e.qZA(),e.YNc(12,be,2,1,"div",45),e.qZA(),e.YNc(13,xe,2,4,"a",46),e.qZA(),e.TgZ(14,"div",25),e._uU(15),e.qZA(),e.TgZ(16,"div",27)(17,"span",47),e.ALo(18,"async"),e._uU(19),e.ALo(20,"async"),e.qZA()(),e.TgZ(21,"div",48),e.YNc(22,Pe,1,0,"app-icon",49),e.TgZ(23,"a",50),e._uU(24),e.qZA()(),e.TgZ(25,"div",51)(26,"mat-checkbox",52),e.NdJ("change",function(){const s=e.CHM(t).$implicit,_=e.oxw(4);return e.KtG(_.toggleDebug(s))}),e.ALo(27,"async"),e.ALo(28,"async"),e.qZA()(),e.TgZ(29,"div",53)(30,"button",54),e.NdJ("click",function(){const s=e.CHM(t).$implicit,_=e.oxw(4);return e.KtG(_.editModule(s))}),e._UZ(31,"app-icon",55),e.qZA(),e.TgZ(32,"button",56),e._UZ(33,"app-icon",57),e.qZA(),e.TgZ(34,"mat-menu",null,58),e.YNc(36,Ze,5,2,"button",59),e.qZA()()()}if(2&o){const t=a.$implicit,n=a.index,i=e.MAs(35),s=e.oxw(4);e.Q6J("context-menu",i),e.xp6(5),e.ekj("bg-base-content",!t.running)("bg-error",t.running&&!1===t.connected)("bg-success",t.running&&!!t.connected)("bg-pending",t.running&&void 0===t.connected),e.Q6J("sys",s.item.id)("mod",e.lcZ(6,29,s.bindings)[n])("model",t.connected),e.xp6(2),e.Q6J("ngIf",t.running&&void 0===t.connected),e.xp6(3),e.Q6J("routerLink",e.VKq(39,Oe,t.id))("title",(null==t.driver?null:t.driver.name)||"<Unnamed>"),e.xp6(1),e.hij(" ",(null==t.driver?null:t.driver.name)||"<Unnamed>"," "),e.xp6(1),e.Q6J("ngIf",t.notes),e.xp6(1),e.Q6J("ngIf",t.edge_id),e.xp6(2),e.hij(" ",s.driver_type(t.role||(null==t.driver?null:t.driver.role))," "),e.xp6(2),e.Q6J("title",e.lcZ(18,31,s.bindings)[n]),e.xp6(2),e.Oqu(e.lcZ(20,33,s.bindings)[n]),e.xp6(3),e.Q6J("ngIf",t.tls),e.xp6(1),e.Q6J("href",t.ip?(t.tls?"https://":"http://")+t.ip:t.uri,e.LSH),e.xp6(1),e.Oqu(t.ip||t.uri),e.xp6(2),e.Q6J("disabled",!t.running)("checked",e.lcZ(27,35,s.debugging)[t.id])("matTooltip",(e.lcZ(28,37,s.debugging)[t.id]?"Disable":"Enable")+" Debugging"),e.xp6(6),e.Q6J("matMenuTriggerFor",i),e.xp6(4),e.Q6J("ngForOf",t.running?s.menu_options:s.offline_options)}}function Ie(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",18)(1,"div",19),e._UZ(2,"div",20),e.TgZ(3,"div",21),e.SDv(4,22),e.qZA(),e.TgZ(5,"div",23),e.SDv(6,24),e.qZA(),e.TgZ(7,"div",25),e.SDv(8,26),e.qZA(),e.TgZ(9,"div",27),e.SDv(10,28),e.qZA(),e.TgZ(11,"div",27),e.SDv(12,29),e.qZA(),e.TgZ(13,"div",30),e.SDv(14,31),e.qZA(),e._UZ(15,"div",32),e.qZA(),e.TgZ(16,"div",33),e.NdJ("cdkDropListDropped",function(i){e.CHM(t);const s=e.oxw(3);return e.KtG(s.drop(i))}),e.YNc(17,Ne,37,41,"div",34),e.ALo(18,"async"),e.qZA()()}if(2&o){const t=e.oxw(3);e.xp6(17),e.Q6J("ngForOf",e.lcZ(18,1,t.modules))}}function Le(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Ie,19,3,"div",17),e.ALo(2,"async"),e.BQk()),2&o){const t=e.oxw(2),n=e.MAs(4);let i;e.xp6(1),e.Q6J("ngIf",null==(i=e.lcZ(2,2,t.modules))?null:i.length)("ngIfElse",n)}}function $e(o,a){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"section",3)(2,"item-search-field",4),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.new_module=i.id)}),e.qZA(),e.TgZ(3,"button",5),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.addModule())}),e.SDv(4,6),e.qZA(),e.TgZ(5,"button",7),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.newModule())}),e.SDv(6,8),e.qZA()(),e.YNc(7,ve,5,3,"section",9),e.TgZ(8,"section",10)(9,"h3",11),e.SDv(10,12),e.qZA(),e.YNc(11,Le,3,4,"ng-container",13),e.ALo(12,"async"),e.qZA(),e.BQk()}if(2&o){const t=e.oxw(),n=e.MAs(2);e.xp6(2),e.Q6J("query_fn",t.query_fn)("exclude",t.exclude_fn)("ngModel",null),e.xp6(1),e.Q6J("disabled",!t.new_module),e.xp6(4),e.Q6J("ngIf",t.item.id&&t.item.modules&&!t.hide_exec),e.xp6(4),e.Q6J("ngIf",!e.lcZ(12,7,t.loading).modules)("ngIfElse",n)}}function we(o,a){1&o&&(e.TgZ(0,"div",69),e._UZ(1,"mat-spinner",70),e.TgZ(2,"p"),e._uU(3,"Loading modules..."),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("diameter",48))}function Ye(o,a){1&o&&(e.TgZ(0,"div",69)(1,"p"),e._uU(2,"No devices for system"),e.qZA()())}let Fe=(()=>{class o extends $.c{driver_type(t){if(null==t)return"";switch(t){case d.TAy.Device:return"Device";case d.TAy.SSH:return"SSH";case d.TAy.Service:return"Service";case d.TAy.Websocket:return"Websocket"}return"Logic"}get item(){return this._service.active_item}constructor(t,n){super(),this._service=t,this._dialog=n,this.device_listener={},this.item$=this._service.item,this.loading=this._service.loading,this.modules=this._service.modules,this.debugging=this._service.debug_state,this.bindings=this._service.module_bindings,this.menu_options=[{id:"power",name:"Toggle Power",icon:{type:"icon",class:"backoffice-power-plug"}},{id:"state",name:"View State",icon:{type:"icon",class:"backoffice-eye"}},{id:"reload",name:"Recompile Driver",icon:{type:"icon",class:"backoffice-cw"}},{id:"edit",name:"Edit Module",icon:{type:"icon",class:"backoffice-edit"}},{id:"remove",name:"Remove Module",icon:{type:"icon",class:"backoffice-trash"}},{id:"load",name:"Load Module",icon:{type:"icon",class:"backoffice-arrow-with-circle-up"}}],this.offline_options=[{id:"power",name:"Toggle Power",icon:{type:"icon",class:"backoffice-power-plug"}},{id:"edit",name:"Edit Module",icon:{type:"icon",class:"backoffice-edit"}},{id:"remove",name:"Remove Module",icon:{type:"icon",class:"backoffice-trash"}},{id:"load",name:"Load Module",icon:{type:"icon",class:"backoffice-arrow-with-circle-up"}}],this.query_fn=i=>(0,d.Ne_)({q:i}).pipe((0,h.U)(s=>s.data.map(_=>({..._,extra:_.driver?.name})).filter(_=>!_.control_system_id))),this.exclude_fn=i=>i.control_system_id===this.item.id||i.role===d.TAy.Logic,this.newModule=()=>this._service.newModule(),this.removeModule=i=>this._service.removeModule(i),this.editModule=i=>this._service.editModule(i),this.joinModule=i=>this._service.joinModule(i),this.reloadModule=i=>this._service.reloadModule(i),this.toggleDebug=i=>this._service.toggleModuleDebug(i),this.power=i=>this._service.toggleModulePower(i)}handleContextEvent(t,n){if(t)switch(t.id){case"power":this.power(n);break;case"state":this.viewState(n);break;case"reload":this.reloadModule(n);break;case"remove":this.removeModule(n);break;case"load":this.loadModule(n);break;case"edit":this.editModule(n)}}reload(t){return(0,m.Z)(function*(){const n=yield(0,d.P8j)(t.id).toPromise();for(const i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})()}viewState(t){var n=this;return(0,m.Z)(function*(){const i=n._service.getModules();n._dialog.open(Te.W,{data:{system:n.item,module:t,devices:i}})})()}loadModule(t){(0,d.$yY)(t.id).toPromise().then(()=>(0,u.t5)(`Successfully loaded module "${t.name||t.id}"`),n=>(0,u.cB)(`Error loading module. Error: ${JSON.stringify(n.response||n.message||n)}`))}drop(t){t&&t.previousIndex!==t.currentIndex&&this._service.reorderModules(t.previousIndex,t.currentIndex)}addModule(){this.new_module&&(this.joinModule(this.new_module),this.new_module="")}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(x),e.Y36(B.uw))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["system-modules"]],features:[e.qOj],decls:5,vars:1,consts:function(){let t,n,i,s,_,l,r,g,S,v;return t=$localize`:@@addExistingAction␟8f50eee9d9b0eebaeadd97255bc3e5dc1f095c30␟4161166080314782574: Add existing `,n=$localize`:@@newAction␟1f048f39d0b8565dc14a060ab7fa746e7f780f84␟778924775597593118: Add new `,i=$localize`:@@moduleListHeader␟e8eea559e7b48b6744ba5b97a5c7d4ee27ff7b4d␟2210018937903105246: Module List `,s=$localize`:@@execHeader␟9871d8fa856ba440ac531210821716ee279c9327␟2605526423196683591: Execute command `,_=$localize`:@@moduleStateLabel␟1fe7f352e3bc7356c77226a4d8404ee498b0c9e3␟4221055628112420738: State `,l=$localize`:@@moduleNameLabel␟0da9e5314dbb425c214c88ca2b0449f57c4ec264␟8751673256360811138: Name `,r=$localize`:@@moduleTypeLabel␟e22bbfbfb67ac82dd6039ba6f64d73405d9d42c4␟5597457735903946099: Type `,g=$localize`:@@moduleClassLabel␟854f0df0f6dd52d4c28d575977c6e7bd641e8458␟2482335949657196140: Class `,S=$localize`:@@moduleIpLabel␟e80fa953f9bca955499cd79cc853b0e1fd51cb32␟4332685056058298852: IP/URI `,v=$localize`:@@moduleStateLabel␟fc83a662146f8a30bed7c588fc57842492e04140␟2901515939360038365: Debug `,[[4,"ngIf"],["load_state",""],["empty_state",""],["add-module","",1,"flex","space-x-2","flex-wrap","mb-2"],["name","module","placeholder","Add existing module",1,"flex-grow-1","w-full","sm:flex-1","sm:w-auto","h-12",3,"query_fn","exclude","ngModel","ngModelChange"],["btn","",1,"flex-1","w-40","sm:w-32","sm:flex-none","h-11",3,"disabled","click"],t,["btn","",1,"flex-1","w-40","sm:w-32","sm:flex-none","h-11",3,"click"],n,["exec","","class","mb-2",4,"ngIf"],["device-list",""],[1,"font-medium","text-lg","mb-2"],i,[4,"ngIf","ngIfElse"],["exec","",1,"mb-2"],s,[3,"system"],["role","table","class","overflow-x-auto min-w-[60rem]",4,"ngIf","ngIfElse"],["role","table",1,"overflow-x-auto","min-w-[60rem]"],["table-head","",1,"text-sm"],[1,"w-10","p-2"],[1,"w-12","p-2"],_,[1,"flex-1","p-2"],l,[1,"w-24","p-2"],r,[1,"w-48","p-2"],g,S,[1,"w-[3.5rem]","p-2"],v,[1,"w-24","p-2","h-9"],["body","","cdkDropList","",1,"overflow-y-auto",3,"cdkDropListDropped"],["table-row","","cdkDrag","",3,"context-menu","contextAction",4,"ngFor","ngForOf"],["table-row","","cdkDrag","",3,"context-menu","contextAction"],["class","w-[calc(100-0.5rem)] m-1 h-10 rounded border-2 border-dashed border-neutral bg-base-200",4,"cdkDragPlaceholder"],[1,"w-10","flex","justify-center","h-full",2,"cursor","grab"],["className","backoffice-select-arrows","cdkDragHandle",""],[1,"w-12","flex","items-center","justify-center","p-2","h-full","relative"],["dot","","binding","","bind","connected",1,"h-4","w-4","rounded-full",3,"sys","mod","model","modelChange","click"],["class","absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none","diameter","32",4,"ngIf"],[1,"flex","items-center","flex-1","h-full","p-2"],[1,"flex-1","flex","flex-col","justify-center","w-px"],[1,"truncate","underline","underline-offset-4","w-full",3,"routerLink","title","contextmenu"],["class","text-xs truncate w-full",4,"ngIf"],["matRipple","","class","text-xs h-6 w-6 rounded-full bg-info flex items-center justify-center shadow text-info-content",3,"matTooltip","routerLink",4,"ngIf"],[1,"truncate",3,"title"],[1,"w-48","text-right","flex","items-center","h-full","p-2"],["className","backoffice-lock",4,"ngIf"],["target","_blank",1,"truncate","underline",3,"href"],[1,"w-[3.5rem]","flex","items-center","justify-center","p-2","h-full"],["matTooltipPosition","left",3,"disabled","checked","matTooltip","change"],[1,"w-24","flex","px-2","justify-center"],["icon","",3,"click"],["className","backoffice-edit"],["icon","",3,"matMenuTriggerFor"],["className","backoffice-dots-three-vertical"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],[1,"w-[calc(100-0.5rem)]","m-1","h-10","rounded","border-2","border-dashed","border-neutral","bg-base-200"],["diameter","32",1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","pointer-events-none"],[1,"text-xs","truncate","w-full"],["matRipple","",1,"text-xs","h-6","w-6","rounded-full","bg-info","flex","items-center","justify-center","shadow","text-info-content",3,"matTooltip","routerLink"],["className","backoffice-lock"],["mat-menu-item","",3,"click"],[1,"flex","items-center","space-x-2"],[3,"icon"],[1,"text"],[1,"flex","flex-col","items-center","p-8","mx-auto"],[1,"mb-4",3,"diameter"]]},template:function(n,i){1&n&&(e.YNc(0,$e,13,9,"ng-container",0),e.YNc(1,we,4,1,"ng-template",null,1,e.W1O),e.YNc(3,Ye,3,0,"ng-template",null,2,e.W1O)),2&n&&e.Q6J("ngIf",i.item)},dependencies:[p.sg,p.O5,M.JJ,M.On,b.rH,N.o,he.Q,z.D,J.y,Ce.G,O.Ou,Y.gM,F.VK,F.OP,F.p6,Me.oG,D.wG,C.Wj,C.Zt,C.Bh,C.Hk,p.Ov],styles:["button[btn][_ngcontent-%COMP%]{min-width:8rem}button.mat-menu-item[_ngcontent-%COMP%]{display:flex;align-items:center}button[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{margin-left:1rem}[role=table]>div[_ngcontent-%COMP%]{width:100%;min-width:48rem}.bg-success[_ngcontent-%COMP%]{height:.5rem!important;width:.5rem!important}[dot][_ngcontent-%COMP%]{transition:height .2s,width .2s}mat-checkbox.mat-checkbox-disabled[_ngcontent-%COMP%]{pointer-events:none}"]})}return o})();var q=c(4170),Re=c(2032);const Ue=function(o){return["/triggers",o]};function ke(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",22)(1,"i",23),e.NdJ("modelChange",function(i){const _=e.CHM(t).$implicit,l=e.oxw(3);return e.KtG(l.trigger_state[_.id]=i)})("modelChange",function(){const s=e.CHM(t).$implicit,_=e.oxw(3);return e.KtG(_.updateComparisons(s.id))}),e.qZA(),e.TgZ(2,"div",24),e._UZ(3,"div",25),e.qZA(),e.TgZ(4,"div",12)(5,"a",26),e._uU(6),e.qZA()(),e.TgZ(7,"div",27),e._uU(8),e.qZA(),e.TgZ(9,"div",27),e._uU(10),e.qZA(),e.TgZ(11,"div",28),e._uU(12),e.ALo(13,"dateFrom"),e.qZA(),e.TgZ(14,"div",29)(15,"button",30),e.NdJ("click",function(){const s=e.CHM(t).$implicit,_=e.oxw(3);return e.KtG(_.copyWebhookURL(s))}),e._UZ(16,"app-icon",31),e.qZA(),e.TgZ(17,"button",30),e.NdJ("click",function(){const s=e.CHM(t).$implicit,_=e.oxw(3);return e.KtG(_.editTrigger(s))}),e._UZ(18,"app-icon",32),e.qZA(),e.TgZ(19,"button",30),e.NdJ("click",function(){const s=e.CHM(t).$implicit,_=e.oxw(3);return e.KtG(_.deleteTrigger(s))}),e._UZ(20,"app-icon",33),e.qZA()()()}if(2&o){const t=a.$implicit,n=e.oxw(3);e.xp6(1),e.Q6J("sys",n.item.id)("bind",t.id)("model",n.trigger_state[t.id]),e.xp6(2),e.ekj("bg-base-content",!(null!=n.trigger_state[t.id]&&n.trigger_state[t.id].triggered))("bg-success",null==n.trigger_state[t.id]?null:n.trigger_state[t.id].triggered),e.xp6(2),e.Q6J("routerLink",e.VKq(14,Ue,t.id)),e.xp6(1),e.Oqu(t.name),e.xp6(2),e.hij(" ",null==n.trigger_state[t.id]?null:n.trigger_state[t.id].trigger_count," "),e.xp6(2),e.hij(" ",(null==n.trigger_state[t.id]?null:n.trigger_state[t.id].action_errors)+(null==n.trigger_state[t.id]?null:n.trigger_state[t.id].comparison_errors)||"0"," "),e.xp6(2),e.hij(" ",e.lcZ(13,12,1e3*+t.created_at)," ")}}function Be(o,a){if(1&o&&(e.TgZ(0,"div",9)(1,"div",10),e._UZ(2,"div",11),e.TgZ(3,"div",12),e.SDv(4,13),e.qZA(),e.TgZ(5,"div",14),e.SDv(6,15),e.qZA(),e.TgZ(7,"div",14),e.SDv(8,16),e.qZA(),e.TgZ(9,"div",17),e.SDv(10,18),e.qZA(),e._UZ(11,"div",19),e.qZA(),e.TgZ(12,"div",20),e.YNc(13,ke,21,16,"div",21),e.ALo(14,"async"),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(13),e.Q6J("ngForOf",e.lcZ(14,1,t.triggers))}}function Ge(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Be,15,3,"div",8),e.ALo(2,"async"),e.BQk()),2&o){const t=e.oxw(),n=e.MAs(12);let i;e.xp6(1),e.Q6J("ngIf",null==(i=e.lcZ(2,2,t.triggers))?null:i.length)("ngIfElse",n)}}function ze(o,a){1&o&&(e.TgZ(0,"div",34),e._UZ(1,"mat-spinner",35),e.TgZ(2,"p"),e._uU(3,"Loading triggers..."),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("diameter",48))}function Je(o,a){1&o&&(e.TgZ(0,"div",34)(1,"p"),e._uU(2,"No triggers for system"),e.qZA()())}let De=(()=>{class o{get item(){return this._service.active_item}constructor(t){var n=this;this._service=t,this.filter$=new A.X(""),this.loading=this._service.loading,this.trigger_state={},this.comparisons={},this.temp_trigger=new A.X(null),this.triggers=(0,E.aj)([this.filter$,this._service.triggers,this.temp_trigger]).pipe((0,h.U)(([i,s,_])=>{const l=i.toLowerCase(),r=(0,Z.Tw)(_?[...s,_]:s,"id");return i?r.filter(g=>g.name.toLowerCase().includes(l)):r})),this.copyWebhookURL=i=>{(0,Z.vQ)(`${location.origin}/api/engine/v2/webhook/${i.id}/notify?secret=${i.webhook_secret}`),(0,u.QD)("Webhook link copied to clipboard")},this.editTrigger=function(){var i=(0,m.Z)(function*(s){return n.temp_trigger.next(yield n._service.editTrigger(s))});return function(s){return i.apply(this,arguments)}}(),this.deleteTrigger=i=>this._service.removeTrigger(i),this.selectTrigger=(0,m.Z)(function*(){return n.temp_trigger.next((yield n._service.selectTrigger())||null)})}updateComparisons(t){if(this.comparisons[t]="",this.trigger_state[t])for(const n in this.trigger_state[t].conditions)this.trigger_state[t].conditions.hasOwnProperty(n)&&(this.comparisons[t]&&(this.comparisons[t]+="\n"),this.comparisons[t]+=`${n}: ${this.trigger_state[t].conditions[n]}`)}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(x))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["system-triggers"]],decls:13,vars:5,consts:function(){let t,n,i,s;return t=$localize`:@@nameLabel␟851d1ba79a56f7143fc04dbfed912dd2e40af5a9␟5635653058319830659: Name `,n=$localize`:@@triggerCountLabel␟d0ea4c946d36271ef5a7eea211009023e2889b7d␟3931882206009909445: Count `,i=$localize`:@@triggerErrorsLabel␟1fce9d65748a6c97d279c89a0fdbae43bbc57720␟966064976086561720: Errors `,s=$localize`:@@descriptionLabel␟f1b6540744a5b8ea6596fb6aad63773e1e57474c␟5939856475984736508: Added `,[[1,"flex","items-center","mb-4","space-x-2"],["btn","",2,"min-width","8rem",3,"click"],["appearance","outline",1,"h-12","flex-1"],["matPrefix","","className","backoffice-magnifying-glass text-xl mr-2"],["matInput","","placeholder","Filter triggers...",1,"rounded-none",3,"ngModel","ngModelChange"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],["role","table","class","overflow-x-auto",4,"ngIf","ngIfElse"],["role","table",1,"overflow-x-auto"],["table-head",""],[1,"w-12","p-2"],["flex","",1,"flex-1","p-2"],t,[1,"w-16","p-2"],n,i,[1,"w-28","p-2"],s,[1,"w-32","p-2"],["table-body","",1,"overflow-y-auto"],["table-row","",4,"ngFor","ngForOf"],["table-row",""],["hidden","","binding","","mod","_TRIGGER__1",3,"sys","bind","model","modelChange"],[1,"w-12","flex","items-center","justify-center","h-full","p-2"],[1,"h-2","w-2","rounded-full"],[1,"truncate",3,"routerLink"],["desc","",1,"w-16","p-2"],["desc","",1,"w-28","p-2"],[1,"w-32","p-2","items-center","justify-center"],["btn","","icon","",3,"click"],["className","backoffice-link"],["className","backoffice-edit"],["className","backoffice-trash"],[1,"flex","flex-col","items-center","p-8","mx-auto"],[1,"mb-4",3,"diameter"]]},template:function(n,i){if(1&n&&(e.TgZ(0,"section",0)(1,"button",1),e.NdJ("click",function(){return i.selectTrigger()}),e._uU(2," Add Trigger "),e.qZA(),e.TgZ(3,"mat-form-field",2),e._UZ(4,"app-icon",3),e.TgZ(5,"input",4),e.NdJ("ngModelChange",function(_){return i.filter$.next(_)}),e.qZA()()(),e.TgZ(6,"section"),e.YNc(7,Ge,3,4,"ng-container",5),e.ALo(8,"async"),e.qZA(),e.YNc(9,ze,4,1,"ng-template",null,6,e.W1O),e.YNc(11,Je,3,0,"ng-template",null,7,e.W1O)),2&n){const s=e.MAs(10);e.xp6(5),e.Q6J("ngModel",""),e.xp6(2),e.Q6J("ngIf",!e.lcZ(8,3,i.loading).triggers)("ngIfElse",s)}},dependencies:[p.sg,p.O5,M.Fj,M.JJ,M.On,b.rH,N.o,z.D,q.KE,q.qo,Re.Nt,O.Ou,p.Ov,G.R],styles:["[_nghost-%COMP%]{height:100%;width:100%}[flex][_ngcontent-%COMP%]{min-width:8rem}[role=table]>div[_ngcontent-%COMP%]{width:100%;min-width:36rem}"]})}return o})();var K=c(1418);function qe(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.saveZoneOrder())}),e._uU(1," Save Zone Order "),e.qZA()}}function Ke(o,a){1&o&&e._UZ(0,"div",27)}function Qe(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw(3);return e.KtG(s.removeZone(i))}),e._UZ(1,"app-icon",29),e.qZA()}}const Xe=function(o){return["/zones",o]};function je(o,a){if(1&o&&(e.TgZ(0,"div",19),e.YNc(1,Ke,1,0,"div",20),e.TgZ(2,"div",21),e._UZ(3,"app-icon",22),e.qZA(),e.TgZ(4,"div",12)(5,"a",23),e._uU(6),e.qZA()(),e.TgZ(7,"div",24),e._uU(8),e.qZA(),e.TgZ(9,"div",25),e.YNc(10,Qe,2,0,"button",26),e.ALo(11,"async"),e.qZA()()),2&o){const t=a.$implicit,n=e.oxw(3);e.ekj("bg-pending",n.changed[t.id]),e.Q6J("matTooltip",n.changed[t.id]?"Zone order changed":""),e.xp6(2),e.ekj("pointer-events-none",t.pending)("text-pending",t.pending),e.xp6(1),e.Q6J("className",t.pending?"backoffice-warning":"backoffice-select-arrows"),e.xp6(2),e.Q6J("routerLink",e.VKq(14,Xe,t.id)),e.xp6(1),e.hij(" ",t.name," "),e.xp6(2),e.hij(" ",t.description," "),e.xp6(2),e.Q6J("ngIf",e.lcZ(11,12,n.zones).length>1)}}function He(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",9)(1,"div",10),e._UZ(2,"div",11),e.TgZ(3,"div",12),e.SDv(4,13),e.qZA(),e.TgZ(5,"div",14),e.SDv(6,15),e.qZA(),e._UZ(7,"div",16),e.qZA(),e.TgZ(8,"div",17),e.NdJ("cdkDropListDropped",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.drop(i))}),e.YNc(9,je,12,16,"div",18),e.ALo(10,"async"),e.qZA()()}if(2&o){const t=e.oxw(2);e.xp6(9),e.Q6J("ngForOf",e.lcZ(10,1,t.zones))}}function Ve(o,a){if(1&o&&(e.ynx(0),e.YNc(1,He,11,3,"div",8),e.ALo(2,"async"),e.BQk()),2&o){const t=e.oxw();let n;e.xp6(1),e.Q6J("ngIf",null==(n=e.lcZ(2,1,t.zones))?null:n.length)}}function We(o,a){1&o&&(e.TgZ(0,"div",30),e._UZ(1,"mat-spinner",31),e.TgZ(2,"p"),e._uU(3,"Loading zones..."),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("diameter",48))}let et=(()=>{class o{get item(){return this._service.active_item}constructor(t){var n=this;this._service=t,this.order_changed=!1,this.changed={},this.pending_zones=new A.X([]),this.zone_order=new A.X([]),this.loading=this._service.loading,this.zones=(0,E.aj)([this._service.zones,this.pending_zones,this.zone_order]).pipe((0,h.U)(([i,s,_])=>[...i,...s.map(l=>({...l,pending:!0}))].sort((l,r)=>_.indexOf(l.id)-_.indexOf(r.id)))),this.query_fn=i=>(0,d.I0G)({q:i}).pipe((0,h.U)(s=>s.data)),this.exclude_fn=i=>this.item.zones.indexOf(i.id)>=0,this.removeZone=i=>i.pending?this.pending_zones.next(this.pending_zones.getValue().filter(s=>s.id!==i.id)):this._service.removeZone(i),this.addPendingZone=i=>this.pending_zones.next([...this.pending_zones.getValue(),i]),this.savePendingZones=(0,m.Z)(function*(){n.pending_zones.getValue().length&&(yield n._service.addZones(n.pending_zones.getValue()),n.pending_zones.next([]))}),this.saveZoneOrder=(0,m.Z)(function*(){const i=yield n._service.zones.pipe((0,K.q)(1)).toPromise();let s=n.zone_order.getValue();i.every(({id:_},l)=>s[l]===_)||(yield n._service.reorderZones(s),n.order_changed=!1,n.changed={},n.zone_order.next([]))})}drop(t){var n=this;return(0,m.Z)(function*(){if(t&&t.previousIndex!==t.currentIndex){const i=yield n._service.zones.pipe((0,K.q)(1)).toPromise();let s=n.zone_order.getValue();s.length!==i.length&&(s=i.map(l=>l.id));const _=s.splice(t.previousIndex,1);n.changed[_[0]]=!0,s.splice(t.currentIndex,0,_[0]),n.zone_order.next(s),n.order_changed=!i.every(({id:l},r)=>s[r]===l)}})()}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(x))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["system-zones"]],decls:10,vars:10,consts:function(){let t,n;return t=$localize`:@@nameLabel␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,n=$localize`:@@descriptionLabel␟0f2005f864307f35fc334cb58b20a28b2af7af84␟4993784719124887635: Description `,[[1,"flex","items-center","space-x-2","mb-4"],["name","zone",1,"flex-1","h-12",3,"query_fn","exclude","clear_on_select","ngModel","ngModelChange"],["btn","",3,"disabled","click"],[1,"relative"],["btn","","class","shadow z-50 mb-2",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],["load_state",""],["btn","",1,"shadow","z-50","mb-2",3,"click"],["role","table","class","overflow-x-auto",4,"ngIf"],["role","table",1,"overflow-x-auto"],["table-head",""],[1,"w-12","p-2"],[1,"w-48","p-2"],t,["desc","",1,"flex-1","p-2"],n,[1,"w-16","p-2"],["body","","cdkDropList","",1,"overflow-y-auto",3,"cdkDropListDropped"],["table-row","","cdkDrag","","class","bg-opacity-40",3,"bg-pending","matTooltip",4,"ngFor","ngForOf"],["table-row","","cdkDrag","",1,"bg-opacity-40",3,"matTooltip"],["class","w-[calc(100-0.5rem)] m-1 h-10 rounded border-2 border-dashed border-neutral bg-base-200 bg-opacity-25",4,"cdkDragPlaceholder"],[1,"w-12","flex","justify-center","h-full","p-2",2,"cursor","grab"],["cdkDragHandle","",3,"className"],[3,"routerLink"],["desc","",1,"flex-1","truncate"],[1,"w-16","p-2","items-center","justify-center"],["btn","","icon","",3,"click",4,"ngIf"],[1,"w-[calc(100-0.5rem)]","m-1","h-10","rounded","border-2","border-dashed","border-neutral","bg-base-200","bg-opacity-25"],["btn","","icon","",3,"click"],["className","backoffice-trash"],[1,"flex","flex-col","items-center","p-8","mx-auto"],[1,"mb-4",3,"diameter"]]},template:function(n,i){if(1&n&&(e.TgZ(0,"section",0)(1,"item-search-field",1),e.NdJ("ngModelChange",function(_){return i.addPendingZone(_)}),e.qZA(),e.TgZ(2,"button",2),e.NdJ("click",function(){return i.savePendingZones()}),e._uU(3," Save Pending "),e.qZA()(),e.TgZ(4,"section",3),e.YNc(5,qe,2,0,"button",4),e.YNc(6,Ve,3,3,"ng-container",5),e.ALo(7,"async"),e.qZA(),e.YNc(8,We,4,1,"ng-template",null,6,e.W1O)),2&n){const s=e.MAs(9);e.xp6(1),e.Q6J("query_fn",i.query_fn)("exclude",i.exclude_fn)("clear_on_select",!0)("ngModel",null),e.xp6(1),e.Q6J("disabled",!i.pending_zones.getValue().length),e.xp6(3),e.Q6J("ngIf",i.order_changed),e.xp6(1),e.Q6J("ngIf",!e.lcZ(7,8,i.loading).zones)("ngIfElse",s)}},dependencies:[p.sg,p.O5,M.JJ,M.On,b.rH,N.o,J.y,O.Ou,Y.gM,C.Wj,C.Zt,C.Bh,C.Hk,p.Ov],styles:["[_nghost-%COMP%]{height:100%;width:100%}[desc][_ngcontent-%COMP%]{min-width:8rem}"]})}return o})();var tt=c(1557);function nt(o,a){if(1&o&&e._UZ(0,"metadata-display",1),2&o){const t=e.oxw();e.Q6J("item",t.item)}}let it=(()=>{class o{get item(){return this._service.active_item}constructor(t){this._service=t}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(w.L))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["system-metadata"]],decls:1,vars:1,consts:[[3,"item",4,"ngIf"],[3,"item"]],template:function(n,i){1&n&&e.YNc(0,nt,1,1,"metadata-display",0),2&n&&e.Q6J("ngIf",i.item)},dependencies:[p.O5,tt.J]})}return o})();var ot=c(6497),st=c(8791),_t=c(2637),lt=c(5694),ct=c(8771),rt=c(6529),at=c(4331),dt=c(1387);function mt(o,a){if(1&o){const t=e.EpF();e.ynx(0),e._UZ(1,"item-details",17)(2,"item-tablist",18),e.TgZ(3,"div",19,20),e.NdJ("scroll",function(){e.CHM(t);const i=e.MAs(4),s=e.oxw();return e.KtG(s.scroll=i.scrollTop)}),e._UZ(5,"router-outlet"),e.qZA(),e.BQk()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("can_edit",!0)("item",t.item),e.xp6(1),e.Q6J("base",t.name)("tabs",t.tab_list)("scrolled",t.scroll>0)}}function ut(o,a){1&o&&e._UZ(0,"app-debug-output",21)}function gt(o,a){1&o&&e._UZ(0,"app-debug-output",22)}const ft=[{path:":id",component:(()=>{class o extends $.c{get item(){return this._service.active_item}get extensions(){return(0,L.fq)(this._service.active_item,this.name)}get debug_position(){return this._debug.position}updateTabList(t){this.tab_list=[{id:"about",name:"About",icon:{class:"backoffice-info-with-circle"}},{id:"modules",name:"Modules",count:t?.devices??"?",icon:{class:"backoffice-tablet"}},{id:"zones",name:"Zones",count:t?.zones??"?",icon:{class:"backoffice-layers"}},{id:"triggers",name:"Triggers",count:t?.triggers??"?",icon:{class:"backoffice-stopwatch"}},{id:"metadata",name:"Metadata",count:t?.metadata??"?",icon:{class:"backoffice-gist"}},{id:"history",name:"Settings History",icon:{class:"backoffice-clock"}}].concat(this.extensions)}constructor(t,n,i){super(),this._service=t,this._item=n,this._debug=i,this.name="systems",this.open_menu=!1,this.scroll=0,this.tab_list=[],this.newItem=()=>this._item.create(),this.bulkAdd=()=>this._item.bulkAdd()}ngOnInit(){this.subscription("item-change",this._item.active_item$.subscribe(()=>this.updateTabList({}))),this.subscription("counts",this._service.counts.subscribe(t=>this.updateTabList(t)))}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(x),e.Y36(w.L),e.Y36(k.i))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["new-systems-view"]],features:[e.qOj],decls:18,vars:5,consts:[[1,"absolute","inset-0","flex","items-center","divide-y","sm:divide-y-0","sm:divide-x","divide-base-200","bg-base-100"],[1,"sm:h-full",3,"open","openChange"],[1,"flex","flex-col","h-full","flex-1","overflow-hidden","w-px"],[1,"flex","flex-1","h-px"],[1,"hidden","sm:block"],[1,"flex-1","w-1/2","h-full","relative","flex","flex-col","z-0"],[1,"z-20","sm:hidden"],["btn","","icon","",1,"sm:hidden","mr-2",3,"click"],["className","backoffice-menu"],[1,"flex","flex-col","flex-1","h-1/2"],[4,"ngIf"],["matTooltip","New system","matTooltipPosition","right","matRipple","",1,"absolute","bottom-2","left-2","sm:-left-9","w-12","h-12","flex","items-center","justify-center","bg-secondary","rounded-lg","shadow","z-30","text-secondary-content",3,"click"],[1,"text-3xl",3,"className"],["matTooltip","Bulk add systems","matTooltipPosition","right","matRipple","",1,"absolute","bottom-16","left-2","sm:-left-8","w-10","h-10","flex","items-center","justify-center","bg-secondary","rounded-lg","shadow","z-30","text-secondary-content",3,"click"],[1,"text-2xl"],["below","",4,"ngIf"],["side","","class","h-full max-w-[30rem]",4,"ngIf"],["type","System",3,"can_edit","item"],[1,"z-10",3,"base","tabs","scrolled"],[1,"flex-1","h-1/2","w-full","overflow-auto","p-4","z-0","relative",3,"scroll"],["el",""],["below",""],["side","",1,"h-full","max-w-[30rem]"]],template:function(n,i){1&n&&(e.TgZ(0,"div",0)(1,"sidebar-menu",1),e.NdJ("openChange",function(_){return i.open_menu=_}),e.qZA(),e.TgZ(2,"div",2)(3,"div",3),e._UZ(4,"item-sidebar",4),e.TgZ(5,"div",5)(6,"item-selection",6)(7,"button",7),e.NdJ("click",function(){return i.open_menu=!0}),e._UZ(8,"app-icon",8),e.qZA()(),e.TgZ(9,"div",9),e.YNc(10,mt,6,5,"ng-container",10),e.qZA(),e.TgZ(11,"button",11),e.NdJ("click",function(){return i.newItem()}),e._UZ(12,"app-icon",12),e.qZA(),e.TgZ(13,"button",13),e.NdJ("click",function(){return i.bulkAdd()}),e.TgZ(14,"app-icon",14),e._uU(15,"playlist_add"),e.qZA()()()(),e.YNc(16,ut,1,0,"app-debug-output",15),e.qZA(),e.YNc(17,gt,1,0,"app-debug-output",16),e.qZA()),2&n&&(e.xp6(1),e.Q6J("open",i.open_menu),e.xp6(9),e.Q6J("ngIf",null==i.item?null:i.item.id),e.xp6(2),e.Q6J("className","backoffice-plus"),e.xp6(4),e.Q6J("ngIf","below"===i.debug_position),e.xp6(1),e.Q6J("ngIf","side"===i.debug_position))},dependencies:[p.O5,b.lC,N.o,_t.$,lt.z,ct.V,rt.K,at.r,dt.l,Y.gM,D.wG]})}return o})(),children:[{path:"about",component:Se},{path:"modules",component:Fe},{path:"triggers",component:De},{path:"zones",component:et},{path:"metadata",component:it},{path:"extend/:id",component:ot.z},{path:"history",component:st.D},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:"-"}];var pt=c(5858);let St=(()=>{class o{static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275mod=e.oAB({type:o});static#n=this.\u0275inj=e.cJS({imports:[p.ez,M.u5,M.UX,b.Bz.forChild(ft),pt.X,C._t]})}return o})()}}]);