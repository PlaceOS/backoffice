<div class="container">
    <section class="select">
        <button mat-button (tapped)="newDevice()">Add new</button>
        <div class="dropdown">
            <engine-item-dropdown
                [service]="module_service"
                label="Select device"
                [(model)]="new_module"
            ></engine-item-dropdown>
        </div>
        <button mat-button [disabled]="!new_module" (tapped)="addDevice()">
            Add existing
        </button>
    </section>
    <section>
        <table *ngIf="devices && devices.length > 0">
            <thead>
                <td class="small"></td>
                <td class="small"></td>
                <td class="name">Name</td>
                <td class="module">Class</td>
                <td class="ip">IP</td>
                <td class="small"></td>
            </thead>
            <tbody cdkDropList (cdkDropListDropped)="drop($event)">
                <tr
                    *ngFor="let device of (devices || [])"
                    a-context-item
                    [data]="menu_options"
                    [content]="context_menu"
                    (event)="handleContextEvent($event, device)"
                    cdkDrag
                >
                    <td class="small">
                        <div class="action grab" cdkDragHandle>
                            <i class="backoffice-select-arrows"></i>
                        </div>
                    </td>
                    <td class="small">
                        <i
                            binding
                            [(model)]="device.connected"
                            [sys]="item.id"
                            [mod]="device_classes[device.id]"
                            bind="connected"
                        ></i>
                        <div
                            class="state"
                            [class.active]="device.connected"
                            (tapped)="power(device)"
                        ></div>
                    </td>
                    <td class="name">
                        <a [routerLink]="['/devices', device.id]" routerLinkActive="router-link-active" >{{device.name}}</a>
                    </td>
                    <td class="module">
                        <a-checkbox
                            [label]="device_classes[device.id]"
                        ></a-checkbox>
                    </td>
                    <td class="ip">
                        <div class="lock">
                            <i class="backoffice-lock" *ngIf="device.tls"></i>
                        </div>
                        <a [href]="(device.tls ? 'https://' : 'http://') + device.ip">{{device.ip}}</a>
                    </td>
                    <td
                        class="small"
                        a-context-item
                        [content]="context_menu"
                        eventName="click"
                        (event)="handleContextEvent($event, device)"
                        touchrelease
                    >
                        <div class="action">
                            <i class="backoffice-dots-three-vertical"></i>
                        </div>
                    </td>
                    <td class="placeholder" colspan="6" *cdkDragPlaceholder></td>
                </tr>
            </tbody>
        </table>
        <div
            class="info-block"
            *ngIf="!devices || devices.length <= 0"
        >
            <div class="text">No devices for system</div>
        </div>
    </section>
</div>
