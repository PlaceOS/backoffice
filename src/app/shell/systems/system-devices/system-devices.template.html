<div class="container">
    <section class="select">
        <button mat-button (tapped)="newDevice()">Add new</button>
        <div class="dropdown">
            <item-search-field [service]="module_service"  (ngModelChange)="new_module = $event.id"></item-search-field>
        </div>
        <button mat-button [disabled]="!new_module" (tapped)="addDevice()">
            Add existing
        </button>
    </section>
    <section>
        <table *ngIf="devices && devices.length > 0">
            <thead>
                <td class="small"></td>
                <td class="small"></td>
                <td class="name">Name</td>
                <td class="module">Class</td>
                <td class="ip">IP</td>
                <td class="small"></td>
            </thead>
            <tbody cdkDropList (cdkDropListDropped)="drop($event)">
                <tr
                    *ngFor="let device of (devices || [])"
                    [context-menu]="menu_options"
                    (contextAction)="handleContextEvent($event, device)"
                    cdkDrag
                >
                    <td class="small">
                        <div class="action grab" cdkDragHandle>
                            <i class="backoffice-select-arrows"></i>
                        </div>
                    </td>
                    <td class="small">
                        <i
                            binding
                            [(model)]="device.connected"
                            [sys]="item.id"
                            [mod]="device_classes[device.id]"
                            bind="connected"
                        ></i>
                        <div
                            class="state"
                            [class.active]="device.connected"
                            (tapped)="power(device)"
                        ></div>
                    </td>
                    <td class="name">
                        <a
                            [routerLink]="['/devices', device.id]"
                            routerLinkActive="router-link-active"
                            >{{device.name}}</a
                        >
                    </td>
                    <td class="module">
                        <mat-checkbox>{{ device_classes[device.id] }}</mat-checkbox>
                    </td>
                    <td class="ip">
                        <div class="lock">
                            <i class="backoffice-lock" *ngIf="device.tls"></i>
                        </div>
                        <a [href]="(device.tls ? 'https://' : 'http://') + device.ip"
                            >{{device.ip}}</a
                        >
                    </td>
                    <td class="small" touchrelease>
                        <button mat-icon-button [matMenuTriggerFor]="menu">
                            <app-icon
                                [icon]="{ class: 'backoffice-dots-three-vertical' }"
                            ></app-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                            <button
                                mat-menu-item
                                *ngFor="let item of menu_options"
                                (tapped)="handleContextEvent(item, device)"
                            >
                                <app-icon [icon]="item.icon"></app-icon>
                                <div class="text">{{ item.name }}</div>
                            </button>
                        </mat-menu>
                    </td>
                    <td class="placeholder" colspan="6" *cdkDragPlaceholder></td>
                </tr>
            </tbody>
        </table>
        <div class="info-block" *ngIf="!devices || devices.length <= 0">
            <div class="text">No devices for system</div>
        </div>
    </section>
</div>
