"use strict";(self.webpackChunkbackoffice=self.webpackChunkbackoffice||[]).push([[727],{8727:(le,L,c)=>{c.r(L),c.d(L,{AppPlaceModule:()=>Zn});var r=c(6362),a=c(1876),F=c(9504),B=c(2856),S=c(1843),O=c(8537),x=c(6123),N=c(7352),R=c(1683),e=c(6723),h=c(1259);const ce=function(o){return["/admin",o]};function re(o,s){if(1&o&&(e.TgZ(0,"a",5),e._UZ(1,"app-icon",6),e.TgZ(2,"span"),e._uU(3),e.qZA()()),2&o){const t=s.$implicit;e.Q6J("routerLink",e.VKq(3,ce,t.id)),e.xp6(1),e.Q6J("icon",t.icon),e.xp6(2),e.Oqu(t.name)}}let de=(()=>{class o extends S.K{constructor(t,n,i){super(),this._settings=t,this._service=n,this._users=i,this.tab_list=[]}get extensions(){return(0,O.fq)(this._service.active_item,"admin")}get dark_mode(){return this._users.dark_mode}updateTabList(){this.tab_list=[{id:"about",name:"About",icon:{class:"backoffice-info"}},{id:"database",name:"Database",icon:{class:"backoffice-database"}},{id:"clusters",name:"Clusters",icon:{class:"backoffice-server"}},{id:"edge",name:"Edges",icon:{class:"backoffice-server"}},{id:"interfaces",name:"Interfaces",icon:{class:"backoffice-browser"}},{id:"brokers",name:"MQTT Brokers",icon:{class:"backoffice-server"}},{id:"staff-api",name:"Staff API",icon:{class:"backoffice-gist"}},{id:"extensions",name:"Extensions",icon:{class:"backoffice-gist"}},{id:"api-keys",name:"API Keys",icon:{class:"backoffice-key"}},{id:"schemas",name:"Custom Schemas",icon:{class:"backoffice-list"}}].concat(this.extensions)}ngOnInit(){this._settings.title="Admin",this.updateTabList()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(N.g),e.Y36(x.L),e.Y36(R.w))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-engine"]],features:[e.qOj],decls:7,vars:1,consts:[[1,"h-16","p-4","text-2xl","bg-white","border-b","border-gray-400","border-opacity-30","shadow","z-10","dark:text-white","dark:bg-greyer"],[1,"flex","flex-1","z-0","h-1/2","dark:text-white"],[1,"relative","w-64","h-full","bg-white","border-r","border-gray-400","border-opacity-30","shadow","z-10","dark:bg-greyer"],["class","flex items-center space-x-2 my-2 rounded-l-2xl h-8 px-3 ml-3 hover:bg-primary hover:bg-opacity-25","routerLinkActive","active",3,"routerLink",4,"ngFor","ngForOf"],[1,"relative","flex-1","w-1/2","h-full","z-0","bg-white","px-4","dark:text-white","dark:bg-grey"],["routerLinkActive","active",1,"flex","items-center","space-x-2","my-2","rounded-l-2xl","h-8","px-3","ml-3","hover:bg-primary","hover:bg-opacity-25",3,"routerLink"],[3,"icon"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._uU(1," PlaceOS Admin "),e.qZA(),e.TgZ(2,"div",1)(3,"div",2),e.YNc(4,re,4,5,"a",3),e.qZA(),e.TgZ(5,"div",4),e._UZ(6,"router-outlet"),e.qZA()()),2&t&&(e.xp6(4),e.Q6J("ngForOf",n.tab_list))},directives:[r.sg,F.yS,F.Od,h.o,F.lC],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%}.active[_ngcontent-%COMP%]{background-color:#c2185b!important;color:#fff;margin-right:-1px}\n/*# sourceMappingURL=engine.component.ts-angular-inline--61.css.map*/"]}),o})();var d=c(3698);let me=(()=>{class o extends S.K{reindex(t=!0){const n=`${(0,d._ds)()}/reindex${t?"?backfill=true":""}`;return(0,d.v_Q)(n,null).toPromise()}backfill(){const t=`${(0,d._ds)()}/backfill`;return(0,d.v_Q)(t,null).toPromise()}}return o.\u0275fac=function(){let s;return function(n){return(s||(s=e.n5z(o)))(n||o)}}(),o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var p=c(2016),P=c(1961),C=c(7317),y=c(4742);function pe(o,s){1&o&&(e.ynx(0),e._uU(1,"Re-index"),e.BQk())}function ue(o,s){1&o&&(e.ynx(0),e._uU(1,"Backfill"),e.BQk())}function fe(o,s){1&o&&(e.TgZ(0,"div",3),e._UZ(1,"mat-spinner",4),e.qZA())}let ge=(()=>{class o{constructor(t){this._engine_service=t}reindex(){this.reindexing=!0,this._engine_service.reindex().then(()=>this.reindexing=!1,t=>{this.reindexing=!1,(0,p.cB)(`Error reindexing database. Error: ${JSON.stringify(t.response||t.message||t)}`)})}backfill(){this.backfilling=!0,this._engine_service.backfill().then(()=>this.backfilling=!1,t=>{this.backfilling=!1,(0,p.cB)(`Error reindexing database. Error: ${JSON.stringify(t.response||t.message||t)}`)})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(me))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-database-details"]],decls:18,vars:6,consts:[["mat-button","",3,"disabled","click"],[4,"ngIf","ngIfElse"],["spinner",""],[1,"flex","justify-center","w-full","my-1"],["diameter","32"]],template:function(t,n){if(1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-content"),e._uU(2," Re-index elasticsearch for the "),e._UZ(3,"br"),e._uU(4,"current state of the database "),e.qZA(),e.TgZ(5,"mat-card-actions")(6,"button",0),e.NdJ("click",function(){return n.reindex()}),e.YNc(7,pe,2,0,"ng-container",1),e.qZA()()(),e.TgZ(8,"mat-card")(9,"mat-card-content"),e._uU(10," Backfill elasticsearch with the"),e._UZ(11,"br"),e._uU(12," current state of the database "),e.qZA(),e.TgZ(13,"mat-card-actions")(14,"button",0),e.NdJ("click",function(){return n.backfill()}),e.YNc(15,ue,2,0,"ng-container",1),e.qZA()()(),e.YNc(16,fe,2,0,"ng-template",null,2,e.W1O)),2&t){const i=e.MAs(17);e.xp6(6),e.Q6J("disabled",n.reindexing),e.xp6(1),e.Q6J("ngIf",!n.reindexing)("ngIfElse",i),e.xp6(7),e.Q6J("disabled",n.backfilling),e.xp6(1),e.Q6J("ngIf",!n.backfilling)("ngIfElse",i)}},directives:[P.a8,P.dn,P.hq,C.lW,r.O5,y.Ou],styles:["[_nghost-%COMP%]{padding:1em;display:flex;flex-wrap:wrap}button[_ngcontent-%COMP%]{min-width:10em;margin:.25em}mat-card[_ngcontent-%COMP%]{margin:.5em;text-align:center}\n/*# sourceMappingURL=database-details.component.ts-angular-inline--62.css.map*/"]}),o})();var M=c(6933),he=c(8086),U=c(2395),te=c(8559),u=c(5758);function Ce(o,s){if(1&o){const t=e.EpF();e.tHW(0,14,1),e.TgZ(1,"button",18),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return i.changelog(i.changelog_data)}),e.qZA(),e.N_p()}}function Ae(o,s){if(1&o&&(e.TgZ(0,"div",19)(1,"h3",20),e._uU(2),e.qZA(),e.TgZ(3,"div",21)(4,"label",22),e._uU(5,"Commit Hash:"),e.qZA(),e.TgZ(6,"div",23),e._uU(7),e.qZA()(),e.TgZ(8,"div",21)(9,"label",22),e._uU(10,"Version:"),e.qZA(),e.TgZ(11,"div",23),e._uU(12),e.qZA()(),e.TgZ(13,"div",21)(14,"label",22),e._uU(15,"Build time:"),e.qZA(),e.TgZ(16,"div",24),e._uU(17),e.qZA()(),e.TgZ(18,"div",25)(19,"label",22),e._uU(20,"Platform:"),e.qZA(),e.TgZ(21,"div",23),e._uU(22),e.qZA()()()),2&o){const t=s.$implicit;e.xp6(2),e.hij(" ",t.service," "),e.xp6(5),e.hij(" ",t.commit," "),e.xp6(5),e.hij(" ",t.version," "),e.xp6(5),e.Oqu(t.build_time),e.xp6(5),e.hij(" ",t.platform_version," ")}}let Ee=(()=>{class o extends S.K{constructor(t,n){super(),this._users=t,this._dialog=n,this.changelog_data=""}get user(){return this._users.user}get backoffice_version(){return(null==M.q?void 0:M.q.tag)||""}get backoffice_hash(){return(null==M.q?void 0:M.q.hash)||""}get backoffice_build(){return`${(0,te.Z)(M.q.time,"dd MMM yyyy")} at ${(0,te.Z)(M.q.time," h:mma")}`}ngOnInit(){this.loadApiDetails(),this.loadPlatformDetails()}changelog(t){this._dialog.open(he.n,{data:{changelog:t}})}copy(t,n){(0,U.vQ)(n),(0,p.QD)(`Copied ${t} to clipboard`)}loadApiDetails(){(0,d.U2M)(`${(0,d._ds)()}/cluster/versions`).toPromise().then(t=>this.api_details=t,t=>(0,p.cB)(`Error loading API details. Error: ${JSON.stringify(t.response||t.message||t)}`))}loadPlatformDetails(){(0,d.U2M)(`${(0,d._ds)()}/platform`).toPromise().then(t=>this.changelog_data=t.changelog.replace("# Changelog\n\n",""),t=>(0,p.cB)(`Error loading API details. Error: ${JSON.stringify(t.response||t.message||t)}`))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(R.w),e.Y36(u.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-engine-details"]],features:[e.qOj],decls:23,vars:5,consts:function(){let s,t,n,i,_;return s=$localize`:@@backoffice␟f15da484530fe89db8e06a17ee783ba2182ce593␟8046151527921290223:Backoffice`,t=$localize`:@@version␟ca17606ffe979fb5b411861280c33d2ad3e7a216␟6791662619770759914:Version:`,n=$localize`:@@commitHash␟d7f702c34df541537a2a188810a28d361a2cb09e␟8250617165434775274:Commit Hash:`,i=$localize`:@@buildTime␟401b32daa4e71a24498df7b26a72153805508074␟2870652620203683834:Build:`,_=$localize`:@@apiHeader␟cc9971b464ecdb2a245c9f893522ab8d15ec7772␟2896800999683306287: API ${"\ufffd*20:1\ufffd\ufffd#1:1\ufffd"}:START_TAG_BUTTON:View Changelog${"\ufffd/#1:1\ufffd\ufffd/*20:1\ufffd"}:CLOSE_TAG_BUTTON:`,[[1,"text-lg","font-medium"],s,[1,"space-y-2","mb-4","flex","flex-col","px-2"],[1,"flex","items-center"],["for","version",1,"w-24"],t,["name","version",1,"bg-gray-300/60","rounded","p-1","text-xs","mono","flex","items-center",3,"click"],["for","hash",1,"w-24"],n,["name","hash",1,"bg-gray-300/60","rounded","p-1","text-xs","mono","flex","items-center",3,"click"],["for","build-time",1,"w-24"],i,["name","build-time",1,"text-sm",3,"click"],[1,"text-lg","font-medium","flex","items-center"],_,["class","p-2 text-xs underline",3,"click",4,"ngIf"],[1,"flex","flex-wrap","py-2"],["class","bg-white dark:bg-[#424242] rounded shadow m-2 min-w-[40%] flex-1 overflow-hidden",4,"ngFor","ngForOf"],[1,"p-2","text-xs","underline",3,"click"],[1,"bg-white","dark:bg-[#424242]","rounded","shadow","m-2","min-w-[40%]","flex-1","overflow-hidden"],[1,"w-full","px-4","py-2","mb-1","border-b","border-gray-200","dark:border-white/20"],[1,"flex","items-center","px-4","py-1","hover:bg-gray-400/20"],[1,"w-24"],[1,"bg-gray-300/60","rounded","p-1","text-xs","mono"],[1,"text-sm"],[1,"flex","items-center","px-4","py-1","hover:bg-gray-400/20","mb-1"]]},template:function(t,n){1&t&&(e.TgZ(0,"h3",0),e.SDv(1,1),e.qZA(),e.TgZ(2,"section",2)(3,"div",3)(4,"label",4),e.SDv(5,5),e.qZA(),e.TgZ(6,"div",6),e.NdJ("click",function(){return n.copy("version",n.backoffice_version)}),e._uU(7),e.qZA()(),e.TgZ(8,"div",3)(9,"label",7),e.SDv(10,8),e.qZA(),e.TgZ(11,"div",9),e.NdJ("click",function(){return n.copy("hash",n.backoffice_hash)}),e._uU(12),e.qZA()(),e.TgZ(13,"div",3)(14,"label",10),e.SDv(15,11),e.qZA(),e.TgZ(16,"div",12),e.NdJ("click",function(){return n.copy("build time",n.backoffice_build)}),e._uU(17),e.qZA()()(),e.TgZ(18,"h3",13),e.tHW(19,14),e.YNc(20,Ce,2,0,"button",15),e.N_p(),e.qZA(),e.TgZ(21,"section",16),e.YNc(22,Ae,23,5,"div",17),e.qZA()),2&t&&(e.xp6(7),e.hij(" ",n.backoffice_version," "),e.xp6(5),e.hij(" ",n.backoffice_hash," "),e.xp6(5),e.hij(" ",n.backoffice_build," "),e.xp6(3),e.Q6J("ngIf",n.changelog_data),e.xp6(2),e.Q6J("ngForOf",n.api_details))},directives:[r.O5,r.sg],styles:["[_nghost-%COMP%]{position:absolute;top:0;left:0;padding:1rem;width:100%;height:100%;overflow:auto}\n/*# sourceMappingURL=details.component.ts-angular-inline--63.css.map*/"]}),o})();var ve=c(9151),ne=c(8759),D=c(9095),E=c(6942),$=c(7418),Te=c(3491),Se=c(2088);const Oe=["chart"];let xe=(()=>{class o{constructor(){this.points=[]}get used_memory(){var t;return(0,d.VDv)(1024*((null===(t=this.node)||void 0===t?void 0:t.memory_usage)||0))}get total_memory(){var t;return(0,d.VDv)(1024*((null===(t=this.node)||void 0===t?void 0:t.memory_total)||0))}get memory_percentage(){var t,n;return((null===(t=this.node)||void 0===t?void 0:t.memory_usage)||0)/((null===(n=this.node)||void 0===n?void 0:n.memory_total)||1)*100}ngOnInit(){this.generateCharts()}ngOnChanges(t){t.history&&this.history&&this.generateCharts()}generateCharts(){const t=[...this.history];for(;t.length<12;)t.unshift({});const n=t.slice(Math.max(0,t.length-12)).map((i,_)=>({x:_,y:i.value||0}));this.points=[...n]}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["admin-cluster-node"]],viewQuery:function(t,n){if(1&t&&e.Gf(Oe,7),2&t){let i;e.iGM(i=e.CRH())&&(n._chart_el=i.first)}},inputs:{node:"node",history:"history"},features:[e.TTD],decls:15,vars:6,consts:function(){let s,t;return s=$localize`:@@cluserMemoryUsed␟815de8480fe5cfeb9901a306873590d38168a754␟3965710386570662641:Memory Used`,t=$localize`:@@clusterCpuUsage␟6e5f806667d8c63b5716b1959c0cf07babd739f1␟3236008470518102616:CPU Usage`,[[1,"mb-2","h-40","w-64"],["basic-line-graph","",3,"points"],[1,"memory-utilisation"],[1,"flex","items-center","space-x-2","p-2"],s,[1,"value"],[1,"flex","items-center","space-x-2","bg-black","bg-opacity-5","rounded","p-2"],t]},template:function(t,n){1&t&&(e.TgZ(0,"h4"),e._uU(1),e.qZA(),e.TgZ(2,"div",0),e._UZ(3,"div",1),e.qZA(),e.TgZ(4,"div",2)(5,"div",3)(6,"label"),e.SDv(7,4),e.qZA(),e.TgZ(8,"div",5),e._uU(9),e.qZA()(),e.TgZ(10,"div",6)(11,"label"),e.SDv(12,7),e.qZA(),e.TgZ(13,"div",5),e._uU(14),e.qZA()()()),2&t&&(e.xp6(1),e.Oqu(null==n.node?null:n.node.hostname),e.xp6(2),e.Q6J("points",n.points),e.xp6(6),e.lnq(" ",n.used_memory," / ",n.total_memory," (",n.memory_percentage.toFixed(2),"%) "),e.xp6(5),e.hij("",null==n.node?null:n.node.total_cpu,"%"))},directives:[Se.C],encapsulation:2}),o})();const Ne=function(){return[]};function Pe(o,s){if(1&o&&(e.ynx(0),e._UZ(1,"admin-cluster-node",1),e.BQk()),2&o){const t=s.$implicit,n=e.oxw();e.xp6(1),e.Q6J("node",t)("history",n.cpu_history[t.hostname]||e.DdM(2,Ne))}}let ye=(()=>{class o{constructor(){this.cpu_history={}}ngOnChanges(t){t.cluster&&this.cluster&&(this.cluster_nodes=[this.cluster,...this.cluster.edge_nodes],this.cpu_history=this.cpu_history||{})}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["engine-cluster-item"]],inputs:{cluster:"cluster",cpu_history:"cpu_history"},features:[e.TTD],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"node","history"]],template:function(t,n){1&t&&e.YNc(0,Pe,2,3,"ng-container",0),2&t&&e.Q6J("ngForOf",n.cluster_nodes)},directives:[r.sg,xe],styles:[""]}),o})();var K=c(9431),Me=c(9429);const be=function(){return{class:"backoffice-trash"}};function Ze(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",13),e._UZ(1,"div",14),e.ALo(2,"driverFormat"),e.TgZ(3,"div",8),e._uU(4),e.qZA(),e.TgZ(5,"div",8),e._uU(6),e.qZA(),e.TgZ(7,"div",8),e._uU(8),e.qZA(),e.TgZ(9,"div",15)(10,"button",1),e.NdJ("click",function(){const _=e.CHM(t).$implicit;return e.oxw().confirmKillProcess(_)}),e._UZ(11,"app-icon",2),e.qZA()()()}if(2&o){const t=s.$implicit;e.xp6(1),e.Q6J("innerHTML",e.lcZ(2,5,t.id),e.oJD),e.xp6(3),e.hij(" ",t.cpu_usage.toFixed(2),"% "),e.xp6(2),e.Oqu(t.used_memory),e.xp6(2),e.Oqu(t.module_instances),e.xp6(3),e.Q6J("icon",e.DdM(7,be))}}function Ie(o,s){1&o&&(e.TgZ(0,"div",16)(1,"p"),e.SDv(2,17),e.qZA()())}const Fe=function(){return{type:"icon",class:"backoffice-arrow-left"}};let Ue=(()=>{class o extends S.K{constructor(t){super(),this._dialog=t,this.close=new e.vpe,this.process_list=[],this.column_list=["id","cpu_usage","memory_usage","module_instances","running"]}ngOnInit(){this.loadProcesses(),this.interval("load_tasks",()=>this.loadProcesses(),2e3)}confirmKillProcess(t){const n=this._dialog.open(K.z,Object.assign(Object.assign({},K.t),{data:{title:"Kill process",content:`\n                    <p>Are you sure you want kill the process for "${t.id}"?</p>\n                    <p>The process will be terminated <strong>immediately</strong>.\n                    The process may be restarted after a short while.</p>\n                `,icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("confirm_kill",n.componentInstance.event.subscribe(i=>{"done"===i.reason&&(this.killing=t.id,n.componentInstance.loading="Processing request...",this.killProcess(t).then(()=>{this.killing=null,n.close()},_=>{n.componentInstance.loading=null,this.killing=null,(0,p.cB)(`Error killing process. Error: ${JSON.stringify(_.response||_.message||_)}`),n.close()}))}))}killProcess(t){return(0,d.qx2)(this.cluster.id,t.id).toPromise()}loadProcesses(){this.loading=!0,(0,d.X8f)(this.cluster.id,{include_status:!0}).subscribe(t=>{this.process_list=t||[],this.loading=!1})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(u.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["engine-cluster-task-list"]],inputs:{cluster:"cluster"},outputs:{close:"close"},features:[e.qOj],decls:19,vars:5,consts:function(){let s,t;return s=$localize`:@@clusterHeader␟2837d97a9e0e3c660f026394ec40fe8e4ba4e592␟2012083462068270549: Cluster - ${"\ufffd0\ufffd"}:INTERPOLATION: `,t=$localize`:@@processTableEmpty␟9f96a52f0ede1cccf0177605958427b397bea944␟702517565059377669:No tasks running on cluster`,[[1,"flex","items-center","mb-4"],["mat-icon-button","",3,"click"],[3,"icon"],[1,"text-lg","font-medium"],s,["role","table",1,"h-1/2","flex-1"],["table-head",""],[1,"flex-1","p-2"],[1,"w-24","p-2"],[1,"w-12","p-2"],["table-body",""],["table-row","",4,"ngFor","ngForOf"],["class","flex flex-col items-center p-8",4,"ngIf"],["table-row",""],[1,"flex-1","p-2",3,"innerHTML"],[1,"w-12","flex","items-center","justify-center"],[1,"flex","flex-col","items-center","p-8"],t]},template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return n.close.emit()}),e._UZ(2,"app-icon",2),e.qZA(),e.TgZ(3,"h3",3),e.SDv(4,4),e.qZA()(),e.TgZ(5,"div",5)(6,"div",6)(7,"div",7),e._uU(8,"Name"),e.qZA(),e.TgZ(9,"div",8),e._uU(10,"CPU %"),e.qZA(),e.TgZ(11,"div",8),e._uU(12,"Memory"),e.qZA(),e.TgZ(13,"div",8),e._uU(14,"Instances"),e.qZA(),e._UZ(15,"div",9),e.qZA(),e.TgZ(16,"div",10),e.YNc(17,Ze,12,8,"div",11),e.qZA()(),e.YNc(18,Ie,3,0,"div",12)),2&t&&(e.xp6(2),e.Q6J("icon",e.DdM(4,Fe)),e.xp6(2),e.pQV(null==n.cluster?null:n.cluster.hostname),e.QtT(4),e.xp6(13),e.Q6J("ngForOf",n.process_list),e.xp6(1),e.Q6J("ngIf",!n.process_list||!n.process_list.length))},directives:[C.lW,h.o,r.sg,r.O5],pipes:[Me.X],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1rem;height:100%;width:100%}\n/*# sourceMappingURL=cluster-task-list.component.ts-angular-inline--73.css.map*/"]}),o})();const ke=function(){return[]};function Re(o,s){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"mat-card",4)(2,"mat-card-header")(3,"mat-card-title",5),e._uU(4),e.qZA()(),e.TgZ(5,"mat-card-content"),e._UZ(6,"engine-cluster-item",6),e.qZA(),e.TgZ(7,"mat-card-actions")(8,"button",7),e.NdJ("click",function(){const _=e.CHM(t).$implicit;return e.oxw(3).active_cluster=_}),e.SDv(9,8),e.qZA()()(),e.BQk()}if(2&o){const t=s.$implicit,n=e.oxw(3);e.xp6(4),e.hij("",t.hostname||"Undefined Cluster"," "),e.xp6(2),e.Q6J("cluster",t)("cpu_history",n.cpu_history[t.id]||e.DdM(3,ke))}}function De(o,s){if(1&o&&(e.ynx(0),e.YNc(1,Re,10,4,"ng-container",3),e.BQk()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.cluster_list)}}function we(o,s){if(1&o&&(e.ynx(0),e.YNc(1,De,2,1,"ng-container",0),e.BQk()),2&o){const t=e.oxw(),n=e.MAs(4);e.xp6(1),e.Q6J("ngIf",!t.active_cluster)("ngIfElse",n)}}const Le=function(){return{class:"backoffice-cross"}};function qe(o,s){1&o&&(e.TgZ(0,"div",9),e._UZ(1,"app-icon",10),e.TgZ(2,"div",11),e.SDv(3,12),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("icon",e.DdM(1,Le)))}function Be(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"engine-cluster-task-list",13),e.NdJ("close",function(){return e.CHM(t),e.oxw().active_cluster=null}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("cluster",t.active_cluster)}}let $e=(()=>{class o extends S.K{constructor(){super(...arguments),this.cluster_list=[],this.cpu_history={},this.clusters$=(0,Te.F)(2e3).pipe((0,ve.h)(()=>!this.active_cluster),(0,ne.b)(()=>this.loading=!0),(0,D.w)(()=>(0,d.rEJ)({include_status:!0})),(0,E.U)(t=>t.data),(0,$.K)(t=>[]),(0,E.U)(t=>{this.cluster_list=t||[];const n=Date.now();this.cluster_list.forEach(i=>{this.cpu_history[i.id]||(this.cpu_history[i.id]={});const _=[i,...i.edge_nodes];for(const l of _)this.cpu_history[i.id][l.hostname]||(this.cpu_history[i.id][l.hostname]=[]),this.cpu_history[i.id][l.hostname].push({id:n,value:l.core_cpu}),this.cpu_history[i.id][l.hostname].length>120&&this.cpu_history[i.id][l.hostname].shift()})}),(0,ne.b)(()=>this.loading=!1))}ngOnInit(){this.subscription("load_cluster",this.clusters$.subscribe())}}return o.\u0275fac=function(){let s;return function(n){return(s||(s=e.n5z(o)))(n||o)}}(),o.\u0275cmp=e.Xpm({type:o,selectors:[["engine-cluster-details"]],features:[e.qOj],decls:5,vars:2,consts:function(){let s,t;return s=$localize`:@@viewClusterProcesses␟98b5b5888e2159cd2cf3ea350a64b6e03d5e7572␟4310237000483500177: View Processes `,t=$localize`:@@clusterListEmpty␟d2439117e1e3b740500ee9adc477711383f33d30␟7110510397716287271: No Cluster details to show `,[[4,"ngIf","ngIfElse"],["empty_state",""],["process_state",""],[4,"ngFor","ngForOf"],[1,"m-2","text-center"],["clas","capitalize"],[3,"cluster","cpu_history"],["mat-button","",3,"click"],s,[1,"absolute","inset-0","flex","flex-col","items-center","p-8","space-y-2"],[1,"text-3xl",3,"icon"],[1,"text"],t,[3,"cluster","close"]]},template:function(t,n){if(1&t&&(e.YNc(0,we,2,2,"ng-container",0),e.YNc(1,qe,4,2,"ng-template",null,1,e.W1O),e.YNc(3,Be,1,1,"ng-template",null,2,e.W1O)),2&t){const i=e.MAs(2);e.Q6J("ngIf",n.cluster_list&&n.cluster_list.length)("ngIfElse",i)}},directives:[r.O5,r.sg,P.a8,P.dk,P.n5,P.dn,ye,P.hq,C.lW,h.o,Ue],styles:["[_nghost-%COMP%]{display:flex;flex-wrap:wrap;height:100%;width:100%}\n/*# sourceMappingURL=cluster-details.component.ts-angular-inline--64.css.map*/"]}),o})();var f=c(4929);function Ke(o,s){if(1&o&&(e.TgZ(0,"div",8)(1,"div",4),e._uU(2),e.qZA(),e.TgZ(3,"div",5)(4,"code"),e._uU(5),e.qZA()()()),2&o){const t=s.$implicit;e.xp6(2),e.Oqu(t.id),e.xp6(3),e.hij(" ",t.name||"~No Commit Hash~"," ")}}function Je(o,s){if(1&o&&(e.TgZ(0,"div",2)(1,"div",3)(2,"div",4),e._uU(3,"Repository"),e.qZA(),e.TgZ(4,"div",5),e._uU(5,"Commit Hash"),e.qZA()(),e.TgZ(6,"div",6),e.YNc(7,Ke,6,2,"div",7),e.qZA()()),2&o){const t=e.oxw();e.xp6(7),e.Q6J("ngForOf",t.interfaces)}}function Xe(o,s){1&o&&(e.TgZ(0,"div",9),e._UZ(1,"app-icon",10),e.TgZ(2,"p"),e._uU(3,"No interfaces"),e.qZA()())}let Ge=(()=>{class o{constructor(){this.interfaces=[]}ngOnInit(){this.loadInterfaces()}loadInterfaces(){return(0,f.mG)(this,void 0,void 0,function*(){const t=yield(0,d.BmL)().toPromise();this.interfaces=Object.keys(t).map(n=>({id:n,name:t[n]}))})}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-interfaces"]],decls:3,vars:2,consts:[["role","table",4,"ngIf","ngIfElse"],["load_state",""],["role","table"],["table-head",""],[1,"flex-1","p-2"],[1,"w-[20rem]","p-2"],["table-body",""],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"flex","flex-col","items-center","p-8"],["className","backoffice-cross",1,"mb-4"]],template:function(t,n){if(1&t&&(e.YNc(0,Je,8,1,"div",0),e.YNc(1,Xe,4,0,"ng-template",null,1,e.W1O)),2&t){const i=e.MAs(2);e.Q6J("ngIf",n.interfaces&&n.interfaces.length)("ngIfElse",i)}},directives:[r.O5,r.sg,h.o],styles:["[_nghost-%COMP%]{padding:1rem;width:100%;height:100%}\n/*# sourceMappingURL=interfaces.component.ts-angular-inline--65.css.map*/"]}),o})();var oe=c(3082);const Qe=function(){return{class:"backoffice-edit"}},Ye=function(){return{class:"backoffice-trash"}};function je(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",16)(1,"div",9),e._uU(2),e.qZA(),e.TgZ(3,"div",10),e._uU(4," "),e.SDv(5,17),e._uU(6," "),e.qZA(),e.TgZ(7,"div",11),e._uU(8),e.qZA(),e.TgZ(9,"div",12),e._uU(10),e.qZA(),e.TgZ(11,"div",13),e._uU(12),e.qZA(),e.TgZ(13,"div",13),e._uU(14," "),e.SDv(15,18),e._uU(16," "),e.qZA(),e.TgZ(17,"div",9),e._uU(18),e.ALo(19,"json"),e.qZA(),e.TgZ(20,"div",19)(21,"button",20),e.NdJ("click",function(){const _=e.CHM(t).$implicit;return e.oxw(2).editBroker(_)}),e._UZ(22,"app-icon",21),e.qZA(),e.TgZ(23,"button",20),e.NdJ("click",function(){const _=e.CHM(t).$implicit;return e.oxw(2).deleteBroker(_)}),e._UZ(24,"app-icon",21),e.qZA()()()}if(2&o){const t=s.$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(3),e.pQV(t.auth_type),e.QtT(5),e.xp6(3),e.Oqu(t.description),e.xp6(2),e.Oqu(t.host),e.xp6(2),e.Oqu(t.port),e.xp6(3),e.pQV(t.tls),e.QtT(15),e.xp6(3),e.Oqu(e.lcZ(19,9,t.filters)),e.xp6(4),e.Q6J("icon",e.DdM(11,Qe)),e.xp6(2),e.Q6J("icon",e.DdM(12,Ye))}}function He(o,s){if(1&o&&(e.TgZ(0,"div",7)(1,"div",8)(2,"div",9),e._uU(3,"Name"),e.qZA(),e.TgZ(4,"div",10),e._uU(5,"Auth Type"),e.qZA(),e.TgZ(6,"div",11),e._uU(7,"Description"),e.qZA(),e.TgZ(8,"div",12),e._uU(9,"Host"),e.qZA(),e.TgZ(10,"div",13),e._uU(11,"Port"),e.qZA(),e.TgZ(12,"div",13),e._uU(13,"TLS"),e.qZA(),e.TgZ(14,"div",9),e._uU(15,"Filters"),e.qZA(),e._UZ(16,"div",10),e.qZA(),e.TgZ(17,"div",14),e.YNc(18,je,25,13,"div",15),e.qZA()()),2&o){const t=e.oxw();e.xp6(18),e.Q6J("ngForOf",t.brokers)}}function ze(o,s){1&o&&(e.TgZ(0,"div",22)(1,"p"),e._uU(2,"No Brokers"),e.qZA()())}let We=(()=>{class o extends S.K{constructor(t){super(),this._dialog=t,this.brokers=[]}ngOnInit(){this.loadBrokers()}newBroker(){const t=this._dialog.open(oe.K,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new d.w4u,name:"Broker",save:n=>(0,d.z0G)(n)}});this.subscription("modal_events",t.componentInstance.event.subscribe(n=>{"done"===n.reason&&this.loadBrokers()}))}editBroker(t){const n=this._dialog.open(oe.K,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:t,name:"Broker",save:i=>(0,d.VTA)(i.id,i)}});this.subscription("modal_events",n.componentInstance.event.subscribe(i=>{"done"===i.reason&&this.loadBrokers()}))}deleteBroker(t){return(0,f.mG)(this,void 0,void 0,function*(){if(t){const n=yield(0,U._5)({title:"Delete MQTT Broker",content:"<p>Are you sure you want delete this boker?</p><p>The broker will be deleted <strong>immediately.</strong></p>",icon:{type:"icon",class:"backoffice-trash"}},this._dialog);if(!n)return;n.loading("Deleting broker...");const i=yield(0,d.bws)(t.id).toPromise().catch(_=>_);if(n.close(),i)return(0,p.cB)(`Error deleting broker. Error: ${JSON.stringify(i.response||i.message||i)}`);(0,p.t5)(`Successfully deleted broker "${t.name}".`),this.loadBrokers()}})}loadBrokers(){return(0,f.mG)(this,void 0,void 0,function*(){const t=yield(0,d.zOf)().pipe((0,E.U)(n=>n.data)).toPromise();this.brokers=t})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(u.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-brokers"]],features:[e.qOj],decls:9,vars:2,consts:function(){let s,t;return s=$localize`:␟adee30e7ac4fc6cea612033aa0e36fbd638bf9ac␟6259518065458203177:{VAR_SELECT, select, 0 {Certificate } , 2 {User Password } , other {No Auth }}`,s=e.Zx4(s,{VAR_SELECT:"\ufffd0\ufffd"}),t=$localize`:␟9a505795a50d2999edad754aef444307458115f7␟8318225782441593222:{VAR_SELECT, select, true {Yes } , false {No }}`,t=e.Zx4(t,{VAR_SELECT:"\ufffd0\ufffd"}),[["mat-button","",1,"my-4",3,"click"],[1,"flex","items-center"],["className","backoffice-plus"],[1,"text"],[1,"overflow-auto"],["role","table","class","min-w-[52rem]",4,"ngIf","ngIfElse"],["load_state",""],["role","table",1,"min-w-[52rem]"],["table-head",""],[1,"w-32","p-2"],[1,"w-24","p-2"],[1,"flex-1","p-2"],[1,"w-32","p-2","truncate"],[1,"w-16","p-2"],["table-body",""],["table-row","",4,"ngFor","ngForOf"],["table-row",""],s,t,[1,"w-24","p-2","flex","items-center"],["mat-icon-button","",3,"click"],[3,"icon"],[1,"flex","flex-col","items-center"]]},template:function(t,n){if(1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return n.newBroker()}),e.TgZ(1,"div",1),e._UZ(2,"app-icon",2),e.TgZ(3,"div",3),e._uU(4,"Add Broker"),e.qZA()()(),e.TgZ(5,"div",4),e.YNc(6,He,19,1,"div",5),e.qZA(),e.YNc(7,ze,3,0,"ng-template",null,6,e.W1O)),2&t){const i=e.MAs(8);e.xp6(6),e.Q6J("ngIf",n.brokers&&n.brokers.length)("ngIfElse",i)}},directives:[C.lW,h.o,r.O5,r.sg],pipes:[r.Ts],styles:["[_nghost-%COMP%]{padding:1rem}\n/*# sourceMappingURL=brokers.component.ts-angular-inline--66.css.map*/"]}),o})();var Ve=c(9960),J=c(5670),et=c(1155),v=c(4770),b=c(1434),Z=c(1130),w=c(4683);const tt=function(){return{type:"icon",class:"backoffice-cross"}};function nt(o,s){1&o&&(e.TgZ(0,"button",5),e._UZ(1,"app-icon",6),e.qZA()),2&o&&(e.xp6(1),e.Q6J("icon",e.DdM(1,tt)))}function ot(o,s){if(1&o&&(e.TgZ(0,"mat-option",26)(1,"span",27),e._uU(2),e.qZA()()),2&o){const t=s.$implicit;e.Q6J("value",t),e.xp6(2),e.Oqu(t)}}function it(o,s){1&o&&(e.TgZ(0,"label"),e._uU(1,"Conditions"),e.qZA())}function st(o,s){if(1&o&&(e.TgZ(0,"mat-option",26)(1,"span",27),e._uU(2),e.qZA()()),2&o){const t=s.$implicit;e.Q6J("value",t),e.xp6(2),e.Oqu(t)}}const X=function(){return{standalone:!0}},_t=function(){return{class:"backoffice-cross"}};function at(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",8)(1,"div",9)(2,"mat-form-field",12)(3,"input",28),e.NdJ("ngModelChange",function(i){return e.CHM(t).$implicit[0]=i}),e.qZA()()(),e.TgZ(4,"div",9)(5,"mat-form-field",12)(6,"mat-select",29),e.NdJ("ngModelChange",function(i){return e.CHM(t).$implicit[1]=i}),e.YNc(7,st,3,2,"mat-option",14),e.qZA()()(),e.TgZ(8,"div",9)(9,"mat-form-field",12)(10,"input",30),e.NdJ("ngModelChange",function(i){return e.CHM(t).$implicit[2]=i}),e.qZA()()(),e.TgZ(11,"button",31),e.NdJ("click",function(){const _=e.CHM(t).$implicit;return e.oxw(2).removeCondition(_)}),e._UZ(12,"app-icon",6),e.qZA()()}if(2&o){const t=s.$implicit,n=e.oxw(2);e.xp6(3),e.Q6J("ngModel",t[0])("ngModelOptions",e.DdM(9,X)),e.xp6(3),e.Q6J("ngModel",t[1])("ngModelOptions",e.DdM(10,X)),e.xp6(1),e.Q6J("ngForOf",n.condition_ops),e.xp6(3),e.Q6J("disabled","truthy"===t[1]||"falsy"===t[1])("ngModel",t[2])("ngModelOptions",e.DdM(11,X)),e.xp6(2),e.Q6J("icon",e.DdM(12,_t))}}function lt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",7)(1,"div",8)(2,"div",9)(3,"label",10),e.tHW(4,11),e._UZ(5,"span"),e.N_p(),e.qZA(),e.TgZ(6,"mat-form-field",12)(7,"mat-select",13),e.YNc(8,ot,3,2,"mat-option",14),e.qZA()()(),e.TgZ(9,"div",9)(10,"label",15),e.tHW(11,16),e._UZ(12,"span"),e.N_p(),e.qZA(),e.TgZ(13,"mat-form-field",12),e._UZ(14,"input",17),e.TgZ(15,"mat-error"),e.SDv(16,18),e.qZA()()()(),e.TgZ(17,"div",9)(18,"label",19),e.tHW(19,20),e._UZ(20,"span"),e.N_p(),e.qZA(),e.TgZ(21,"mat-form-field",12),e._UZ(22,"input",21),e.TgZ(23,"mat-error"),e.SDv(24,22),e.qZA()()(),e.TgZ(25,"div",23),e.YNc(26,it,2,0,"label",3),e.YNc(27,at,13,13,"div",24),e.TgZ(28,"button",25),e.NdJ("click",function(){return e.CHM(t),e.oxw().addCondition()}),e._uU(29,"Add Condition"),e.qZA()()()}if(2&o){const t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(8),e.Q6J("ngForOf",t.available_types),e.xp6(18),e.Q6J("ngIf",null==t.form.controls.conditions.value?null:t.form.controls.conditions.value.length),e.xp6(1),e.Q6J("ngForOf",t.form.controls.conditions.value)}}function ct(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"mat-dialog-actions")(1,"button",32),e._uU(2,"Cancel"),e.qZA(),e.TgZ(3,"button",33),e.NdJ("click",function(){return e.CHM(t),e.oxw().submit()}),e._uU(4),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(4),e.hij("",t.item?"Save":"Add"," [S]")}}function rt(o,s){1&o&&(e.TgZ(0,"div",34)(1,"div",35)(2,"div",36),e._UZ(3,"mat-spinner",37),e.qZA(),e.TgZ(4,"div",38),e._uU(5,"Processing request..."),e.qZA()()())}let dt=(()=>{class o extends S.K{constructor(t,n){super(),this._data=t,this._hotkey=n,this.event=new e.vpe,this.available_types=["admin","systems","modules","zones","drivers","repositories","triggers","users","domains"],this.condition_ops=["includes","equals","truthy","falsy"],this.item=this._data.item,this.loading=!1}ngOnInit(){var t,n,i,_;this.subscription("save",this._hotkey.listen(["KeyS"],()=>this.submit())),this.form=new a.cw({type:new a.NI((null===(t=this.item)||void 0===t?void 0:t.type)||"systems",[a.kI.required]),name:new a.NI((null===(n=this.item)||void 0===n?void 0:n.name)||"",[a.kI.required]),url:new a.NI((null===(i=this.item)||void 0===i?void 0:i.url)||"",[a.kI.required]),conditions:new a.NI((null===(_=this.item)||void 0===_?void 0:_.conditions)||[])})}addCondition(){this.form.controls.conditions.value.push(["","",""])}removeCondition(t){this.form.controls.conditions.setValue(this.form.controls.conditions.value.filter(n=>n!==t))}submit(){if(this.form.markAllAsTouched(),!this.form.valid)return;const t=this.form.value;t.conditions=t.conditions.filter(n=>n[0]&&n[1]),this.event.emit({reason:"done",metadata:t})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(u.WI),e.Y36(et.t))},o.\u0275cmp=e.Xpm({type:o,selectors:[["extension-modal"]],outputs:{event:"event"},features:[e.qOj],decls:9,vars:5,consts:function(){let s,t,n,i,_,l,m,g,T;return s=$localize`:@@typeLabel␟bf3a1deab2bcaeddfcfd7782ed54db830840d950␟5706127539532094818:Type${"\ufffd#5\ufffd"}:START_TAG_SPAN:*${"\ufffd/#5\ufffd"}:CLOSE_TAG_SPAN:: `,t=$localize`:@@nameLabel␟a6b516b2a07891bc316fc0d40fd572bc7ec46f3e␟346892941642015871:Name${"\ufffd#12\ufffd"}:START_TAG_SPAN:*${"\ufffd/#12\ufffd"}:CLOSE_TAG_SPAN:: `,n=$localize`:@@extensionNamePlaceholder␟d4a3634b658f6ac93604e3078106d79a140b8f7a␟6487826043722252959:Extension Display Name`,i=$localize`:@@nameError␟7a48e7a68431ebbfa25cde40585dd405e42cd1db␟7513538297502205849:A valid name is required`,_=$localize`:@@urlLabel␟7ee18d2358331fdb6eec3d6c2b1f3f4a7a50ec76␟4688120902984071927:URL${"\ufffd#20\ufffd"}:START_TAG_SPAN:*${"\ufffd/#20\ufffd"}:CLOSE_TAG_SPAN:: `,l=$localize`:@@extensionUrlPlaceholder␟1cfc829fdf84ddffc5a47a8938119b912fd251a4␟4436431142729435103:Extension URL`,m=$localize`:@@urlError␟2456d09bc2a34c4c067354efdb9c5783efe6e0b7␟4193103363836374269:A valid URL is required`,g=$localize`:@@conditionPlaceholder␟f545fbb6b587caa70ce7d42cdbb1077844b6d749␟6760598080948557972:Condition Field`,T=$localize`:@@conditionValuePlaceholder␟81bcdbb856d39d2d033c153b3953bb340e883efd␟1069058670263181644:Condition Value`,[["mat-dialog-title",""],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],["class","body",3,"formGroup",4,"ngIf","ngIfElse"],[4,"ngIf"],["load_state",""],["mat-icon-button","","mat-dialog-close",""],[3,"icon"],[1,"body",3,"formGroup"],[1,"fieldset"],[1,"field"],["for","type"],s,["appearance","outline"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],["for","name"],t,["matInput","","name","name","placeholder",n,"formControlName","name"],i,["for","url"],_,["matInput","","name","url","placeholder",l,"formControlName","url"],m,[1,"w-full"],["class","fieldset",4,"ngFor","ngForOf"],["mat-button","",1,"w-full",3,"click"],[3,"value"],[1,"capitalize"],["matInput","","name","url","placeholder",g,3,"ngModel","ngModelOptions","ngModelChange"],["placeholder","Operation",3,"ngModel","ngModelOptions","ngModelChange"],["matInput","","name","value","placeholder",T,3,"disabled","ngModel","ngModelOptions","ngModelChange"],["mat-icon-button","",3,"click"],["mat-button","","mat-dialog-close","",1,"inverse"],["mat-button","","type","submit",3,"click"],[1,"body"],[1,"info-block"],[1,"icon"],["diameter","32"],[1,"text"]]},template:function(t,n){if(1&t&&(e.TgZ(0,"header")(1,"h3",0),e._uU(2),e.qZA(),e.YNc(3,nt,2,2,"button",1),e.qZA(),e.TgZ(4,"mat-dialog-content"),e.YNc(5,lt,30,4,"div",2),e.qZA(),e.YNc(6,ct,5,1,"mat-dialog-actions",3),e.YNc(7,rt,6,0,"ng-template",null,4,e.W1O)),2&t){const i=e.MAs(8);e.xp6(2),e.hij("",n.item?"Edit":"New"," Extension"),e.xp6(1),e.Q6J("ngIf",!n.loading),e.xp6(2),e.Q6J("ngIf",n.form&&!n.loading)("ngIfElse",i),e.xp6(1),e.Q6J("ngIf",!n.loading)}},directives:[u.uh,r.O5,C.lW,u.ZT,h.o,u.xY,a.JL,a.sg,v.KE,b.gD,a.JJ,a.u,r.sg,Z.ey,w.Nt,a.Fj,v.TO,a.On,u.H8,y.Ou],styles:[".body[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:column;padding:1em;width:32rem;max-width:calc(100vw - 2rem)}.icon[_ngcontent-%COMP%]{height:1.2em;width:1.2em;display:flex;align-items:center;justify-content:center;font-size:2em}.content[_ngcontent-%COMP%]{width:16rem;text-align:center;font-size:.8em}.info-block[_ngcontent-%COMP%]{margin:2em 6em}.capitalize[_ngcontent-%COMP%]{text-transform:capitalize}.fieldset[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%}.fieldset[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{width:auto;flex:1;min-width:25%;margin:0 .25em}@media screen and (max-width: 640px){.fieldset[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{min-width:20em;margin:0}}.fieldset[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]:first-child{margin-left:0}.fieldset[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]:last-child{margin-right:0}.fieldset[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:.5rem}.field[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;min-width:50%;width:100%}.field[_ngcontent-%COMP%]   div.error[_ngcontent-%COMP%]{position:absolute;bottom:.5em;left:1em;color:var(--error);font-size:.7em;font-weight:500}label[_ngcontent-%COMP%]{font-size:.8em;font-weight:500;margin:.5em 0}label.error[_ngcontent-%COMP%]{color:var(--error)}label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--pending)}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:8em}"]}),o})();const mt=["app-extensions",""];function pt(o,s){if(1&o&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&o){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}const ut=function(){return{class:"backoffice-edit"}},ft=function(){return{class:"backoffice-trash"}};function gt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",19)(1,"div",20),e._uU(2),e.qZA(),e.TgZ(3,"div",13),e._uU(4),e.qZA(),e.TgZ(5,"div",14),e._uU(6),e.qZA(),e.TgZ(7,"div",15),e._uU(8),e.qZA(),e.TgZ(9,"div",21)(10,"button",22),e.NdJ("click",function(){const _=e.CHM(t).$implicit;return e.oxw(2).editExtension(_)}),e._UZ(11,"app-icon",23),e.qZA(),e.TgZ(12,"button",22),e.NdJ("click",function(){const _=e.CHM(t).$implicit;return e.oxw(2).removeExtension(_)}),e._UZ(13,"app-icon",23),e.qZA()()()}if(2&o){const t=s.$implicit;e.xp6(2),e.hij(" ",t.type," "),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.url),e.xp6(2),e.hij(" ",t.conditions.length," "),e.xp6(3),e.Q6J("icon",e.DdM(6,ut)),e.xp6(2),e.Q6J("icon",e.DdM(7,ft))}}function ht(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"div",3)(2,"label",4),e._uU(3,"Domain: "),e.qZA(),e.TgZ(4,"mat-form-field",5)(5,"mat-select",6),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().domain=i})("ngModelChange",function(i){return e.CHM(t),e.oxw().setDomain(i)}),e.YNc(6,pt,2,2,"mat-option",7),e.qZA()(),e.TgZ(7,"button",8),e.NdJ("click",function(){return e.CHM(t),e.oxw().editExtension()}),e._uU(8," Add Extension "),e.qZA()(),e.TgZ(9,"div",9)(10,"p")(11,"strong"),e._uU(12,"Note:"),e.qZA(),e._uU(13," Backoffice requires a full page refresh for extension changes and additions to apply"),e.qZA()(),e.TgZ(14,"div",10)(15,"div",11)(16,"div",12),e._uU(17,"Type"),e.qZA(),e.TgZ(18,"div",13),e._uU(19,"Name"),e.qZA(),e.TgZ(20,"div",14),e._uU(21,"URL"),e.qZA(),e.TgZ(22,"div",15),e._uU(23,"Conditions"),e.qZA(),e._UZ(24,"div",12),e.qZA(),e.TgZ(25,"div",16),e.YNc(26,gt,14,8,"div",17),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(5),e.Q6J("ngModel",t.domain),e.xp6(1),e.Q6J("ngForOf",t.domain_list),e.xp6(20),e.Q6J("ngForOf",t.extension_list)}}function Ct(o,s){if(1&o&&(e.TgZ(0,"div",24)(1,"div",25),e._UZ(2,"mat-spinner",26),e.qZA(),e.TgZ(3,"div",27),e._uU(4),e.qZA()()),2&o){const t=e.oxw();e.xp6(2),e.Q6J("diameter",32),e.xp6(2),e.Oqu(t.loading)}}let At=(()=>{class o{constructor(t){this._dialog=t,this.loading="",this.extension_list=[]}ngOnInit(){return(0,f.mG)(this,void 0,void 0,function*(){this.loading="Loading domains...",this.domain_list=yield(0,d.R2s)().pipe((0,E.U)(t=>t.data)).toPromise(),this.setDomain(this.domain_list[0]),this.loading=""})}setDomain(t){var n,i;this.domain=t;const _=(null===(i=null===(n=this.domain.config)||void 0===n?void 0:n.backoffice)||void 0===i?void 0:i.extend)||{},l=[];for(const m in _)if(_[m])for(const g in _[m])!_[m][g]||l.push(Object.assign(Object.assign({},_[m][g]),{name:g,type:m}));this.extension_list=l,this.extension_list.sort((m,g)=>m.type.localeCompare(g.type)||m.name.localeCompare(g.name))}editExtension(t){const n=this._dialog.open(dt,{data:{item:t?JSON.parse(JSON.stringify(t)):void 0}});n.componentInstance.event.pipe((0,J.P)(i=>"done"===i.reason)).subscribe(i=>(0,f.mG)(this,void 0,void 0,function*(){n.componentInstance.loading=!0,t&&(this.extension_list=this.extension_list.filter(_=>_!==t)),this.extension_list.push(i.metadata),yield this.updateDomain(),n.componentInstance.loading=!1,n.close()}))}removeExtension(t){return(0,f.mG)(this,void 0,void 0,function*(){const n=this._dialog.open(K.z,{data:{title:"Remove extension",content:`Are you sure you want to remove the extension "${t.name}" from ${t.type}?`,icon:{class:"backoffice-trash"}}});n.componentInstance.event.pipe((0,J.P)(i=>"done"===i.reason)).subscribe(i=>(0,f.mG)(this,void 0,void 0,function*(){n.componentInstance.loading="Removing extension...",this.extension_list=this.extension_list.filter(_=>_!==t),yield this.updateDomain().catch(_=>(0,p.cB)(`Error removing extension: ${_}`)),n.componentInstance.loading="",n.close()}))})}updateDomain(){return(0,f.mG)(this,void 0,void 0,function*(){const t={};for(const _ of this.extension_list){t[_.type]||(t[_.type]={});const l=Object.assign({},_);delete l.type,delete l.name,t[_.type][_.name]=l}const n=new d.OeX(Object.assign(Object.assign({},this.domain),{config:Object.assign(Object.assign({},this.domain.config),{backoffice:Object.assign(Object.assign({},this.domain.config.backoffice||{}),{extend:t})})})),i=yield(0,d.gKz)(this.domain.id,n).toPromise();this.setDomain(i)})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(u.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["","app-extensions",""]],attrs:mt,decls:5,vars:2,consts:[[1,"text-lg","font-medium","mb-4"],[4,"ngIf","ngIfElse"],["load_state",""],[1,"flex","items-center","space-x-2","mb-4"],["for","type"],["appearance","outline",1,"h-12"],["name","type","placeholder","Select Domain...",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["mat-button","",3,"click"],[1,"bg-info","my-4","p-4","flex","items-center","rounded","shadow","space-x-4","text-sm","text-white"],["role","table"],["table-head",""],[1,"w-24","p-2"],[1,"w-40","p-2"],[1,"flex-1","p-2"],[1,"w-28","p-2"],["table-body",""],["table-row","",4,"ngFor","ngForOf"],[3,"value"],["table-row",""],[1,"w-24","p-2","capitalize"],[1,"w-24","flex","items-center","justify-center"],["mat-icon-button","",3,"click"],[3,"icon"],[1,"info-block"],[1,"icon"],[3,"diameter"],[1,"text"]],template:function(t,n){if(1&t&&(e.TgZ(0,"h2",0),e._uU(1,"Backoffice extensions"),e.qZA(),e.YNc(2,ht,27,3,"div",1),e.YNc(3,Ct,5,2,"ng-template",null,2,e.W1O)),2&t){const i=e.MAs(4);e.xp6(2),e.Q6J("ngIf",!n.loading)("ngIfElse",i)}},directives:[r.O5,v.KE,b.gD,a.JJ,a.On,r.sg,Z.ey,C.lW,h.o,y.Ou],styles:["[_nghost-%COMP%]{padding:1rem;width:100%;height:100%}\n/*# sourceMappingURL=extensions.component.ts-angular-inline--67.css.map*/"]}),o})();var I=c(4505),k=c(9128),Et=c(9244);function vt(o,s){1&o&&(e.TgZ(0,"button",5),e._UZ(1,"app-icon",6),e.qZA())}function Tt(o,s){if(1&o&&e._UZ(0,"input",25),2&o){const t=e.oxw().$implicit,n=e.oxw(3);e.Q6J("formControlName",t.key)("placeholder",n.name_map[t.key]||t.key)}}function St(o,s){if(1&o&&e._UZ(0,"textarea",25),2&o){const t=e.oxw().$implicit,n=e.oxw(3);e.Q6J("formControlName",t.key)("placeholder",n.name_map[t.key]||t.key)}}function Ot(o,s){if(1&o&&(e.TgZ(0,"div",17)(1,"label",21),e._uU(2),e.TgZ(3,"span"),e._uU(4,"*"),e.qZA(),e._uU(5,":"),e.qZA(),e.TgZ(6,"mat-form-field",10),e.ynx(7,22),e.YNc(8,Tt,1,2,"input",23),e.YNc(9,St,1,2,"textarea",24),e.BQk(),e.TgZ(10,"mat-error"),e._uU(11),e.qZA()()()),2&o){const t=s.$implicit,n=e.oxw(3);e.xp6(2),e.Oqu(n.name_map[t.key]||t.key),e.xp6(5),e.Q6J("ngSwitch",t.key),e.xp6(2),e.Q6J("ngSwitchCase","signing_key"),e.xp6(2),e.hij("A ",t.key," is required")}}function xt(o,s){if(1&o&&(e.TgZ(0,"form",19),e.YNc(1,Ot,12,4,"div",20),e.ALo(2,"keyvalue"),e.qZA()),2&o){const t=e.oxw(2);e.Q6J("formGroup",t.credentials),e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,2,t.credentials.controls))}}const Nt=function(){return["type","amount"]};function Pt(o,s){if(1&o&&(e.TgZ(0,"main",7)(1,"div",8)(2,"div",9)(3,"label"),e._uU(4,"Name"),e.TgZ(5,"span"),e._uU(6,"*"),e.qZA(),e._uU(7,":"),e.qZA(),e.TgZ(8,"mat-form-field",10),e._UZ(9,"input",11),e.TgZ(10,"mat-error"),e._uU(11,"A tenant name is required"),e.qZA()()(),e.TgZ(12,"div",9)(13,"label"),e._uU(14,"Conference Type:"),e.qZA(),e.TgZ(15,"mat-form-field",10),e._UZ(16,"input",12),e.qZA()(),e.TgZ(17,"div",9)(18,"label"),e._uU(19,"Platform"),e.TgZ(20,"span"),e._uU(21,"*"),e.qZA(),e._uU(22,":"),e.qZA(),e.TgZ(23,"mat-form-field",10)(24,"mat-select",13)(25,"mat-option",14),e._uU(26,"Google"),e.qZA(),e.TgZ(27,"mat-option",15),e._uU(28,"Office365"),e.qZA()()()()(),e.YNc(29,xt,3,4,"form",16),e.TgZ(30,"div",17)(31,"label"),e._uU(32,"Booking Limits"),e.qZA(),e._UZ(33,"object-list-field",18),e.qZA()()),2&o){const t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(29),e.Q6J("ngIf",t.credentials),e.xp6(4),e.Q6J("fields",e.DdM(3,Nt))}}function yt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"footer",26)(1,"button",27),e.NdJ("click",function(){return e.CHM(t),e.oxw().save()}),e._uU(2,"Save"),e.qZA()()}}function Mt(o,s){1&o&&(e.TgZ(0,"main",28),e._UZ(1,"mat-spinner",29),e.TgZ(2,"p"),e._uU(3,"Saving staff API tenant..."),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("diameter",48))}const bt={issuer:"Service Account Email",signing_key:"Private Key",sub:"Service User",client_id:"Client ID",client_secret:"Client Secret",domain:"Domain",scopes:"Scopes",user_agent:"User Agent"};let Zt=(()=>{class o{constructor(t,n){this._data=t,this._dialog_ref=n,this.event=new e.vpe,this.tenant=this._data.tenant,this.domain=this._data.domain,this.loading=!1,this.name_map=bt}get office_form(){var t,n,i,_,l,m;return new a.cw({tenant:new a.NI((null===(n=null===(t=this.tenant)||void 0===t?void 0:t.credentials)||void 0===n?void 0:n.tenant)||"",[a.kI.required]),client_id:new a.NI((null===(_=null===(i=this.tenant)||void 0===i?void 0:i.credentials)||void 0===_?void 0:_.client_id)||"",[a.kI.required]),client_secret:new a.NI((null===(m=null===(l=this.tenant)||void 0===l?void 0:l.credentials)||void 0===m?void 0:m.client_secret)||"",[a.kI.required])})}get google_form(){var t,n,i,_,l,m,g,T,A,z,W,V,ee;return new a.cw({issuer:new a.NI((null===(n=null===(t=this.tenant)||void 0===t?void 0:t.credentials)||void 0===n?void 0:n.issue)||"",[a.kI.required]),signing_key:new a.NI((null===(_=null===(i=this.tenant)||void 0===i?void 0:i.credentials)||void 0===_?void 0:_.signing_key)||"",[a.kI.required]),scopes:new a.NI((null===(m=null===(l=this.tenant)||void 0===l?void 0:l.credentials)||void 0===m?void 0:m.scopes)||"",[a.kI.required]),domain:new a.NI((null===(T=null===(g=this.tenant)||void 0===g?void 0:g.credentials)||void 0===T?void 0:T.domain)||(null===(A=this._data.domain)||void 0===A?void 0:A.domain)||"",[a.kI.required]),sub:new a.NI((null===(W=null===(z=this.tenant)||void 0===z?void 0:z.credentials)||void 0===W?void 0:W.sub)||"",[a.kI.required]),user_agent:new a.NI((null===(ee=null===(V=this.tenant)||void 0===V?void 0:V.credentials)||void 0===ee?void 0:ee.user_agent)||"PlaceOS",[a.kI.required])})}get credentials(){var t;return null===(t=this.form)||void 0===t?void 0:t.controls.credentials}ngOnInit(){var t,n,i,_,l,m;const g=(null===(t=this.tenant)||void 0===t?void 0:t.booking_limits)||{};this.form=new a.cw({domain:new a.NI((null===(n=this.domain)||void 0===n?void 0:n.domain)||this.tenant.domain||"localhost"),name:new a.NI((null===(i=this.tenant)||void 0===i?void 0:i.name)||"",[a.kI.required]),platform:new a.NI((null===(_=this.tenant)||void 0===_?void 0:_.platform)||"google",[a.kI.required]),conference_type:new a.NI((null===(l=this.tenant)||void 0===l?void 0:l.conference_type)||""),booking_limits:new a.NI(Object.keys(g).map(T=>({type:T,amount:g[T]}))),credentials:"office365"===(null===(m=this.tenant)||void 0===m?void 0:m.platform)?this.office_form:this.google_form}),this.form.controls.platform.valueChanges.subscribe(T=>{this.form.removeControl("credentials"),this.form.addControl("credentials","office365"===T?this.office_form:this.google_form)})}save(){var t;return(0,f.mG)(this,void 0,void 0,function*(){if(this.form.markAllAsTouched(),!this.form.valid)return;this._dialog_ref.disableClose=!0,this.loading=!0;const n=this.form.value.booking_limits.reduct((l,{type:m,amount:g})=>l[m]=+g,{}),_=yield((null===(t=this.tenant)||void 0===t?void 0:t.id)?(0,d.gzd)(`/api/staff/v1/tenants/${this.tenant.id}`,Object.assign(Object.assign(Object.assign({},this.tenant||{}),this.form.value),{booking_limits:n})):(0,d.v_Q)("/api/staff/v1/tenants",Object.assign(Object.assign(Object.assign({},this.tenant||{}),this.form.value),{booking_limits:n}))).toPromise().catch(l=>null);if(this.loading=!1,this._dialog_ref.disableClose=!1,!_)return(0,p.cB)("Error adding new tenant.");(0,p.t5)("Successfully added new tenant."),this._dialog_ref.close()})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(u.WI),e.Y36(u.so))},o.\u0275cmp=e.Xpm({type:o,selectors:[["staff-tenant-modal"]],outputs:{event:"event"},decls:9,vars:5,consts:[[1,"flex-1"],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],["class","overflow-auto",3,"formGroup",4,"ngIf","ngIfElse"],["class","p-2 border-t border-gray-200 flex justify-center",4,"ngIf"],["load_state",""],["mat-icon-button","","mat-dialog-close",""],["className","backoffice-cross"],[1,"overflow-auto",3,"formGroup"],[1,"flex","items-center","flex-wrap","space-x-0","sm:space-x-2"],[1,"flex","flex-col","flex-1"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Tenant Name"],["matInput","","formControlName","conference_type","placeholder","Conference Type"],["formControlName","platform"],["value","google"],["value","office365"],[3,"formGroup",4,"ngIf"],[1,"flex","flex-col"],["formControlName","booking_limits",3,"fields"],[3,"formGroup"],["class","flex flex-col",4,"ngFor","ngForOf"],[1,"capitalize"],[3,"ngSwitch"],["matInput","",3,"formControlName","placeholder",4,"ngSwitchDefault"],["matInput","",3,"formControlName","placeholder",4,"ngSwitchCase"],["matInput","",3,"formControlName","placeholder"],[1,"p-2","border-t","border-gray-200","flex","justify-center"],["mat-button","",3,"click"],[1,"flex","flex-col","p-8","items-center","justify-center"],[1,"mb-4",3,"diameter"]],template:function(t,n){if(1&t&&(e.TgZ(0,"header")(1,"h3"),e._uU(2),e.qZA(),e._UZ(3,"div",0),e.YNc(4,vt,2,0,"button",1),e.qZA(),e.YNc(5,Pt,34,4,"main",2),e.YNc(6,yt,3,0,"footer",3),e.YNc(7,Mt,4,1,"ng-template",null,4,e.W1O)),2&t){const i=e.MAs(8);e.xp6(2),e.hij("",n.tenant?"Edit":"New"," Tenant"),e.xp6(2),e.Q6J("ngIf",!n.loading),e.xp6(1),e.Q6J("ngIf",!n.loading)("ngIfElse",i),e.xp6(1),e.Q6J("ngIf",!n.loading)}},directives:[r.O5,C.lW,u.ZT,h.o,a.JL,a.sg,v.KE,w.Nt,a.Fj,a.JJ,a.u,v.TO,b.gD,Z.ey,a._Y,r.sg,r.RF,r.ED,r.n9,Et.i,y.Ou],pipes:[r.Nd],styles:["main[_ngcontent-%COMP%]{width:32rem;max-width:calc(100vw - 5rem);max-height:65vh}\n/*# sourceMappingURL=staff-tenant-modal.component.ts-angular-inline--68.css.map*/"]}),o})();function It(o,s){if(1&o&&(e.TgZ(0,"mat-option",9),e._uU(1),e.qZA()),2&o){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function Ft(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",18)(1,"div",19),e._uU(2),e.qZA(),e.TgZ(3,"div",20),e._uU(4),e.qZA(),e.TgZ(5,"div",21)(6,"button",22),e.NdJ("click",function(){const _=e.CHM(t).$implicit;return e.oxw(3).editTenant(_)}),e._UZ(7,"app-icon",23),e.qZA(),e.TgZ(8,"button",22),e.NdJ("click",function(){const _=e.CHM(t).$implicit;return e.oxw(3).removeTenant(_)}),e._UZ(9,"app-icon",24),e.qZA()()()}if(2&o){const t=s.$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.platform)}}function Ut(o,s){if(1&o&&(e.TgZ(0,"div",11)(1,"div",12)(2,"div",13),e._uU(3,"Name"),e.qZA(),e.TgZ(4,"div",14),e._uU(5,"Platform"),e.qZA(),e._UZ(6,"div",15),e.qZA(),e.TgZ(7,"div",16),e.YNc(8,Ft,10,2,"div",17),e.ALo(9,"async"),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(8),e.Q6J("ngForOf",e.lcZ(9,1,t.tenants))}}function kt(o,s){if(1&o&&(e.ynx(0),e.YNc(1,Ut,10,3,"div",10),e.ALo(2,"async"),e.BQk()),2&o){const t=e.oxw(),n=e.MAs(11);let i;e.xp6(1),e.Q6J("ngIf",null==(i=e.lcZ(2,2,t.tenants))?null:i.length)("ngIfElse",n)}}function Rt(o,s){1&o&&(e.TgZ(0,"div",25)(1,"p"),e._uU(2,"No tenants for selected domain"),e.qZA()())}function Dt(o,s){if(1&o&&(e.TgZ(0,"div",26),e._UZ(1,"mat-spinner",27),e.TgZ(2,"p"),e._uU(3),e.qZA()()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("diameter",48),e.xp6(2),e.Oqu(t.loading)}}let wt=(()=>{class o{constructor(t){this._dialog=t,this.loading="",this.domain=new I.X(null),this.tenants=this.domain.pipe((0,D.w)(()=>(this.loading="Loading tenants for domain...",(0,d.U2M)("/api/staff/v1/tenants"))),(0,$.K)(n=>[]),(0,E.U)(n=>(this.loading="",n.filter(i=>i.domain===this.domain.getValue().domain))),(0,k.d)())}ngOnInit(){return(0,f.mG)(this,void 0,void 0,function*(){this.loading="Loading domains...",this.domain_list=yield(0,d.R2s)().pipe((0,E.U)(t=>t.data)).toPromise(),this.domain.next(this.domain_list[0]),this.loading=""})}editTenant(t){this._dialog.open(Zt,{data:{tenant:t,domain:this.domain.getValue()}}).afterClosed().subscribe(i=>this.domain.next(this.domain.getValue()))}removeTenant(t){return(0,f.mG)(this,void 0,void 0,function*(){const n=yield(0,U._5)({title:"Remove tenant?",content:`Remove <strong>${t.name}</strong> from this domain?<br>You or your users may lose access to some data.`,icon:{type:"icon",class:"backoffice-trash"}},this._dialog);if(!n||!n.reason)return;n.loading("Removing tenant from domain...");const i=yield(0,d.IVX)(`/api/staff/v1/tenants/${t.id}`).toPromise().catch(_=>{(0,p.cB)(`Error removing module ${t.id} from domain. Error: ${_.statusText||_.message||_}`)});n.close(),i&&((0,p.t5)("Successfully removed tenant from domain."),this.domain.next(this.domain.getValue()))})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(u.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["staff-api"]],decls:14,vars:6,consts:[[1,"flex","items-center","space-x-2","mb-4"],["for","type"],["appearance","outline",1,"h-12"],["name","type","placeholder","Select Domain...",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["mat-button","",3,"click"],[4,"ngIf","ngIfElse"],["empty_state",""],["load_state",""],[3,"value"],["class","w-full",4,"ngIf","ngIfElse"],[1,"w-full"],["table-head",""],[1,"w-1/2","p-2"],[1,"flex-1","p-2"],[1,"w-24","p-2","h-10"],["table-body",""],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"w-1/2","p-2","truncate"],[1,"flex-1","p-2","truncate"],[1,"w-24","px-2","flex","items-center","justify-end"],["mat-icon-button","",1,"h-10","w-10",3,"click"],["className","backoffice-edit"],["className","backoffice-trash"],[1,"flex","flex-col","items-center","justify-center"],[1,"w-full","flex","flex-col","items-center","justify-center"],[1,"mb-4",3,"diameter"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"label",1),e._uU(2,"Domain: "),e.qZA(),e.TgZ(3,"mat-form-field",2)(4,"mat-select",3),e.NdJ("ngModelChange",function(_){return n.domain.next(_)}),e.ALo(5,"async"),e.YNc(6,It,2,2,"mat-option",4),e.qZA()(),e.TgZ(7,"button",5),e.NdJ("click",function(){return n.editTenant()}),e._uU(8,"Add Tenant"),e.qZA()(),e.YNc(9,kt,3,4,"ng-container",6),e.YNc(10,Rt,3,0,"ng-template",null,7,e.W1O),e.YNc(12,Dt,4,2,"ng-template",null,8,e.W1O)),2&t){const i=e.MAs(13);e.xp6(4),e.Q6J("ngModel",e.lcZ(5,4,n.domain)),e.xp6(2),e.Q6J("ngForOf",n.domain_list),e.xp6(3),e.Q6J("ngIf",!n.loading)("ngIfElse",i)}},directives:[v.KE,b.gD,a.JJ,a.On,r.sg,Z.ey,C.lW,r.O5,h.o,y.Ou],pipes:[r.Ov],styles:["[_nghost-%COMP%]{position:relative;height:100%;width:100%;padding:1rem}\n/*# sourceMappingURL=staff-api.component.ts-angular-inline--69.css.map*/"]}),o})();var G=c(4139);function Lt(o,s){1&o&&(e.TgZ(0,"button",5),e._UZ(1,"app-icon",6),e.qZA())}function qt(o,s){if(1&o&&(e.TgZ(0,"main",7)(1,"div",8)(2,"label"),e._uU(3,"Name"),e.TgZ(4,"span"),e._uU(5,"*"),e.qZA(),e._uU(6,":"),e.qZA(),e.TgZ(7,"mat-form-field",9),e._UZ(8,"input",10),e.TgZ(9,"mat-error"),e._uU(10,"A edge name is required"),e.qZA()()(),e.TgZ(11,"div",8)(12,"label"),e._uU(13,"Description:"),e.qZA(),e.TgZ(14,"mat-form-field",9),e._UZ(15,"textarea",11),e.qZA()()()),2&o){const t=e.oxw();e.Q6J("formGroup",t.form)}}function Bt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"footer",12)(1,"button",13),e.NdJ("click",function(){return e.CHM(t),e.oxw().save()}),e._uU(2,"Save"),e.qZA()()}}function $t(o,s){1&o&&(e.TgZ(0,"main",14),e._UZ(1,"mat-spinner",15),e.TgZ(2,"p"),e._uU(3,"Saving edge..."),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("diameter",48))}let Kt=(()=>{class o{constructor(t,n){this._data=t,this._dialog_ref=n,this.event=new e.vpe,this.edge=this._data.edge,this.loading=!1}ngOnInit(){var t,n;this.form=new a.cw({name:new a.NI((null===(t=this.edge)||void 0===t?void 0:t.name)||"",[a.kI.required]),description:new a.NI((null===(n=this.edge)||void 0===n?void 0:n.description)||"")})}save(){return(0,f.mG)(this,void 0,void 0,function*(){if(this.form.markAllAsTouched(),!this.form.valid)return;this._dialog_ref.disableClose=!0,this.loading=!0;const t=Object.assign(Object.assign({},this.edge),this.form.value),i=yield(t.id?(0,d.sNt)(t.id,t):(0,d.Z_z)(t)).toPromise().catch(_=>null);if(this.loading=!1,this._dialog_ref.disableClose=!1,!i)return(0,p.cB)("Error adding new edge.");(0,p.t5)("Successfully added new edge."),this._dialog_ref.close()})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(u.WI),e.Y36(u.so))},o.\u0275cmp=e.Xpm({type:o,selectors:[["edge-modal"]],outputs:{event:"event"},decls:9,vars:5,consts:[[1,"flex-1"],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],["class","overflow-auto",3,"formGroup",4,"ngIf","ngIfElse"],["class","p-2 border-t border-gray-200 flex justify-center",4,"ngIf"],["load_state",""],["mat-icon-button","","mat-dialog-close",""],["className","backoffice-cross"],[1,"overflow-auto",3,"formGroup"],[1,"flex","flex-col","flex-1"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Edge Name"],["matInput","","formControlName","description","placeholder","Edge description..."],[1,"p-2","border-t","border-gray-200","flex","justify-center"],["mat-button","",3,"click"],[1,"flex","flex-col","p-8","items-center","justify-center"],[1,"mb-4",3,"diameter"]],template:function(t,n){if(1&t&&(e.TgZ(0,"header")(1,"h3"),e._uU(2),e.qZA(),e._UZ(3,"div",0),e.YNc(4,Lt,2,0,"button",1),e.qZA(),e.YNc(5,qt,16,1,"main",2),e.YNc(6,Bt,3,0,"footer",3),e.YNc(7,$t,4,1,"ng-template",null,4,e.W1O)),2&t){const i=e.MAs(8);e.xp6(2),e.hij("",n.edge?"Edit":"New"," Edge"),e.xp6(2),e.Q6J("ngIf",!n.loading),e.xp6(1),e.Q6J("ngIf",!n.loading&&n.form)("ngIfElse",i),e.xp6(1),e.Q6J("ngIf",!n.loading)}},directives:[r.O5,C.lW,u.ZT,h.o,a.JL,a.sg,v.KE,w.Nt,a.Fj,a.JJ,a.u,v.TO,y.Ou],styles:["main[_ngcontent-%COMP%]{width:32rem;max-width:calc(100vw - 5rem);max-height:65vh}\n/*# sourceMappingURL=edge-modal.component.ts-angular-inline--70.css.map*/"]}),o})();const Jt=["admin-edge",""];function Xt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",12)(1,"div",13),e._uU(2),e.qZA(),e.TgZ(3,"div",13),e._uU(4),e.qZA(),e.TgZ(5,"div",14),e._uU(6),e.qZA(),e.TgZ(7,"div",15)(8,"button",16),e.NdJ("click",function(){const _=e.CHM(t).$implicit;return e.oxw(3).token(_)}),e._UZ(9,"app-icon",17),e.qZA(),e.TgZ(10,"button",16),e.NdJ("click",function(){const _=e.CHM(t).$implicit;return e.oxw(3).edit(_)}),e._UZ(11,"app-icon",18),e.qZA(),e.TgZ(12,"button",16),e.NdJ("click",function(){const _=e.CHM(t).$implicit;return e.oxw(3).remove(_)}),e._UZ(13,"app-icon",19),e.qZA()()()}if(2&o){const t=s.$implicit;e.xp6(2),e.Oqu(t.id),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description)}}function Gt(o,s){if(1&o&&(e.TgZ(0,"div",5)(1,"div",6)(2,"div",7),e._uU(3,"id"),e.qZA(),e.TgZ(4,"div",7),e._uU(5,"Name"),e.qZA(),e.TgZ(6,"div",8),e._uU(7,"description"),e.qZA(),e._UZ(8,"div",9),e.qZA(),e.TgZ(9,"div",10),e.YNc(10,Xt,14,3,"div",11),e.ALo(11,"async"),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(10),e.Q6J("ngForOf",e.lcZ(11,1,t.edges))}}function Qt(o,s){if(1&o&&(e.ynx(0),e.YNc(1,Gt,12,3,"div",4),e.ALo(2,"async"),e.BQk()),2&o){const t=e.oxw(),n=e.MAs(4);let i;e.xp6(1),e.Q6J("ngIf",null==(i=e.lcZ(2,2,t.edges))?null:i.length)("ngIfElse",n)}}function Yt(o,s){1&o&&(e.TgZ(0,"div",20)(1,"p"),e._uU(2,"No edges"),e.qZA()())}function jt(o,s){if(1&o&&(e.TgZ(0,"div",21),e._UZ(1,"mat-spinner",22),e.TgZ(2,"p"),e._uU(3),e.qZA()()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("diameter",48),e.xp6(2),e.Oqu(t.loading)}}let Ht=(()=>{class o{constructor(t){this._dialog=t,this.loading="",this._change=new I.X(!1),this.edges=this._change.pipe((0,D.w)(n=>(this.loading="Loading Edges...",(0,d.KQ8)())),(0,$.K)(n=>(0,G.of)({})),(0,E.U)(n=>(this.loading="",(null==n?void 0:n.data)||[])),(0,k.d)()),this.token=n=>(0,f.mG)(this,void 0,void 0,function*(){const i=yield(0,d.HLJ)(n.id).toPromise();(0,U.vQ)(i.token),(0,p.QD)("Token copied to clickboard.")}),this.edit=n=>(0,f.mG)(this,void 0,void 0,function*(){return this._dialog.open(Kt,{data:{edge:n}})}),this.remove=n=>(0,f.mG)(this,void 0,void 0,function*(){const i=yield(0,U._5)({title:"Remove edge?",content:`Remove <strong>${n.name}</strong>?<br>You or your users may lose access to some data.`,icon:{type:"icon",class:"backoffice-trash"}},this._dialog);if(!i)return;i.loading("Removing edge...");const _=yield(0,d.eAF)(n.id).toPromise().catch(l=>l);if(i.close(),_)return(0,p.cB)(`Error removing edge. Error: ${_.statusText||_.message||_}`);(0,p.t5)("Successfully removed Edge."),this._change.next(!this._change.getValue())})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(u.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["","admin-edge",""]],attrs:Jt,decls:7,vars:2,consts:[["mat-button","",1,"w-full","sm:w-32","mb-4",3,"click"],[4,"ngIf","ngIfElse"],["empty_state",""],["load_state",""],["class","w-full",4,"ngIf","ngIfElse"],[1,"w-full"],["table-head",""],[1,"w-32","p-2"],[1,"flex-1","p-2"],[1,"w-32","p-2","h-10"],["table-body",""],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"w-32","p-2","truncate"],[1,"flex-1","p-2","truncate"],[1,"w-32","px-2","flex","items-center","justify-end"],["mat-icon-button","",1,"h-10","w-10",3,"click"],["className","backoffice-key"],["className","backoffice-edit"],["className","backoffice-trash"],[1,"flex","flex-col","items-center","justify-center"],[1,"w-full","flex","flex-col","items-center","justify-center"],[1,"mb-4",3,"diameter"]],template:function(t,n){if(1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return n.edit()}),e._uU(1,"Add New Edge"),e.qZA(),e.YNc(2,Qt,3,4,"ng-container",1),e.YNc(3,Yt,3,0,"ng-template",null,2,e.W1O),e.YNc(5,jt,4,2,"ng-template",null,3,e.W1O)),2&t){const i=e.MAs(6);e.xp6(2),e.Q6J("ngIf",!n.loading)("ngIfElse",i)}},directives:[C.lW,r.O5,r.sg,h.o,y.Ou],pipes:[r.Ov],styles:["[_nghost-%COMP%]{padding:1rem;height:100%;width:100%;min-height:10rem}\n/*# sourceMappingURL=edge.component.ts-angular-inline--71.css.map*/"]}),o})();var zt=c(8024),Wt=c(1452);function Vt(o,s){if(1&o&&(e.TgZ(0,"mat-option",13),e._uU(1),e.qZA()),2&o){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function en(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",14)(1,"div",1)(2,"label",2),e._uU(3,"Schema Name: "),e.qZA(),e.TgZ(4,"mat-form-field",3)(5,"input",15),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().schema_copy.name=i}),e.qZA()()(),e.TgZ(6,"button",8),e.NdJ("click",function(){return e.CHM(t),e.oxw().saveSchema()}),e._uU(7," Save Schema "),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(5),e.Q6J("ngModel",t.schema_copy.name)}}function tn(o,s){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"settings-form-field",16),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().schema_copy.schema=i}),e.qZA(),e.BQk()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.schema_copy.schema)("readonly",!1)}}function nn(o,s){1&o&&(e.TgZ(0,"div",17)(1,"p",18),e._uU(2,"Select a schema to edit"),e.qZA()())}let on=(()=>{class o{constructor(t){this._state=t,this.schema_list=this._state.schemas.pipe((0,k.d)(1))}copySchema(){!this.active_schema||(this.schema_copy=JSON.parse(JSON.stringify(this.active_schema)))}newSchema(){return(0,f.mG)(this,void 0,void 0,function*(){this.active_schema={name:"New Schema",schema:"{}"},this.copySchema()})}saveSchema(){this._state.saveSchema(this.schema_copy),this.active_schema=null,this.schema_copy=null}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(zt.O))},o.\u0275cmp=e.Xpm({type:o,selectors:[["admin-schemas"]],decls:18,vars:7,consts:[[1,"flex","items-center","space-x-2","my-4"],[1,"flex","flex-col"],["for","type"],["appearance","outline",1,"h-12"],["name","type","placeholder","Select Schema...",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"click"],[1,"italic","font-sans"],["mat-button","",1,"mt-6",3,"click"],["class","flex items-center space-x-2 mb-4",4,"ngIf"],[1,"relative","flex-1","h-1/2"],[4,"ngIf","ngIfElse"],["empty_state",""],[3,"value"],[1,"flex","items-center","space-x-2","mb-4"],["matInput","",3,"ngModel","ngModelChange"],["lang","json",3,"ngModel","readonly","ngModelChange"],[1,"absolute","inset-0","flex","items-center","justify-center"],[1,"p-8"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"label",2),e._uU(3,"Schema: "),e.qZA(),e.TgZ(4,"mat-form-field",3)(5,"mat-select",4),e.NdJ("ngModelChange",function(_){return n.active_schema=_})("ngModelChange",function(){return n.copySchema()}),e.YNc(6,Vt,2,2,"mat-option",5),e.ALo(7,"async"),e.TgZ(8,"mat-option",6),e.NdJ("click",function(_){return n.newSchema(),_.preventDefault()}),e.TgZ(9,"span",7),e._uU(10,"New Schema"),e.qZA()()()()(),e.TgZ(11,"button",8),e.NdJ("click",function(){return n.newSchema()}),e._uU(12," Add Schema "),e.qZA()(),e.YNc(13,en,8,1,"div",9),e.TgZ(14,"div",10),e.YNc(15,tn,2,2,"ng-container",11),e.qZA(),e.YNc(16,nn,3,0,"ng-template",null,12,e.W1O)),2&t){const i=e.MAs(17);e.xp6(5),e.Q6J("ngModel",n.active_schema),e.xp6(1),e.Q6J("ngForOf",e.lcZ(7,5,n.schema_list)),e.xp6(7),e.Q6J("ngIf",n.schema_copy),e.xp6(2),e.Q6J("ngIf",n.schema_copy)("ngIfElse",i)}},directives:[v.KE,b.gD,a.JJ,a.On,r.sg,Z.ey,C.lW,r.O5,w.Nt,a.Fj,Wt.x],pipes:[r.Ov],styles:["[_nghost-%COMP%]{position:absolute;top:0;left:1rem;right:1rem;bottom:0;display:flex;flex-direction:column}\n/*# sourceMappingURL=schemas.component.ts-angular-inline--72.css.map*/"]}),o})();var sn=c(3910),Q=c(7716),_n=c(823),an=c(8325),ie=c(1170);function ln(o){(0,ie.Z)(1,arguments);var s=(0,an.Z)(o),t=s.getTime();return t}function se(o){return(0,ie.Z)(1,arguments),Math.floor(ln(o)/1e3)}class _e{constructor(s){this.id=s.id||"",this.name=s.name||"",this.user_id=s.user_id||"",this.authority_id=s.authority_id||"",this.description=s.description||"",this.permissions=s.permissions||"user",this.created_at=s.created_at||se(new Date),this.updated_at=s.updated_at||se(new Date),this.secret=s.secret,this.x_api_key=s.x_api_key||"",this.scopes=s.scopes||[]}}var Y=c(5939),ae=c(442),q=c(1196),cn=c(3352),j=c(2796);const rn=["input"];function dn(o,s){1&o&&(e.TgZ(0,"button",5),e._UZ(1,"app-icon",6),e.qZA())}function mn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"mat-chip",31),e.NdJ("removed",function(){e.CHM(t);const i=e.oxw(2);return i.removeScope(i.tag)}),e._uU(1),e._UZ(2,"app-icon",32),e.qZA()}if(2&o){const t=s.$implicit;e.Q6J("selectable",!0)("removable",!0),e.xp6(1),e.hij(" ",t," ")}}function pn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",33),e.NdJ("click",function(){const _=e.CHM(t).$implicit,l=e.oxw(2);return l.form.patchValue({user:_,user_id:_.id}),l.setSearch("")}),e._uU(1),e.qZA()}if(2&o){const t=s.$implicit,n=e.oxw(2);e.ekj("text-primary",(null==n.form.value.user?null:n.form.value.user.id)===t.id),e.xp6(1),e.hij(" ",t.name," ")}}const un=function(){return{standalone:!0}};function fn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"main",7)(1,"div",8)(2,"label",9),e._uU(3,"Name"),e.qZA(),e.TgZ(4,"mat-form-field",10),e._UZ(5,"input",11),e.qZA()(),e.TgZ(6,"div",8)(7,"label",9),e._uU(8,"Description"),e.qZA(),e.TgZ(9,"mat-form-field",10),e._UZ(10,"textarea",12),e.qZA()(),e.TgZ(11,"div",8)(12,"label",13),e._uU(13,"Scopes"),e.qZA(),e.TgZ(14,"mat-form-field",10)(15,"mat-chip-list",14,15),e.YNc(17,mn,3,3,"mat-chip",16),e.TgZ(18,"input",17),e.NdJ("matChipInputTokenEnd",function(i){return e.CHM(t),e.oxw().addScope(i)}),e.qZA()()()(),e.TgZ(19,"div",8)(20,"label",18),e._uU(21,"User"),e.TgZ(22,"span"),e._uU(23,"*"),e.qZA()(),e.TgZ(24,"an-action-field",19),e.NdJ("click",function(){return e.CHM(t),e.oxw().focusInput()}),e.TgZ(25,"div"),e._uU(26),e.qZA()(),e.TgZ(27,"mat-menu",null,20)(29,"mat-form-field",21),e.NdJ("click",function(i){return i.preventDefault(),i.stopPropagation()}),e.TgZ(30,"input",22,23),e.NdJ("ngModelChange",function(i){return e.CHM(t),e.oxw().setSearch(i)}),e.qZA()(),e.YNc(32,pn,2,3,"button",24),e.ALo(33,"slice"),e.ALo(34,"async"),e.qZA()(),e.TgZ(35,"div",8)(36,"label",25),e._uU(37,"Permissions"),e.qZA(),e.TgZ(38,"mat-form-field",10)(39,"mat-select",26)(40,"mat-option",27),e._uU(41,"None"),e.qZA(),e.TgZ(42,"mat-option",28),e._uU(43,"User"),e.qZA(),e.TgZ(44,"mat-option",29),e._uU(45,"Support"),e.qZA(),e.TgZ(46,"mat-option",30),e._uU(47,"Admin"),e.qZA()()()()()}if(2&o){const t=e.MAs(16),n=e.MAs(28),i=e.oxw();e.Q6J("formGroup",i.form),e.xp6(17),e.Q6J("ngForOf",i.scope_list),e.xp6(1),e.Q6J("matChipInputFor",t)("matChipInputSeparatorKeyCodes",i.separators)("matChipInputAddOnBlur",!0),e.xp6(6),e.Q6J("matMenuTriggerFor",n),e.xp6(1),e.ekj("opacity-30",!(null!=i.form.value.user&&i.form.value.user.id)),e.xp6(1),e.hij(" ",(null==i.form.value.user?null:i.form.value.user.name)||"Select user"," "),e.xp6(4),e.Q6J("ngModelOptions",e.DdM(18,un)),e.xp6(2),e.Q6J("ngForOf",e.Dn7(33,12,e.lcZ(34,16,i.users),0,10)),e.xp6(8),e.Q6J("value",null)}}function gn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"footer",34)(1,"button",35),e.NdJ("click",function(){return e.CHM(t),e.oxw().save()}),e._uU(2,"Save"),e.qZA()()}}function hn(o,s){if(1&o&&(e.TgZ(0,"main",36),e._UZ(1,"mat-spinner",37),e.TgZ(2,"p"),e._uU(3),e.qZA()()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("diameter",32),e.xp6(2),e.Oqu(t.loading)}}let Cn=(()=>{class o{constructor(t){this._service=t,this.event=new e.vpe,this.form=new a.cw({name:new a.NI("",[a.kI.required]),user:new a.NI(null),user_id:new a.NI("",[a.kI.required]),description:new a.NI(""),scopes:new a.NI([]),permissions:new a.NI("")}),this.search_str=new I.X(""),this.users=(0,Q.aj)([this._service.users,this.form.valueChanges]).pipe((0,E.U)(([n,{permissions:i}])=>"admin"===i?n.filter(_=>_.sys_admin):"support"===i?n.filter(_=>_.support||_.sys_admin):n.sort((_,l)=>{var m;return null===(m=_.name)||void 0===m?void 0:m.localeCompare(l.name)}))),this.separators=[Y.K5,Y.OC,Y.L_],this.focusInput=()=>setTimeout(()=>{var n,i;return null===(i=null===(n=this._input_el)||void 0===n?void 0:n.nativeElement)||void 0===i?void 0:i.focus()},100),this.setSearch=n=>this._service.setSearch(n),this.addScope=n=>(0,ae.Z)(this.form.controls.scopes,n),this.removeScope=n=>(0,ae.i)(this.form.controls.scopes,n),setTimeout(()=>this.form.patchValue({permissions:null}),100)}get scope_list(){return this.form.controls.scopes.value}save(){this.form.markAllAsTouched(),this.form.valid&&(delete Object.assign({},this.form.value).user,this.event.emit({reason:"done",metadata:this.form.value}))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(H))},o.\u0275cmp=e.Xpm({type:o,selectors:[["api-key-modal"]],viewQuery:function(t,n){if(1&t&&e.Gf(rn,5),2&t){let i;e.iGM(i=e.CRH())&&(n._input_el=i.first)}},outputs:{event:"event"},decls:8,vars:4,consts:function(){let s;return s=$localize`:@@apiScopePlaceholder␟312125edb94a1ac433d530e4ec51212da69819d9␟4303954101435613129:Scopes...`,[[1,"h-12","flex","items-center","justify-between","p-2"],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],["class","w-[32rem] max-w-[calc(100vw-2rem)]",3,"formGroup",4,"ngIf","ngIfElse"],["class","p-2 flex items-center justify-center border-t border-gray-100 dark:border-gray-100/20",4,"ngIf"],["load_state",""],["mat-icon-button","","mat-dialog-close",""],["className","backoffice-cross"],[1,"w-[32rem]","max-w-[calc(100vw-2rem)]",3,"formGroup"],[1,"flex","flex-col"],["for","name"],["appearance","outline"],["name","name","formControlName","name","placeholder","Name","matInput",""],["name","description","formControlName","description","placeholder","Description","matInput",""],["for","scope"],["aria-label","Scopes"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],["placeholder",s,3,"matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],["for","user"],["yPosition","below",1,"mb-8",3,"matMenuTriggerFor","click"],["menu","matMenu"],["appearance","outline",1,"px-2","h-12",3,"click"],["matInput","","ngModel","","placeholder","Search users...",3,"ngModelOptions","ngModelChange"],["input",""],["mat-menu-item","",3,"text-primary","click",4,"ngFor","ngForOf"],["for","permissions"],["name","permissions","formControlName","permissions","placeholder","None"],[3,"value"],["value","user"],["value","support"],["value","admin"],[3,"selectable","removable","removed"],["matChipRemove","","className","backoffice-cross"],["mat-menu-item","",3,"click"],[1,"p-2","flex","items-center","justify-center","border-t","border-gray-100","dark:border-gray-100/20"],["mat-button","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","space-y-2","p-8","w-[24rem]","h-64"],[3,"diameter"]]},template:function(t,n){if(1&t&&(e.TgZ(0,"header",0)(1,"h2"),e._uU(2,"New API Key"),e.qZA(),e.YNc(3,dn,2,0,"button",1),e.qZA(),e.YNc(4,fn,48,19,"main",2),e.YNc(5,gn,3,0,"footer",3),e.YNc(6,hn,4,2,"ng-template",null,4,e.W1O)),2&t){const i=e.MAs(7);e.xp6(3),e.Q6J("ngIf",!n.loading),e.xp6(1),e.Q6J("ngIf",!n.loading&&n.form)("ngIfElse",i),e.xp6(1),e.Q6J("ngIf",!n.loading)}},directives:[r.O5,C.lW,u.ZT,h.o,a.JL,a.sg,v.KE,a.Fj,w.Nt,a.JJ,a.u,q.qn,r.sg,q.HS,q.qH,q.oH,cn.s,j.p6,j.VK,a.On,j.OP,b.gD,Z.ey,y.Ou],pipes:[r.OU,r.Ov],styles:[""]}),o})(),H=(()=>{class o{constructor(t){this._dialog=t,this._search=new I.X(""),this._domain=new I.X(null),this._last_key=new I.X(null),this._change=new I.X(0),this.last_key=this._last_key.asObservable(),this.active_domain=this._domain.asObservable(),this.available_domains=(0,d.R2s)({limit:500}).pipe((0,E.U)(n=>n.data),(0,k.d)(1)),this.available_keys=(0,Q.aj)([this._domain,this._change]).pipe((0,D.w)(([n])=>n?(0,d.IOR)({query_params:{authority_id:n.id},fn:i=>new _e(i),path:"api_keys"}).pipe((0,E.U)(i=>i.data)):(0,G.of)([])),(0,k.d)(1)),this.users=(0,Q.aj)([this._domain,this._search,this._change]).pipe((0,_n.b)(300),(0,D.w)(([n,i])=>n?(0,d.E4d)({authority_id:n.id,q:i}).pipe((0,E.U)(_=>_.data)):(0,G.of)([])),(0,k.d)(1))}setDomain(t){this._domain.next(t)}setSearch(t){this._search.next(t)}newKey(){return(0,f.mG)(this,void 0,void 0,function*(){const t=this._dialog.open(Cn),n=yield Promise.race([t.componentInstance.event.pipe((0,J.P)(l=>"done"===l.reason)).toPromise(),t.afterClosed().toPromise()]);if("done"!==(null==n?void 0:n.reason))return;t.componentInstance.loading="Creating new API key...";const i=this._domain.getValue(),_=yield(0,d.Ue8)({query_params:{},fn:l=>new _e(l),path:"api_keys",form_data:Object.assign(Object.assign({},n.metadata),{authority_id:i.id})}).toPromise().catch(l=>{throw t.close(),(0,p.cB)(l),l});this._last_key.next(_),this._change.next(Date.now()),(0,p.t5)("Successfully created new API key."),t.close()})}removeKey(t){return(0,f.mG)(this,void 0,void 0,function*(){const n=yield(0,U._5)({title:"Remove API Key",content:"Are you sure you wish to remove this API key?\n                    Removing this key may result in applications using this key to stop working.",icon:{content:"delete"}},this._dialog);"done"===(null==n?void 0:n.reason)&&(n.loading("Removing API key..."),yield(0,d.OdJ)({id:t.id,query_params:{},path:"api_keys"}).toPromise(),n.close(),(0,p.t5)("Successfully removed API key."))})}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(u.uw))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),o})();class An{constructor(s,t){this._document=t;const n=this._textarea=this._document.createElement("textarea"),i=n.style;i.position="fixed",i.top=i.opacity="0",i.left="-999em",n.setAttribute("aria-hidden","true"),n.value=s,this._document.body.appendChild(n)}copy(){const s=this._textarea;let t=!1;try{if(s){const n=this._document.activeElement;s.select(),s.setSelectionRange(0,s.value.length),t=this._document.execCommand("copy"),n&&n.focus()}}catch(n){}return t}destroy(){const s=this._textarea;s&&(s.remove(),this._textarea=void 0)}}let En=(()=>{class o{constructor(t){this._document=t}copy(t){const n=this.beginCopy(t),i=n.copy();return n.destroy(),i}beginCopy(t){return new An(t,this._document)}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(r.K0))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var vn=c(239);function Tn(o,s){if(1&o&&(e.TgZ(0,"mat-option",10),e._uU(1),e.qZA()),2&o){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function Sn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",11)(1,"div",12)(2,"label",13),e._uU(3),e.ALo(4,"async"),e.qZA()(),e.TgZ(5,"div",14)(6,"div",15),e.NdJ("click",function(){return e.CHM(t),e.oxw().copyKey()}),e._uU(7),e.ALo(8,"async"),e.qZA()()()}if(2&o){const t=e.oxw();let n,i;e.xp6(3),e.hij(" Last API Key Details (",(null==(n=e.lcZ(4,2,t.last_key))?null:n.name)||"Unanamed API Key",") "),e.xp6(4),e.hij(" ",null==(i=e.lcZ(8,4,t.last_key))?null:i.x_api_key," ")}}function On(o,s){if(1&o&&(e.TgZ(0,"span",30),e._uU(1),e.qZA()),2&o){const t=s.$implicit;e.xp6(1),e.hij(" ",t," ")}}function xn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",25)(1,"div",18),e._uU(2),e.qZA(),e.TgZ(3,"div",19),e._uU(4),e.qZA(),e.TgZ(5,"div",20),e.YNc(6,On,2,1,"span",26),e.qZA(),e.TgZ(7,"div",21),e._uU(8),e.qZA(),e.TgZ(9,"div",18),e._uU(10),e.ALo(11,"dateFrom"),e.qZA(),e.TgZ(12,"div",27)(13,"button",28),e.NdJ("click",function(){const _=e.CHM(t).$implicit;return e.oxw(2).deleteKey(_)}),e._UZ(14,"app-icon",29),e.qZA()()()}if(2&o){const t=s.$implicit;e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description),e.xp6(2),e.Q6J("ngForOf",t.scopes),e.xp6(2),e.Oqu(t.permissions||"None"),e.xp6(2),e.hij(" ",e.lcZ(11,5,1e3*t.created_at)," ")}}function Nn(o,s){if(1&o&&(e.TgZ(0,"div",16)(1,"div",17)(2,"div",18),e._uU(3,"Name"),e.qZA(),e.TgZ(4,"div",19),e._uU(5,"Description"),e.qZA(),e.TgZ(6,"div",20),e._uU(7,"Scopes"),e.qZA(),e.TgZ(8,"div",21),e._uU(9,"Permissions"),e.qZA(),e.TgZ(10,"div",18),e._uU(11,"Created"),e.qZA(),e._UZ(12,"div",22),e.qZA(),e.TgZ(13,"div",23),e.YNc(14,xn,15,7,"div",24),e.ALo(15,"async"),e.qZA()()),2&o){const t=e.oxw();e.xp6(14),e.Q6J("ngForOf",e.lcZ(15,1,t.key_list))}}function Pn(o,s){1&o&&(e.TgZ(0,"div",31)(1,"p"),e._uU(2,"No API Keys"),e.qZA()())}const Mn=[{path:"",component:de,canActivate:[B.w],children:[{path:"about",component:Ee},{path:"database",component:ge},{path:"clusters",component:$e},{path:"interfaces",component:Ge},{path:"brokers",component:We},{path:"edge",component:Ht},{path:"extensions",component:At},{path:"staff-api",component:wt},{path:"schemas",component:on},{path:"api-keys",component:(()=>{class o{constructor(t,n){this._service=t,this._clipboard=n,this.domain=this._service.active_domain,this.domain_list=this._service.available_domains,this.key_list=this._service.available_keys,this.last_key=this._service.last_key,this.setDomain=i=>this._service.setDomain(i),this.newKey=()=>this._service.newKey(),this.deleteKey=i=>this._service.removeKey(i)}copyKey(){return(0,f.mG)(this,void 0,void 0,function*(){const t=yield this.last_key.pipe((0,sn.q)(1)).toPromise();!(null==t?void 0:t.x_api_key)||(this._clipboard.copy(t.x_api_key),(0,p.QD)("Copied API key to clipboard."))})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(H),e.Y36(En))},o.\u0275cmp=e.Xpm({type:o,selectors:[["admin-api-keys"]],decls:18,vars:16,consts:[[1,"flex","items-start","space-x-2","m-4"],[1,"flex","flex-col","space-y-1"],["for","type"],["appearance","outline",1,"h-12"],["name","type","placeholder","Select Domain...",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["mat-button","",1,"mt-8","min-w-[8rem]",3,"disabled","click"],["class","rounded shadow border border-gray-100 min-w-[24rem]",4,"ngIf"],["role","table",4,"ngIf","ngIfElse"],["load_state",""],[3,"value"],[1,"rounded","shadow","border","border-gray-100","min-w-[24rem]"],[1,"border-b","px-2","pb-1","border-gray-200","!w-full"],[1,"p-0","m-0"],[1,"p-2"],[1,"select-all","text-xs","opacity-60","mono","break-words","cursor-pointer",3,"click"],["role","table"],["table-head",""],[1,"w-32","p-2"],[1,"flex-1","p-2"],[1,"w-32","p-2","truncate"],[1,"w-28","p-2"],[1,"w-16","p-2"],["table-body",""],["table-row","",4,"ngFor","ngForOf"],["table-row",""],["class","m-1 px-2 py-1 bg-gray-400 rounded text-xs text-white",4,"ngFor","ngForOf"],[1,"w-16","p-2","flex","items-center"],["mat-icon-button","",3,"click"],["className","backoffice-trash"],[1,"m-1","px-2","py-1","bg-gray-400","rounded","text-xs","text-white"],[1,"flex","flex-col","items-center"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"label",2),e._uU(3,"Domain: "),e.qZA(),e.TgZ(4,"mat-form-field",3)(5,"mat-select",4),e.NdJ("ngModelChange",function(_){return n.setDomain(_)}),e.ALo(6,"async"),e.YNc(7,Tn,2,2,"mat-option",5),e.ALo(8,"async"),e.qZA()()(),e.TgZ(9,"button",6),e.NdJ("click",function(){return n.newKey()}),e.ALo(10,"async"),e._uU(11," Add API Key "),e.qZA(),e.YNc(12,Sn,9,6,"div",7),e.ALo(13,"async"),e.qZA(),e.YNc(14,Nn,16,3,"div",8),e.ALo(15,"async"),e.YNc(16,Pn,3,0,"ng-template",null,9,e.W1O)),2&t){const i=e.MAs(17);let _;e.xp6(5),e.Q6J("ngModel",e.lcZ(6,6,n.domain)),e.xp6(2),e.Q6J("ngForOf",e.lcZ(8,8,n.domain_list)),e.xp6(2),e.Q6J("disabled",!e.lcZ(10,10,n.domain)),e.xp6(3),e.Q6J("ngIf",e.lcZ(13,12,n.last_key)),e.xp6(2),e.Q6J("ngIf",null==(_=e.lcZ(15,14,n.key_list))?null:_.length)("ngIfElse",i)}},directives:[v.KE,b.gD,a.JJ,a.On,r.sg,Z.ey,C.lW,r.O5,h.o],pipes:[r.Ov,vn.R],styles:[""]}),o})()},{path:"extend/:id",component:Ve.z},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:""}];var bn=c(9522);let Zn=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[H],imports:[[r.ez,a.u5,a.UX,F.Bz.forChild(Mn),bn.X]]}),o})()},3491:(le,L,c)=>{c.d(L,{F:()=>B});var r=c(5901),a=c(328),F=c(7269);function B(O=0,x=a.P){return(!(0,F.k)(O)||O<0)&&(O=0),(!x||"function"!=typeof x.schedule)&&(x=a.P),new r.y(N=>(N.add(x.schedule(S,O,{subscriber:N,counter:0,period:O})),N))}function S(O){const{subscriber:x,counter:N,period:R}=O;x.next(N),this.schedule({subscriber:x,counter:N+1,period:R},R)}}}]);
//# sourceMappingURL=727.93b7523ec9836e83.js.map