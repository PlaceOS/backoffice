"use strict";(self.webpackChunkbackoffice=self.webpackChunkbackoffice||[]).push([[886],{8886:(E_,L,s)=>{s.r(L),s.d(L,{AppZonesModule:()=>m_});var m=s(6362),l=s(1876),O=s(9504),B=s(1843),Y=s(8537),T=s(4929),d=s(3650),f=s(4505),N=s(7716),Q=s(4139),q=s(823),u=s(9095),g=s(6942),M=s(7418),P=s(9128),j=s(5670),y=s(2395),H=s(6123),A=s(2016),k=s(3277),e=s(6723),$=s(5758);let p=(()=>{class t{constructor(_,n){this._service=_,this._dialog=n,this._loading=new f.X(!1),this._change=new f.X(!1),this.loading=this._loading.asObservable(),this.item=this._service.item,this.counts=(0,N.aj)([this._service.all_item,this._change]).pipe((0,q.b)(300),(0,u.w)(o=>(0,T.mG)(this,void 0,void 0,function*(){const[a]=o;if(!(a instanceof d.TT8))return{};this._loading.next(!0);const c=yield Promise.all([(0,d.vIL)({zone_id:a.id,limit:1}).pipe((0,g.U)(E=>E.total)).toPromise().catch(E=>0),(0,d.Vgq)(a.id).pipe((0,g.U)(E=>E.total)).toPromise().catch(E=>0),(0,d.Eio)(a.id).pipe((0,g.U)(E=>E.length)).toPromise().catch(E=>0),(0,d.I0G)({parent:a.id,limit:1}).pipe((0,g.U)(E=>E.total)).toPromise().catch(E=>0)]),[r,v,h,R]=c;return this._loading.next(!1),{systems:r,triggers:v,metadata:h,children:R}}))),this.systems=this.item.pipe((0,u.w)(o=>o instanceof d.TT8?(0,d.vIL)({zone_id:o.id}):[]),(0,g.U)(o=>o.data),(0,M.K)(o=>[]),(0,P.d)()),this.triggers=this.item.pipe((0,u.w)(o=>o instanceof d.TT8?(0,d.Vgq)(o.id):[]),(0,g.U)(o=>o.data),(0,M.K)(o=>[]),(0,P.d)()),this.metadata=this.item.pipe((0,u.w)(o=>o instanceof d.TT8?(0,d.Eio)(o.id):(0,Q.of)([])),(0,M.K)(o=>[]),(0,P.d)(1)),this.children=this.item.pipe((0,u.w)(o=>o instanceof d.TT8?(0,d.I0G)({parent:o.id}):[]),(0,g.U)(o=>o.data),(0,M.K)(o=>[]),(0,P.d)()),setTimeout(()=>this._change.next(!this._change.getValue()),1e3)}get active_item(){return this._service.active_item}selectTrigger(){return(0,T.mG)(this,void 0,void 0,function*(){const _=this._dialog.open(k.f,{data:{service_name:"Triggers",query_fn:a=>(0,d.$Um)({q:a}).pipe((0,g.U)(c=>c.data))}}),n=yield Promise.race([_.componentInstance.event.pipe((0,j.P)(a=>"action"===a.reason)).toPromise(),_.afterClosed().toPromise()]);if(!n||!n.reason)return _.close();const o=yield this.addTrigger(_.componentInstance.item);_.close(),o&&this._service.replaceItem(o)})}addTrigger(_){return(0,T.mG)(this,void 0,void 0,function*(){return(0,d.BfP)(this.active_item.id,Object.assign(Object.assign({},this.active_item),{triggers:(0,y.Tw)([...this.active_item.triggers,_.id])})).toPromise()})}removeTrigger(_){return(0,T.mG)(this,void 0,void 0,function*(){const n=yield(0,y._5)({title:"Remove trigger",content:`<p>Are you sure you want remove trigger "${_.name}"?</p><p>Configuration will be updated <strong>immediately</strong>.</p>`,icon:{type:"icon",class:"backoffice-trash"}},this._dialog);if(!n||!n.reason)return;const o=yield(0,d.BfP)(this.active_item.id,Object.assign(Object.assign({},this.active_item),{triggers:this.active_item.triggers.filter(a=>a!==_.id)})).toPromise().catch(a=>{throw n.close(),(0,A.cB)(`Error removing trigger ${_.id} from zone. Error: ${a.statusText||a.message||a}`),a});n.close(),(0,A.t5)("Successfully removed trigger from zone."),o&&this._service.replaceItem(o)})}}return t.\u0275fac=function(_){return new(_||t)(e.LFG(H.L),e.LFG($.uw))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var W=s(9101),V=s(1609);let ee=(()=>{class t extends B.K{constructor(_,n,o){super(),this._service=_,this._route=n,this._router=o,this.name="zones",this.tab_list=[]}get extensions(){return(0,Y.fq)(this._service.active_item,this.name)}updateTabList(_){console.log("Details:",_),this.tab_list=[{id:"about",name:"About",icon:{class:"backoffice-info-with-circle"}},{id:"systems",name:"Systems",count:_.systems,icon:{class:"backoffice-documents"}},{id:"triggers",name:"Triggers",count:_.triggers,icon:{class:"backoffice-stopwatch"}},{id:"metadata",name:"Metadata",count:_.metadata,icon:{class:"backoffice-gist"}},{id:"children",name:"Children",count:_.children,icon:{class:"backoffice-flow-tree"}},{id:"history",name:"Settings History",icon:{class:"backoffice-clock"}}].concat(this.extensions)}ngOnInit(){this.subscription("item",this._service.counts.subscribe(_=>this.updateTabList(_))),this.updateTabList({})}}return t.\u0275fac=function(_){return new(_||t)(e.Y36(p),e.Y36(O.gz),e.Y36(O.F0))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-zones"]],features:[e.qOj],decls:3,vars:1,consts:[[1,"flex-1","flex-col","sm:flex-row","flex","h-full","w-full","relative"],["heading","Zones","name","zones",1,"absolute","top-0","left-0","h-12","w-full","sm:h-full","sm:static"],["name","zone","route","zones",1,"flex-1","relative","mt-12","sm:mt-0","w-full","sm:w-1/2",3,"tabs"]],template:function(_,n){1&_&&(e.TgZ(0,"div",0),e._UZ(1,"sidebar",1)(2,"item-display",2),e.qZA()),2&_&&(e.xp6(2),e.Q6J("tabs",n.tab_list))},directives:[W.k,V.s],styles:["sidebar[_ngcontent-%COMP%]{transition:height .3s}@media screen and (min-width: 640px){sidebar[_ngcontent-%COMP%]{width:20em!important}}\n/*# sourceMappingURL=zones.component.ts-angular-inline--45.css.map*/"]}),t})();var _e=s(4611),C=s(4770),te=s(1434),ne=s(1130),oe=s(1184),K=s(1196),ie=s(3436),I=s(4742),U=s(9433);function ae(t,i){1&t&&(e.TgZ(0,"header",7),e.SDv(1,12),e.qZA())}function se(t,i){if(1&t&&(e.TgZ(0,"mat-option",18),e._uU(1),e.qZA()),2&t){const _=i.$implicit;e.Q6J("value",_),e.xp6(1),e.hij(" ",_.name," ")}}function le(t,i){if(1&t&&e._UZ(0,"execute-method-field",19),2&t){const _=e.oxw(2);e.Q6J("system",_.active_system)}}function ce(t,i){if(1&t){const _=e.EpF();e.TgZ(0,"section",13)(1,"mat-form-field",14)(2,"mat-select",15),e.NdJ("ngModelChange",function(o){return e.CHM(_),e.oxw().active_system=o}),e.YNc(3,se,2,2,"mat-option",16),e.ALo(4,"async"),e.qZA()(),e.YNc(5,le,1,1,"execute-method-field",17),e.qZA()}if(2&t){const _=e.oxw();e.xp6(2),e.Q6J("ngModel",_.active_system),e.xp6(1),e.Q6J("ngForOf",e.lcZ(4,3,_.systems)),e.xp6(2),e.Q6J("ngIf",_.active_system&&_.active_system.id)}}const de=function(t){return["/zones",t,"about"]};function re(t,i){if(1&t&&(e.TgZ(0,"div",20)(1,"label"),e.SDv(2,21),e.qZA(),e.TgZ(3,"div",22)(4,"a",23),e._uU(5),e.qZA()()()),2&t){const _=e.oxw();e.xp6(4),e.Q6J("routerLink",e.VKq(2,de,null==_.item?null:_.item.parent_id)),e.xp6(1),e.Oqu(null==_.item?null:_.item.parent_id)}}function me(t,i){if(1&t&&(e.TgZ(0,"div",20)(1,"label"),e.SDv(2,24),e.qZA(),e.TgZ(3,"div",25),e._uU(4),e.ALo(5,"dateFrom"),e.qZA()()),2&t){const _=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,1,1e3*(null==_.item?null:_.item.created_at))," ")}}function Ee(t,i){if(1&t&&(e.TgZ(0,"div",20)(1,"label"),e.SDv(2,26),e.qZA(),e.TgZ(3,"div",25),e._uU(4),e.ALo(5,"dateFrom"),e.qZA()()),2&t){const _=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,1,1e3*(null==_.item?null:_.item.updated_at))," ")}}function Se(t,i){if(1&t&&(e.TgZ(0,"div",20)(1,"label"),e.SDv(2,27),e.qZA(),e.TgZ(3,"div",25),e._uU(4),e.qZA()()),2&t){const _=e.oxw();e.xp6(4),e.Oqu(null==_.item?null:_.item.location)}}function ge(t,i){if(1&t&&(e.TgZ(0,"div",20)(1,"label"),e.SDv(2,28),e.qZA(),e.TgZ(3,"div",25),e._uU(4),e.qZA()()),2&t){const _=e.oxw();e.xp6(4),e.Oqu(null==_.item?null:_.item.code)}}function Oe(t,i){if(1&t&&(e.TgZ(0,"div",20)(1,"label"),e.SDv(2,29),e.qZA(),e.TgZ(3,"div",25),e._uU(4),e.qZA()()),2&t){const _=e.oxw();e.xp6(4),e.Oqu(null==_.item?null:_.item.type)}}function Ae(t,i){if(1&t&&(e.TgZ(0,"div",20)(1,"label"),e.SDv(2,30),e.qZA(),e.TgZ(3,"div",25),e._uU(4),e.qZA()()),2&t){const _=e.oxw();e.xp6(4),e.Oqu(null==_.item?null:_.item.count)}}function Ce(t,i){if(1&t&&(e.TgZ(0,"div",20)(1,"label"),e.SDv(2,31),e.qZA(),e.TgZ(3,"div",25),e._uU(4),e.qZA()()),2&t){const _=e.oxw();e.xp6(4),e.Oqu(null==_.item?null:_.item.capacity)}}function pe(t,i){if(1&t&&(e.TgZ(0,"div",20)(1,"label"),e.SDv(2,32),e.qZA(),e.TgZ(3,"a",33),e._uU(4),e.qZA()()),2&t){const _=e.oxw();e.xp6(3),e.Q6J("href",null==_.item?null:_.item.map_id,e.LSH),e.xp6(1),e.Oqu(null==_.item?null:_.item.map_id)}}function fe(t,i){1&t&&(e.TgZ(0,"header",7),e.SDv(1,34),e.qZA())}function ue(t,i){if(1&t&&e._UZ(0,"section",35),2&t){const _=e.oxw();e.Q6J("innerHTML",_.parsed_description,e.oJD)}}function Te(t,i){if(1&t&&(e.TgZ(0,"mat-chip"),e._uU(1),e.qZA()),2&t){const _=i.$implicit;e.xp6(1),e.Oqu(_)}}function Ne(t,i){if(1&t&&(e.TgZ(0,"div",25)(1,"mat-chip-list",40),e.YNc(2,Te,2,1,"mat-chip",41),e.qZA()()),2&t){const _=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",_.tag_list)}}function Me(t,i){if(1&t&&(e.TgZ(0,"section",36)(1,"label",37),e.SDv(2,38),e.qZA(),e.YNc(3,Ne,3,1,"div",39),e.qZA()),2&t){const _=e.oxw(),n=e.MAs(24);e.xp6(3),e.Q6J("ngIf",_.tag_list&&_.tag_list.length)("ngIfElse",n)}}function Pe(t,i){if(1&t&&(e.TgZ(0,"section"),e._UZ(1,"a-settings-form",42),e.qZA()),2&t){const _=e.oxw();e.xp6(1),e.Q6J("merge",!0)("id",null==_.item?null:_.item.id)("settings",null==_.item?null:_.item.settings)}}function Ze(t,i){1&t&&(e.TgZ(0,"div",43),e._UZ(1,"mat-spinner",44),e.TgZ(2,"p"),e.SDv(3,45),e.qZA()())}function Fe(t,i){1&t&&(e.TgZ(0,"p",46),e.SDv(1,47),e.qZA())}let ve=(()=>{class t{constructor(_){this._service=_,this.systems=this._service.systems}get item(){return this._service.active_item}get parsed_description(){var _;return this.item?(0,_e.TU)(null===(_=this.item)||void 0===_?void 0:_.description):""}get tag_list(){var _;return this.item?null===(_=this.item)||void 0===_?void 0:_.tags:[]}}return t.\u0275fac=function(_){return new(_||t)(e.Y36(p))},t.\u0275cmp=e.Xpm({type:t,selectors:[["zone-about"]],decls:25,vars:20,consts:function(){let i,_,n,o,a,c,r,v,h,R,E,D,J,G,w;return i=$localize`:@@settingsLabel␟5ba97a3f90a79c4d7720b941ae416c8c84337e38␟180274732945114229: Settings `,_=$localize`:@@execHeader␟6e9fe55331b587290e95336846799c928c323b8f␟5406219849635212445: Execute Command `,n=$localize`:@@zoneParentLabel␟8dce5a1b53185785ceb8eaece03a45f95a1058ae␟1730450554195977822:Parent ID:`,o=$localize`:@@zoneCreatedAtLabel␟a5ed099ffc9e96f6970df843289ade8a7d20ab9f␟1616250945945379783:Created:`,a=$localize`:@@zoneUpdatedAtLabel␟f94240161f912dbd8758b858877cddeab80f36cb␟1116759395536210856:Updated:`,c=$localize`:@@zoneLocationLabel␟4bebbae34f84157c0b5b852529f0bc2c39a5a38a␟4510013877734913501:Location:`,r=$localize`:@@zoneCodeLabel␟08a3263c58aafca24f31b3f312d90934a14069e5␟4793952596010266372:Code:`,v=$localize`:@@zoneTypeLabel␟b2ec946dbfa29aa3430b9999250edf9a2a6e3552␟2473796624751549543:Type: `,h=$localize`:@@zoneCountLabel␟e684046d73bcee88e82f7ff01e2852789a05fc32␟6836949342567686088:Count:`,R=$localize`:@@zoneCapacityLabel␟a1170e85d1897210d5fe03d1f363587de15d02cd␟8062822823331512246:Capacity:`,E=$localize`:@@zoneMapLabel␟b59ac98267a9fea534d729d6021e4ad108b9166e␟5947091241433737383:Map:`,D=$localize`:@@descriptionLabel␟91d130f4d03590d2ab82ec6ccd644aaff7dbf49c␟7630730180260398735: Description `,J=$localize`:@@zoneTagsLabel␟d1c4e9d07d3789fb1c66dec61f2d52c6b81b10f6␟7952806382632077864:Tags:`,G=$localize`:@@zoneLoadingLabel␟adb8ef1c4f047ddce91397fb4d8f83acc47f4649␟1768664919049731907:Loading zone settings...`,w=$localize`:@@zoneTagsEmpty␟48171f6d8b15daa87a49496d685bd03bb4f84253␟1765229228159298837: <No Tags> `,[["class","font-medium text-lg",4,"ngIf"],["class","mb-4",4,"ngIf"],[1,"space-y-2"],["class","flex items-center space-x-2",4,"ngIf"],["class","description",3,"innerHTML",4,"ngIf"],["class","flex space-x-2 mt-1",4,"ngIf"],[1,"my-4"],[1,"font-medium","text-lg"],i,[4,"ngIf","ngIfElse"],["load_state",""],["empty_tag_state",""],_,[1,"mb-4"],["appearance","outline",1,"h-12"],["placeholder","Select system",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"system",4,"ngIf"],[3,"value"],[3,"system"],[1,"flex","items-center","space-x-2"],n,[1,"value","underline"],[3,"routerLink"],o,[1,"value"],a,c,r,v,h,R,E,[1,"underline",3,"href"],D,[1,"description",3,"innerHTML"],[1,"flex","space-x-2","mt-1"],["for","tags",1,"my-1"],J,["class","value",4,"ngIf","ngIfElse"],["name","tags"],[4,"ngFor","ngForOf"],[3,"merge","id","settings"],[1,"flex","flex-col","items-center","p-8"],["diameter","48",1,"mb-4"],G,[1,"text-center","py-1"],w]},template:function(_,n){if(1&_&&(e.YNc(0,ae,2,0,"header",0),e.ALo(1,"async"),e.YNc(2,ce,6,5,"section",1),e.ALo(3,"async"),e.TgZ(4,"section",2),e.YNc(5,re,6,4,"div",3),e.YNc(6,me,6,3,"div",3),e.YNc(7,Ee,6,3,"div",3),e.YNc(8,Se,5,1,"div",3),e.YNc(9,ge,5,1,"div",3),e.YNc(10,Oe,5,1,"div",3),e.YNc(11,Ae,5,1,"div",3),e.YNc(12,Ce,5,1,"div",3),e.YNc(13,pe,5,2,"div",3),e.qZA(),e.YNc(14,fe,2,0,"header",0),e.YNc(15,ue,1,1,"section",4),e.YNc(16,Me,4,2,"section",5),e._UZ(17,"hr",6),e.TgZ(18,"header",7),e.SDv(19,8),e.qZA(),e.YNc(20,Pe,2,3,"section",9),e.YNc(21,Ze,4,0,"ng-template",null,10,e.W1O),e.YNc(23,Fe,2,0,"ng-template",null,11,e.W1O)),2&_){const o=e.MAs(22);let a,c;e.Q6J("ngIf",null==(a=e.lcZ(1,16,n.systems))?null:a.length),e.xp6(2),e.Q6J("ngIf",null==(c=e.lcZ(3,18,n.systems))?null:c.length),e.xp6(3),e.Q6J("ngIf",null==n.item?null:n.item.parent_id),e.xp6(1),e.Q6J("ngIf",null==n.item?null:n.item.created_at),e.xp6(1),e.Q6J("ngIf",null==n.item?null:n.item.updated_at),e.xp6(1),e.Q6J("ngIf",null==n.item?null:n.item.location),e.xp6(1),e.Q6J("ngIf",null==n.item?null:n.item.code),e.xp6(1),e.Q6J("ngIf",null==n.item?null:n.item.type),e.xp6(1),e.Q6J("ngIf",null==n.item?null:n.item.count),e.xp6(1),e.Q6J("ngIf",null==n.item?null:n.item.capacity),e.xp6(1),e.Q6J("ngIf",null==n.item?null:n.item.map_id),e.xp6(1),e.Q6J("ngIf",null==n.item?null:n.item.description),e.xp6(1),e.Q6J("ngIf",null==n.item?null:n.item.description),e.xp6(1),e.Q6J("ngIf",n.item&&n.tag_list),e.xp6(4),e.Q6J("ngIf",null==n.item?null:n.item.settings)("ngIfElse",o)}},directives:[m.O5,C.KE,te.gD,l.JJ,l.On,m.sg,ne.ey,oe.Q,O.yS,K.qn,K.HS,ie.v,I.$g],pipes:[m.Ov,U.R],styles:["[_nghost-%COMP%]{padding:1rem;height:100%;width:100%}\n/*# sourceMappingURL=zone-about.component.ts-angular-inline--46.css.map*/"]}),t})();var Z=s(1259),b=s(4683),x=s(89);const he=function(t){return["/systems",t]};function Re(t,i){if(1&t&&(e.TgZ(0,"div",16)(1,"div",17)(2,"a",18),e._uU(3),e.qZA()(),e.TgZ(4,"div",10),e._uU(5),e.qZA(),e.TgZ(6,"div",12),e._uU(7),e.ALo(8,"dateFrom"),e.qZA()()),2&t){const _=i.$implicit;e.xp6(2),e.Q6J("routerLink",e.VKq(7,he,_.id))("matTooltip",_.id),e.xp6(1),e.hij(" ",_.name," "),e.xp6(2),e.Oqu(_.modules.length),e.xp6(2),e.Oqu(e.lcZ(8,5,1e3*(null==_?null:_.created_at)))}}function Ie(t,i){if(1&t&&(e.TgZ(0,"div",6)(1,"div",7)(2,"div",8),e.SDv(3,9),e.qZA(),e.TgZ(4,"div",10),e.SDv(5,11),e.qZA(),e.TgZ(6,"div",12),e.SDv(7,13),e.qZA()(),e.TgZ(8,"div",14),e.YNc(9,Re,9,9,"div",15),e.ALo(10,"async"),e.qZA()()),2&t){const _=e.oxw();e.xp6(9),e.Q6J("ngForOf",e.lcZ(10,1,_.systems))}}function Ue(t,i){1&t&&(e.TgZ(0,"div",19)(1,"p"),e.SDv(2,20),e.qZA()())}let be=(()=>{class t{constructor(_){this._state=_,this.filter$=new f.X(""),this.systems=(0,N.aj)([this.filter$,this._state.systems]).pipe((0,g.U)(n=>{const[o,a]=n,c=o.toLowerCase();return o?a.filter(r=>r.name.toLowerCase().includes(c)):a}))}}return t.\u0275fac=function(_){return new(_||t)(e.Y36(p))},t.\u0275cmp=e.Xpm({type:t,selectors:[["zone-systems"]],decls:8,vars:5,consts:function(){let i,_,n,o;return i=$localize`:@@systemTableName␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,_=$localize`:@@systemTablePanelCount␟6c24d3e08bc16576fbd5580dc255a31c4b08c366␟8919524640139321287:No. Modules`,n=$localize`:@@systemTableCreated␟1b051734b0ee9021991c91b3ed4e81c244322462␟4207916966377787111:Created`,o=$localize`:@@systemTableEmpty␟443361e57db2ac76049b227574b4a6b8a67ae879␟6249884397292386469:No systems found`,[[1,"flex"],["appearance","outline",1,"flex-1"],["matPrefix","","className","backoffice-magnifying-glass",1,"text-lg"],["matInput","","name","search-filter","placeholder","Filter Systems",3,"ngModel","ngModelChange"],["role","table",4,"ngIf","ngIfElse"],["empty_state",""],["role","table"],["table-head",""],[1,"flex-1","p-2"],i,[1,"w-28","p-2"],_,[1,"w-32","p-2"],n,["table-body",""],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"flex-1","p-2","underline"],["matTooltipPosition","right",3,"routerLink","matTooltip"],[1,"flex","flex-col","items-center","p-8"],o]},template:function(_,n){if(1&_&&(e.TgZ(0,"div",0)(1,"mat-form-field",1),e._UZ(2,"app-icon",2),e.TgZ(3,"input",3),e.NdJ("ngModelChange",function(a){return n.filter$.next(a)}),e.qZA()()(),e.YNc(4,Ie,11,3,"div",4),e.ALo(5,"async"),e.YNc(6,Ue,3,0,"ng-template",null,5,e.W1O)),2&_){const o=e.MAs(7);let a;e.xp6(3),e.Q6J("ngModel",""),e.xp6(1),e.Q6J("ngIf",null==(a=e.lcZ(5,3,n.systems))?null:a.length)("ngIfElse",o)}},directives:[C.KE,Z.o,C.qo,b.Nt,l.Fj,l.JJ,l.On,m.O5,m.sg,O.yS,x.gM],pipes:[m.Ov,U.R],styles:["[_nghost-%COMP%]{padding:1rem;width:100%;height:100%}\n/*# sourceMappingURL=zone-systems.component.ts-angular-inline--47.css.map*/"]}),t})();var X=s(7317);const xe=function(t){return["/triggers",t]};function Le(t,i){if(1&t){const _=e.EpF();e.TgZ(0,"div",18)(1,"div",11)(2,"a",19),e._uU(3),e.qZA()(),e.TgZ(4,"div",20),e._uU(5),e.ALo(6,"dateFrom"),e.qZA(),e.TgZ(7,"div",21)(8,"button",22),e.NdJ("click",function(){const a=e.CHM(_).$implicit;return e.oxw(3).deleteTrigger(a)}),e._UZ(9,"app-icon",23),e.qZA()()()}if(2&t){const _=i.$implicit;e.xp6(2),e.Q6J("routerLink",e.VKq(5,xe,_.id)),e.xp6(1),e.Oqu(_.name),e.xp6(2),e.hij(" ",e.lcZ(6,3,1e3*+_.created_at)," ")}}function Be(t,i){if(1&t&&(e.TgZ(0,"div",9)(1,"div",10)(2,"div",11),e.SDv(3,12),e.qZA(),e.TgZ(4,"div",13),e.SDv(5,14),e.qZA(),e._UZ(6,"div",15),e.qZA(),e.TgZ(7,"div",16),e.YNc(8,Le,10,7,"div",17),e.ALo(9,"async"),e.qZA()()),2&t){const _=e.oxw(2);e.xp6(8),e.Q6J("ngForOf",e.lcZ(9,1,_.triggers))}}function ye(t,i){if(1&t&&(e.ynx(0),e.YNc(1,Be,10,3,"div",8),e.ALo(2,"async"),e.BQk()),2&t){const _=e.oxw(),n=e.MAs(12);let o;e.xp6(1),e.Q6J("ngIf",null==(o=e.lcZ(2,2,_.triggers))?null:o.length)("ngIfElse",n)}}function $e(t,i){1&t&&(e.TgZ(0,"div",24),e._UZ(1,"mat-spinner",25),e.TgZ(2,"p"),e._uU(3,"Loading triggers..."),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("diameter",48))}function Ke(t,i){1&t&&(e.TgZ(0,"div",24)(1,"p"),e._uU(2,"No triggers for zone"),e.qZA()())}let Xe=(()=>{class t{constructor(_){this._state=_,this.filter$=new f.X(""),this.triggers=(0,N.aj)([this.filter$,this._state.triggers]).pipe((0,g.U)(n=>{const[o,a]=n,c=o.toLowerCase();return o?a.filter(r=>r.name.toLowerCase().includes(c)):a})),this.loading=this._state.loading,this.selectTrigger=()=>this._state.selectTrigger(),this.deleteTrigger=n=>this._state.removeTrigger(n)}get item(){return this._state.active_item}}return t.\u0275fac=function(_){return new(_||t)(e.Y36(p))},t.\u0275cmp=e.Xpm({type:t,selectors:[["zone-triggers"]],decls:13,vars:5,consts:function(){let i,_;return i=$localize`:@@nameLabel␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,_=$localize`:@@descriptionLabel␟80e3b490720757978c99a7b5af3885faf202b955␟231679111972850796:Added`,[[1,"flex","items-center","mb-4","space-x-2"],["mat-button","",2,"min-width","8rem",3,"click"],["appearance","outline",1,"h-12","flex-1"],["matPrefix","","className","backoffice-magnifying-glass text-xl mr-2"],["matInput","","placeholder","Filter triggers...",1,"rounded-none",3,"ngModel","ngModelChange"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],["role","table","class","overflow-x-auto",4,"ngIf","ngIfElse"],["role","table",1,"overflow-x-auto"],["table-head",""],["flex","",1,"flex-1","p-2"],i,[1,"w-28","p-2"],_,[1,"w-32","p-2"],["table-body","",1,"overflow-y-auto"],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"truncate",3,"routerLink"],["desc","",1,"w-28","p-2"],[1,"w-32","p-2","items-center","justify-center"],["mat-icon-button","",3,"click"],["className","backoffice-trash"],[1,"flex","flex-col","items-center","p-8","mx-auto"],[1,"mb-4",3,"diameter"]]},template:function(_,n){if(1&_&&(e.TgZ(0,"section",0)(1,"button",1),e.NdJ("click",function(){return n.selectTrigger()}),e._uU(2," Add Trigger "),e.qZA(),e.TgZ(3,"mat-form-field",2),e._UZ(4,"app-icon",3),e.TgZ(5,"input",4),e.NdJ("ngModelChange",function(a){return n.filter$.next(a)}),e.qZA()()(),e.TgZ(6,"section"),e.YNc(7,ye,3,4,"ng-container",5),e.ALo(8,"async"),e.qZA(),e.YNc(9,$e,4,1,"ng-template",null,6,e.W1O),e.YNc(11,Ke,3,0,"ng-template",null,7,e.W1O)),2&_){const o=e.MAs(10);e.xp6(5),e.Q6J("ngModel",""),e.xp6(2),e.Q6J("ngIf",!e.lcZ(8,3,n.loading))("ngIfElse",o)}},directives:[X.lW,C.KE,Z.o,C.qo,b.Nt,l.Fj,l.JJ,l.On,m.O5,m.sg,O.yS,I.$g],pipes:[m.Ov,U.R],styles:["[_nghost-%COMP%]{padding:1rem;width:100%;height:100%}\n/*# sourceMappingURL=zone-triggers.component.ts-angular-inline--48.css.map*/"]}),t})();const ze=function(t){return["/zone",t]};function De(t,i){if(1&t&&(e.TgZ(0,"div",14)(1,"div",15)(2,"a",16),e._uU(3),e.TgZ(4,"span",17),e._uU(5),e.qZA(),e._uU(6,") "),e.qZA()(),e.TgZ(7,"div",10),e._uU(8),e.qZA()()),2&t){const _=i.$implicit;e.xp6(2),e.Q6J("routerLink",e.VKq(5,ze,_.id))("matTooltip",_.id),e.xp6(1),e.hij(" ",_.name," ("),e.xp6(2),e.Oqu(_.id),e.xp6(3),e.Oqu(_.description)}}function Je(t,i){if(1&t&&(e.TgZ(0,"div",6)(1,"div",7)(2,"div",8),e.SDv(3,9),e.qZA(),e.TgZ(4,"div",10),e.SDv(5,11),e.qZA()(),e.TgZ(6,"div",12),e.YNc(7,De,9,7,"div",13),e.ALo(8,"async"),e.qZA()()),2&t){const _=e.oxw();e.xp6(7),e.Q6J("ngForOf",e.lcZ(8,1,_.children))}}function Ge(t,i){1&t&&(e.TgZ(0,"div",18),e.SDv(1,19),e.qZA())}let we=(()=>{class t{constructor(_){this._state=_,this.filter$=new f.X(""),this.children=(0,N.aj)([this.filter$,this._state.children]).pipe((0,g.U)(n=>{const[o,a]=n,c=o.toLowerCase();return o?a.filter(r=>r.name.toLowerCase().includes(c)):a})),this.loading=this._state.loading}get item(){return this._state.active_item}}return t.\u0275fac=function(_){return new(_||t)(e.Y36(p))},t.\u0275cmp=e.Xpm({type:t,selectors:[["zone-children"]],decls:8,vars:5,consts:function(){let i,_,n,o;return i=$localize`:@@zoneChildrenTableFilter␟48b4cc111b7400e0a4602f4805cab66025dbb55d␟8361856721210143570:Filter Zones`,_=$localize`:@@zoneChildrenTableName␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,n=$localize`:@@descriptionLabel␟eec715de352a6b114713b30b640d319fa78207a0␟4902817035128594900:Description`,o=$localize`:@@zoneChildrenTableEmpty␟1b895a59396d575379143c2deec22ed0c1d65834␟1207585495728440175: No child zones found `,[[1,"flex","items-center"],["appearance","outline",1,"flex-1"],["matPrefix","","className","backoffice-magnifying-glass",1,"text-lg"],["matInput","","name","search-filter","placeholder",i,3,"ngModel","ngModelChange"],["role","table",4,"ngIf","ngIfElse"],["empty_state",""],["role","table"],["table-head",""],[1,"flex-1","p-2"],_,[1,"w-3/5","p-2"],n,["table-body",""],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"flex-1","p-2","underline"],["routerLinkActive","router-link-active",3,"routerLink","matTooltip"],[1,"id"],[1,"flex","flex-col","items-center","p-8"],o]},template:function(_,n){if(1&_&&(e.TgZ(0,"div",0)(1,"mat-form-field",1),e._UZ(2,"app-icon",2),e.TgZ(3,"input",3),e.NdJ("ngModelChange",function(a){return n.filter$.next(a)}),e.qZA()()(),e.YNc(4,Je,9,3,"div",4),e.ALo(5,"async"),e.YNc(6,Ge,2,0,"ng-template",null,5,e.W1O)),2&_){const o=e.MAs(7);let a;e.xp6(3),e.Q6J("ngModel",""),e.xp6(1),e.Q6J("ngIf",(null==(a=e.lcZ(5,3,n.children))?null:a.length)>0)("ngIfElse",o)}},directives:[C.KE,Z.o,C.qo,b.Nt,l.Fj,l.JJ,l.On,m.O5,m.sg,O.yS,O.Od,x.gM],pipes:[m.Ov],styles:["[_nghost-%COMP%]{padding:1rem;width:100%;height:100%}\n/*# sourceMappingURL=zone-children.component.ts-angular-inline--49.css.map*/"]}),t})();var Ye=s(4906),Qe=s(3088),z=s(9431),qe=s(8024),F=s(6531),je=s(1452);function He(t,i){if(1&t){const _=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(o){return o.stopPropagation()})("click",function(){e.CHM(_);const o=e.oxw(3).$implicit;return e.oxw(3).saveMetadata(o)}),e.SDv(1,20),e.qZA()}}function ke(t,i){if(1&t&&(e.ynx(0),e.YNc(1,He,2,0,"button",18),e.BQk()),2&t){const _=e.oxw(2).$implicit,n=e.oxw(3),o=e.MAs(4);e.xp6(1),e.Q6J("ngIf",!n.loading[_.name])("ngIfElse",o)}}const We=function(){return{class:"backoffice-trash"}};function Ve(t,i){if(1&t){const _=e.EpF();e.TgZ(0,"div",21)(1,"button",22),e.NdJ("click",function(){e.CHM(_);const o=e.oxw(2).$implicit;return e.oxw(3).deleteMetadata(o.name)}),e._UZ(2,"app-icon",14),e.qZA()()}2&t&&(e.xp6(2),e.Q6J("icon",e.DdM(1,We)))}const e_=function(){return{class:"backoffice-edit"}};function __(t,i){if(1&t){const _=e.EpF();e.TgZ(0,"mat-expansion-panel",10)(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"div",11),e._uU(4),e.qZA(),e.YNc(5,ke,2,2,"ng-container",12),e.TgZ(6,"button",13),e.NdJ("click",function(o){e.CHM(_);const a=e.oxw().$implicit;return e.oxw(3).editMetadataDetails(a),o.stopPropagation()}),e._UZ(7,"app-icon",14),e.qZA(),e.YNc(8,Ve,3,2,"div",15),e.qZA()(),e.TgZ(9,"div",16),e._UZ(10,"settings-form-field",17),e.qZA()()}if(2&t){const _=e.oxw().$implicit,n=e.oxw(3);e.ekj("no-padding",!0),e.Q6J("formGroup",n.form_map[_.name]),e.xp6(4),e.hij(" ",n.form_map[_.name].controls.name.value," "),e.xp6(1),e.Q6J("ngIf",n.edited[_.name]),e.xp6(2),e.Q6J("icon",e.DdM(9,e_)),e.xp6(1),e.Q6J("ngIf",!_.new),e.xp6(2),e.Q6J("schema",n.schema_map[_.name])("readonly",!1)}}function t_(t,i){if(1&t&&(e.ynx(0),e.YNc(1,__,11,10,"mat-expansion-panel",9),e.BQk()),2&t){const _=i.$implicit,n=e.oxw(3);e.xp6(1),e.Q6J("ngIf",n.form_map[_.name])}}function n_(t,i){if(1&t&&(e.TgZ(0,"div",7)(1,"mat-accordion"),e.YNc(2,t_,2,1,"ng-container",8),e.qZA()()),2&t){const _=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",_.metadata)}}function o_(t,i){if(1&t){const _=e.EpF();e.TgZ(0,"div",3)(1,"button",4),e.NdJ("click",function(){return e.CHM(_),e.oxw().newMetadata()}),e.SDv(2,5),e.qZA(),e.YNc(3,n_,3,1,"div",6),e.qZA()}if(2&t){const _=e.oxw(),n=e.MAs(2);e.xp6(3),e.Q6J("ngIf",null==_.metadata?null:_.metadata.length)("ngIfElse",n)}}function i_(t,i){1&t&&(e.TgZ(0,"div",23),e.SDv(1,24),e.qZA())}function a_(t,i){1&t&&e._UZ(0,"mat-spinner",25)}let s_=(()=>{class t extends B.K{constructor(_,n,o){super(),this._dialog=_,this._service=n,this._schemas=o,this.form_map={},this.edited={},this.loading={},this.schema_map={}}get item(){return this._service.active_item}validateName(_){return n=>_.indexOf(n.value)>=0?{name:!0}:null}ngOnInit(){this.subscription("metadata",this._service.metadata.subscribe(_=>{this.metadata=_||[],this.generateForms()}))}newMetadata(){this.metadata||(this.metadata=[]),this.metadata.push({name:`new_field_${Math.floor(999999999*Math.random())}`,description:"",new:!0,details:{}}),this.generateForms()}editMetadataDetails(_){this._dialog.open(Qe.v,{maxWidth:"95vw",data:{form:this.form_map[_.name]}})}deleteMetadata(_){const n=this._dialog.open(z.z,Object.assign(Object.assign({},z.t),{data:{title:"Kill process",content:`\n                    <p>Are you sure you want delete the metadata property "${_}"?</p>\n                `,icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("confirm",n.componentInstance.event.subscribe(o=>{"done"===o.reason&&(0,d._p1)(this.item.id,{name:_}).subscribe(()=>{(0,A.t5)(`Successfully removed "${_}" metadata.`),this.metadata=this.metadata.filter(a=>a.name!==_),this.generateForms()},a=>(0,A.cB)(`Error removing old "${_}" metadata. Error: ${a.response||a.message||a}`)),n.close()}))}saveMetadata(_){const n=this.form_map[_.name];if(n.markAllAsTouched(),!n.valid)return(0,A.cB)(`JSON for property "${n.controls.name.value}" is invalid`);const o=n.value;this.loading[_.name]=!0,(0,d.Ymr)(this.item.id,Object.assign(Object.assign({},o),{details:JSON.parse(o.details)})).subscribe(a=>{this.loading[_.name]=!1;const c=this.metadata.findIndex(r=>r.name===_.name);this.edited[_.name]=!1,_.name!==a.name&&(0,d._p1)(this.item.id,_).toPromise().catch(r=>(0,A.cB)(`Error removing old "${_.name}" metadata. Error: ${JSON.stringify(r.response||r.message||r)}`)),c>=0&&this.metadata.splice(c,1,Object.assign(Object.assign({},a),{new:!1})),(0,A.t5)(`Saved "${o.name}" metadata.`),this.generateForms()},a=>{this.loading[_.name]=!1,(0,A.cB)(`Error saving "${o.name}" metadata. Error: ${JSON.stringify(a.response||a.message||a)}`)})}generateForms(){delete this.form_map,this.form_map={},this.metadata.forEach(_=>{const n="string"==typeof _.details?JSON.parse(_.details):_.details;this.form_map[_.name]=new l.cw({name:new l.NI(_.name,[l.kI.required,this.validateName(this.metadata.filter(o=>o.name!==_.name).map(o=>o.name))]),description:new l.NI(_.description),editors:new l.NI(_.editors),details:new l.NI(JSON.stringify(n||{},void 0,4),[l.kI.required,Ye.NS]),schema:new l.NI(_.schema)}),this.subscription(`${_.name}_changes`,this.form_map[_.name].valueChanges.subscribe(()=>this.edited[_.name]=!0)),this.subscription(`${_.name}_schema`,this.form_map[_.name].controls.schema.valueChanges.subscribe(o=>{let a=this._schemas.getSchema(o);if(!a)try{a=JSON.parse(o)}catch(c){a={}}this.schema_map[_.name]=a}))})}}return t.\u0275fac=function(_){return new(_||t)(e.Y36($.uw),e.Y36(p),e.Y36(qe.O))},t.\u0275cmp=e.Xpm({type:t,selectors:[["zone-metadata"]],features:[e.qOj],decls:5,vars:1,consts:function(){let i,_,n;return i=$localize`:@@addMetadataAction␟21539c364f82b6b766d912c3734a014cb30f27a9␟6503325999299484981: Add new Metadata Field `,_=$localize`:@@saveAction␟baa3a276f05a6226cb663918714882c53b84da34␟25086637338905953: Save `,n=$localize`:@@zoneMetadataEmpty␟2bd9761768337769895eb2434531437eff6955ec␟5420436980181509251: No zone metadata found `,[["class","p-4",4,"ngIf"],["empty_state",""],["load_state",""],[1,"p-4"],["mat-button","",3,"click"],i,["class","mt-4",4,"ngIf","ngIfElse"],[1,"mt-4"],[4,"ngFor","ngForOf"],[3,"no-padding","formGroup",4,"ngIf"],[3,"formGroup"],["edit","",1,"flex-1"],[4,"ngIf"],["mat-icon-button","","matTooltip","Edit Metadata Settings",3,"click"],[3,"icon"],["class","contents",4,"ngIf"],[1,"settings"],["formControlName","details","lang","json",3,"schema","readonly"],["mat-button","","save","",3,"click",4,"ngIf","ngIfElse"],["mat-button","","save","",3,"click"],_,[1,"contents"],["mat-icon-button","","matTooltip","Remove Metadata",3,"click"],[1,"p-8","text-center"],n,["diameter","32"]]},template:function(_,n){1&_&&(e.YNc(0,o_,4,2,"div",0),e.YNc(1,i_,2,0,"ng-template",null,1,e.W1O),e.YNc(3,a_,1,0,"ng-template",null,2,e.W1O)),2&_&&e.Q6J("ngIf",n.item)},directives:[m.O5,X.lW,F.pp,m.sg,F.ib,l.JL,l.sg,F.yz,F.yK,x.gM,Z.o,je.x,l.JJ,l.u,I.$g],styles:["[edit][_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{opacity:0;transition:opacity .2s}[edit][_ngcontent-%COMP%]:hover   app-icon[_ngcontent-%COMP%]{opacity:1}mat-panel-title[_ngcontent-%COMP%]{display:flex;align-items:center;height:1.2em;overflow:visible}mat-panel-title[_ngcontent-%COMP%]   [save][_ngcontent-%COMP%]{font-size:.8em;background:none;border:none;text-decoration:underline;color:inherit}mat-form-field[_ngcontent-%COMP%]{height:3em}.settings[_ngcontent-%COMP%]{width:100%}.contents[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;flex:1;min-width:2em}.contents[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{text-decoration:none}\n/*# sourceMappingURL=zone-metadata.component.ts-angular-inline--50.css.map*/"]}),t})();var l_=s(9960),c_=s(5558);const d_=[{path:":id",component:ee,children:[{path:"about",component:ve},{path:"systems",component:be},{path:"triggers",component:Xe},{path:"children",component:we},{path:"metadata",component:s_},{path:"extend/:id",component:l_.z},{path:"history",component:c_.D},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:"-"}];var r_=s(9522);let m_=(()=>{class t{}return t.\u0275fac=function(_){return new(_||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[m.ez,l.u5,l.UX,O.Bz.forChild(d_),r_.X]]}),t})()}}]);
//# sourceMappingURL=886.2cdc72f5669de870.js.map