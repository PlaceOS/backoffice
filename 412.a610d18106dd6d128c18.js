(self.webpackChunkplaceos=self.webpackChunkplaceos||[]).push([[412],{4412:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AppUsersModule:()=>de});var n=i(1511),a=i(3695),s=i(6898),o=i(8194),c=i(5697),l=i(1572),r=i(5712),d=i(7096),m=i(6478);let u=(()=>{class e extends o.K{constructor(e){super(),this._service=e,this.name="users",this.show_options=this._service.show_options,this.tab_list=[]}get extensions(){return(0,c.fq)(this._service.active_item,this.name)}updateTabList(e){this.tab_list=[{id:"about",name:"About",icon:{class:"backoffice-info-with-circle"}},{id:"metadata",name:"Metadata",count:null==e?void 0:e.metadata,icon:{class:"backoffice-gist"}},{id:"history",name:"History",icon:{class:"backoffice-list"}}].concat(this.extensions)}ngOnInit(){this.subscription("item",this._service.item.subscribe(()=>this.updateTabList())),this.updateTabList()}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(r.L))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-users"]],features:[l.qOj],decls:3,vars:1,consts:[[1,"flex-1","flex-col","sm:flex-row","flex","h-full","w-full","relative"],["heading","Users","name","users",1,"absolute","top-0","left-0","h-12","w-full","sm:h-full","sm:static"],["name","user","route","users",1,"flex-1","relative","mt-12","sm:mt-0","w-full","sm:w-1/2",3,"tabs"]],template:function(e,t){1&e&&(l.TgZ(0,"div",0),l._UZ(1,"sidebar",1),l._UZ(2,"item-display",2),l.qZA()),2&e&&(l.xp6(2),l.Q6J("tabs",t.tab_list))},directives:[d.k,m.s],styles:["sidebar[_ngcontent-%COMP%]{transition:height .3s}@media screen and (min-width:640px){sidebar[_ngcontent-%COMP%]{width:20em!important}}"]}),e})();var p=i(33),f=i(6529);function g(e,t){if(1&e&&(l.TgZ(0,"div",12),l.TgZ(1,"label"),l.SDv(2,13),l.qZA(),l.TgZ(3,"div",14),l.TgZ(4,"a",15),l._uU(5),l.qZA(),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(4),l.Q6J("href","mailto:"+(null==e.item?null:e.item.email),l.LSH),l.xp6(1),l.Oqu(null==e.item?null:e.item.email)}}function h(e,t){if(1&e&&(l.TgZ(0,"div",12),l.TgZ(1,"label"),l.SDv(2,16),l.qZA(),l.TgZ(3,"div",14),l._uU(4),l.ALo(5,"dateFrom"),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(4),l.hij(" ",l.lcZ(5,1,1e3*(null==e.item?null:e.item.created_at))," ")}}function v(e,t){if(1&e&&(l.TgZ(0,"div",12),l.TgZ(1,"label"),l.SDv(2,17),l.qZA(),l.TgZ(3,"div",14),l._uU(4),l.ALo(5,"dateFrom"),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(4),l.hij(" ",l.lcZ(5,1,1e3*(null==e.item?null:e.item.updated_at))," ")}}function b(e,t){if(1&e&&(l.TgZ(0,"mat-chip"),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.xp6(1),l.Oqu(e)}}function Z(e,t){if(1&e&&(l.TgZ(0,"div",14),l.TgZ(1,"mat-chip-list",21),l.YNc(2,b,2,1,"mat-chip",22),l.qZA(),l.qZA()),2&e){const e=l.oxw(2);l.xp6(2),l.Q6J("ngForOf",e.item.groups)}}function _(e,t){if(1&e&&(l.TgZ(0,"div",12),l.TgZ(1,"label",18),l.SDv(2,19),l.qZA(),l.YNc(3,Z,3,1,"div",20),l.qZA()),2&e){const e=l.oxw(),t=l.MAs(23);l.xp6(3),l.Q6J("ngIf",null==e.item.groups?null:e.item.groups.length)("ngIfElse",t)}}function x(e,t){1&e&&(l.TgZ(0,"div",14),l._uU(1,"No Access Groups"),l.qZA())}let A=(()=>{class e{constructor(e){this._service=e}get item(){return this._service.active_item}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(r.L))},e.\u0275cmp=l.Xpm({type:e,selectors:[["user-about"]],decls:24,vars:6,consts:function(){let e,t,i,n,a,s,o;return e=$localize`:@@techSupportRole␟031b6f40313933f6363bf8501916fb1167661df3␟7524309407036744400: User Role `,t=$localize`:@@techSupportRole␟2c67d427fc4370f7ebbc262e58af19c48a3cef5b␟3160540339920565657: Tech Support `,i=$localize`:@@systemAdminRole␟41029fd65510d474588802219fa1a77f3764381e␟8405084038860811251: System Admin `,n=$localize`:@@userCreatedAtLabel␟91b96d7228b6e05c238fa4e39abfc17ad51a6eef␟6631334172623029500:Email:`,a=$localize`:@@userCreatedAtLabel␟a5ed099ffc9e96f6970df843289ade8a7d20ab9f␟1616250945945379783:Created:`,s=$localize`:@userUpdatedAtLabel␟f94240161f912dbd8758b858877cddeab80f36cb␟1116759395536210856:Updated:`,o=$localize`:@@userGroupsLabel␟de3e25c09f9ea2b26ac8502f589ec8cdeaa2ada0␟1800028427787031247:User Groups:`,[[1,"mb-4","space-y-2"],["class","flex items-center space-x-2",4,"ngIf"],["role","table"],["table-head",""],[1,"w-40","p-2"],e,[1,"flex-1","p-2"],["table-body",""],["table-row",""],t,i,["empty_group_state",""],[1,"flex","items-center","space-x-2"],n,[1,"value"],[3,"href"],a,s,["for","groups",1,"my-1"],o,["class","value",4,"ngIf","ngIfElse"],["name","groups"],[4,"ngFor","ngForOf"]]},template:function(e,t){1&e&&(l.TgZ(0,"section",0),l.YNc(1,g,6,2,"div",1),l.YNc(2,h,6,3,"div",1),l.YNc(3,v,6,3,"div",1),l.YNc(4,_,4,2,"div",1),l.qZA(),l.TgZ(5,"section"),l.TgZ(6,"div",2),l.TgZ(7,"div",3),l.TgZ(8,"div",4),l.SDv(9,5),l.qZA(),l._UZ(10,"div",6),l.qZA(),l.TgZ(11,"div",7),l.TgZ(12,"div",8),l.TgZ(13,"div",4),l.SDv(14,9),l.qZA(),l.TgZ(15,"div",6),l._uU(16),l.qZA(),l.qZA(),l.TgZ(17,"div",8),l.TgZ(18,"div",4),l.SDv(19,10),l.qZA(),l.TgZ(20,"div",6),l._uU(21),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.YNc(22,x,2,0,"ng-template",null,11,l.W1O)),2&e&&(l.xp6(1),l.Q6J("ngIf",null==t.item?null:t.item.created_at),l.xp6(1),l.Q6J("ngIf",null==t.item?null:t.item.created_at),l.xp6(1),l.Q6J("ngIf",null==t.item?null:t.item.updated_at),l.xp6(1),l.Q6J("ngIf",null==t.item?null:t.item.groups),l.xp6(12),l.hij(" ",!0===(null==t.item?null:t.item.support)," "),l.xp6(5),l.hij(" ",!0===(null==t.item?null:t.item.sys_admin)," "))},directives:[n.O5,p.qn,n.sg,p.HS],pipes:[f.R],styles:["[_nghost-%COMP%]{padding:1rem;width:100%;height:100%}"]}),e})();function w(e,t){if(1&e&&(l.TgZ(0,"div",10),l.TgZ(1,"div",4),l._uU(2),l.ALo(3,"date"),l.qZA(),l.TgZ(4,"div",4),l._uU(5),l.ALo(6,"date"),l.qZA(),l.TgZ(7,"div",4),l.TgZ(8,"div"),l._uU(9),l.qZA(),l.TgZ(10,"div"),l._uU(11,"View"),l.qZA(),l.qZA(),l.qZA()),2&e){const e=t.$implicit;l.xp6(2),l.hij(" ",l.xi3(3,3,e.start,"MMM d, y, h:mm a")," "),l.xp6(3),l.hij(" ",l.xi3(6,6,e.end,"MMM d, y, h:mm a")," "),l.xp6(4),l.Oqu(e.systems.length)}}function T(e,t){if(1&e&&(l.TgZ(0,"div",2),l.TgZ(1,"div",3),l.TgZ(2,"div",4),l.SDv(3,5),l.qZA(),l.TgZ(4,"div",4),l.SDv(5,6),l.qZA(),l.TgZ(6,"div",4),l.SDv(7,7),l.qZA(),l.qZA(),l.TgZ(8,"div",8),l.YNc(9,w,12,9,"div",9),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(9),l.Q6J("ngForOf",e.logs)}}function q(e,t){1&e&&(l.TgZ(0,"div",11),l.SDv(1,12),l.qZA())}let y=(()=>{class e extends o.K{constructor(e){super(),this._service=e,this.logs=[]}get item(){return this._service.active_item}ngOnInit(){this.subscription("item",this._service.item.subscribe(e=>{this.loadUserLogs()}))}loadUserLogs(e=0){}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(r.L))},e.\u0275cmp=l.Xpm({type:e,selectors:[["user-history"]],features:[l.qOj],decls:3,vars:2,consts:function(){let e,t,i,n;return e=$localize`:@@logEventStart␟8d06853e46a6d74951ff1cf9617f069c91fd50c5␟2130731909238927129:Session Start`,t=$localize`:@@logEventEnd␟e5cdb48c00597060251112914bcac2582f564c38␟4243735233618363847:Ended`,i=$localize`:@@logEventAction␟5b0d0e1718f55dc2d351402810b8cd61b139400f␟7550650761322890930: Systems Accessed `,n=$localize`:@@logTableEmpty␟721160b85c58426d8f14dc1d83290969edb6585c␟1736905540793055600: No logs found `,[["role","table",4,"ngIf","ngIfElse"],["empty_state",""],["role","table"],["table-head",""],[1,"w-1/3"],e,t,i,["table-body",""],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"p-8","text-center"],n]},template:function(e,t){if(1&e&&(l.YNc(0,T,10,1,"div",0),l.YNc(1,q,2,0,"ng-template",null,1,l.W1O)),2&e){const e=l.MAs(2);l.Q6J("ngIf",null==t.logs?null:t.logs.length)("ngIfElse",e)}},directives:[n.O5,n.sg],pipes:[n.uU],styles:["[_nghost-%COMP%]{padding:1rem;height:100%;width:100%}"]}),e})();var O=i(3511),M=i(5802),I=i(2187),N=i(8256),S=i(3049),J=i(8739),$=i(4608),U=i(4762),k=i(8512),C=i(3080),E=i(878),Y=i(7701),F=i(4689),Q=i(9996),j=i(7727),z=i(8303);let L=(()=>{class e{constructor(e,t){this._service=e,this._dialog=t,this._loading=new k.X(!1),this._change=new k.X(!1),this.loading=this._loading.asObservable(),this.item=this._service.item,this.counts=(0,C.aj)([this._service.all_item,this._change]).pipe((0,Y.b)(300),(0,F.w)(e=>(0,U.mG)(this,void 0,void 0,function*(){const[t]=e;if(!(t instanceof M.TT8))return{};this._loading.next(!0);const i=yield Promise.all([(0,M.rlq)(t.id).pipe((0,Q.U)(e=>e.length)).toPromise().catch(e=>0)]),[n]=i;return this._loading.next(!1),{metadata:n}}))),this.metadata=this.item.pipe((0,F.w)(e=>e instanceof M.gGR?(0,M.rlq)(e.id):(0,E.of)([])),(0,j.K)(e=>[]),(0,z.d)(1)),setTimeout(()=>this._change.next(!this._change.getValue()),1e3)}get active_item(){return this._service.active_item}}return e.\u0275fac=function(t){return new(t||e)(l.LFG(r.L),l.LFG($.uw))},e.\u0275prov=l.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var P=i(7486),D=i(5980),G=i(5001),B=i(6828),X=i(3609),H=i(6402),R=i(7806);function K(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"button",19),l.NdJ("click",function(e){return e.stopPropagation()})("click",function(){l.CHM(e);const t=l.oxw(3).$implicit;return l.oxw(3).saveMetadata(t)}),l.SDv(1,20),l.qZA()}}function W(e,t){if(1&e&&(l.ynx(0),l.YNc(1,K,2,0,"button",18),l.BQk()),2&e){const e=l.oxw(2).$implicit,t=l.oxw(3),i=l.MAs(4);l.xp6(1),l.Q6J("ngIf",!t.loading[e.name])("ngIfElse",i)}}const V=function(){return{class:"backoffice-trash"}};function ee(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",21),l.TgZ(1,"button",22),l.NdJ("click",function(){l.CHM(e);const t=l.oxw(2).$implicit;return l.oxw(3).deleteMetadata(t.name)}),l._UZ(2,"app-icon",14),l.qZA(),l.qZA()}2&e&&(l.xp6(2),l.Q6J("icon",l.DdM(1,V)))}const te=function(){return{class:"backoffice-edit"}};function ie(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"mat-expansion-panel",10),l.TgZ(1,"mat-expansion-panel-header"),l.TgZ(2,"mat-panel-title"),l.TgZ(3,"div",11),l._uU(4),l.qZA(),l.YNc(5,W,2,2,"ng-container",12),l.TgZ(6,"button",13),l.NdJ("click",function(t){l.CHM(e);const i=l.oxw().$implicit;return l.oxw(3).editMetadataDetails(i),t.stopPropagation()}),l._UZ(7,"app-icon",14),l.qZA(),l.YNc(8,ee,3,2,"div",15),l.qZA(),l.qZA(),l.TgZ(9,"div",16),l._UZ(10,"settings-form-field",17),l.qZA(),l.qZA()}if(2&e){const e=l.oxw().$implicit,t=l.oxw(3);l.ekj("no-padding",!0),l.Q6J("formGroup",t.form_map[e.name]),l.xp6(4),l.hij(" ",t.form_map[e.name].controls.name.value," "),l.xp6(1),l.Q6J("ngIf",t.edited[e.name]),l.xp6(2),l.Q6J("icon",l.DdM(9,te)),l.xp6(1),l.Q6J("ngIf",!e.new),l.xp6(2),l.Q6J("schema",t.schema_map[e.name])("readonly",!1)}}function ne(e,t){if(1&e&&(l.ynx(0),l.YNc(1,ie,11,10,"mat-expansion-panel",9),l.BQk()),2&e){const e=t.$implicit,i=l.oxw(3);l.xp6(1),l.Q6J("ngIf",i.form_map[e.name])}}function ae(e,t){if(1&e&&(l.TgZ(0,"div",7),l.TgZ(1,"mat-accordion"),l.YNc(2,ne,2,1,"ng-container",8),l.qZA(),l.qZA()),2&e){const e=l.oxw(2);l.xp6(2),l.Q6J("ngForOf",e.metadata)}}function se(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",3),l.TgZ(1,"button",4),l.NdJ("click",function(){return l.CHM(e),l.oxw().newMetadata()}),l.SDv(2,5),l.qZA(),l.YNc(3,ae,3,1,"div",6),l.qZA()}if(2&e){const e=l.oxw(),t=l.MAs(2);l.xp6(3),l.Q6J("ngIf",null==e.metadata?null:e.metadata.length)("ngIfElse",t)}}function oe(e,t){1&e&&(l.TgZ(0,"div",23),l.SDv(1,24),l.qZA())}function ce(e,t){1&e&&l._UZ(0,"mat-spinner",25)}const le=[{path:":id",component:u,children:[{path:"about",component:A},{path:"metadata",component:(()=>{class e extends o.K{constructor(e,t,i){super(),this._dialog=e,this._service=t,this._schemas=i,this.form_map={},this.edited={},this.loading={},this.schema_map={}}get item(){return this._service.active_item}validateName(e){return t=>e.indexOf(t.value)>=0?{name:!0}:null}ngOnInit(){this.subscription("metadata",this._service.metadata.subscribe(e=>{this.metadata=e,this.generateForms()}))}newMetadata(){this.metadata.push({name:`new_field_${Math.floor(999999999*Math.random())}`,description:"",new:!0,details:{}}),this.generateForms()}editMetadataDetails(e){this._dialog.open(N.v,{maxWidth:"95vw",data:{form:this.form_map[e.name]}})}deleteMetadata(e){const t=this._dialog.open(S.z,Object.assign(Object.assign({},S.t),{data:{title:"Kill process",content:`\n                    <p>Are you sure you want delete the metadata property "${e}"?</p>\n                `,icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("confirm",t.componentInstance.event.subscribe(i=>{"done"===i.reason&&(0,M._p1)(this.item.id,{name:e}).subscribe(()=>{(0,J.t5)(`Successfully removed "${e}" metadata.`),this.metadata=this.metadata.filter(t=>t.name!==e),this.generateForms()},t=>(0,J.cB)(`Error removing old "${e}" metadata. Error: ${t.response||t.message||t}`)),t.close()}))}saveMetadata(e){const t=this.form_map[e.name];if(t.markAllAsTouched(),!t.valid)return(0,J.cB)(`JSON for property "${t.controls.name.value}" is invalid`);const i=t.value;this.loading[e.name]=!0,(0,M.Ymr)(this.item.id,Object.assign(Object.assign({},i),{details:JSON.parse(i.details)})).subscribe(t=>{this.loading[e.name]=!1;const n=this.metadata.findIndex(t=>t.name===e.name);this.edited[e.name]=!1,e.name!==t.name&&(0,M._p1)(this.item.id,e).toPromise().catch(t=>(0,J.cB)(`Error removing old "${e.name}" metadata. Error: ${JSON.stringify(t.response||t.message||t)}`)),n>=0&&this.metadata.splice(n,1,Object.assign(Object.assign({},t),{new:!1})),(0,J.t5)(`Saved "${i.name}" metadata.`),this.generateForms()},t=>{this.loading[e.name]=!1,(0,J.cB)(`Error saving "${i.name}" metadata. Error: ${JSON.stringify(t.response||t.message||t)}`)})}generateForms(){delete this.form_map,this.form_map={},this.metadata.forEach(e=>{const t="string"==typeof e.details?JSON.parse(e.details):e.details;this.form_map[e.name]=new a.cw({name:new a.NI(e.name,[a.kI.required,this.validateName(this.metadata.filter(t=>t.name!==e.name).map(e=>e.name))]),description:new a.NI(e.description),editors:new a.NI(e.editors),details:new a.NI(JSON.stringify(t||{},void 0,4),[a.kI.required,I.NS]),schema:new a.NI(e.schema)}),this.subscription(`${e.name}_changes`,this.form_map[e.name].valueChanges.subscribe(()=>this.edited[e.name]=!0)),this.subscription(`${e.name}_schema`,this.form_map[e.name].controls.schema.valueChanges.subscribe(t=>{let i=this._schemas.getSchema(t);if(!i)try{i=JSON.parse(t)}catch(n){i={}}this.schema_map[e.name]=i}))})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36($.uw),l.Y36(L),l.Y36(P.O))},e.\u0275cmp=l.Xpm({type:e,selectors:[["user-metadata"]],features:[l.qOj],decls:5,vars:1,consts:function(){let e,t,i;return e=$localize`:@@addMetadataAction␟21539c364f82b6b766d912c3734a014cb30f27a9␟6503325999299484981: Add new Metadata Field `,t=$localize`:@@saveAction␟baa3a276f05a6226cb663918714882c53b84da34␟25086637338905953: Save `,i=$localize`:@@userMetadataEmpty␟3b713db48de98501f8d533c049da179eaceef7e1␟1254780188914338824: No user metadata found `,[["class","p-4",4,"ngIf"],["empty_state",""],["load_state",""],[1,"p-4"],["mat-button","",3,"click"],e,["class","mt-4",4,"ngIf","ngIfElse"],[1,"mt-4"],[4,"ngFor","ngForOf"],[3,"no-padding","formGroup",4,"ngIf"],[3,"formGroup"],["edit","",1,"flex-1"],[4,"ngIf"],["mat-icon-button","","matTooltip","Edit Metadata Settings",3,"click"],[3,"icon"],["class","contents",4,"ngIf"],[1,"settings"],["formControlName","details","lang","json",3,"schema","readonly"],["mat-button","","save","",3,"click",4,"ngIf","ngIfElse"],["mat-button","","save","",3,"click"],t,[1,"contents"],["mat-icon-button","","matTooltip","Remove Metadata",3,"click"],[1,"p-8","text-center"],i,["diameter","32"]]},template:function(e,t){1&e&&(l.YNc(0,se,4,2,"div",0),l.YNc(1,oe,2,0,"ng-template",null,1,l.W1O),l.YNc(3,ce,1,0,"ng-template",null,2,l.W1O)),2&e&&l.Q6J("ngIf",t.item)},directives:[n.O5,D.lW,G.pp,n.sg,G.ib,a.JL,a.sg,G.yz,G.yK,B.gM,X.o,H.x,a.JJ,a.u,R.$g],styles:["[edit][_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{opacity:0;transition:opacity .2s}[edit][_ngcontent-%COMP%]:hover   app-icon[_ngcontent-%COMP%]{opacity:1}mat-panel-title[_ngcontent-%COMP%]{display:flex;align-items:center;height:1.2em;overflow:visible}mat-panel-title[_ngcontent-%COMP%]   [save][_ngcontent-%COMP%]{font-size:.8em;background:none;border:none;text-decoration:underline;color:inherit}mat-form-field[_ngcontent-%COMP%]{height:3em}.settings[_ngcontent-%COMP%]{width:100%}.contents[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;flex:1;min-width:2em}.contents[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{text-decoration:none}"]}),e})()},{path:"history",component:y},{path:"extend/:id",component:O.z},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:"-"}];var re=i(7561);let de=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=l.oAB({type:e}),e.\u0275inj=l.cJS({imports:[[n.ez,a.u5,a.UX,s.Bz.forChild(le),re.X]]}),e})()}}]);
//# sourceMappingURL=412.a610d18106dd6d128c18.js.map