"use strict";(self.webpackChunkbackoffice=self.webpackChunkbackoffice||[]).push([[432],{6179:(Ie,g,i)=>{i.r(g),i.d(g,{AppModulesModule:()=>be});var c=i(6895),S=i(4719),E=i(6581),O=i(5861),a=i(2837),f=i(591),B=i(1086),D=i(2198),Z=i(13),u=i(7545),m=i(5154),M=i(4850),x=i(7221),y=i(2994),p=i(6123),C=i(2016),$=i(7701),e=i(6353),K=i(5412);let T=(()=>{class _{constructor(t,o){this._state=t,this._dialog=o,this._loading=new f.X(!1),this.loading=this._loading.asObservable(),this.item=this._state.item.pipe((0,D.h)(n=>n instanceof a.SQz)),this.associated_settings=this._state.active_item$.pipe((0,Z.b)(300),(0,u.w)(n=>n&&n instanceof a.SQz?(0,a.eRm)(n.id):[])),this.driver=this.item.pipe((0,u.w)(n=>(0,a.L4d)(n.driver_id)),(0,m.d)(1)),this.system=this.item.pipe((0,u.w)(n=>n.system_id?(0,a.hMA)(n.system_id):(0,B.of)(null)),(0,m.d)(1)),this.system_list=this.item.pipe((0,u.w)(n=>(this._loading.next(!0),console.log("Loading Systems..."),(0,a.vIL)({module_id:n.id}))),(0,M.U)(n=>n.data),(0,x.K)(()=>[]),(0,y.b)(n=>this._loading.next(!1)),(0,m.d)(1))}get active_item(){return this._state.active_item}toggleModuleState(){var t=this;return(0,O.Z)(function*(){const n=yield(t.active_item.running?a.iAP:a.Dqv)(t.active_item.id).pipe((0,M.U)(l=>null)).toPromise().catch(l=>l);if(n)return console.log("Error:",n),void("string"==typeof n&&n.length<64?(0,C.cB)(n):(0,C.cB)(`Failed to ${t.active_item.running?"stop":"start"} device '${t.active_item.id}'.\nView Error?`,"View",()=>t.viewDetails(n)));(0,C.t5)("Module successfully "+(t.active_item.running?"stopped":"started")),t.active_item.running=!t.active_item.running})()}viewDetails(t){this._dialog.open($.a,{data:{content:t}})}}return _.\u0275fac=function(t){return new(t||_)(e.LFG(p.L),e.LFG(K.uw))},_.\u0275prov=e.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})();var X=i(3436),U=i(4859),P=i(1572),v=i(490);function J(_,s){if(1&_&&(e.TgZ(0,"div",13)(1,"label"),e.SDv(2,14),e.qZA(),e.TgZ(3,"div",15),e._uU(4),e.qZA()()),2&_){const t=e.oxw();e.xp6(4),e.Oqu(t.item.notes)}}function Q(_,s){if(1&_&&(e.TgZ(0,"div",13)(1,"label"),e.SDv(2,16),e.qZA(),e.TgZ(3,"div",15),e._uU(4),e.qZA()()),2&_){const t=e.oxw();e.xp6(4),e.Oqu(t.item.ip)}}function G(_,s){if(1&_&&(e.TgZ(0,"div",13)(1,"label"),e.SDv(2,17),e.qZA(),e.TgZ(3,"div",15),e._uU(4),e.qZA()()),2&_){const t=e.oxw();e.xp6(4),e.Oqu(t.item.port)}}function Y(_,s){1&_&&(e.TgZ(0,"code",20),e._uU(1,"TLS"),e.qZA())}function w(_,s){1&_&&(e.TgZ(0,"code",20),e._uU(1,"UDP"),e.qZA())}function z(_,s){if(1&_&&(e.TgZ(0,"div",13)(1,"label"),e.SDv(2,18),e.qZA(),e.YNc(3,Y,2,0,"code",19),e.YNc(4,w,2,0,"code",19),e.qZA()),2&_){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.item.tls),e.xp6(1),e.Q6J("ngIf",t.item.udp)}}function q(_,s){if(1&_&&(e.TgZ(0,"div",13)(1,"label"),e.SDv(2,21),e.qZA(),e.TgZ(3,"div",15),e._uU(4),e.ALo(5,"dateFrom"),e.qZA()()),2&_){const t=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,1,1e3*t.item.created_at)," ")}}function j(_,s){if(1&_&&(e.TgZ(0,"div",13)(1,"label"),e.SDv(2,22),e.qZA(),e.TgZ(3,"div",15),e._uU(4),e.ALo(5,"dateFrom"),e.qZA()()),2&_){const t=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,1,1e3*t.item.updated_at)," ")}}const V=function(_){return["/drivers",_]};function W(_,s){if(1&_&&(e.TgZ(0,"div",13)(1,"label"),e.SDv(2,23),e.qZA(),e.TgZ(3,"a",24),e._uU(4),e.ALo(5,"async"),e.qZA()()),2&_){const t=e.oxw();e.xp6(3),e.Q6J("routerLink",e.VKq(4,V,t.item.driver_id)),e.xp6(1),e.hij(" ",e.lcZ(5,2,t.driver).name||"<Unnamed>"," ")}}const H=function(_){return["/systems",_,"modules"]};function k(_,s){if(1&_&&(e.TgZ(0,"div",13)(1,"label"),e.SDv(2,25),e.qZA(),e.TgZ(3,"a",24),e.ALo(4,"async"),e._uU(5),e.ALo(6,"async"),e.qZA()()),2&_){const t=e.oxw();e.xp6(3),e.Q6J("routerLink",e.VKq(6,H,e.lcZ(4,2,t.system).id)),e.xp6(2),e.hij(" ",e.lcZ(6,4,t.system).name," ")}}function ee(_,s){1&_&&(e.TgZ(0,"div",26),e.SDv(1,27),e.qZA())}function _e(_,s){1&_&&e._UZ(0,"mat-spinner",28)}function te(_,s){1&_&&(e.TgZ(0,"div",26),e.SDv(1,29),e.qZA())}function oe(_,s){1&_&&e._UZ(0,"mat-spinner",28)}const ne=function(){return[]};function ie(_,s){if(1&_&&(e.TgZ(0,"section"),e._UZ(1,"a-settings-form",30),e.ALo(2,"async"),e.qZA()),2&_){const t=e.oxw();e.xp6(1),e.Q6J("id",t.item.id)("merge",!0)("settings",t.item.settings)("merge_settings",e.lcZ(2,4,t.other_settings)||e.DdM(6,ne))}}function se(_,s){1&_&&(e.TgZ(0,"div",31),e._UZ(1,"mat-spinner",32),e.TgZ(2,"p"),e.SDv(3,33),e.qZA()())}let le=(()=>{class _{constructor(t){this._service=t,this.driver=this._service.driver,this.system=this._service.system,this.other_settings=this._service.associated_settings}get item(){return this._service.active_item}toggleModuleState(){var t=this;return(0,O.Z)(function*(){t.stopping=!0,yield t._service.toggleModuleState(),t.stopping=!1})()}}return _.\u0275fac=function(t){return new(t||_)(e.Y36(T))},_.\u0275cmp=e.Xpm({type:_,selectors:[["module-about"]],decls:28,vars:22,consts:function(){let s,t,o,n,l,A,r,N,R,b,I,h;return s=$localize`:@@settingsLabel␟5ba97a3f90a79c4d7720b941ae416c8c84337e38␟180274732945114229: Settings `,t=$localize`:@moduleNotesLabel␟3b193ba24bd715ed412f5419df3acb59090141d3␟8421971980013015956:Notes:`,o=$localize`:@moduleIPLabel␟8271bb466916303dc1516952bf50e7e6626f7b2c␟253752108238785328:IP:`,n=$localize`:@modulePortLabel␟a2ceedad860954f374fc1ac8bae057292b1cec2e␟6167294183925653141:Port:`,l=$localize`:@moduleTLSLabel␟2a29507802055ca7586062ecd0486e58728951ae␟6065664962291805568:Protocol:`,A=$localize`:@@moduleCreatedAtLabel␟a5ed099ffc9e96f6970df843289ade8a7d20ab9f␟1616250945945379783:Created:`,r=$localize`:@moduleUpdatedAtLabel␟f94240161f912dbd8758b858877cddeab80f36cb␟1116759395536210856:Updated:`,N=$localize`:@moduleUpdatedAtLabel␟797f76e214854e3930b89347440a035b92fb3adb␟1174891546565206449:Driver:`,R=$localize`:@moduleUpdatedAtLabel␟aaeaff696111bf2df60b2d2df331ca5c1d7dc4e2␟6879447585908883888:System:`,b=$localize`:@@moduleStartStateToggle␟63edb7870dab5d1f8ae331fd7c34b8bf1173e98b␟6794353257757367522: Start Module `,I=$localize`:@@moduleStopStateToggle␟d0bb337e9772ba341dc5451a405a03af69654df8␟9034986550821411231: Stop Module `,h=$localize`:@@moduleDetailsLoading␟cb7cffb188a2b0bce758e40f67c29387dd6ccfcf␟3678638452756535871:Loading module settings...`,[[1,"space-x-2","flex"],[1,"rounded","p-2","border","border-gray-200","dark:border-neutral-500","space-y-2","w-1/3","flex-1"],["class","flex items-center space-x-2",4,"ngIf"],[1,"rounded","p-2","border","border-gray-200","dark:border-neutral-500","space-y-2","w-1/3","flex-1","flex","flex-col"],[1,"w-full","text-center"],["mat-button","",1,"w-full",3,"disabled","click"],["class","text",4,"ngIf"],["diameter","32",4,"ngIf"],[1,"my-4"],[1,"font-medium","text-lg"],s,[4,"ngIf","ngIfElse"],["load_state",""],[1,"flex","items-center","space-x-2"],t,[1,"value"],o,n,l,["class","bg-success text-white",4,"ngIf"],[1,"bg-success","text-white"],A,r,N,[1,"underline",3,"routerLink"],R,[1,"text"],b,["diameter","32"],I,[3,"id","merge","settings","merge_settings"],[1,"p-8","flex","flex-col","items-center","justify-center","m-auto"],["diameter","48",1,"mb-4"],h]},template:function(t,o){if(1&t&&(e.TgZ(0,"section",0)(1,"div",1),e.YNc(2,J,5,1,"div",2),e.YNc(3,Q,5,1,"div",2),e.YNc(4,G,5,1,"div",2),e.YNc(5,z,5,2,"div",2),e.YNc(6,q,6,3,"div",2),e.YNc(7,j,6,3,"div",2),e.YNc(8,W,6,6,"div",2),e.ALo(9,"async"),e.YNc(10,k,7,8,"div",2),e.ALo(11,"async"),e.qZA(),e.TgZ(12,"div",3)(13,"h3",4),e._uU(14,"Module Controls"),e.qZA(),e.TgZ(15,"button",5),e.NdJ("click",function(){return o.toggleModuleState()}),e.YNc(16,ee,2,0,"div",6),e.YNc(17,_e,1,0,"mat-spinner",7),e.qZA(),e.TgZ(18,"button",5),e.NdJ("click",function(){return o.toggleModuleState()}),e.YNc(19,te,2,0,"div",6),e.YNc(20,oe,1,0,"mat-spinner",7),e.qZA()()(),e._UZ(21,"hr",8),e.TgZ(22,"header",9),e.SDv(23,10),e.qZA(),e.YNc(24,ie,3,7,"section",11),e.ALo(25,"async"),e.YNc(26,se,4,0,"ng-template",null,12,e.W1O)),2&t){const n=e.MAs(27);e.xp6(2),e.Q6J("ngIf",o.item.notes),e.xp6(1),e.Q6J("ngIf",o.item.ip),e.xp6(1),e.Q6J("ngIf",o.item.port>1),e.xp6(1),e.Q6J("ngIf",o.item.tls||o.item.udp),e.xp6(1),e.Q6J("ngIf",o.item.created_at),e.xp6(1),e.Q6J("ngIf",o.item.updated_at),e.xp6(1),e.Q6J("ngIf",e.lcZ(9,16,o.driver)),e.xp6(2),e.Q6J("ngIf",e.lcZ(11,18,o.system)),e.xp6(5),e.Q6J("disabled",o.item.running||o.stopping),e.xp6(1),e.Q6J("ngIf",!o.stopping),e.xp6(1),e.Q6J("ngIf",o.stopping),e.xp6(1),e.Q6J("disabled",!o.item.running||o.stopping),e.xp6(1),e.Q6J("ngIf",!o.stopping),e.xp6(1),e.Q6J("ngIf",o.stopping),e.xp6(4),e.Q6J("ngIf",o.item.settings&&e.lcZ(25,20,o.other_settings))("ngIfElse",n)}},dependencies:[c.O5,E.yS,X.v,U.lW,P.Ou,c.Ov,v.R],styles:["[_nghost-%COMP%]{height:100%;width:100%}label[_ngcontent-%COMP%]{width:4rem}"]}),_})();var de=i(3426),L=i(5341),F=i(9549),ae=i(4144);const ce=function(_){return["/systems",_]};function Se(_,s){if(1&_&&(e.TgZ(0,"div",18)(1,"div",19)(2,"a",20),e._uU(3),e.qZA()(),e.TgZ(4,"div",12),e._uU(5),e.qZA(),e.TgZ(6,"div",14),e._uU(7),e.ALo(8,"dateFrom"),e.qZA()()),2&_){const t=s.$implicit;e.xp6(2),e.Q6J("routerLink",e.VKq(6,ce,t.id)),e.xp6(1),e.Oqu(t.name),e.xp6(2),e.hij(" ",t.installed_ui_devices||"0"," "),e.xp6(2),e.hij(" ",e.lcZ(8,4,1e3*t.created_at)," ")}}function Ee(_,s){if(1&_&&(e.TgZ(0,"div",8)(1,"div",9)(2,"div",10),e.SDv(3,11),e.qZA(),e.TgZ(4,"div",12),e.SDv(5,13),e.qZA(),e.TgZ(6,"div",14),e.SDv(7,15),e.qZA()(),e.TgZ(8,"div",16),e.YNc(9,Se,9,8,"div",17),e.ALo(10,"async"),e.qZA()()),2&_){const t=e.oxw(2);e.xp6(9),e.Q6J("ngForOf",e.lcZ(10,1,t.system_list))}}function ue(_,s){if(1&_&&(e.TgZ(0,"section"),e.YNc(1,Ee,11,3,"div",7),e.ALo(2,"async"),e.qZA()),2&_){const t=e.oxw(),o=e.MAs(9);let n;e.xp6(1),e.Q6J("ngIf",null==(n=e.lcZ(2,2,t.system_list))?null:n.length)("ngIfElse",o)}}function Ae(_,s){1&_&&(e.TgZ(0,"div",21),e._UZ(1,"mat-spinner",22),e.TgZ(2,"p"),e._uU(3,"Loading systems..."),e.qZA()()),2&_&&(e.xp6(1),e.Q6J("diameter",48))}function re(_,s){1&_&&(e.TgZ(0,"div",21)(1,"p"),e._uU(2,"No systems with module"),e.qZA()())}let Oe=(()=>{class _{constructor(t){this._service=t,this.filter$=new f.X(""),this.loading=this._service.loading,this.system_list=(0,de.aj)([this.filter$,this._service.system_list]).pipe((0,M.U)(o=>{const[n,l]=o,A=n.toLowerCase();return n?l.filter(r=>r.name.toLowerCase().includes(A)):l}))}}return _.\u0275fac=function(t){return new(t||_)(e.Y36(T))},_.\u0275cmp=e.Xpm({type:_,selectors:[["module-systems"]],decls:10,vars:5,consts:function(){let s,t,o;return s=$localize`:@@nameLabel␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,t=$localize`:@@systemLabel␟6c24d3e08bc16576fbd5580dc255a31c4b08c366␟8919524640139321287:No. Modules`,o=$localize`:@@createdLabel␟1b051734b0ee9021991c91b3ed4e81c244322462␟4207916966377787111:Created`,[[1,"flex","items-center","mb-4"],["appearance","outline",1,"h-12","flex-1"],["matPrefix","","className","backoffice-magnifying-glass text-xl mr-2"],["matInput","","placeholder","Filter systems...",1,"rounded-none",3,"ngModel","ngModelChange"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],["role","table","class","overflow-x-auto",4,"ngIf","ngIfElse"],["role","table",1,"overflow-x-auto"],["table-head",""],["flex","",1,"flex-1","p-2"],s,[1,"w-48","p-2"],t,[1,"w-36","p-2"],o,["table-body","",1,"overflow-y-auto"],["table-row","",4,"ngFor","ngForOf"],["table-row",""],["flex","",1,"flex-1","p-2","underline"],[3,"routerLink"],[1,"flex","flex-col","items-center","p-8","mx-auto"],[1,"mb-4",3,"diameter"]]},template:function(t,o){if(1&t&&(e.TgZ(0,"section",0)(1,"mat-form-field",1),e._UZ(2,"app-icon",2),e.TgZ(3,"input",3),e.NdJ("ngModelChange",function(l){return o.filter$.next(l)}),e.qZA()()(),e.YNc(4,ue,3,4,"section",4),e.ALo(5,"async"),e.YNc(6,Ae,4,1,"ng-template",null,5,e.W1O),e.YNc(8,re,3,0,"ng-template",null,6,e.W1O)),2&t){const n=e.MAs(7);e.xp6(3),e.Q6J("ngModel",""),e.xp6(1),e.Q6J("ngIf",!e.lcZ(5,3,o.loading))("ngIfElse",n)}},dependencies:[c.sg,c.O5,S.Fj,S.JJ,S.On,E.yS,L.o,F.KE,F.qo,ae.Nt,P.Ou,c.Ov,v.R],styles:["[_nghost-%COMP%]{height:100%;width:100%}"]}),_})();var me=i(9960),Me=i(5558),Ce=i(8537),ge=i(1843),fe=i(4834),pe=i(3409),Te=i(3182),Ue=i(1535),Pe=i(1551),ve=i(266),Le=i(3238);function Fe(_,s){if(1&_){const t=e.EpF();e.ynx(0),e._UZ(1,"item-details",11)(2,"item-tablist",12),e.TgZ(3,"div",13,14),e.NdJ("scroll",function(){e.CHM(t);const n=e.MAs(4),l=e.oxw();return e.KtG(l.scroll=n.scrollTop)}),e._UZ(5,"router-outlet"),e.qZA(),e.BQk()}if(2&_){const t=e.oxw();e.xp6(1),e.Q6J("can_edit",!0)("item",t.item),e.xp6(1),e.Q6J("base",t.name)("tabs",t.tab_list)("scrolled",t.scroll>0)}}const Ne=[{path:":id",component:(()=>{class _ extends ge.K{constructor(t){super(),this._service=t,this.open_menu=!1,this.name="modules",this.tab_list=[],this.newItem=()=>this._service.create()}get item(){return this._service.active_item}get extensions(){return(0,Ce.fq)(this._service.active_item,this.name)}updateTabList(){this.tab_list=[{id:"about",name:"About",icon:{class:"backoffice-info-with-circle"}},{id:"systems",name:"Systems",count:this.system_count,icon:{class:"backoffice-documents"}},{id:"history",name:"Settings History",icon:{class:"backoffice-clock"}}].concat(this.extensions)}ngOnInit(){this.subscription("item",this._service.item.subscribe(t=>{this.loadValues(t),this.updateTabList()})),this.updateTabList()}loadValues(t){var o=this;return(0,O.Z)(function*(){if(!t)return;const n={offset:0,limit:1,module_id:t.id};o.system_count=(yield(0,a.vIL)(n).toPromise()).total})()}}return _.\u0275fac=function(t){return new(t||_)(e.Y36(p.L))},_.\u0275cmp=e.Xpm({type:_,selectors:[["new-modules-view"]],features:[e.qOj],decls:11,vars:5,consts:[[1,"absolute","inset-0","flex","items-center","divide-y","sm:divide-y-0","sm:divide-x","divide-gray-300","dark:divide-neutral-600","bg-white","dark:bg-neutral-700"],[1,"sm:h-full",3,"open","openChange"],["title","Modules",1,"hidden","sm:block",3,"route"],[1,"flex-1","w-1/2","h-full","relative","flex","flex-col","z-0"],["title","Modules",1,"z-20","sm:hidden",3,"route"],["mat-icon-button","",1,"sm:hidden","mr-2",3,"click"],["className","backoffice-menu"],[1,"flex","flex-col","flex-1","h-1/2"],[4,"ngIf"],["matTooltip","New module","matTooltipPosition","right","matRipple","",1,"absolute","bottom-2","left-2","sm:-left-9","w-12","h-12","flex","items-center","justify-center","bg-primary","dark:bg-pink","rounded-lg","shadow","z-30","text-white",3,"click"],[1,"text-3xl",3,"className"],["type","Module",3,"can_edit","item"],[1,"z-10",3,"base","tabs","scrolled"],[1,"flex-1","h-1/2","w-full","overflow-auto","p-4","z-0","relative",3,"scroll"],["el",""]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"sidebar-menu",1),e.NdJ("openChange",function(l){return o.open_menu=l}),e.qZA(),e._UZ(2,"item-sidebar",2),e.TgZ(3,"div",3)(4,"item-selection",4)(5,"button",5),e.NdJ("click",function(){return o.open_menu=!0}),e._UZ(6,"app-icon",6),e.qZA()(),e.TgZ(7,"div",7),e.YNc(8,Fe,6,5,"ng-container",8),e.qZA(),e.TgZ(9,"button",9),e.NdJ("click",function(){return o.newItem()}),e._UZ(10,"app-icon",10),e.qZA()()()),2&t&&(e.xp6(1),e.Q6J("open",o.open_menu),e.xp6(1),e.Q6J("route",o.name),e.xp6(2),e.Q6J("route",o.name),e.xp6(4),e.Q6J("ngIf",null==o.item?null:o.item.id),e.xp6(2),e.Q6J("className","backoffice-plus"))},dependencies:[c.O5,E.lC,L.o,fe.$,pe.V,Te.K,Ue.r,Pe.l,U.lW,ve.gM,Le.wG]}),_})(),children:[{path:"about",component:le},{path:"systems",component:Oe},{path:"extend/:id",component:me.z},{path:"history",component:Me.D},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:"-"}];var Re=i(4524);let be=(()=>{class _{}return _.\u0275fac=function(t){return new(t||_)},_.\u0275mod=e.oAB({type:_}),_.\u0275inj=e.cJS({imports:[c.ez,S.u5,E.Bz.forChild(Ne),Re.X]}),_})()}}]);