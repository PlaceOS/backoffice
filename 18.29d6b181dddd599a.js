"use strict";(self.webpackChunkbackoffice=self.webpackChunkbackoffice||[]).push([[18],{4018:(ge,f,n)=>{n.r(f),n.d(f,{AppDriversModule:()=>pe});var c=n(6362),S=n(1876),A=n(9504),m=n(4929),a=n(3698),R=n(6123),p=n(1843),L=n(8537),e=n(6723),B=n(9101),Z=n(1609);let x=(()=>{class t extends p.K{constructor(_){super(),this._service=_,this.name="drivers",this.show_options=this._service.show_options,this.tab_list=[]}get extensions(){return(0,L.fq)(this._service.active_item,this.name)}updateTabList(){this.tab_list=[{id:"about",name:"About",icon:{class:"backoffice-info-with-circle"}},{id:"modules",name:"Modules",count:this.device_count,icon:{class:"backoffice-tablet"}},{id:"history",name:"Settings History",icon:{class:"backoffice-clock"}}].concat(this.extensions)}ngOnInit(){this.subscription("item",this._service.item.subscribe(_=>{this.loadValues(_),this.updateTabList()})),this.updateTabList()}loadValues(_){return(0,m.mG)(this,void 0,void 0,function*(){if(!_)return;const i={offset:0,limit:1,driver_id:_.id};this.device_count=(yield(0,a.Ne_)(i).toPromise()).total})}}return t.\u0275fac=function(_){return new(_||t)(e.Y36(R.L))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-drivers"]],features:[e.qOj],decls:3,vars:1,consts:[[1,"flex-1","flex-col","sm:flex-row","flex","h-full","w-full","relative"],["heading","Drivers","name","drivers",1,"absolute","top-0","left-0","h-12","w-full","sm:h-full","sm:static"],["name","driver","route","drivers",1,"flex-1","relative","mt-12","sm:mt-0","w-full","sm:w-1/2",3,"tabs"]],template:function(_,i){1&_&&(e.TgZ(0,"div",0),e._UZ(1,"sidebar",1)(2,"item-display",2),e.qZA()),2&_&&(e.xp6(2),e.Q6J("tabs",i.tab_list))},directives:[B.k,Z.s],styles:["sidebar[_ngcontent-%COMP%]{transition:height .3s}@media screen and (min-width: 640px){sidebar[_ngcontent-%COMP%]{width:20em!important}}\n/*# sourceMappingURL=drivers.component.ts-angular-inline--24.css.map*/"]}),t})();var C=n(4505),y=n(9151),g=n(9095),$=n(7418),V=n(6774),K=n(3859),X=n(8759),v=n(6942),G=n(9128),T=n(2395),u=n(2016),J=n(7701),w=n(5758);let M=(()=>{class t{constructor(_,i){this._state=_,this._dialog=i,this._loading=new C.X(!1),this._last_error=new C.X(null),this.item=this._state.item,this.loading=this._loading.asObservable(),this.last_error=this._last_error.asObservable(),this.is_compiled=this.item.pipe((0,y.h)(o=>!!o&&o instanceof a.CbG),(0,g.w)(o=>(0,a.J_X)(o.id)),(0,$.K)(o=>(0,m.mG)(this,void 0,void 0,function*(){const r=yield null==o?void 0:o.json();if(this._last_error.next((null==r?void 0:r.compilation_output)||o),console.log("Driver Error:",r),!(null==r?void 0:r.compilation_output))throw o})),(0,V.a)((0,K.g)(1e3)),(0,X.b)(o=>o?this._last_error.next(null):"")),this.modules=this.item.pipe((0,g.w)(o=>(0,m.mG)(this,void 0,void 0,function*(){this._loading.next(!0);const r=yield(0,a.Ne_)({driver_id:o.id}).toPromise();return this._loading.next(!1),r})),(0,v.U)(o=>o.data),(0,G.d)()),this.item.subscribe(()=>this._last_error.next(null))}get active_item(){return this._state.active_item}viewError(){const _=this._last_error.getValue();!_||this._dialog.open(J.a,{data:{title:"Driver Compilation Error",content:_}})}recompileDriver(){return(0,m.mG)(this,void 0,void 0,function*(){const _=yield(0,T._5)({title:"Recompile Driver",content:"<p>Are you sure you want recompile this driver?</p><p>New driver code will be loaded and device settings will be updated.</p>",icon:{type:"icon",class:"backoffice-cycle"}},this._dialog);if(!_||!_.reason)return _.close();_.loading("Recompiling driver...");const i=yield(0,a.qEr)(this._state.active_item.id).toPromise().catch(o=>null);if(_.close(),!i)return(0,u.cB)("Failed to recompiled driver.");(0,u.t5)("Successfully recompiled driver.")})}removeModule(_){return(0,m.mG)(this,void 0,void 0,function*(){const i=yield(0,T._5)({title:"Remove module?",content:`Remove ${_.driver_id}?<br>All associated data be deleted immediatedly.`,icon:{type:"icon",class:"backoffice-trash"}},this._dialog);if(!i||!i.reason)return;const o=yield(0,a.zed)(this.active_item.id,_.id).toPromise().catch(r=>{(0,u.cB)(`Error removing module ${_.id}. Error: ${r.statusText||r.message||r}`)});i.close(),o&&(this._state.replaceItem(o),(0,u.t5)("Successfully removed module."))})}}return t.\u0275fac=function(_){return new(_||t)(e.LFG(R.L),e.LFG(w.uw))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var F=n(4742),D=n(7317),Q=n(3436),q=n(239);function z(t,s){if(1&t&&(e.TgZ(0,"div",2)(1,"label"),e.SDv(2,21),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA()()),2&t){const _=e.oxw();e.xp6(4),e.Oqu(_.item.default_uri)}}function j(t,s){if(1&t&&(e.TgZ(0,"div",2)(1,"label"),e.SDv(2,22),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA()()),2&t){const _=e.oxw();e.xp6(4),e.Oqu(_.item.default_port)}}function Y(t,s){1&t&&e._UZ(0,"mat-spinner",23)}function W(t,s){if(1&t){const _=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){return e.CHM(_),e.oxw().viewErrors()}),e._uU(1," View Errors "),e.qZA()}}function H(t,s){if(1&t&&(e.TgZ(0,"section"),e._UZ(1,"a-settings-form",24),e.qZA()),2&t){const _=e.oxw();e.xp6(1),e.Q6J("merge",!0)("id",_.item.id)("settings",_.item.settings)}}function k(t,s){1&t&&(e.TgZ(0,"div",25),e._UZ(1,"mat-spinner",26),e.TgZ(2,"p"),e.SDv(3,27),e.qZA()())}const ee=function(t){return["/repositories",t,"about"]};let _e=(()=>{class t{constructor(_){this._service=_,this.compiled=this._service.is_compiled,this.compilation_error=this._service.last_error,this.recompileDriver=()=>this._service.recompileDriver(),this.viewErrors=()=>this._service.viewError()}get item(){return this._service.active_item||{}}}return t.\u0275fac=function(_){return new(_||t)(e.Y36(M))},t.\u0275cmp=e.Xpm({type:t,selectors:[["driver-about"]],decls:55,vars:26,consts:function(){let s,_,i,o,r,d,E,I,N,U,h,b;return s=$localize`:@@driverDetailsCompiled␟cf381ca16eaabe3374d51e9f94f2218500c4fa4e␟9153697548218950089:Compiled:`,_=$localize`:@@driverDetailsCommit␟9550d280606a1dc85aa6687e6375c8c3edfa14ac␟2338640606551983669:Repository:`,i=$localize`:@@driverDetailsCommit␟fd8aae50a9e4449f1ca02dd094975918d9a5667b␟1255418805683509654:Commit:`,o=$localize`:@@driverDetailsFileName␟38b21a77c169dc1d573d1959b82ee0d1bc2382a4␟3153886573188541985:File Name:`,r=$localize`:@@driverDetailsModuleName␟30503cc4139d9b80b7ee428e70c83f93018643c3␟2852585380255004131:Module Name:`,d=$localize`:@@driverCreatedAtLabel␟a5ed099ffc9e96f6970df843289ade8a7d20ab9f␟1616250945945379783:Created:`,E=$localize`:@@driverUpdatedAtLabel␟f94240161f912dbd8758b858877cddeab80f36cb␟1116759395536210856:Updated:`,I=$localize`:@@driverReloadAction␟9e4193ff8bc8eb566c2a631f96b9c93ac4d22a4e␟5398060262188177679: Recompile Driver `,N=$localize`:@@settingsLabel␟5ba97a3f90a79c4d7720b941ae416c8c84337e38␟180274732945114229: Settings `,U=$localize`:@@driverDefaultURILabel␟aaf77b7baecf340df6c6e20f4016289f440c390e␟2755927892619874934:Default URI:`,h=$localize`:@@driverDefaultPortLabel␟708739a9f194ca4078bfdeed2db588d855c042b8␟8341926293707687932:Default Port Number:`,b=$localize`:@@driverLoadingLabel␟07c312791623a62194aaf1b64cf77ac60427ba34␟1421066576333999335:Loading driver settings...`,[[1,"mb-4","space-y-2"],["class","flex items-center space-x-2",4,"ngIf"],[1,"flex","items-center","space-x-2"],s,[1,"value"],["diameter","24",4,"ngIf"],["mat-button","",3,"click",4,"ngIf"],_,[1,"underline",3,"routerLink"],i,o,r,d,E,["mat-button","",3,"click"],I,[1,"my-4"],[1,"font-medium","text-lg"],N,[4,"ngIf","ngIfElse"],["load_state",""],U,h,["diameter","24"],[3,"merge","id","settings"],[1,"flex","flex-col","items-center","justify-center"],["diameter","48",1,"mb-4"],b]},template:function(_,i){if(1&_&&(e.TgZ(0,"section",0),e.YNc(1,z,5,1,"div",1),e.YNc(2,j,5,1,"div",1),e.TgZ(3,"div",2)(4,"label"),e.SDv(5,3),e.qZA(),e.TgZ(6,"div",4),e._uU(7),e.ALo(8,"async"),e.qZA(),e.YNc(9,Y,1,0,"mat-spinner",5),e.ALo(10,"async"),e.YNc(11,W,2,0,"button",6),e.ALo(12,"async"),e.qZA(),e.TgZ(13,"div",2)(14,"label"),e.SDv(15,7),e.qZA(),e.TgZ(16,"div",4)(17,"a",8),e._uU(18),e.qZA()()(),e.TgZ(19,"div",2)(20,"label"),e.SDv(21,9),e.qZA(),e.TgZ(22,"div",4),e._uU(23),e.qZA()(),e.TgZ(24,"div",2)(25,"label"),e.SDv(26,10),e.qZA(),e.TgZ(27,"div",4),e._uU(28),e.qZA()(),e.TgZ(29,"div",2)(30,"label"),e.SDv(31,11),e.qZA(),e.TgZ(32,"div",4),e._uU(33),e.qZA()(),e.TgZ(34,"div",2)(35,"label"),e.SDv(36,12),e.qZA(),e.TgZ(37,"div",4),e._uU(38),e.ALo(39,"dateFrom"),e.qZA()(),e.TgZ(40,"div",2)(41,"label"),e.SDv(42,13),e.qZA(),e.TgZ(43,"div",4),e._uU(44),e.ALo(45,"dateFrom"),e.qZA()()(),e.TgZ(46,"section")(47,"button",14),e.NdJ("click",function(){return i.recompileDriver()}),e.SDv(48,15),e.qZA()(),e._UZ(49,"hr",16),e.TgZ(50,"header",17),e.SDv(51,18),e.qZA(),e.YNc(52,H,2,3,"section",19),e.YNc(53,k,4,0,"ng-template",null,20,e.W1O)),2&_){const o=e.MAs(54);e.xp6(1),e.Q6J("ngIf",i.item.default_uri),e.xp6(1),e.Q6J("ngIf",i.item.default_port),e.xp6(5),e.hij(" ",e.lcZ(8,14,i.compiled)?"true":"false"," "),e.xp6(2),e.Q6J("ngIf",!e.lcZ(10,16,i.compiled)),e.xp6(2),e.Q6J("ngIf",e.lcZ(12,18,i.compilation_error)),e.xp6(6),e.Q6J("routerLink",e.VKq(24,ee,i.item.repository_id)),e.xp6(1),e.hij(" ",i.item.repository_id,""),e.xp6(5),e.Oqu(i.item.commit),e.xp6(5),e.Oqu(i.item.file_name),e.xp6(5),e.Oqu(null==i.item?null:i.item.module_name),e.xp6(5),e.Oqu(e.lcZ(39,20,1e3*i.item.created_at)),e.xp6(6),e.Oqu(e.lcZ(45,22,1e3*i.item.updated_at)),e.xp6(8),e.Q6J("ngIf",i.item.settings)("ngIfElse",o)}},directives:[c.O5,F.Ou,D.lW,A.yS,Q.v],pipes:[c.Ov,q.R],styles:["[_nghost-%COMP%]{padding:1rem;height:100%;width:100%}\n/*# sourceMappingURL=driver-about.component.ts-angular-inline--25.css.map*/"]}),t})();var te=n(7716),P=n(4770),ie=n(1259),oe=n(4683),ne=n(9484),se=n(89),O=n(2796);function re(t,s){if(1&t){const _=e.EpF();e.TgZ(0,"i",30),e.NdJ("modelChange",function(o){return e.CHM(_),e.oxw().$implicit.connected=o}),e.qZA()}if(2&t){const _=e.oxw().$implicit;e.Q6J("model",_.connected)("sys",_.system.id)("mod",_)}}function le(t,s){1&t&&(e.TgZ(0,"div",31),e._UZ(1,"mat-spinner",32),e.TgZ(2,"span"),e._uU(3,"Loading systems..."),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("diameter",32))}const ae=function(t){return["/systems",t]};function de(t,s){if(1&t&&(e.TgZ(0,"a",33)(1,"div",34)(2,"div",35),e._uU(3),e.qZA(),e.TgZ(4,"div",36),e._uU(5),e.qZA()()()),2&t){const _=s.$implicit;e.Q6J("routerLink",e.VKq(3,ae,_.id)),e.xp6(3),e.hij(" ",_.display_name||_.name," "),e.xp6(2),e.hij(" ",_.id," ")}}const ce=function(t){return["/modules",t]},me=function(){return[]};function Ee(t,s){if(1&t){const _=e.EpF();e.TgZ(0,"div",15)(1,"div",16),e.YNc(2,re,1,3,"i",17),e._UZ(3,"div",18),e.qZA(),e.TgZ(4,"div",19),e.tHW(5,20),e._UZ(6,"a",21),e.N_p(),e.qZA(),e.TgZ(7,"div",12)(8,"button",22),e.NdJ("click",function(){const r=e.CHM(_).$implicit;return e.oxw(2).loadSystems(r)}),e._UZ(9,"app-icon",23),e.qZA(),e.TgZ(10,"mat-menu",null,24)(12,"div",25),e._uU(13),e.qZA(),e.YNc(14,le,4,1,"div",26),e.YNc(15,de,6,5,"a",27),e.qZA(),e.TgZ(16,"button",28),e.NdJ("click",function(){const r=e.CHM(_).$implicit;return e.oxw(2).removeModule(r)}),e._UZ(17,"app-icon",29),e.qZA()()()}if(2&t){const _=s.$implicit,i=e.MAs(11),o=e.oxw(2);e.xp6(2),e.Q6J("ngIf",_.system),e.xp6(1),e.ekj("bg-error",_.running&&!_.connected)("bg-success",_.running&&_.connected),e.xp6(3),e.Q6J("routerLink",e.VKq(11,ce,_.id)),e.pQV(_.custom_name||_.name),e.QtT(5),e.xp6(2),e.Q6J("matMenuTriggerFor",i),e.xp6(5),e.hij(" ",null==o.systems[_.id]?null:o.systems[_.id].length," System(s) "),e.xp6(1),e.Q6J("ngIf",o.loading_systems),e.xp6(1),e.Q6J("ngForOf",o.systems[_.id]||e.DdM(13,me))}}function Se(t,s){if(1&t&&(e.TgZ(0,"div",7)(1,"div",8)(2,"div",9),e._uU(3,"State"),e.qZA(),e.TgZ(4,"div",10),e.SDv(5,11),e.qZA(),e._UZ(6,"div",12),e.qZA(),e.TgZ(7,"div",13),e.YNc(8,Ee,18,14,"div",14),e.ALo(9,"async"),e.qZA()()),2&t){const _=e.oxw();e.xp6(8),e.Q6J("ngForOf",e.lcZ(9,1,_.modules))}}function ue(t,s){1&t&&(e.TgZ(0,"div",37),e._UZ(1,"mat-spinner",38),e.TgZ(2,"p"),e._uU(3,"Loading modules..."),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("diameter",48))}function Ae(t,s){1&t&&(e.TgZ(0,"div",37)(1,"p"),e._uU(2,"No modules with driver"),e.qZA()())}let Ce=(()=>{class t extends p.K{constructor(_){super(),this._service=_,this.loading_systems=!1,this.filter$=new C.X(""),this.loading=this._service.loading,this.item=this._service.item,this.systems={},this.modules=(0,te.aj)([this.filter$,this._service.modules]).pipe((0,v.U)(i=>{const[o,r]=i,d=o.toLowerCase();return o?r.filter(E=>E.name.toLowerCase().includes(d)||E.custom_name.toLowerCase().includes(d)):r})),this.removeModule=i=>this._service.removeModule(i)}loadSystems(_){return(0,m.mG)(this,void 0,void 0,function*(){this.loading_systems=!0;const i=yield(0,a.vIL)({module_id:_.id}).pipe((0,v.U)(({data:o})=>o)).toPromise();this.systems[_.id]=i||[],this.loading_systems=!1})}}return t.\u0275fac=function(_){return new(_||t)(e.Y36(M))},t.\u0275cmp=e.Xpm({type:t,selectors:[["driver-devices"]],features:[e.qOj],decls:11,vars:5,consts:function(){let s,_;return s=$localize`:@@nameLabel␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,_=$localize`:@@nameLabel␟bd6c739af47a911fc716b91fef6e9be600cd414a␟5610024539333668683:${"\ufffd#6\ufffd"}:START_LINK: ${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd/#6\ufffd"}:CLOSE_LINK:`,[[1,"flex","items-center","mb-4"],["appearance","outline",1,"h-12","flex-1"],["matPrefix","","className","backoffice-magnifying-glass text-xl mr-2"],["matInput","","placeholder","Filter Devices...",1,"rounded-none",3,"ngModel","ngModelChange"],["role","table","class","overflow-x-auto",4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],["role","table",1,"overflow-x-auto"],["table-head",""],[1,"w-12","p-2"],["flex","",1,"flex-1","p-2"],s,[1,"w-24","p-2"],["table-body","",1,"overflow-y-auto"],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"w-12","p-2","flex","items-center","justify-center"],["binding","","bind","connected",3,"model","sys","mod","modelChange",4,"ngIf"],[1,"h-2","w-2","rounded-full","bg-black"],["flex","",1,"flex-1","p-2","underline"],_,[3,"routerLink"],["mat-icon-button","","matTooltip","View Systems",3,"matMenuTriggerFor","click"],["className","backoffice-eye"],["menu","matMenu"],[1,"flex","items-center","justify-center","px-2","pb-2","opacity-70","border-b","border-gray-200","text-sm"],["class","flex items-center space-x-2 p-2 text-sm",4,"ngIf"],["mat-menu-item","","class","leading-tight",3,"routerLink",4,"ngFor","ngForOf"],["mat-icon-button","",3,"click"],["className","backoffice-trash"],["binding","","bind","connected",3,"model","sys","mod","modelChange"],[1,"flex","items-center","space-x-2","p-2","text-sm"],[3,"diameter"],["mat-menu-item","",1,"leading-tight",3,"routerLink"],[1,"flex","flex-col","justify-center","px-2","h-full"],[1,"text-base"],[1,"text-xs","opacity-60"],[1,"flex","flex-col","items-center","p-8","mx-auto"],[1,"mb-4",3,"diameter"]]},template:function(_,i){if(1&_&&(e.TgZ(0,"section",0)(1,"mat-form-field",1),e._UZ(2,"app-icon",2),e.TgZ(3,"input",3),e.NdJ("ngModelChange",function(r){return i.filter$.next(r)}),e.qZA()()(),e.TgZ(4,"section"),e.YNc(5,Se,10,3,"div",4),e.ALo(6,"async"),e.qZA(),e.YNc(7,ue,4,1,"ng-template",null,5,e.W1O),e.YNc(9,Ae,3,0,"ng-template",null,6,e.W1O)),2&_){const o=e.MAs(10);let r;e.xp6(3),e.Q6J("ngModel",""),e.xp6(2),e.Q6J("ngIf",null==(r=e.lcZ(6,3,i.modules))?null:r.length)("ngIfElse",o)}},directives:[P.KE,ie.o,P.qo,oe.Nt,S.Fj,S.JJ,S.On,c.O5,c.sg,ne.D,A.yS,D.lW,se.gM,O.p6,O.VK,F.Ou,O.OP],pipes:[c.Ov],styles:["[_nghost-%COMP%]{padding:1rem;height:100%;width:100%}[role=table][_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;min-width:28rem}\n/*# sourceMappingURL=driver-devices.component.ts-angular-inline--26.css.map*/"]}),t})();var ve=n(9960),Oe=n(5558);const fe=[{path:":id",component:x,children:[{path:"about",component:_e},{path:"modules",component:Ce},{path:"extend/:id",component:ve.z},{path:"history",component:Oe.D},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:"-"}];var Re=n(9522);let pe=(()=>{class t{}return t.\u0275fac=function(_){return new(_||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[c.ez,S.u5,A.Bz.forChild(fe),Re.X]]}),t})()}}]);
//# sourceMappingURL=18.29d6b181dddd599a.js.map