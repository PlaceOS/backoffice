"use strict";(self.webpackChunkbackoffice=self.webpackChunkbackoffice||[]).push([[94],{2094:(ve,E,s)=>{s.r(E),s.d(E,{AppUsersModule:()=>Te});var d=s(8267),c=s(9902),P=s(525),f=s(2378),A=s(1292),O=s(3083),e=s(2222),U=s(2016),R=s(2874);let N=(()=>{class n extends A.K{constructor(t){super(),this._service=t,this.name="users",this.show_options=this._service.show_options,this.tab_list=[]}get extensions(){return(0,O.fq)(this._service.active_item,this.name)}updateTabList(t){this.tab_list=[{id:"about",name:"About",icon:{class:"backoffice-info-with-circle"}},{id:"metadata",name:"Metadata",count:null==t?void 0:t.metadata,icon:{class:"backoffice-gist"}},{id:"history",name:"History",icon:{class:"backoffice-list"}}].concat(this.extensions)}ngOnInit(){this.subscription("item",this._service.item.subscribe(()=>this.updateTabList())),this.updateTabList()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(f.L))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-users"]],features:[e.qOj],decls:3,vars:1,consts:[[1,"flex-1","flex-col","sm:flex-row","flex","h-full","w-full","relative"],["heading","Users","name","users",1,"absolute","top-0","left-0","h-12","w-full","sm:h-full","sm:static"],["name","user","route","users",1,"flex-1","relative","mt-12","sm:mt-0","w-full","sm:w-1/2",3,"tabs"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"sidebar",1),e._UZ(2,"item-display",2),e.qZA()),2&t&&(e.xp6(2),e.Q6J("tabs",o.tab_list))},directives:[U.k,R.s],styles:["sidebar[_ngcontent-%COMP%]{transition:height .3s}@media screen and (min-width: 640px){sidebar[_ngcontent-%COMP%]{width:20em!important}}\n/*# sourceMappingURL=users.component.ts-angular-inline--39.css.map*/"]}),n})();var T=s(1933),b=s(6835);function Z(n,i){if(1&n&&(e.TgZ(0,"div",12),e.TgZ(1,"label"),e.SDv(2,13),e.qZA(),e.TgZ(3,"div",14),e.TgZ(4,"a",15),e._uU(5),e.qZA(),e.qZA(),e.qZA()),2&n){const t=e.oxw();e.xp6(4),e.Q6J("href","mailto:"+(null==t.item?null:t.item.email),e.LSH),e.xp6(1),e.Oqu(null==t.item?null:t.item.email)}}function x(n,i){if(1&n&&(e.TgZ(0,"div",12),e.TgZ(1,"label"),e.SDv(2,16),e.qZA(),e.TgZ(3,"div",14),e._uU(4),e.ALo(5,"dateFrom"),e.qZA(),e.qZA()),2&n){const t=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,1,1e3*(null==t.item?null:t.item.created_at))," ")}}function I(n,i){if(1&n&&(e.TgZ(0,"div",12),e.TgZ(1,"label"),e.SDv(2,17),e.qZA(),e.TgZ(3,"div",14),e._uU(4),e.ALo(5,"dateFrom"),e.qZA(),e.qZA()),2&n){const t=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,1,1e3*(null==t.item?null:t.item.updated_at))," ")}}function y(n,i){if(1&n&&(e.TgZ(0,"div",12),e.TgZ(1,"label"),e.SDv(2,18),e.qZA(),e.TgZ(3,"div",19),e._uU(4),e.qZA(),e.qZA()),2&n){const t=e.oxw();e.xp6(4),e.hij(" ",null==t.item?null:t.item.authority_id," ")}}function $(n,i){if(1&n&&(e.TgZ(0,"mat-chip"),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.xp6(1),e.Oqu(t)}}function F(n,i){if(1&n&&(e.TgZ(0,"div",14),e.TgZ(1,"mat-chip-list",23),e.YNc(2,$,2,1,"mat-chip",24),e.qZA(),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.item.groups)}}function L(n,i){if(1&n&&(e.TgZ(0,"div",12),e.TgZ(1,"label",20),e.SDv(2,21),e.qZA(),e.YNc(3,F,3,1,"div",22),e.qZA()),2&n){const t=e.oxw(),o=e.MAs(24);e.xp6(3),e.Q6J("ngIf",null==t.item.groups?null:t.item.groups.length)("ngIfElse",o)}}function B(n,i){1&n&&(e.TgZ(0,"div",14),e._uU(1,"No Access Groups"),e.qZA())}let G=(()=>{class n{constructor(t){this._service=t}get item(){return this._service.active_item}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(f.L))},n.\u0275cmp=e.Xpm({type:n,selectors:[["user-about"]],decls:25,vars:7,consts:function(){let i,t,o,a,_,r,l,u;return i=$localize`:@@techSupportRole␟031b6f40313933f6363bf8501916fb1167661df3␟7524309407036744400: User Role `,t=$localize`:@@techSupportRole␟2c67d427fc4370f7ebbc262e58af19c48a3cef5b␟3160540339920565657: Tech Support `,o=$localize`:@@systemAdminRole␟41029fd65510d474588802219fa1a77f3764381e␟8405084038860811251: System Admin `,a=$localize`:@@userCreatedAtLabel␟91b96d7228b6e05c238fa4e39abfc17ad51a6eef␟6631334172623029500:Email:`,_=$localize`:@@userCreatedAtLabel␟a5ed099ffc9e96f6970df843289ade8a7d20ab9f␟1616250945945379783:Created:`,r=$localize`:@userUpdatedAtLabel␟f94240161f912dbd8758b858877cddeab80f36cb␟1116759395536210856:Updated:`,l=$localize`:@userUpdatedAtLabel␟ce59f677986b7ffb7d9aecd079f5d117c5d4021b␟1873791838056734854:Authority ID:`,u=$localize`:@@userGroupsLabel␟de3e25c09f9ea2b26ac8502f589ec8cdeaa2ada0␟1800028427787031247:User Groups:`,[[1,"mb-4","space-y-2"],["class","flex items-center space-x-2",4,"ngIf"],["role","table"],["table-head",""],[1,"w-40","p-2"],i,[1,"flex-1","p-2"],["table-body",""],["table-row",""],t,o,["empty_group_state",""],[1,"flex","items-center","space-x-2"],a,[1,"value"],[3,"href"],_,r,l,[1,"value","mono"],["for","groups",1,"my-1"],u,["class","value",4,"ngIf","ngIfElse"],["name","groups"],[4,"ngFor","ngForOf"]]},template:function(t,o){1&t&&(e.TgZ(0,"section",0),e.YNc(1,Z,6,2,"div",1),e.YNc(2,x,6,3,"div",1),e.YNc(3,I,6,3,"div",1),e.YNc(4,y,5,1,"div",1),e.YNc(5,L,4,2,"div",1),e.qZA(),e.TgZ(6,"section"),e.TgZ(7,"div",2),e.TgZ(8,"div",3),e.TgZ(9,"div",4),e.SDv(10,5),e.qZA(),e._UZ(11,"div",6),e.qZA(),e.TgZ(12,"div",7),e.TgZ(13,"div",8),e.TgZ(14,"div",4),e.SDv(15,9),e.qZA(),e.TgZ(16,"div",6),e._uU(17),e.qZA(),e.qZA(),e.TgZ(18,"div",8),e.TgZ(19,"div",4),e.SDv(20,10),e.qZA(),e.TgZ(21,"div",6),e._uU(22),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.YNc(23,B,2,0,"ng-template",null,11,e.W1O)),2&t&&(e.xp6(1),e.Q6J("ngIf",null==o.item?null:o.item.created_at),e.xp6(1),e.Q6J("ngIf",null==o.item?null:o.item.created_at),e.xp6(1),e.Q6J("ngIf",null==o.item?null:o.item.updated_at),e.xp6(1),e.Q6J("ngIf",null==o.item?null:o.item.authority_id),e.xp6(1),e.Q6J("ngIf",null==o.item?null:o.item.groups),e.xp6(12),e.hij(" ",!0===(null==o.item?null:o.item.support)," "),e.xp6(5),e.hij(" ",!0===(null==o.item?null:o.item.sys_admin)," "))},directives:[d.O5,T.qn,d.sg,T.HS],pipes:[b.R],styles:["[_nghost-%COMP%]{padding:1rem;width:100%;height:100%}\n/*# sourceMappingURL=user-about.component.ts-angular-inline--40.css.map*/"]}),n})();function w(n,i){if(1&n&&(e.TgZ(0,"div",10),e.TgZ(1,"div",4),e._uU(2),e.ALo(3,"date"),e.qZA(),e.TgZ(4,"div",4),e._uU(5),e.ALo(6,"date"),e.qZA(),e.TgZ(7,"div",4),e.TgZ(8,"div"),e._uU(9),e.qZA(),e.TgZ(10,"div"),e._uU(11,"View"),e.qZA(),e.qZA(),e.qZA()),2&n){const t=i.$implicit;e.xp6(2),e.hij(" ",e.xi3(3,3,t.start,"MMM d, y, h:mm a")," "),e.xp6(3),e.hij(" ",e.xi3(6,6,t.end,"MMM d, y, h:mm a")," "),e.xp6(4),e.Oqu(t.systems.length)}}function X(n,i){if(1&n&&(e.TgZ(0,"div",2),e.TgZ(1,"div",3),e.TgZ(2,"div",4),e.SDv(3,5),e.qZA(),e.TgZ(4,"div",4),e.SDv(5,6),e.qZA(),e.TgZ(6,"div",4),e.SDv(7,7),e.qZA(),e.qZA(),e.TgZ(8,"div",8),e.YNc(9,w,12,9,"div",9),e.qZA(),e.qZA()),2&n){const t=e.oxw();e.xp6(9),e.Q6J("ngForOf",t.logs)}}function J(n,i){1&n&&(e.TgZ(0,"div",11),e.SDv(1,12),e.qZA())}let K=(()=>{class n extends A.K{constructor(t){super(),this._service=t,this.logs=[]}get item(){return this._service.active_item}ngOnInit(){this.subscription("item",this._service.item.subscribe(t=>{this.loadUserLogs()}))}loadUserLogs(t=0){}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(f.L))},n.\u0275cmp=e.Xpm({type:n,selectors:[["user-history"]],features:[e.qOj],decls:3,vars:2,consts:function(){let i,t,o,a;return i=$localize`:@@logEventStart␟8d06853e46a6d74951ff1cf9617f069c91fd50c5␟2130731909238927129:Session Start`,t=$localize`:@@logEventEnd␟e5cdb48c00597060251112914bcac2582f564c38␟4243735233618363847:Ended`,o=$localize`:@@logEventAction␟5b0d0e1718f55dc2d351402810b8cd61b139400f␟7550650761322890930: Systems Accessed `,a=$localize`:@@logTableEmpty␟721160b85c58426d8f14dc1d83290969edb6585c␟1736905540793055600: No logs found `,[["role","table",4,"ngIf","ngIfElse"],["empty_state",""],["role","table"],["table-head",""],[1,"w-1/3"],i,t,o,["table-body",""],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"p-8","text-center"],a]},template:function(t,o){if(1&t&&(e.YNc(0,X,10,1,"div",0),e.YNc(1,J,2,0,"ng-template",null,1,e.W1O)),2&t){const a=e.MAs(2);e.Q6J("ngIf",null==o.logs?null:o.logs.length)("ngIfElse",a)}},directives:[d.O5,d.sg],pipes:[d.uU],styles:["[_nghost-%COMP%]{padding:1rem;height:100%;width:100%}\n/*# sourceMappingURL=user-history.component.ts-angular-inline--41.css.map*/"]}),n})();var Y=s(5605),m=s(8999),q=s(3427),D=s(4307),v=s(395),g=s(3829),Q=s(6195),j=s(8806),C=s(1119),z=s(899),H=s(8252),W=s(9820),h=s(9026),V=s(8377),k=s(592),ee=s(8537),M=s(6298);let te=(()=>{class n{constructor(t,o){this._service=t,this._dialog=o,this._loading=new C.X(!1),this._change=new C.X(!1),this.loading=this._loading.asObservable(),this.item=this._service.item,this.counts=(0,z.aj)([this._service.all_item,this._change]).pipe((0,W.b)(300),(0,h.w)(a=>(0,j.mG)(this,void 0,void 0,function*(){const[_]=a;if(!(_ instanceof m.TT8))return{};this._loading.next(!0);const r=yield Promise.all([(0,m.Eio)(_.id).pipe((0,V.U)(u=>u.length)).toPromise().catch(u=>0)]),[l]=r;return this._loading.next(!1),{metadata:l}}))),this.metadata=this.item.pipe((0,h.w)(a=>a instanceof m.gGR?(0,m.Eio)(a.id):(0,H.of)([])),(0,k.K)(a=>[]),(0,ee.d)(1)),setTimeout(()=>this._change.next(!this._change.getValue()),1e3)}get active_item(){return this._service.active_item}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(f.L),e.LFG(M.uw))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var ne=s(7752),S=s(8420),oe=s(4731),ie=s(9499),ae=s(3013),se=s(9372);function _e(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(a){return a.stopPropagation()})("click",function(){e.CHM(t);const a=e.oxw(3).$implicit;return e.oxw(3).saveMetadata(a)}),e.SDv(1,20),e.qZA()}}function ce(n,i){if(1&n&&(e.ynx(0),e.YNc(1,_e,2,0,"button",18),e.BQk()),2&n){const t=e.oxw(2).$implicit,o=e.oxw(3),a=e.MAs(4);e.xp6(1),e.Q6J("ngIf",!o.loading[t.name])("ngIfElse",a)}}const le=function(){return{class:"backoffice-trash"}};function re(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",21),e.TgZ(1,"button",22),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2).$implicit;return e.oxw(3).deleteMetadata(a.name)}),e._UZ(2,"app-icon",14),e.qZA(),e.qZA()}2&n&&(e.xp6(2),e.Q6J("icon",e.DdM(1,le)))}const de=function(){return{class:"backoffice-edit"}};function me(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"mat-expansion-panel",10),e.TgZ(1,"mat-expansion-panel-header"),e.TgZ(2,"mat-panel-title"),e.TgZ(3,"div",11),e._uU(4),e.qZA(),e.YNc(5,ce,2,2,"ng-container",12),e.TgZ(6,"button",13),e.NdJ("click",function(a){e.CHM(t);const _=e.oxw().$implicit;return e.oxw(3).editMetadataDetails(_),a.stopPropagation()}),e._UZ(7,"app-icon",14),e.qZA(),e.YNc(8,re,3,2,"div",15),e.qZA(),e.qZA(),e.TgZ(9,"div",16),e._UZ(10,"settings-form-field",17),e.qZA(),e.qZA()}if(2&n){const t=e.oxw().$implicit,o=e.oxw(3);e.ekj("no-padding",!0),e.Q6J("formGroup",o.form_map[t.name]),e.xp6(4),e.hij(" ",o.form_map[t.name].controls.name.value," "),e.xp6(1),e.Q6J("ngIf",o.edited[t.name]),e.xp6(2),e.Q6J("icon",e.DdM(9,de)),e.xp6(1),e.Q6J("ngIf",!t.new),e.xp6(2),e.Q6J("schema",o.schema_map[t.name])("readonly",!1)}}function pe(n,i){if(1&n&&(e.ynx(0),e.YNc(1,me,11,10,"mat-expansion-panel",9),e.BQk()),2&n){const t=i.$implicit,o=e.oxw(3);e.xp6(1),e.Q6J("ngIf",o.form_map[t.name])}}function ge(n,i){if(1&n&&(e.TgZ(0,"div",7),e.TgZ(1,"mat-accordion"),e.YNc(2,pe,2,1,"ng-container",8),e.qZA(),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.metadata)}}function ue(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"div",3),e.TgZ(1,"button",4),e.NdJ("click",function(){return e.CHM(t),e.oxw().newMetadata()}),e.SDv(2,5),e.qZA(),e.YNc(3,ge,3,1,"div",6),e.qZA()}if(2&n){const t=e.oxw(),o=e.MAs(2);e.xp6(3),e.Q6J("ngIf",null==t.metadata?null:t.metadata.length)("ngIfElse",o)}}function fe(n,i){1&n&&(e.TgZ(0,"div",23),e.SDv(1,24),e.qZA())}function Se(n,i){1&n&&e._UZ(0,"mat-spinner",25)}const Ae=[{path:":id",component:N,children:[{path:"about",component:G},{path:"metadata",component:(()=>{class n extends A.K{constructor(t,o,a){super(),this._dialog=t,this._service=o,this._schemas=a,this.form_map={},this.edited={},this.loading={},this.schema_map={}}get item(){return this._service.active_item}validateName(t){return o=>t.indexOf(o.value)>=0?{name:!0}:null}ngOnInit(){this.subscription("metadata",this._service.metadata.subscribe(t=>{this.metadata=t,this.generateForms()}))}newMetadata(){this.metadata.push({name:`new_field_${Math.floor(999999999*Math.random())}`,description:"",new:!0,details:{}}),this.generateForms()}editMetadataDetails(t){this._dialog.open(D.v,{maxWidth:"95vw",data:{form:this.form_map[t.name]}})}deleteMetadata(t){const o=this._dialog.open(v.z,Object.assign(Object.assign({},v.t),{data:{title:"Kill process",content:`\n                    <p>Are you sure you want delete the metadata property "${t}"?</p>\n                `,icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("confirm",o.componentInstance.event.subscribe(a=>{"done"===a.reason&&(0,m._p1)(this.item.id,{name:t}).subscribe(()=>{(0,g.t5)(`Successfully removed "${t}" metadata.`),this.metadata=this.metadata.filter(_=>_.name!==t),this.generateForms()},_=>(0,g.cB)(`Error removing old "${t}" metadata. Error: ${_.response||_.message||_}`)),o.close()}))}saveMetadata(t){const o=this.form_map[t.name];if(o.markAllAsTouched(),!o.valid)return(0,g.cB)(`JSON for property "${o.controls.name.value}" is invalid`);const a=o.value;this.loading[t.name]=!0,(0,m.Ymr)(this.item.id,Object.assign(Object.assign({},a),{details:JSON.parse(a.details)})).subscribe(_=>{this.loading[t.name]=!1;const r=this.metadata.findIndex(l=>l.name===t.name);this.edited[t.name]=!1,t.name!==_.name&&(0,m._p1)(this.item.id,t).toPromise().catch(l=>(0,g.cB)(`Error removing old "${t.name}" metadata. Error: ${JSON.stringify(l.response||l.message||l)}`)),r>=0&&this.metadata.splice(r,1,Object.assign(Object.assign({},_),{new:!1})),(0,g.t5)(`Saved "${a.name}" metadata.`),this.generateForms()},_=>{this.loading[t.name]=!1,(0,g.cB)(`Error saving "${a.name}" metadata. Error: ${JSON.stringify(_.response||_.message||_)}`)})}generateForms(){delete this.form_map,this.form_map={},this.metadata.forEach(t=>{const o="string"==typeof t.details?JSON.parse(t.details):t.details;this.form_map[t.name]=new c.cw({name:new c.NI(t.name,[c.kI.required,this.validateName(this.metadata.filter(a=>a.name!==t.name).map(a=>a.name))]),description:new c.NI(t.description),editors:new c.NI(t.editors),details:new c.NI(JSON.stringify(o||{},void 0,4),[c.kI.required,q.NS]),schema:new c.NI(t.schema)}),this.subscription(`${t.name}_changes`,this.form_map[t.name].valueChanges.subscribe(()=>this.edited[t.name]=!0)),this.subscription(`${t.name}_schema`,this.form_map[t.name].controls.schema.valueChanges.subscribe(a=>{let _=this._schemas.getSchema(a);if(!_)try{_=JSON.parse(a)}catch(r){_={}}this.schema_map[t.name]=_}))})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(M.uw),e.Y36(te),e.Y36(Q.O))},n.\u0275cmp=e.Xpm({type:n,selectors:[["user-metadata"]],features:[e.qOj],decls:5,vars:1,consts:function(){let i,t,o;return i=$localize`:@@addMetadataAction␟21539c364f82b6b766d912c3734a014cb30f27a9␟6503325999299484981: Add new Metadata Field `,t=$localize`:@@saveAction␟baa3a276f05a6226cb663918714882c53b84da34␟25086637338905953: Save `,o=$localize`:@@userMetadataEmpty␟3b713db48de98501f8d533c049da179eaceef7e1␟1254780188914338824: No user metadata found `,[["class","p-4",4,"ngIf"],["empty_state",""],["load_state",""],[1,"p-4"],["mat-button","",3,"click"],i,["class","mt-4",4,"ngIf","ngIfElse"],[1,"mt-4"],[4,"ngFor","ngForOf"],[3,"no-padding","formGroup",4,"ngIf"],[3,"formGroup"],["edit","",1,"flex-1"],[4,"ngIf"],["mat-icon-button","","matTooltip","Edit Metadata Settings",3,"click"],[3,"icon"],["class","contents",4,"ngIf"],[1,"settings"],["formControlName","details","lang","json",3,"schema","readonly"],["mat-button","","save","",3,"click",4,"ngIf","ngIfElse"],["mat-button","","save","",3,"click"],t,[1,"contents"],["mat-icon-button","","matTooltip","Remove Metadata",3,"click"],[1,"p-8","text-center"],o,["diameter","32"]]},template:function(t,o){1&t&&(e.YNc(0,ue,4,2,"div",0),e.YNc(1,fe,2,0,"ng-template",null,1,e.W1O),e.YNc(3,Se,1,0,"ng-template",null,2,e.W1O)),2&t&&e.Q6J("ngIf",o.item)},directives:[d.O5,ne.lW,S.pp,d.sg,S.ib,c.JL,c.sg,S.yz,S.yK,oe.gM,ie.o,ae.x,c.JJ,c.u,se.$g],styles:["[edit][_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{opacity:0;transition:opacity .2s}[edit][_ngcontent-%COMP%]:hover   app-icon[_ngcontent-%COMP%]{opacity:1}mat-panel-title[_ngcontent-%COMP%]{display:flex;align-items:center;height:1.2em;overflow:visible}mat-panel-title[_ngcontent-%COMP%]   [save][_ngcontent-%COMP%]{font-size:.8em;background:none;border:none;text-decoration:underline;color:inherit}mat-form-field[_ngcontent-%COMP%]{height:3em}.settings[_ngcontent-%COMP%]{width:100%}.contents[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;flex:1;min-width:2em}.contents[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{text-decoration:none}\n/*# sourceMappingURL=user-metadata.component.ts-angular-inline--42.css.map*/"]}),n})()},{path:"history",component:K},{path:"extend/:id",component:Y.z},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:"-"}];var Ee=s(1226);let Te=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[d.ez,c.u5,c.UX,P.Bz.forChild(Ae),Ee.X]]}),n})()}}]);
//# sourceMappingURL=94.09108bb589769208.js.map