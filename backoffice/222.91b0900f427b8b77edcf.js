(self.webpackChunkplaceos=self.webpackChunkplaceos||[]).push([[222],{9222:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AppDriversModule:()=>ee});var o=i(1511),n=i(3695),s=i(6898),r=i(4762),l=i(5546),c=i(8194),a=i(5697),d=i(1572),u=i(5712),m=i(7096),f=i(6478);let v=(()=>{class e extends c.K{constructor(e){super(),this._service=e,this.name="drivers",this.show_options=this._service.show_options,this.tab_list=[]}get extensions(){return(0,a.fq)(this._service.active_item,this.name)}updateTabList(){this.tab_list=[{id:"about",name:"About",icon:{class:"backoffice-info-with-circle"}},{id:"modules",name:"Modules",count:this.device_count,icon:{class:"backoffice-tablet"}}].concat(this.extensions)}ngOnInit(){this.subscription("item",this._service.item.subscribe(e=>{this.loadValues(e),this.updateTabList()})),this.updateTabList()}loadValues(e){return(0,r.mG)(this,void 0,void 0,function*(){if(!e)return;const t={offset:0,limit:1,driver_id:e.id};this.device_count=(yield(0,l.Ne_)(t).toPromise()).total})}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(u.L))},e.\u0275cmp=d.Xpm({type:e,selectors:[["app-drivers"]],features:[d.qOj],decls:3,vars:1,consts:[[1,"flex-1","flex-col","sm:flex-row","flex","h-full","w-full","relative"],["heading","Drivers","name","drivers",1,"absolute","top-0","left-0","h-12","w-full","sm:h-full","sm:static"],["name","driver","route","drivers",1,"flex-1","relative","mt-12","sm:mt-0","w-full","sm:w-1/2",3,"tabs"]],template:function(e,t){1&e&&(d.TgZ(0,"div",0),d._UZ(1,"sidebar",1),d._UZ(2,"item-display",2),d.qZA()),2&e&&(d.xp6(2),d.Q6J("tabs",t.tab_list))},directives:[m.k,f.s],styles:["sidebar[_ngcontent-%COMP%]{transition:height .3s}@media screen and (min-width:640px){sidebar[_ngcontent-%COMP%]{width:20em!important}}"]}),e})();var p=i(8512),g=i(3835),Z=i(4689),h=i(7727),b=i(5012),_=i(2628),A=i(4019),x=i(9996),T=i(8303),q=i(4103),w=i(8739),y=i(5646),L=i(4608);let N=(()=>{class e{constructor(e,t){this._state=e,this._dialog=t,this._loading=new p.X(!1),this._last_error=new p.X(null),this.item=this._state.item,this.loading=this._loading.asObservable(),this.last_error=this._last_error.asObservable(),this.is_compiled=this.item.pipe((0,g.h)(e=>!!e&&e instanceof l.CbG),(0,Z.w)(e=>(0,l.J_X)(e.id)),(0,h.K)(e=>(0,r.mG)(this,void 0,void 0,function*(){const t=yield null==e?void 0:e.json();if(this._last_error.next((null==t?void 0:t.compilation_output)||e),console.log("Driver Error:",t),!(null==t?void 0:t.compilation_output))throw e})),(0,b.a)((0,_.g)(1e3)),(0,A.b)(e=>e?this._last_error.next(null):"")),this.modules=this.item.pipe((0,Z.w)(e=>(0,r.mG)(this,void 0,void 0,function*(){this._loading.next(!0);const t=yield(0,l.Ne_)({driver_id:e.id}).toPromise();return this._loading.next(!1),t})),(0,x.U)(e=>e.data),(0,T.d)()),this.item.subscribe(()=>this._last_error.next(null))}get active_item(){return this._state.active_item}viewError(){const e=this._last_error.getValue();e&&this._dialog.open(y.a,{data:{title:"Driver Compilation Error",content:e}})}recompileDriver(){return(0,r.mG)(this,void 0,void 0,function*(){const e=yield(0,q._5)({title:"Recompile Driver",content:"<p>Are you sure you want recompile this driver?</p><p>New driver code will be loaded and device settings will be updated.</p>",icon:{type:"icon",class:"backoffice-cycle"}},this._dialog);if(!e||!e.reason)return e.close();e.loading("Recompiling driver...");const t=yield(0,l.qEr)(this._state.active_item.id).toPromise().catch(e=>null);if(e.close(),!t)return(0,w.cB)("Failed to recompiled driver.");(0,w.t5)("Successfully recompiled driver.")})}removeModule(e){return(0,r.mG)(this,void 0,void 0,function*(){const t=yield(0,q._5)({title:"Remove module?",content:`Remove ${e.driver_id}?<br>All associated data be deleted immediatedly.`,icon:{type:"icon",class:"backoffice-trash"}},this._dialog);if(!t||!t.reason)return;const i=yield(0,l.zed)(this.active_item.id,e.id).toPromise().catch(t=>{(0,w.cB)(`Error removing module ${e.id}. Error: ${t.statusText||t.message||t}`)});t.close(),i&&(this._state.replaceItem(i),(0,w.t5)("Successfully removed module."))})}}return e.\u0275fac=function(t){return new(t||e)(d.LFG(u.L),d.LFG(L.uw))},e.\u0275prov=d.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var O=i(5980),$=i(7806),C=i(9441),D=i(6529);function I(e,t){if(1&e&&(d.TgZ(0,"div",2),d.TgZ(1,"label"),d.SDv(2,19),d.qZA(),d.TgZ(3,"div",4),d._uU(4),d.qZA(),d.qZA()),2&e){const e=d.oxw();d.xp6(4),d.Oqu(e.item.default_uri)}}function U(e,t){if(1&e&&(d.TgZ(0,"div",2),d.TgZ(1,"label"),d.SDv(2,20),d.qZA(),d.TgZ(3,"div",4),d._uU(4),d.qZA(),d.qZA()),2&e){const e=d.oxw();d.xp6(4),d.Oqu(e.item.default_port)}}function J(e,t){1&e&&d._UZ(0,"mat-spinner",21)}function S(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"button",12),d.NdJ("click",function(){return d.CHM(e),d.oxw().viewErrors()}),d._uU(1,"View Errors"),d.qZA()}}function k(e,t){if(1&e&&(d.TgZ(0,"section"),d._UZ(1,"a-settings-form",22),d.qZA()),2&e){const e=d.oxw();d.xp6(1),d.Q6J("merge",!0)("id",e.item.id)("settings",e.item.settings)}}function M(e,t){1&e&&(d.TgZ(0,"div",23),d._UZ(1,"mat-spinner",24),d.TgZ(2,"p"),d.SDv(3,25),d.qZA(),d.qZA())}let E=(()=>{class e{constructor(e){this._service=e,this.compiled=this._service.is_compiled,this.compilation_error=this._service.last_error,this.recompileDriver=()=>this._service.recompileDriver(),this.viewErrors=()=>this._service.viewError()}get item(){return this._service.active_item||{}}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(N))},e.\u0275cmp=d.Xpm({type:e,selectors:[["driver-about"]],decls:49,vars:22,consts:function(){let e,t,i,o,n,s,r,l,c,a,d;return e=$localize`:@@driverDetailsCompiled␟cf381ca16eaabe3374d51e9f94f2218500c4fa4e␟9153697548218950089:Compiled:`,t=$localize`:@@driverDetailsCommit␟fd8aae50a9e4449f1ca02dd094975918d9a5667b␟1255418805683509654:Commit:`,i=$localize`:@@driverDetailsFileName␟38b21a77c169dc1d573d1959b82ee0d1bc2382a4␟3153886573188541985:File Name:`,o=$localize`:@@driverDetailsModuleName␟30503cc4139d9b80b7ee428e70c83f93018643c3␟2852585380255004131:Module Name:`,n=$localize`:@@driverCreatedAtLabel␟a5ed099ffc9e96f6970df843289ade8a7d20ab9f␟1616250945945379783:Created:`,s=$localize`:@@driverUpdatedAtLabel␟f94240161f912dbd8758b858877cddeab80f36cb␟1116759395536210856:Updated:`,r=$localize`:@@driverReloadAction␟9e4193ff8bc8eb566c2a631f96b9c93ac4d22a4e␟5398060262188177679: Recompile Driver `,l=$localize`:@@settingsLabel␟121cc5391cd2a5115bc2b3160379ee5b36cd7716␟4930506384627295710:Settings`,c=$localize`:@@driverDefaultURILabel␟aaf77b7baecf340df6c6e20f4016289f440c390e␟2755927892619874934:Default URI:`,a=$localize`:@@driverDefaultPortLabel␟708739a9f194ca4078bfdeed2db588d855c042b8␟8341926293707687932:Default Port Number:`,d=$localize`:@@driverLoadingLabel␟07c312791623a62194aaf1b64cf77ac60427ba34␟1421066576333999335:Loading driver settings...`,[[1,"mb-4","space-y-2"],["class","flex items-center space-x-2",4,"ngIf"],[1,"flex","items-center","space-x-2"],e,[1,"value"],["diameter","24",4,"ngIf"],["mat-button","",3,"click",4,"ngIf"],t,i,o,n,s,["mat-button","",3,"click"],r,[1,"my-4"],[1,"font-medium","text-lg"],l,[4,"ngIf","ngIfElse"],["load_state",""],c,a,["diameter","24"],[3,"merge","id","settings"],[1,"flex","flex-col","items-center","justify-center"],["diameter","48",1,"mb-4"],d]},template:function(e,t){if(1&e&&(d.TgZ(0,"section",0),d.YNc(1,I,5,1,"div",1),d.YNc(2,U,5,1,"div",1),d.TgZ(3,"div",2),d.TgZ(4,"label"),d.SDv(5,3),d.qZA(),d.TgZ(6,"div",4),d._uU(7),d.ALo(8,"async"),d.qZA(),d.YNc(9,J,1,0,"mat-spinner",5),d.ALo(10,"async"),d.YNc(11,S,2,0,"button",6),d.ALo(12,"async"),d.qZA(),d.TgZ(13,"div",2),d.TgZ(14,"label"),d.SDv(15,7),d.qZA(),d.TgZ(16,"div",4),d._uU(17),d.qZA(),d.qZA(),d.TgZ(18,"div",2),d.TgZ(19,"label"),d.SDv(20,8),d.qZA(),d.TgZ(21,"div",4),d._uU(22),d.qZA(),d.qZA(),d.TgZ(23,"div",2),d.TgZ(24,"label"),d.SDv(25,9),d.qZA(),d.TgZ(26,"div",4),d._uU(27),d.qZA(),d.qZA(),d.TgZ(28,"div",2),d.TgZ(29,"label"),d.SDv(30,10),d.qZA(),d.TgZ(31,"div",4),d._uU(32),d.ALo(33,"dateFrom"),d.qZA(),d.qZA(),d.TgZ(34,"div",2),d.TgZ(35,"label"),d.SDv(36,11),d.qZA(),d.TgZ(37,"div",4),d._uU(38),d.ALo(39,"dateFrom"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(40,"section"),d.TgZ(41,"button",12),d.NdJ("click",function(){return t.recompileDriver()}),d.SDv(42,13),d.qZA(),d.qZA(),d._UZ(43,"hr",14),d.TgZ(44,"header",15),d.SDv(45,16),d.qZA(),d.YNc(46,k,2,3,"section",17),d.YNc(47,M,4,0,"ng-template",null,18,d.W1O)),2&e){const e=d.MAs(48);d.xp6(1),d.Q6J("ngIf",t.item.default_uri),d.xp6(1),d.Q6J("ngIf",t.item.default_port),d.xp6(5),d.Oqu(d.lcZ(8,12,t.compiled)?"true":"false"),d.xp6(2),d.Q6J("ngIf",!d.lcZ(10,14,t.compiled)),d.xp6(2),d.Q6J("ngIf",d.lcZ(12,16,t.compilation_error)),d.xp6(6),d.Oqu(t.item.commit),d.xp6(5),d.Oqu(t.item.file_name),d.xp6(5),d.Oqu(null==t.item?null:t.item.module_name),d.xp6(5),d.Oqu(d.lcZ(33,18,1e3*t.item.created_at)),d.xp6(6),d.Oqu(d.lcZ(39,20,1e3*t.item.updated_at)),d.xp6(8),d.Q6J("ngIf",t.item.settings)("ngIfElse",e)}},directives:[o.O5,O.lW,$.$g,C.v],pipes:[o.Ov,D.R],styles:["[_nghost-%COMP%]{padding:1rem;height:100%;width:100%}"]}),e})();var z=i(3080),Q=i(6283),F=i(3609),P=i(6756),Y=i(5204);function R(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"i",27),d.NdJ("modelChange",function(t){return d.CHM(e),d.oxw().$implicit.connected=t}),d.qZA()}if(2&e){const e=d.oxw().$implicit;d.Q6J("model",e.connected)("sys",e.system.id)("mod",e)}}const K=function(e){return["/modules",e]},j=function(e){return["/systems",e]};function G(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"div",16),d.TgZ(1,"div",17),d.YNc(2,R,1,3,"i",18),d._UZ(3,"div",19),d.qZA(),d.TgZ(4,"div",20),d.tHW(5,21),d._UZ(6,"a",22),d.N_p(),d.qZA(),d.TgZ(7,"div",23),d.tHW(8,24),d._UZ(9,"a",22),d.N_p(),d.qZA(),d.TgZ(10,"div",9),d.TgZ(11,"button",25),d.NdJ("click",function(){const t=d.CHM(e).$implicit;return d.oxw(2).removeModule(t)}),d._UZ(12,"app-icon",26),d.qZA(),d.qZA(),d.qZA()}if(2&e){const e=t.$implicit;d.xp6(2),d.Q6J("ngIf",e.system),d.xp6(1),d.ekj("bg-error",e.running&&!e.connected)("bg-success",e.running&&e.connected),d.xp6(3),d.Q6J("routerLink",d.VKq(9,K,e.id)),d.pQV(e.custom_name||e.name),d.QtT(5),d.xp6(3),d.Q6J("routerLink",d.VKq(11,j,null==e.system?null:e.system.id)),d.pQV(null==e.system?null:e.system.name),d.QtT(8)}}function V(e,t){if(1&e&&(d.TgZ(0,"div",7),d.TgZ(1,"div",8),d.TgZ(2,"div",9),d._uU(3,"State"),d.qZA(),d.TgZ(4,"div",10),d.SDv(5,11),d.qZA(),d.TgZ(6,"div",12),d.SDv(7,13),d.qZA(),d._UZ(8,"div",9),d.qZA(),d.TgZ(9,"div",14),d.YNc(10,G,13,13,"div",15),d.ALo(11,"async"),d.qZA(),d.qZA()),2&e){const e=d.oxw();d.xp6(10),d.Q6J("ngForOf",d.lcZ(11,1,e.modules))}}function X(e,t){1&e&&(d.TgZ(0,"div",28),d._UZ(1,"mat-spinner",29),d.TgZ(2,"p"),d._uU(3,"Loading modules..."),d.qZA(),d.qZA()),2&e&&(d.xp6(1),d.Q6J("diameter",48))}function W(e,t){1&e&&(d.TgZ(0,"div",28),d.TgZ(1,"p"),d._uU(2,"No modules with driver"),d.qZA(),d.qZA())}const H=[{path:":id",component:v,children:[{path:"about",component:E},{path:"modules",component:(()=>{class e extends c.K{constructor(e){super(),this._service=e,this.filter$=new p.X(""),this.loading=this._service.loading,this.item=this._service.item,this.modules=(0,z.aj)([this.filter$,this._service.modules]).pipe((0,x.U)(e=>{const[t,i]=e,o=t.toLowerCase();return t?i.filter(e=>e.name.toLowerCase().includes(o)||e.custom_name.toLowerCase().includes(o)):i})),this.removeModule=e=>this._service.removeModule(e)}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(N))},e.\u0275cmp=d.Xpm({type:e,selectors:[["driver-devices"]],features:[d.qOj],decls:11,vars:5,consts:function(){let e,t,i,o;return e=$localize`:@@nameLabel␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,t=$localize`:@@triggerCountLabel␟cd367617089caee7c1b256e62dc858a8e1d6ebaa␟8627481566428528640: System `,i=$localize`:@@nameLabel␟bd6c739af47a911fc716b91fef6e9be600cd414a␟5610024539333668683:${"\ufffd#6\ufffd"}:START_LINK: ${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd/#6\ufffd"}:CLOSE_LINK:`,o=$localize`:@@triggerCountLabel␟ae1f743f09222b6e5286353943f21c01e58e2296␟2244782107666441480:${"\ufffd#9\ufffd"}:START_LINK: ${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd/#9\ufffd"}:CLOSE_LINK:`,[[1,"flex","items-center","mb-4"],["appearance","outline",1,"h-12","flex-1"],["matPrefix","","className","backoffice-magnifying-glass text-xl mr-2"],["matInput","","placeholder","Filter triggers...",1,"rounded-none",3,"ngModel","ngModelChange"],["role","table","class","overflow-x-auto",4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],["role","table",1,"overflow-x-auto"],["table-head",""],[1,"w-12","p-2"],["flex","",1,"flex-1","p-2"],e,[1,"w-48","p-2"],t,["table-body","",1,"overflow-y-auto"],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"w-12","p-2","flex","items-center","justify-center"],["binding","","bind","connected",3,"model","sys","mod","modelChange",4,"ngIf"],[1,"h-2","w-2","rounded-full","bg-black"],["flex","",1,"flex-1","p-2","underline"],i,[3,"routerLink"],[1,"w-48","p-2","underline"],o,["mat-icon-button","",3,"click"],["className","backoffice-trash"],["binding","","bind","connected",3,"model","sys","mod","modelChange"],[1,"flex","flex-col","items-center","p-8","mx-auto"],[1,"mb-4",3,"diameter"]]},template:function(e,t){if(1&e&&(d.TgZ(0,"section",0),d.TgZ(1,"mat-form-field",1),d._UZ(2,"app-icon",2),d.TgZ(3,"input",3),d.NdJ("ngModelChange",function(e){return t.filter$.next(e)}),d.qZA(),d.qZA(),d.qZA(),d.TgZ(4,"section"),d.YNc(5,V,12,3,"div",4),d.ALo(6,"async"),d.qZA(),d.YNc(7,X,4,1,"ng-template",null,5,d.W1O),d.YNc(9,W,3,0,"ng-template",null,6,d.W1O)),2&e){const e=d.MAs(10);let i;d.xp6(3),d.Q6J("ngModel",""),d.xp6(2),d.Q6J("ngIf",null==(i=d.lcZ(6,3,t.modules))?null:i.length)("ngIfElse",e)}},directives:[Q.KE,F.o,Q.qo,P.Nt,n.Fj,n.JJ,n.On,o.O5,o.sg,s.yS,O.lW,Y.D,$.$g],pipes:[o.Ov],styles:["[_nghost-%COMP%]{padding:1rem;height:100%;width:100%}[role=table][_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;min-width:28rem}"]}),e})()},{path:"extend/:id",component:i(3511).z},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:"-"}];var B=i(7561);let ee=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.oAB({type:e}),e.\u0275inj=d.cJS({imports:[[o.ez,n.u5,s.Bz.forChild(H),B.X]]}),e})()}}]);
//# sourceMappingURL=222.91b0900f427b8b77edcf.js.map