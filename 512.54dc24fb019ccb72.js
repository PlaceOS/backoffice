"use strict";(self.webpackChunkbackoffice=self.webpackChunkbackoffice||[]).push([[512],{5512:(Xe,S,r)=>{r.r(S),r.d(S,{AppDriversModule:()=>qe});var d=r(6575),g=r(987),C=r(9794),p=r(1670),c=r(5530),v=r(462),P=r(9681),h=r(6520),T=r(8175),f=r(7422),A=r(680),K=r(5046),Q=r(9979),G=r(2872),q=r(5746),b=r(3759),Z=r(3540),u=r(9928),X=r(3174),O=r(6939),e=r(163),E=r(6861),R=r(5997),x=r(3910),D=r(702),Y=r(6658),N=r(257);function j(n,a){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"async"),e.qZA()),2&n){const t=e.oxw();let o;e.xp6(1),e.hij(" - ",(null==(o=e.lcZ(2,1,t.drivers_with_updates))?null:o.total)||0," updates available ")}}function k(n,a){1&n&&(e.TgZ(0,"button",6)(1,"app-icon"),e._uU(2,"close"),e.qZA()())}function z(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td")(2,"mat-checkbox",13),e.NdJ("ngModelChange",function(i){const l=e.CHM(t).$implicit,_=e.oxw(4);return e.KtG(_.toggleDriver(l.id,i))}),e.qZA()(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td")(6,"code",14),e._uU(7),e.ALo(8,"slice"),e.qZA()(),e.TgZ(9,"td")(10,"code",14),e._uU(11),e.ALo(12,"slice"),e.qZA()()()}if(2&n){const t=a.$implicit,o=e.oxw(4);e.xp6(2),e.Q6J("ngModel",o.selected_drivers.includes(t.id)),e.xp6(2),e.Oqu(t.name),e.xp6(2),e.Q6J("matTooltip",t.commit),e.xp6(1),e.Oqu(e.Dn7(8,6,t.commit,0,9)),e.xp6(3),e.Q6J("matTooltip",t.commit),e.xp6(1),e.Oqu(e.Dn7(12,10,t.update_info.commit,0,9))}}function H(n,a){if(1&n&&(e.ynx(0),e.YNc(1,z,13,14,"tr",12),e.BQk()),2&n){const t=e.oxw().ngIf;e.xp6(1),e.Q6J("ngForOf",t.data)}}function W(n,a){if(1&n&&(e.ynx(0),e.YNc(1,H,2,1,"ng-container",11),e.BQk()),2&n){const t=a.ngIf;e.oxw();const o=e.MAs(16);e.xp6(1),e.Q6J("ngIf",t.total>0)("ngIfElse",o)}}function ee(n,a){1&n&&(e.TgZ(0,"tr")(1,"td",15),e._uU(2,"No drivers require updating."),e.qZA()())}function te(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"main",7)(1,"table")(2,"thead",8)(3,"tr")(4,"th")(5,"mat-checkbox",9),e.NdJ("change",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.toggleAll(i.checked))}),e.qZA()(),e.TgZ(6,"th"),e._uU(7,"Name"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"Current Version"),e.qZA(),e.TgZ(10,"th"),e._uU(11,"Latest Version"),e.qZA()()(),e.TgZ(12,"tbody"),e.YNc(13,W,2,2,"ng-container",1),e.ALo(14,"async"),e.YNc(15,ee,3,0,"ng-template",null,10,e.W1O),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(5),e.Q6J("checked",t.all_selected)("indeterminate",t.some_selected),e.xp6(8),e.Q6J("ngIf",e.lcZ(14,3,t.drivers_with_updates))}}function ie(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"footer",16)(1,"button",17),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.updateDrivers())}),e._uU(2),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("disabled",t.selected_drivers.length<=0),e.xp6(1),e.hij(" Update Selected Drivers (",t.selected_drivers.length,") ")}}function ne(n,a){if(1&n&&(e.TgZ(0,"div",18),e._UZ(1,"mat-spinner",19),e.TgZ(2,"p"),e._uU(3),e.qZA()()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("diameter",32),e.xp6(2),e.Oqu(t.loading||"Loading drivers...")}}let oe=(()=>{class n{get all_selected(){return this.selected_drivers.length===this.driver_count}get some_selected(){return this.selected_drivers.length>0&&!this.all_selected}constructor(t){this._dialog_ref=t,this.loading="Loading drivers...",this.driver_count=0,this._change=new v.X(0),this.drivers_with_updates=this._change.pipe((0,h.w)(()=>(this.loading="Loading drivers...",(0,c.dDC)({update_available:!0,limit:1e3}).pipe((0,T.K)(()=>(0,P.of)({data:[],total:0}))))),(0,f.U)(o=>(o.data=o.data.filter(i=>i.commit!==i.update_info.commit),o.data=o.data.sort((i,s)=>i.name.localeCompare(s.name)),this.selected_drivers=o.data.map(i=>i.id),this.driver_count=o.total,this.loading="",o)),(0,A.d)(1)),this.selected_drivers=[]}toggleDriver(t,o){this.selected_drivers=this.selected_drivers.filter(i=>i!==t),o&&this.selected_drivers.push(t)}toggleAll(t){var o=this;return(0,p.Z)(function*(){console.log("Toggle all:",t),o.selected_drivers=t?(yield o.drivers_with_updates.pipe((0,O.q)(1)).toPromise()).data.map(i=>i.id):[]})()}updateDrivers(){var t=this;return(0,p.Z)(function*(){t.loading="Updating drivers...",t._dialog_ref.disableClose=!0;const i=(yield t.drivers_with_updates.pipe((0,O.q)(1)).toPromise()).data.filter(s=>t.selected_drivers.includes(s.id));yield Promise.all(i.map(s=>s.commit!==s.update_info.commit?(0,c.VQC)(s.id,{...s,commit:s.update_info.commit}).toPromise():Promise.resolve())).catch(s=>{(0,u.cB)("Error updating drivers",s),t.loading="",t._dialog_ref.disableClose=!1}),(0,u.t5)(`Successfully updated ${i.length} drivers`),t.loading="",t.all_selected?t._dialog_ref.close():t._change.next(Date.now())})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(E.so))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["driver-update-list-modal"]],decls:10,vars:7,consts:[[1,"border-b","border-base-200"],[4,"ngIf"],["btn","","icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","w-[80vw] max-w-[48rem] max-h-[65vh] overflow-auto",4,"ngIf","ngIfElse"],["class","border-t border-base-200 p-2 flex justify-end space-x-2",4,"ngIf"],["load_state",""],["btn","","icon","","matRipple","","mat-dialog-close",""],[1,"w-[80vw]","max-w-[48rem]","max-h-[65vh]","overflow-auto"],[1,"text-left"],[3,"checked","indeterminate","change"],["empty_state",""],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[3,"ngModel","ngModelChange"],[3,"matTooltip"],["colspan","4"],[1,"border-t","border-base-200","p-2","flex","justify-end","space-x-2"],["btn","","matRipple","",3,"disabled","click"],[1,"w-[20rem]","h-48","flex","flex-col","space-y-2","items-center","justify-center"],[3,"diameter"]],template:function(o,i){if(1&o&&(e.TgZ(0,"header",0)(1,"h2"),e._uU(2," Update Drivers "),e.YNc(3,j,3,3,"span",1),e.qZA(),e.YNc(4,k,3,0,"button",2),e.qZA(),e.YNc(5,te,17,5,"main",3),e.ALo(6,"async"),e.YNc(7,ie,3,2,"footer",4)(8,ne,4,2,"ng-template",null,5,e.W1O)),2&o){const s=e.MAs(9);e.xp6(3),e.Q6J("ngIf",!i.loading),e.xp6(1),e.Q6J("ngIf",!i.loading),e.xp6(1),e.Q6J("ngIf",e.lcZ(6,5,i.drivers_with_updates)&&!i.loading)("ngIfElse",s),e.xp6(2),e.Q6J("ngIf",!i.loading)}},dependencies:[d.sg,d.O5,g.JJ,g.On,R.o,E.ZT,x.Ou,D.gM,Y.oG,N.wG,d.Ov,d.OU],styles:["th[_ngcontent-%COMP%]{padding:.25rem .5rem}\n\n/*# sourceMappingURL=driver-update-list-modal.component.ts-angular-inline--43.css.map*/"]})}return n})(),M=(()=>{class n{get active_item(){return this._state.active_item}constructor(t,o){var i=this;this._state=t,this._dialog=o,this._loading=new v.X(!1),this._last_error=new v.X(null),this._poll=new v.X(0),this.item=this._state.item,this.loading=this._loading.asObservable(),this.last_error=this._last_error.asObservable(),this.updates_available=this._poll.pipe((0,h.w)(()=>(0,c.dDC)({update_available:!0,limit:1}).pipe((0,T.K)(()=>(0,P.of)({data:[],total:0})))),(0,f.U)(s=>s.total>1),(0,A.d)(1)),this.is_compiled=this.item.pipe((0,K.h)(s=>!!s&&s instanceof c.CbG),(0,h.w)(s=>(0,c.J_X)(s.id)),(0,T.K)(function(){var s=(0,p.Z)(function*(l){const _=yield l?.json();if(i._last_error.next(_?.compilation_output||l),!_?.compilation_output)throw l});return function(l){return s.apply(this,arguments)}}()),(0,Q.a)((0,G.g)(5e3)),(0,q.b)(s=>s?this._last_error.next(null):""),(0,A.d)(1)),this.modules=this.item.pipe((0,h.w)(function(){var s=(0,p.Z)(function*(l){if(!l)return{data:[]};i._loading.next(!0);const _=yield(0,c.Ne_)({driver_id:l.id}).toPromise();return i._loading.next(!1),_});return function(l){return s.apply(this,arguments)}}()),(0,f.U)(s=>s.data),(0,A.d)()),this.item.subscribe(()=>this._last_error.next(null))}showUpdateList(){this._dialog.open(oe,{})}viewError(){const t=this._last_error.getValue();t&&this._dialog.open(X.a,{data:{title:"Driver Compilation Error",content:t}})}updateDriver(){var t=this;return(0,p.Z)(function*(){const o=t._state.active_item;if(!o.update_available)return(0,u.cB)("No update available.");const i=yield(0,b._5)({title:"Update Driver",content:"<p>Are you sure you want update this driver?</p><p>New driver code will be loaded and device settings will be updated.</p>",icon:{type:"icon",content:"update"}},t._dialog);if(!i||!i.reason)return i.close();i.loading("Updating driver...");let s=yield(0,c.VQC)(o.id,{...o,commit:o.update_info.commit}).toPromise().catch(l=>null);return s?(i.loading("Recompiling driver..."),s=yield(0,c.qEr)(o.id).toPromise().catch(l=>null),i.close(),s?void(0,u.t5)("Successfully updated and recompiled driver."):(0,u.cB)("Failed to recompiled driver.")):(i.close(),(0,u.cB)("Failed to recompiled driver."))})()}recompileDriver(){var t=this;return(0,p.Z)(function*(){const o=yield(0,b._5)({title:"Recompile Driver",content:"<p>Are you sure you want recompile this driver?</p><p>New driver code will be loaded and device settings will be updated.</p>",icon:{type:"icon",class:"backoffice-cycle"}},t._dialog);if(!o||!o.reason)return o.close();o.loading("Recompiling driver...");const i=yield(0,c.qEr)(t._state.active_item.id).toPromise().catch(s=>null);if(o.close(),!i)return(0,u.cB)("Failed to recompiled driver.");(0,u.t5)("Successfully recompiled driver.")})()}removeModule(t){var o=this;return(0,p.Z)(function*(){const i=yield(0,b._5)({title:"Remove module?",content:`Remove ${t.driver_id}?<br>`,extra:["error","Note that all associated data be deleted immediatedly."],icon:{type:"icon",class:"backoffice-trash"}},o._dialog);if(!i||!i.reason)return;const s=yield(0,c.zed)(o.active_item.id,t.id).toPromise().catch(l=>{(0,u.cB)(`Error removing module ${t.id}. Error: ${l.statusText||l.message||l}`)});i.close(),s&&(o._state.replaceItem(s),(0,u.t5)("Successfully removed module."))})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(Z.L),e.LFG(E.uw))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var se=r(4813),re=r(857);function le(n,a){if(1&n&&(e.TgZ(0,"div",3)(1,"label"),e.SDv(2,26),e.qZA(),e.TgZ(3,"div",5),e._uU(4),e.qZA()()),2&n){const t=e.oxw();e.xp6(4),e.Oqu(t.item.default_uri)}}function ae(n,a){if(1&n&&(e.TgZ(0,"div",3)(1,"label"),e.SDv(2,27),e.qZA(),e.TgZ(3,"div",5),e._uU(4),e.qZA()()),2&n){const t=e.oxw();e.xp6(4),e.Oqu(t.item.default_port)}}function de(n,a){1&n&&e._UZ(0,"mat-spinner",28)}function ce(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.viewErrors())}),e._uU(1," View Errors "),e.qZA()}}function _e(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.updateDriver())}),e.SDv(1,30),e.qZA()}}function me(n,a){if(1&n&&(e.TgZ(0,"section"),e._UZ(1,"a-settings-form",31),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("merge",!0)("id",t.item.id)("settings",t.item.settings)}}function ue(n,a){1&n&&(e.TgZ(0,"div",32),e._UZ(1,"mat-spinner",33),e.TgZ(2,"p"),e.SDv(3,34),e.qZA()())}const pe=n=>["/repositories",n,"about"];let ge=(()=>{class n{get item(){return this._service.active_item||{}}constructor(t){this._service=t,this.compiled=this._service.is_compiled,this.compilation_error=this._service.last_error,this.recompileDriver=()=>this._service.recompileDriver(),this.updateDriver=()=>this._service.updateDriver(),this.viewErrors=()=>this._service.viewError()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(M))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["driver-about"]],decls:58,vars:28,consts:()=>{let t,o,i,s,l,_,L,U,$,w,V,B,J;return t=$localize`:@@driverDetailsCommit␟b45d01f61abb874a71b314051193f4b72c3d4cf2␟6307174276781140101:Repository`,o=$localize`:@@driverDetailsModuleName␟9327d1b19b3a735e6a5ff3bce7b4477a8aaeaba3␟3177116271803893494:Module Name`,i=$localize`:@@driverCreatedAtLabel␟1b051734b0ee9021991c91b3ed4e81c244322462␟4207916966377787111:Created`,s=$localize`:@@driverUpdatedAtLabel␟9da0107a35751e722c8b4bca7636fc7645dbdbdc␟7239750919884229270:Updated`,l=$localize`:@@driverDetailsCompiled␟dda62755180bc4044524db69b89b6af3f62293c4␟47117202291491007:Compiled`,_=$localize`:@@driverDetailsCommit␟587805e69e556e3a48a80d3a7aef5478b1c01a37␟6413514884883484792:Commit`,L=$localize`:@@driverDetailsFileName␟8ae7f24cac7975fccced98f430d4e406427999c6␟1758558063878069946:File Name`,U=$localize`:@@driverReloadAction␟cf032c48cd8424c08492adbbdb373b0e058d593a␟2777049056001816309: Recompile Driver `,$=$localize`:@@settingsLabel␟5ba97a3f90a79c4d7720b941ae416c8c84337e38␟180274732945114229: Settings `,w=$localize`:@@driverDefaultURILabel␟a8b05b9e4adb6a84b696c27ae2be833041b7a298␟1203609122448544154:Default URI`,V=$localize`:@@driverDefaultPortLabel␟5a0642e79ff9e5c35292f6c2e85c268427ddc62f␟5266032454888755850: Default Port `,B=$localize`:@@driverReloadAction␟02becb51bd8fb1d6c350c370afcf36a714dedb54␟9015392617187533288: Update Driver `,J=$localize`:@@driverLoadingLabel␟07c312791623a62194aaf1b64cf77ac60427ba34␟1421066576333999335:Loading driver settings...`,[[1,"mb-4","flex","space-x-2"],[1,"rounded","p-2","border","border-base-200","space-y-2","min-w-[45%]","flex-1"],["class","flex items-center space-x-2",4,"ngIf"],[1,"flex","items-center","space-x-2"],t,[1,"value"],[1,"underline",3,"routerLink"],o,i,s,[1,"rounded","p-2","border","border-base-200","space-y-2","min-w-[45%]","flex-1","flex","flex-col"],l,["diameter","24",4,"ngIf"],["btn","",3,"click",4,"ngIf"],_,L,[1,"font-mono","text-sm","truncate",3,"title"],[1,"flex-1"],["btn","","class","w-full",3,"click",4,"ngIf"],["btn","",1,"w-full",3,"click"],U,[1,"my-4"],[1,"font-medium","text-lg"],$,[4,"ngIf","ngIfElse"],["load_state",""],w,V,["diameter","24"],["btn","",3,"click"],B,[3,"merge","id","settings"],[1,"flex","flex-col","items-center","justify-center"],["diameter","48",1,"mb-4"],J]},template:function(o,i){if(1&o&&(e.TgZ(0,"section",0)(1,"div",1),e.YNc(2,le,5,1,"div",2)(3,ae,5,1,"div",2),e.TgZ(4,"div",3)(5,"label"),e.SDv(6,4),e.qZA(),e.TgZ(7,"div",5)(8,"a",6),e._uU(9),e.qZA()()(),e.TgZ(10,"div",3)(11,"label"),e.SDv(12,7),e.qZA(),e.TgZ(13,"div",5),e._uU(14),e.qZA()(),e.TgZ(15,"div",3)(16,"label"),e.SDv(17,8),e.qZA(),e.TgZ(18,"div",5),e._uU(19),e.ALo(20,"dateFrom"),e.qZA()(),e.TgZ(21,"div",3)(22,"label"),e.SDv(23,9),e.qZA(),e.TgZ(24,"div",5),e._uU(25),e.ALo(26,"dateFrom"),e.qZA()()(),e.TgZ(27,"div",10)(28,"div",3)(29,"label"),e.SDv(30,11),e.qZA(),e.TgZ(31,"div",5),e._uU(32),e.ALo(33,"async"),e.qZA(),e.YNc(34,de,1,0,"mat-spinner",12),e.ALo(35,"async"),e.YNc(36,ce,2,0,"button",13),e.ALo(37,"async"),e.qZA(),e.TgZ(38,"div",3)(39,"label"),e.SDv(40,14),e.qZA(),e.TgZ(41,"code"),e._uU(42),e.qZA()(),e.TgZ(43,"div",3)(44,"label"),e.SDv(45,15),e.qZA(),e.TgZ(46,"div",16),e._uU(47),e.qZA()(),e._UZ(48,"div",17),e.YNc(49,_e,2,0,"button",18),e.TgZ(50,"button",19),e.NdJ("click",function(){return i.recompileDriver()}),e.SDv(51,20),e.qZA()()(),e._UZ(52,"hr",21),e.TgZ(53,"header",22),e.SDv(54,23),e.qZA(),e.YNc(55,me,2,3,"section",24)(56,ue,4,0,"ng-template",null,25,e.W1O)),2&o){const s=e.MAs(57);e.xp6(2),e.Q6J("ngIf",i.item.default_uri),e.xp6(1),e.Q6J("ngIf",i.item.default_port),e.xp6(5),e.Q6J("routerLink",e.VKq(26,pe,i.item.repository_id)),e.xp6(1),e.hij(" ",i.item.repository_id,""),e.xp6(5),e.Oqu(null==i.item?null:i.item.module_name),e.xp6(5),e.hij(" ",e.lcZ(20,16,1e3*i.item.created_at)," "),e.xp6(6),e.hij(" ",e.lcZ(26,18,1e3*i.item.updated_at)," "),e.xp6(7),e.hij(" ",e.lcZ(33,20,i.compiled)?"true":"false"," "),e.xp6(2),e.Q6J("ngIf",!e.lcZ(35,22,i.compiled)),e.xp6(2),e.Q6J("ngIf",e.lcZ(37,24,i.compilation_error)),e.xp6(6),e.Oqu(i.item.commit),e.xp6(4),e.Q6J("title",i.item.file_name),e.xp6(1),e.hij(" ",i.item.file_name," "),e.xp6(2),e.Q6J("ngIf",i.item.update_available&&i.item.commit!==i.item.update_info.commit),e.xp6(6),e.Q6J("ngIf",i.item.settings)("ngIfElse",s)}},dependencies:[d.O5,C.rH,se.v,x.Ou,d.Ov,re.R],styles:["[_nghost-%COMP%]{height:100%;width:100%}label[_ngcontent-%COMP%]{width:6rem}\n\n/*# sourceMappingURL=driver-about.component.ts-angular-inline--44.css.map*/"]})}return n})();var fe=r(8159),y=r(4424),ve=r(3720),F=r(1268),Ce=r(9674),I=r(8128);function he(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"i",30),e.NdJ("modelChange",function(i){e.CHM(t);const s=e.oxw().$implicit;return e.KtG(s.connected=i)}),e.qZA()}if(2&n){const t=e.oxw().$implicit;e.Q6J("model",t.connected)("sys",t.system.id)("mod",t)}}function Ae(n,a){1&n&&(e.TgZ(0,"div",31),e._UZ(1,"mat-spinner",32),e.TgZ(2,"span"),e._uU(3,"Loading systems..."),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("diameter",32))}const Te=n=>["/systems",n];function be(n,a){if(1&n&&(e.TgZ(0,"a",33)(1,"div",34)(2,"div",35),e._uU(3),e.qZA(),e.TgZ(4,"div",36),e._uU(5),e.qZA()()()),2&n){const t=a.$implicit;e.Q6J("routerLink",e.VKq(3,Te,t.id)),e.xp6(3),e.hij(" ",t.display_name||t.name," "),e.xp6(2),e.hij(" ",t.id," ")}}const Ee=n=>["/modules",n],Re=()=>[];function xe(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"div",15)(1,"div",16),e.YNc(2,he,1,3,"i",17),e._UZ(3,"div",18),e.qZA(),e.TgZ(4,"div",19),e.tHW(5,20),e._UZ(6,"a",21),e.N_p(),e.qZA(),e.TgZ(7,"div",12)(8,"button",22),e.NdJ("click",function(){const s=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(l.loadSystems(s))}),e._UZ(9,"app-icon",23),e.qZA(),e.TgZ(10,"mat-menu",null,24)(12,"div",25),e._uU(13),e.qZA(),e.YNc(14,Ae,4,1,"div",26)(15,be,6,5,"a",27),e.qZA(),e.TgZ(16,"button",28),e.NdJ("click",function(){const s=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(l.removeModule(s))}),e._UZ(17,"app-icon",29),e.qZA()()()}if(2&n){const t=a.$implicit,o=e.MAs(11),i=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.system),e.xp6(1),e.ekj("bg-error",t.running&&!t.connected)("bg-success",t.running&&t.connected),e.xp6(3),e.Q6J("routerLink",e.VKq(11,Ee,t.id)),e.pQV(t.custom_name||t.name),e.QtT(5),e.xp6(2),e.Q6J("matMenuTriggerFor",o),e.xp6(5),e.hij(" ",null==i.systems[t.id]?null:i.systems[t.id].length," System(s) "),e.xp6(1),e.Q6J("ngIf",i.loading_systems),e.xp6(1),e.Q6J("ngForOf",i.systems[t.id]||e.DdM(13,Re))}}function De(n,a){if(1&n&&(e.TgZ(0,"div",7)(1,"div",8)(2,"div",9),e._uU(3,"State"),e.qZA(),e.TgZ(4,"div",10),e.SDv(5,11),e.qZA(),e._UZ(6,"div",12),e.qZA(),e.TgZ(7,"div",13),e.YNc(8,xe,18,14,"div",14),e.ALo(9,"async"),e.qZA()()),2&n){const t=e.oxw();e.xp6(8),e.Q6J("ngForOf",e.lcZ(9,1,t.modules))}}function Me(n,a){1&n&&(e.TgZ(0,"div",37),e._UZ(1,"mat-spinner",38),e.TgZ(2,"p"),e._uU(3,"Loading modules..."),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("diameter",48))}function Ie(n,a){1&n&&(e.TgZ(0,"div",37)(1,"p"),e._uU(2,"No modules with driver"),e.qZA()())}let Se=(()=>{class n extends y.c{constructor(t){super(),this._service=t,this.loading_systems=!1,this.filter$=new v.X(""),this.loading=this._service.loading,this.item=this._service.item,this.systems={},this.modules=(0,fe.aj)([this.filter$,this._service.modules]).pipe((0,f.U)(o=>{const[i,s]=o,l=i.toLowerCase();return i?s.filter(_=>_.name.toLowerCase().includes(l)||_.custom_name.toLowerCase().includes(l)):s})),this.removeModule=o=>this._service.removeModule(o)}loadSystems(t){var o=this;return(0,p.Z)(function*(){o.loading_systems=!0;const i=yield(0,c.vIL)({module_id:t.id}).pipe((0,f.U)(({data:s})=>s)).toPromise();o.systems[t.id]=i||[],o.loading_systems=!1})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(M))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["driver-devices"]],features:[e.qOj],decls:11,vars:5,consts:()=>{let t,o;return t=$localize`:@@nameLabel␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,o=$localize`:@@nameLabel␟bd6c739af47a911fc716b91fef6e9be600cd414a␟5610024539333668683:${"\ufffd#6\ufffd"}:START_LINK: ${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd/#6\ufffd"}:CLOSE_LINK:`,[[1,"flex","items-center","mb-4"],["appearance","outline",1,"h-12","flex-1"],["matPrefix","","className","backoffice-magnifying-glass text-xl mr-2"],["matInput","","placeholder","Filter Devices...",1,"rounded-none",3,"ngModel","ngModelChange"],["role","table","class","overflow-x-auto",4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],["role","table",1,"overflow-x-auto"],["table-head",""],[1,"w-12","p-2"],["flex","",1,"flex-1","p-2"],t,[1,"w-24","p-2"],["table-body","",1,"overflow-y-auto"],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"w-12","p-2","flex","items-center","justify-center"],["binding","","bind","connected",3,"model","sys","mod","modelChange",4,"ngIf"],[1,"h-2","w-2","rounded-full","bg-base-content"],["flex","",1,"flex-1","p-2","underline"],o,[3,"routerLink"],["btn","","icon","","matTooltip","View Systems",3,"matMenuTriggerFor","click"],["className","backoffice-eye"],["menu","matMenu"],[1,"flex","items-center","justify-center","px-2","pb-2","opacity-70","border-b","border-base-200","text-sm"],["class","flex items-center space-x-2 p-2 text-sm",4,"ngIf"],["mat-menu-item","","class","leading-tight",3,"routerLink",4,"ngFor","ngForOf"],["icon","","btn","","icon","",3,"click"],["className","backoffice-trash"],["binding","","bind","connected",3,"model","sys","mod","modelChange"],[1,"flex","items-center","space-x-2","p-2","text-sm"],[3,"diameter"],["mat-menu-item","",1,"leading-tight",3,"routerLink"],[1,"flex","flex-col","justify-center","px-2","h-full"],[1,"text-base"],[1,"text-xs","opacity-60"],[1,"flex","flex-col","items-center","p-8","mx-auto"],[1,"mb-4",3,"diameter"]]},template:function(o,i){if(1&o&&(e.TgZ(0,"section",0)(1,"mat-form-field",1),e._UZ(2,"app-icon",2),e.TgZ(3,"input",3),e.NdJ("ngModelChange",function(l){return i.filter$.next(l)}),e.qZA()()(),e.TgZ(4,"section"),e.YNc(5,De,10,3,"div",4),e.ALo(6,"async"),e.qZA(),e.YNc(7,Me,4,1,"ng-template",null,5,e.W1O)(9,Ie,3,0,"ng-template",null,6,e.W1O)),2&o){const s=e.MAs(10);let l;e.xp6(3),e.Q6J("ngModel",""),e.xp6(2),e.Q6J("ngIf",null==(l=e.lcZ(6,3,i.modules))?null:l.length)("ngIfElse",s)}},dependencies:[d.sg,d.O5,g.Fj,g.JJ,g.On,C.rH,R.o,ve.D,F.KE,F.qo,Ce.Nt,x.Ou,D.gM,I.VK,I.OP,I.p6,d.Ov],styles:["[_nghost-%COMP%]{height:100%;width:100%}[role=table][_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;min-width:28rem}\n\n/*# sourceMappingURL=driver-devices.component.ts-angular-inline--45.css.map*/"]})}return n})();var Pe=r(6497),Ze=r(8791),Oe=r(2941),Ne=r(5375),ye=r(2637),Fe=r(5694),Le=r(8771),Ue=r(6529),$e=r(4331),we=r(1387);function Ve(n,a){if(1&n){const t=e.EpF();e.ynx(0),e._UZ(1,"item-details",16)(2,"item-tablist",17),e.TgZ(3,"div",18,19),e.NdJ("scroll",function(){e.CHM(t);const i=e.MAs(4),s=e.oxw();return e.KtG(s.scroll=i.scrollTop)}),e._UZ(5,"router-outlet"),e.qZA(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("can_edit",!0)("item",t.item),e.xp6(1),e.Q6J("base",t.name)("tabs",t.tab_list)("scrolled",t.scroll>0)}}function Be(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.showUpdateList())}),e.TgZ(1,"app-icon",21),e._uU(2,"update"),e.qZA()()}}function Je(n,a){1&n&&e._UZ(0,"app-debug-output",22)}function Ke(n,a){1&n&&e._UZ(0,"app-debug-output",23)}const Qe=[{path:":id",component:(()=>{class n extends y.c{get item(){return this._service.active_item}get extensions(){return(0,Oe.fq)(this._service.active_item,this.name)}get debug_position(){return this._debug.position}updateTabList(){this.tab_list=[{id:"about",name:"About",icon:{class:"backoffice-info-with-circle"}},{id:"modules",name:"Modules",count:this.device_count??"?",icon:{class:"backoffice-tablet"}},{id:"history",name:"Settings History",icon:{class:"backoffice-clock"}}].concat(this.extensions)}constructor(t,o,i){super(),this._service=t,this._drivers=o,this._debug=i,this.name="drivers",this.open_menu=!1,this.tab_list=[],this.updates_available=this._drivers.updates_available,this.showUpdateList=()=>this._drivers.showUpdateList(),this.newItem=()=>this._service.create()}ngOnInit(){this.subscription("item",this._service.item.subscribe(t=>{this.device_count=null,this.updateTabList(),this.loadValues(t)}))}loadValues(t){var o=this;return(0,p.Z)(function*(){if(!t)return;const i={offset:0,limit:1,driver_id:t.id};o.device_count=yield(0,c.Ne_)(i).pipe((0,f.U)(({total:s})=>s)).toPromise().catch(s=>0),o.updateTabList()})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(Z.L),e.Y36(M),e.Y36(Ne.i))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["new-drivers-view"]],features:[e.qOj],decls:17,vars:10,consts:[[1,"absolute","inset-0","flex","items-center","divide-y","sm:divide-y-0","sm:divide-x","divide-base-200","bg-base-100"],[1,"sm:h-full",3,"open","openChange"],[1,"flex","flex-col","h-full","flex-1","overflow-hidden","w-px"],[1,"flex","flex-1","h-px"],["title","Drivers",1,"hidden","sm:block",3,"route"],[1,"flex-1","w-1/2","h-full","relative","flex","flex-col","z-0"],["title","Drivers",1,"z-20","sm:hidden",3,"route"],["btn","","icon","",1,"sm:hidden","mr-2",3,"click"],["className","backoffice-menu"],[1,"flex","flex-col","flex-1","h-1/2"],[4,"ngIf"],["class","absolute bottom-16 left-1 sm:-left-8 w-10 h-10 flex items-center justify-center bg-secondary rounded-lg shadow z-30 text-secondary-content","matTooltip","Update Drivers","matTooltipPosition","right","matRipple","",3,"click",4,"ngIf"],["matTooltip","New driver","matTooltipPosition","right","matRipple","",1,"absolute","bottom-2","left-2","sm:-left-9","w-12","h-12","flex","items-center","justify-center","bg-secondary","rounded-lg","shadow","z-30","text-secondary-content",3,"click"],[1,"text-3xl",3,"className"],["below","",4,"ngIf"],["side","","class","h-full max-w-[30rem]",4,"ngIf"],["type","Driver",3,"can_edit","item"],[1,"z-10",3,"base","tabs","scrolled"],[1,"flex-1","h-1/2","w-full","overflow-auto","p-4","z-0","relative",3,"scroll"],["el",""],["matTooltip","Update Drivers","matTooltipPosition","right","matRipple","",1,"absolute","bottom-16","left-1","sm:-left-8","w-10","h-10","flex","items-center","justify-center","bg-secondary","rounded-lg","shadow","z-30","text-secondary-content",3,"click"],[1,"text-3xl"],["below",""],["side","",1,"h-full","max-w-[30rem]"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0)(1,"sidebar-menu",1),e.NdJ("openChange",function(l){return i.open_menu=l}),e.qZA(),e.TgZ(2,"div",2)(3,"div",3),e._UZ(4,"item-sidebar",4),e.TgZ(5,"div",5)(6,"item-selection",6)(7,"button",7),e.NdJ("click",function(){return i.open_menu=!0}),e._UZ(8,"app-icon",8),e.qZA()(),e.TgZ(9,"div",9),e.YNc(10,Ve,6,5,"ng-container",10),e.qZA(),e.YNc(11,Be,3,0,"button",11),e.ALo(12,"async"),e.TgZ(13,"button",12),e.NdJ("click",function(){return i.newItem()}),e._UZ(14,"app-icon",13),e.qZA()()(),e.YNc(15,Je,1,0,"app-debug-output",14),e.qZA(),e.YNc(16,Ke,1,0,"app-debug-output",15),e.qZA()),2&o&&(e.xp6(1),e.Q6J("open",i.open_menu),e.xp6(3),e.Q6J("route",i.name),e.xp6(2),e.Q6J("route",i.name),e.xp6(4),e.Q6J("ngIf",null==i.item?null:i.item.id),e.xp6(1),e.Q6J("ngIf",e.lcZ(12,8,i.updates_available)),e.xp6(3),e.Q6J("className","backoffice-plus"),e.xp6(1),e.Q6J("ngIf","below"===i.debug_position),e.xp6(1),e.Q6J("ngIf","side"===i.debug_position))},dependencies:[d.O5,C.lC,R.o,ye.$,Fe.z,Le.V,Ue.K,$e.r,we.l,D.gM,N.wG,d.Ov]})}return n})(),children:[{path:"about",component:ge},{path:"modules",component:Se},{path:"extend/:id",component:Pe.z},{path:"history",component:Ze.D},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:"-"}];var Ge=r(5858);let qe=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#i=this.\u0275inj=e.cJS({imports:[d.ez,g.u5,C.Bz.forChild(Qe),Ge.X]})}return n})()}}]);
//# sourceMappingURL=512.54dc24fb019ccb72.js.map