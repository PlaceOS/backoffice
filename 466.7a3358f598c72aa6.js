"use strict";(self.webpackChunkbackoffice=self.webpackChunkbackoffice||[]).push([[466],{6636:(Se,T,s)=>{s.r(T),s.d(T,{AppDriversModule:()=>Re});var _=s(8267),v=s(9902),f=s(525),m=s(8806),d=s(8999),E=s(2378),R=s(1292),x=s(3083),e=s(2222),y=s(2016),L=s(2874);let $=(()=>{class i extends R.K{constructor(t){super(),this._service=t,this.name="drivers",this.show_options=this._service.show_options,this.tab_list=[]}get extensions(){return(0,x.fq)(this._service.active_item,this.name)}updateTabList(){this.tab_list=[{id:"about",name:"About",icon:{class:"backoffice-info-with-circle"}},{id:"modules",name:"Modules",count:this.device_count,icon:{class:"backoffice-tablet"}},{id:"history",name:"Settings History",icon:{class:"backoffice-clock"}}].concat(this.extensions)}ngOnInit(){this.subscription("item",this._service.item.subscribe(t=>{this.loadValues(t),this.updateTabList()})),this.updateTabList()}loadValues(t){return(0,m.mG)(this,void 0,void 0,function*(){if(!t)return;const o={offset:0,limit:1,driver_id:t.id};this.device_count=(yield(0,d.Ne_)(o).toPromise()).total})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(E.L))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-drivers"]],features:[e.qOj],decls:3,vars:1,consts:[[1,"flex-1","flex-col","sm:flex-row","flex","h-full","w-full","relative"],["heading","Drivers","name","drivers",1,"absolute","top-0","left-0","h-12","w-full","sm:h-full","sm:static"],["name","driver","route","drivers",1,"flex-1","relative","mt-12","sm:mt-0","w-full","sm:w-1/2",3,"tabs"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"sidebar",1),e._UZ(2,"item-display",2),e.qZA()),2&t&&(e.xp6(2),e.Q6J("tabs",o.tab_list))},directives:[y.k,L.s],styles:["sidebar[_ngcontent-%COMP%]{transition:height .3s}@media screen and (min-width: 640px){sidebar[_ngcontent-%COMP%]{width:20em!important}}\n/*# sourceMappingURL=drivers.component.ts-angular-inline--22.css.map*/"]}),i})();var p=s(1119),U=s(8027),S=s(9026),V=s(592),B=s(1258),q=s(3252),K=s(5029),A=s(8377),G=s(8537),D=s(6133),g=s(3829),X=s(1758),J=s(6298);let P=(()=>{class i{constructor(t,o){this._state=t,this._dialog=o,this._loading=new p.X(!1),this._last_error=new p.X(null),this.item=this._state.item,this.loading=this._loading.asObservable(),this.last_error=this._last_error.asObservable(),this.is_compiled=this.item.pipe((0,U.h)(n=>!!n&&n instanceof d.CbG),(0,S.w)(n=>(0,d.J_X)(n.id)),(0,V.K)(n=>(0,m.mG)(this,void 0,void 0,function*(){const l=yield null==n?void 0:n.json();if(this._last_error.next((null==l?void 0:l.compilation_output)||n),console.log("Driver Error:",l),!(null==l?void 0:l.compilation_output))throw n})),(0,B.a)((0,q.g)(1e3)),(0,K.b)(n=>n?this._last_error.next(null):"")),this.modules=this.item.pipe((0,S.w)(n=>(0,m.mG)(this,void 0,void 0,function*(){this._loading.next(!0);const l=yield(0,d.Ne_)({driver_id:n.id}).toPromise();return this._loading.next(!1),l})),(0,A.U)(n=>n.data),(0,G.d)()),this.item.subscribe(()=>this._last_error.next(null))}get active_item(){return this._state.active_item}viewError(){const t=this._last_error.getValue();!t||this._dialog.open(X.a,{data:{title:"Driver Compilation Error",content:t}})}recompileDriver(){return(0,m.mG)(this,void 0,void 0,function*(){const t=yield(0,D._5)({title:"Recompile Driver",content:"<p>Are you sure you want recompile this driver?</p><p>New driver code will be loaded and device settings will be updated.</p>",icon:{type:"icon",class:"backoffice-cycle"}},this._dialog);if(!t||!t.reason)return t.close();t.loading("Recompiling driver...");const o=yield(0,d.qEr)(this._state.active_item.id).toPromise().catch(n=>null);if(t.close(),!o)return(0,g.cB)("Failed to recompiled driver.");(0,g.t5)("Successfully recompiled driver.")})}removeModule(t){return(0,m.mG)(this,void 0,void 0,function*(){const o=yield(0,D._5)({title:"Remove module?",content:`Remove ${t.driver_id}?<br>All associated data be deleted immediatedly.`,icon:{type:"icon",class:"backoffice-trash"}},this._dialog);if(!o||!o.reason)return;const n=yield(0,d.zed)(this.active_item.id,t.id).toPromise().catch(l=>{(0,g.cB)(`Error removing module ${t.id}. Error: ${l.statusText||l.message||l}`)});o.close(),n&&(this._state.replaceItem(n),(0,g.t5)("Successfully removed module."))})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(E.L),e.LFG(J.uw))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var M=s(7752),Z=s(9372),w=s(2433),Q=s(6835);function z(i,r){if(1&i&&(e.TgZ(0,"div",2),e.TgZ(1,"label"),e.SDv(2,21),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA(),e.qZA()),2&i){const t=e.oxw();e.xp6(4),e.Oqu(t.item.default_uri)}}function j(i,r){if(1&i&&(e.TgZ(0,"div",2),e.TgZ(1,"label"),e.SDv(2,22),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA(),e.qZA()),2&i){const t=e.oxw();e.xp6(4),e.Oqu(t.item.default_port)}}function Y(i,r){1&i&&e._UZ(0,"mat-spinner",23)}function W(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().viewErrors()}),e._uU(1," View Errors "),e.qZA()}}function H(i,r){if(1&i&&(e.TgZ(0,"section"),e._UZ(1,"a-settings-form",24),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("merge",!0)("id",t.item.id)("settings",t.item.settings)}}function k(i,r){1&i&&(e.TgZ(0,"div",25),e._UZ(1,"mat-spinner",26),e.TgZ(2,"p"),e.SDv(3,27),e.qZA(),e.qZA())}const ee=function(i){return["/repositories",i,"about"]};let te=(()=>{class i{constructor(t){this._service=t,this.compiled=this._service.is_compiled,this.compilation_error=this._service.last_error,this.recompileDriver=()=>this._service.recompileDriver(),this.viewErrors=()=>this._service.viewError()}get item(){return this._service.active_item||{}}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(P))},i.\u0275cmp=e.Xpm({type:i,selectors:[["driver-about"]],decls:55,vars:26,consts:function(){let r,t,o,n,l,c,u,I,O,b,N,F;return r=$localize`:@@driverDetailsCompiled␟cf381ca16eaabe3374d51e9f94f2218500c4fa4e␟9153697548218950089:Compiled:`,t=$localize`:@@driverDetailsCommit␟9550d280606a1dc85aa6687e6375c8c3edfa14ac␟2338640606551983669:Repository:`,o=$localize`:@@driverDetailsCommit␟fd8aae50a9e4449f1ca02dd094975918d9a5667b␟1255418805683509654:Commit:`,n=$localize`:@@driverDetailsFileName␟38b21a77c169dc1d573d1959b82ee0d1bc2382a4␟3153886573188541985:File Name:`,l=$localize`:@@driverDetailsModuleName␟30503cc4139d9b80b7ee428e70c83f93018643c3␟2852585380255004131:Module Name:`,c=$localize`:@@driverCreatedAtLabel␟a5ed099ffc9e96f6970df843289ade8a7d20ab9f␟1616250945945379783:Created:`,u=$localize`:@@driverUpdatedAtLabel␟f94240161f912dbd8758b858877cddeab80f36cb␟1116759395536210856:Updated:`,I=$localize`:@@driverReloadAction␟9e4193ff8bc8eb566c2a631f96b9c93ac4d22a4e␟5398060262188177679: Recompile Driver `,O=$localize`:@@settingsLabel␟5ba97a3f90a79c4d7720b941ae416c8c84337e38␟180274732945114229: Settings `,b=$localize`:@@driverDefaultURILabel␟aaf77b7baecf340df6c6e20f4016289f440c390e␟2755927892619874934:Default URI:`,N=$localize`:@@driverDefaultPortLabel␟708739a9f194ca4078bfdeed2db588d855c042b8␟8341926293707687932:Default Port Number:`,F=$localize`:@@driverLoadingLabel␟07c312791623a62194aaf1b64cf77ac60427ba34␟1421066576333999335:Loading driver settings...`,[[1,"mb-4","space-y-2"],["class","flex items-center space-x-2",4,"ngIf"],[1,"flex","items-center","space-x-2"],r,[1,"value"],["diameter","24",4,"ngIf"],["mat-button","",3,"click",4,"ngIf"],t,[1,"underline",3,"routerLink"],o,n,l,c,u,["mat-button","",3,"click"],I,[1,"my-4"],[1,"font-medium","text-lg"],O,[4,"ngIf","ngIfElse"],["load_state",""],b,N,["diameter","24"],[3,"merge","id","settings"],[1,"flex","flex-col","items-center","justify-center"],["diameter","48",1,"mb-4"],F]},template:function(t,o){if(1&t&&(e.TgZ(0,"section",0),e.YNc(1,z,5,1,"div",1),e.YNc(2,j,5,1,"div",1),e.TgZ(3,"div",2),e.TgZ(4,"label"),e.SDv(5,3),e.qZA(),e.TgZ(6,"div",4),e._uU(7),e.ALo(8,"async"),e.qZA(),e.YNc(9,Y,1,0,"mat-spinner",5),e.ALo(10,"async"),e.YNc(11,W,2,0,"button",6),e.ALo(12,"async"),e.qZA(),e.TgZ(13,"div",2),e.TgZ(14,"label"),e.SDv(15,7),e.qZA(),e.TgZ(16,"div",4),e.TgZ(17,"a",8),e._uU(18),e.qZA(),e.qZA(),e.qZA(),e.TgZ(19,"div",2),e.TgZ(20,"label"),e.SDv(21,9),e.qZA(),e.TgZ(22,"div",4),e._uU(23),e.qZA(),e.qZA(),e.TgZ(24,"div",2),e.TgZ(25,"label"),e.SDv(26,10),e.qZA(),e.TgZ(27,"div",4),e._uU(28),e.qZA(),e.qZA(),e.TgZ(29,"div",2),e.TgZ(30,"label"),e.SDv(31,11),e.qZA(),e.TgZ(32,"div",4),e._uU(33),e.qZA(),e.qZA(),e.TgZ(34,"div",2),e.TgZ(35,"label"),e.SDv(36,12),e.qZA(),e.TgZ(37,"div",4),e._uU(38),e.ALo(39,"dateFrom"),e.qZA(),e.qZA(),e.TgZ(40,"div",2),e.TgZ(41,"label"),e.SDv(42,13),e.qZA(),e.TgZ(43,"div",4),e._uU(44),e.ALo(45,"dateFrom"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(46,"section"),e.TgZ(47,"button",14),e.NdJ("click",function(){return o.recompileDriver()}),e.SDv(48,15),e.qZA(),e.qZA(),e._UZ(49,"hr",16),e.TgZ(50,"header",17),e.SDv(51,18),e.qZA(),e.YNc(52,H,2,3,"section",19),e.YNc(53,k,4,0,"ng-template",null,20,e.W1O)),2&t){const n=e.MAs(54);e.xp6(1),e.Q6J("ngIf",o.item.default_uri),e.xp6(1),e.Q6J("ngIf",o.item.default_port),e.xp6(5),e.hij(" ",e.lcZ(8,14,o.compiled)?"true":"false"," "),e.xp6(2),e.Q6J("ngIf",!e.lcZ(10,16,o.compiled)),e.xp6(2),e.Q6J("ngIf",e.lcZ(12,18,o.compilation_error)),e.xp6(6),e.Q6J("routerLink",e.VKq(24,ee,o.item.repository_id)),e.xp6(1),e.hij(" ",o.item.repository_id,""),e.xp6(5),e.Oqu(o.item.commit),e.xp6(5),e.Oqu(o.item.file_name),e.xp6(5),e.Oqu(null==o.item?null:o.item.module_name),e.xp6(5),e.Oqu(e.lcZ(39,20,1e3*o.item.created_at)),e.xp6(6),e.Oqu(e.lcZ(45,22,1e3*o.item.updated_at)),e.xp6(8),e.Q6J("ngIf",o.item.settings)("ngIfElse",n)}},directives:[_.O5,f.yS,M.lW,Z.$g,w.v],pipes:[_.Ov,Q.R],styles:["[_nghost-%COMP%]{padding:1rem;height:100%;width:100%}\n/*# sourceMappingURL=driver-about.component.ts-angular-inline--23.css.map*/"]}),i})();var ie=s(899),h=s(6752),oe=s(9499),ne=s(8482),se=s(4731),C=s(9872),re=s(5426);function le(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"i",30),e.NdJ("modelChange",function(n){return e.CHM(t),e.oxw().$implicit.connected=n}),e.qZA()}if(2&i){const t=e.oxw().$implicit;e.Q6J("model",t.connected)("sys",t.system.id)("mod",t)}}function ae(i,r){1&i&&(e.TgZ(0,"div",31),e._UZ(1,"mat-spinner",32),e.TgZ(2,"span"),e._uU(3,"Loading systems..."),e.qZA(),e.qZA()),2&i&&(e.xp6(1),e.Q6J("diameter",32))}const de=function(i){return["/systems",i]};function ce(i,r){if(1&i&&(e.TgZ(0,"a",33),e.TgZ(1,"div",34),e.TgZ(2,"div",35),e._uU(3),e.qZA(),e.TgZ(4,"div",36),e._uU(5),e.qZA(),e.qZA(),e.qZA()),2&i){const t=r.$implicit;e.Q6J("routerLink",e.VKq(3,de,t.id)),e.xp6(3),e.hij(" ",t.display_name||t.name," "),e.xp6(2),e.hij(" ",t.id," ")}}const _e=function(i){return["/modules",i]},me=function(){return[]};function ue(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",15),e.TgZ(1,"div",16),e.YNc(2,le,1,3,"i",17),e._UZ(3,"div",18),e.qZA(),e.TgZ(4,"div",19),e.tHW(5,20),e._UZ(6,"a",21),e.N_p(),e.qZA(),e.TgZ(7,"div",12),e.TgZ(8,"button",22),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw(2).loadSystems(l)}),e._UZ(9,"app-icon",23),e.qZA(),e.TgZ(10,"mat-menu",null,24),e.TgZ(12,"div",25),e._uU(13),e.qZA(),e.YNc(14,ae,4,1,"div",26),e.YNc(15,ce,6,5,"a",27),e.qZA(),e.TgZ(16,"button",28),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw(2).removeModule(l)}),e._UZ(17,"app-icon",29),e.qZA(),e.qZA(),e.qZA()}if(2&i){const t=r.$implicit,o=e.MAs(11),n=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.system),e.xp6(1),e.ekj("bg-error",t.running&&!t.connected)("bg-success",t.running&&t.connected),e.xp6(3),e.Q6J("routerLink",e.VKq(11,_e,t.id)),e.pQV(t.custom_name||t.name),e.QtT(5),e.xp6(2),e.Q6J("matMenuTriggerFor",o),e.xp6(5),e.hij(" ",null==n.systems[t.id]?null:n.systems[t.id].length," System(s) "),e.xp6(1),e.Q6J("ngIf",n.loading_systems),e.xp6(1),e.Q6J("ngForOf",n.systems[t.id]||e.DdM(13,me))}}function ve(i,r){if(1&i&&(e.TgZ(0,"div",7),e.TgZ(1,"div",8),e.TgZ(2,"div",9),e._uU(3,"State"),e.qZA(),e.TgZ(4,"div",10),e.SDv(5,11),e.qZA(),e._UZ(6,"div",12),e.qZA(),e.TgZ(7,"div",13),e.YNc(8,ue,18,14,"div",14),e.ALo(9,"async"),e.qZA(),e.qZA()),2&i){const t=e.oxw();e.xp6(8),e.Q6J("ngForOf",e.lcZ(9,1,t.modules))}}function ge(i,r){1&i&&(e.TgZ(0,"div",37),e._UZ(1,"mat-spinner",38),e.TgZ(2,"p"),e._uU(3,"Loading modules..."),e.qZA(),e.qZA()),2&i&&(e.xp6(1),e.Q6J("diameter",48))}function fe(i,r){1&i&&(e.TgZ(0,"div",37),e.TgZ(1,"p"),e._uU(2,"No modules with driver"),e.qZA(),e.qZA())}let pe=(()=>{class i extends R.K{constructor(t){super(),this._service=t,this.loading_systems=!1,this.filter$=new p.X(""),this.loading=this._service.loading,this.item=this._service.item,this.systems={},this.modules=(0,ie.aj)([this.filter$,this._service.modules]).pipe((0,A.U)(o=>{const[n,l]=o,c=n.toLowerCase();return n?l.filter(u=>u.name.toLowerCase().includes(c)||u.custom_name.toLowerCase().includes(c)):l})),this.removeModule=o=>this._service.removeModule(o)}loadSystems(t){return(0,m.mG)(this,void 0,void 0,function*(){this.loading_systems=!0;const o=yield(0,d.vIL)({module_id:t.id}).pipe((0,A.U)(({data:n})=>n)).toPromise();this.systems[t.id]=o||[],this.loading_systems=!1})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(P))},i.\u0275cmp=e.Xpm({type:i,selectors:[["driver-devices"]],features:[e.qOj],decls:11,vars:5,consts:function(){let r,t;return r=$localize`:@@nameLabel␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,t=$localize`:@@nameLabel␟bd6c739af47a911fc716b91fef6e9be600cd414a␟5610024539333668683:${"\ufffd#6\ufffd"}:START_LINK: ${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd/#6\ufffd"}:CLOSE_LINK:`,[[1,"flex","items-center","mb-4"],["appearance","outline",1,"h-12","flex-1"],["matPrefix","","className","backoffice-magnifying-glass text-xl mr-2"],["matInput","","placeholder","Filter triggers...",1,"rounded-none",3,"ngModel","ngModelChange"],["role","table","class","overflow-x-auto",4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],["role","table",1,"overflow-x-auto"],["table-head",""],[1,"w-12","p-2"],["flex","",1,"flex-1","p-2"],r,[1,"w-24","p-2"],["table-body","",1,"overflow-y-auto"],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"w-12","p-2","flex","items-center","justify-center"],["binding","","bind","connected",3,"model","sys","mod","modelChange",4,"ngIf"],[1,"h-2","w-2","rounded-full","bg-black"],["flex","",1,"flex-1","p-2","underline"],t,[3,"routerLink"],["mat-icon-button","","matTooltip","View Systems",3,"matMenuTriggerFor","click"],["className","backoffice-eye"],["menu","matMenu"],[1,"flex","items-center","justify-center","px-2","pb-2","opacity-70","border-b","border-gray-200","text-sm"],["class","flex items-center space-x-2 p-2 text-sm",4,"ngIf"],["mat-menu-item","","class","leading-tight",3,"routerLink",4,"ngFor","ngForOf"],["mat-icon-button","",3,"click"],["className","backoffice-trash"],["binding","","bind","connected",3,"model","sys","mod","modelChange"],[1,"flex","items-center","space-x-2","p-2","text-sm"],[3,"diameter"],["mat-menu-item","",1,"leading-tight",3,"routerLink"],[1,"flex","flex-col","justify-center","px-2","h-full"],[1,"text-base"],[1,"text-xs","opacity-60"],[1,"flex","flex-col","items-center","p-8","mx-auto"],[1,"mb-4",3,"diameter"]]},template:function(t,o){if(1&t&&(e.TgZ(0,"section",0),e.TgZ(1,"mat-form-field",1),e._UZ(2,"app-icon",2),e.TgZ(3,"input",3),e.NdJ("ngModelChange",function(l){return o.filter$.next(l)}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(4,"section"),e.YNc(5,ve,10,3,"div",4),e.ALo(6,"async"),e.qZA(),e.YNc(7,ge,4,1,"ng-template",null,5,e.W1O),e.YNc(9,fe,3,0,"ng-template",null,6,e.W1O)),2&t){const n=e.MAs(10);let l;e.xp6(3),e.Q6J("ngModel",""),e.xp6(2),e.Q6J("ngIf",null==(l=e.lcZ(6,3,o.modules))?null:l.length)("ngIfElse",n)}},directives:[h.KE,oe.o,h.qo,ne.Nt,v.Fj,v.JJ,v.On,_.O5,_.sg,f.yS,M.lW,se.gM,C.p6,C.VK,re.D,Z.$g,C.OP],pipes:[_.Ov],styles:["[_nghost-%COMP%]{padding:1rem;height:100%;width:100%}[role=table][_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;min-width:28rem}\n/*# sourceMappingURL=driver-devices.component.ts-angular-inline--24.css.map*/"]}),i})();var Ae=s(5605),Ce=s(8051);const Te=[{path:":id",component:$,children:[{path:"about",component:te},{path:"modules",component:pe},{path:"extend/:id",component:Ae.z},{path:"history",component:Ce.D},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:"-"}];var Ee=s(1226);let Re=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[_.ez,v.u5,f.Bz.forChild(Te),Ee.X]]}),i})()}}]);
//# sourceMappingURL=466.7a3358f598c72aa6.js.map