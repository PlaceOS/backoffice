{"version":3,"file":"142.b5aecd41188824c4.js","mappings":"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","names":["DomainStateService","constructor","_state","_dialog","this","BehaviorSubject","item","_loading","asObservable","combineLatest","_changed","pipe","filter","_","PlaceDomain","switchMap","queryUsers","authority_id","id","map","data","catchError","shareReplay","q","querySAMLSources","queryOAuthSources","queryLDAPSources","list","forEach","array","concat","queryApplications","details","Promise","all","total","toPromise","saml","oauth","ldap","applications","auth_sources","users","active_item","update","domain","updateDomain","n","replaceItem","editApplication","PlaceApplication","owner_id","ref","open","ItemCreateUpdateModalComponent","height","width","maxHeight","maxWidth","name","save","i","updateApplication","addApplication","race","componentInstance","event","first","reason","afterClosed","next","Date","valueOf","deleteApplication","openConfirmModal","title","content","icon","type","class","loading","err","removeApplication","catch","close","notifyError","responseText","message","notifySuccess","editAuthSource","AuthSourceModalComponent","auth_source","deleteAuthSource","PlaceSAMLSource","removeSAMLSource","PlaceOAuthSource","removeOAuthSource","removeLDAPSource","i0","factory","ctx_r5","DomainApplicationsComponent","_service","copySecret","show_secret","copyToClipboard","secret","notifyInfo","selectors","$localize","ctx","DomainAuthenticationComponent","source","DomainUsersComponent","DomainAboutComponent","BaseClass","super","FormGroup","config","FormControl","validateJSONString","internals","ngOnInit","subscription","subscribe","loadForm","form","patchValue","JSON","stringify","undefined","valueChanges","saveChanges","timeout","u","t","valid","parse","value","ROUTES","path","component","DomainsComponent","_item","create","extensions","extensionsForItem","updateTabList","count","tab_list","counts","c","children","ExtensionOutletComponent","redirectTo","AppDomainsModule","CommonModule","FormsModule","ReactiveFormsModule","RouterModule","SharedContentModule"],"sourceRoot":"webpack:///","sources":["./apps/backoffice/src/app/domains/domain-state.service.ts","./apps/backoffice/src/app/domains/domain-applications.component.ts","./apps/backoffice/src/app/domains/domain-authentication.component.ts","./apps/backoffice/src/app/domains/domain-users.component.ts","./apps/backoffice/src/app/domains/domain-about.component.ts","./apps/backoffice/src/app/domains/domains.component.ts","./apps/backoffice/src/app/domains/domains.routes.ts","./apps/backoffice/src/app/domains/domains.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport {\n    addApplication,\n    PlaceApplication,\n    PlaceDomain,\n    PlaceLDAPSource,\n    PlaceOAuthSource,\n    PlaceSAMLSource,\n    PlaceUser,\n    queryApplications,\n    queryLDAPSources,\n    queryOAuthSources,\n    querySAMLSources,\n    queryUsers,\n    removeApplication,\n    removeLDAPSource,\n    removeOAuthSource,\n    removeSAMLSource,\n    updateApplication,\n    updateDomain,\n} from '@placeos/ts-client';\nimport { BehaviorSubject, combineLatest, merge, Observable, of } from 'rxjs';\nimport { catchError, filter, first, map, share, shareReplay, switchMap } from 'rxjs/operators';\nimport { openConfirmModal } from '../common/general';\nimport { ActiveItemService } from '../common/item.service';\nimport { notifyError, notifySuccess } from '../common/notifications';\nimport { AuthSourceModalComponent } from '../overlays/auth-source-modal/auth-source-modal.component';\nimport { ItemCreateUpdateModalComponent } from '../overlays/item-modal/item-modal.component';\n\nexport type PlaceAuthSource = PlaceOAuthSource | PlaceSAMLSource | PlaceLDAPSource;\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class DomainStateService {\n    private _loading = new BehaviorSubject<boolean>(false);\n\n    private _changed = new BehaviorSubject<number>(0);\n\n    public readonly item: Observable<PlaceDomain> = this._state.item as any;\n\n    public readonly loading = this._loading.asObservable();\n\n    public readonly users: Observable<PlaceUser[]> = combineLatest([this._changed, this.item]).pipe(\n        filter(([_, item]) => item instanceof PlaceDomain),\n        switchMap(([_, item]) => queryUsers({ authority_id: item.id } as any)),\n        map((_) => _.data),\n        catchError((_) => []),\n        shareReplay(1)\n    );\n\n    public readonly auth_sources: Observable<PlaceAuthSource[]> = combineLatest([\n        this._changed,\n        this.item,\n    ]).pipe(\n        filter(([_, item]) => item instanceof PlaceDomain),\n        switchMap(([_, item]) => {\n            const q = { authority_id: item.id };\n            return combineLatest([\n                querySAMLSources(q as any).pipe(map((_) => _.data)),\n                queryOAuthSources(q as any).pipe(map((_) => _.data)),\n                queryLDAPSources(q as any).pipe(map((_) => _.data)),\n            ]);\n        }),\n        map((_) => {\n            let list = [];\n            _.forEach((array) => (list = list.concat(array)));\n            return list;\n        }),\n        catchError((_) => []),\n        shareReplay(1)\n    );\n\n    public readonly applications: Observable<PlaceApplication[]> = combineLatest([\n        this._changed,\n        this.item,\n    ]).pipe(\n        filter(([_, item]) => item instanceof PlaceDomain),\n        switchMap(([_, item]) => queryApplications({ authority_id: item.id } as any)),\n        map((_) => _.data),\n        catchError((_) => []),\n        shareReplay(1)\n    );\n\n    public readonly counts = combineLatest([\n        this._changed,\n        this.item,\n    ]).pipe(\n        filter(([_, item]) => item instanceof PlaceDomain),\n        switchMap(async ([_, item]) => {\n            const q = { authority_id: item?.id };\n            const details = await Promise.all([\n                queryApplications(q as any)\n                    .pipe(map((_) => _.total))\n                    .toPromise(),\n                combineLatest([\n                    querySAMLSources(q as any),\n                    queryOAuthSources(q as any),\n                    queryLDAPSources(q as any),\n                ])\n                    .pipe(map(([saml, oauth, ldap]) => saml.total + oauth.total + ldap.total))\n                    .toPromise(),\n                queryUsers(q as any)\n                    .pipe(map((_) => _.total))\n                    .toPromise(),\n            ]);\n            const [applications, auth_sources, users] = details;\n            return {\n                applications,\n                auth_sources: auth_sources || 0,\n                users,\n            };\n        }),\n        shareReplay(1)\n    );\n\n    public get active_item() {\n        return this._state.active_item;\n    }\n\n    constructor(private _state: ActiveItemService, private _dialog: MatDialog) {}\n\n    public async update(domain: PlaceDomain) {\n        const item = await updateDomain(domain.id, domain).toPromise();\n        this._state.replaceItem(item);\n    }\n\n    /**\n     * Open the modal to create a new system\n     */\n    public async editApplication(item?: PlaceApplication) {\n        item = item || new PlaceApplication({ owner_id: this.active_item.id });\n        const ref = this._dialog.open(ItemCreateUpdateModalComponent, {\n            height: 'auto',\n            width: 'auto',\n            maxHeight: 'calc(100vh - 2em)',\n            maxWidth: 'calc(100vw - 2em)',\n            data: {\n                item,\n                name: 'Application',\n                save: (i) => (i.id ? updateApplication(i.id, i) : addApplication(i)),\n            },\n        });\n        const details = await Promise.race([\n            ref.componentInstance.event.pipe(first((_) => _.reason === 'done')).toPromise(),\n            ref.afterClosed().toPromise(),\n        ]);\n        if (!details) return;\n        this._changed.next(new Date().valueOf());\n    }\n\n    /**\n     * Remove application from domain\n     * @param item Application to delete\n     */\n    public async deleteApplication(item: PlaceApplication) {\n        const details = await openConfirmModal(\n            {\n                title: `Delete application`,\n                content: `<p>Are you sure you want delete the application ${item.name}?</p><p>Configuration will be <strong>immediately</strong> updated</p>`,\n                icon: { type: 'icon', class: 'backoffice-trash' },\n            },\n            this._dialog\n        );\n        if (!details) return;\n        details.loading('Deleting domain application...');\n        const err = await removeApplication(item.id)\n            .toPromise()\n            .catch((_) => _);\n        details.close();\n        if (err)\n            return notifyError(\n                `Error removing domain application. Error: ${\n                    err.responseText || err.message || err\n                }`\n            );\n        notifySuccess('Successfully removed domain application.');\n        this._changed.next(new Date().valueOf());\n    }\n\n    /**\n     * Open the modal to create a new system\n     */\n    public async editAuthSource(item?: PlaceAuthSource) {\n        const ref = this._dialog.open(AuthSourceModalComponent, {\n            height: 'auto',\n            width: 'auto',\n            maxHeight: 'calc(100vh - 2em)',\n            maxWidth: 'calc(100vw - 2em)',\n            data: {\n                auth_source: item,\n                domain: this.active_item,\n            },\n        });\n        const details = await Promise.race([\n            ref.componentInstance.event.pipe(first((_) => _.reason === 'done')).toPromise(),\n            ref.afterClosed().toPromise(),\n        ]);\n        if (!details) return;\n        this._changed.next(new Date().valueOf());\n    }\n\n    /**\n     * Remove application from domain\n     * @param item Application to delete\n     */\n    public async deleteAuthSource(item: PlaceAuthSource) {\n        const details = await openConfirmModal(\n            {\n                title: `Delete auth source`,\n                content: `<p>Are you sure you want delete this auth source?</p><p>Deleting this will remove this auth source <strong>immediately</strong></p>`,\n                icon: { type: 'icon', class: 'backoffice-trash' },\n            },\n            this._dialog\n        );\n        if (!details) return;\n        details.loading('Deleting domain auth source...');\n        const method =\n            item instanceof PlaceSAMLSource\n                ? removeSAMLSource\n                : item instanceof PlaceOAuthSource\n                ? removeOAuthSource\n                : removeLDAPSource;\n        const err = await method(item.id)\n            .toPromise()\n            .catch((_) => _);\n        details.close();\n        if (err)\n            return notifyError(\n                `Error removing domain auth source. Error: ${\n                    err.responseText || err.message || err\n                }`\n            );\n        notifySuccess('Successfully removed domain auth source.');\n        this._changed.next(new Date().valueOf());\n    }\n}\n","import { Component } from '@angular/core';\nimport { PlaceDomain, PlaceApplication } from '@placeos/ts-client';\n\nimport { HashMap } from 'apps/backoffice/src/app/common/types';\nimport { copyToClipboard } from 'apps/backoffice/src/app/common/general';\nimport { notifyInfo } from 'apps/backoffice/src/app/common/notifications';\nimport { DomainStateService } from './domain-state.service';\n\n@Component({\n    selector: 'domain-applications',\n    template: `\n        <button\n            mat-button\n            class=\"w-full sm:w-40 mb-4\"\n            (click)=\"newApplication()\"\n            i18n=\"@@newAction\"\n        >\n            New Application\n        </button>\n        <div\n            role=\"table\"\n            class=\"overflow-x-auto\"\n            *ngIf=\"(applications | async)?.length; else empty_state\"\n        >\n            <div table-head>\n                <div class=\"w-40 p-2\" i18n=\"@@applicationTableName\">Name</div>\n                <div class=\"flex-1 p-2\" i18n=\"@@applicationTableRedirect\">\n                    Redirect\n                </div>\n                <div class=\"w-48 p-2\" i18n=\"@@applicationTableClientId\">\n                    Client ID\n                </div>\n                <div class=\"w-48 p-2\" i18n=\"@@applicationTableClientSecret\">\n                    Secret\n                </div>\n                <div class=\"w-24 p-2\" i18n=\"@@applicationTableScope\">Scope</div>\n                <div class=\"w-24\"></div>\n            </div>\n            <div table-body>\n                <div table-row *ngFor=\"let item of applications | async\">\n                    <div class=\"w-40 p-2\" [matTooltip]=\"item.id\">\n                        {{ item.name }}\n                    </div>\n                    <div class=\"flex-1 p-2 underline overflow-hidden\">\n                        <a [href]=\"item.redirect_uri\" class=\"truncate\">{{\n                            item.redirect_uri\n                        }}</a>\n                    </div>\n                    <div class=\"w-48 p-2 truncate text-xs\">{{ item.uid }}</div>\n                    <div\n                        class=\"w-48 p-2 truncate underline text-center text-xs\"\n                        (click)=\"\n                            !show_secret[item.id]\n                                ? (show_secret[item.id] = true)\n                                : copySecret(item)\n                        \"\n                    >\n                        {{ show_secret[item.id] ? item.secret : 'Show' }}\n                    </div>\n                    <div class=\"w-24 p-2\">{{ item.scopes }}</div>\n                    <div class=\"w-24 flex items-center justify-center\">\n                        <button mat-icon-button (click)=\"editApplication(item)\">\n                            <app-icon\n                                [icon]=\"{ class: 'backoffice-edit' }\"\n                            ></app-icon>\n                        </button>\n                        <button\n                            mat-icon-button\n                            (click)=\"deleteApplication(item)\"\n                        >\n                            <app-icon\n                                [icon]=\"{ class: 'backoffice-trash' }\"\n                            ></app-icon>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <ng-template #empty_state>\n            <div empty-state>\n                <p i18n=\"@@applicationTableEmpty\">No applications found</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                height: 100%;\n                width: 100%;\n            }\n\n            [role='table'] > div {\n                min-width: 56rem;\n            }\n        `,\n    ],\n})\nexport class DomainApplicationsComponent {\n    /** List of applications associated with the active domain */\n    public readonly applications = this._service.applications;\n\n    public show_secret: HashMap<boolean> = {};\n\n    public readonly newApplication = () => this._service.editApplication();\n    public readonly editApplication = (item) =>\n        this._service.editApplication(item);\n    public readonly deleteApplication = (item) =>\n        this._service.deleteApplication(item);\n\n    public get item(): PlaceDomain {\n        return this._service.active_item as any;\n    }\n\n    constructor(private _service: DomainStateService) {}\n\n    public copySecret(item: PlaceApplication) {\n        this.show_secret[item.id] = false;\n        copyToClipboard(item.secret);\n        notifyInfo('Copied client secret to clipboard');\n    }\n}\n","import { Component } from '@angular/core';\nimport { PlaceDomain } from '@placeos/ts-client';\n\nimport { HashMap } from 'apps/backoffice/src/app/common/types';\nimport { DomainStateService } from './domain-state.service';\n\n@Component({\n    selector: 'domain-authentication',\n    template: `\n        <button\n            mat-button\n            class=\"w-full sm:w-40 mb-4\"\n            (click)=\"newAuthSource()\"\n            i18n=\"@@newAction\"\n        >\n            New Auth Source\n        </button>\n        <div\n            role=\"table\"\n            class=\"min-w-[36rem]\"\n            *ngIf=\"(auth_sources | async)?.length; else empty_state\"\n        >\n            <div table-head>\n                <div class=\"w-48 p-2\" i18n=\"@@authTableID\">ID</div>\n                <div class=\"flex-1 p-2\" i18n=\"@@authTableName\">Name</div>\n                <div class=\"w-32 p-2\" i18n=\"@@authTableType\">Type</div>\n                <div class=\"w-24 p-2\"></div>\n            </div>\n            <div table-body>\n                <div table-row *ngFor=\"let item of auth_sources | async\">\n                    <div class=\"w-48 p-2 mono text-xs\">\n                        {{ item.id }}\n                    </div>\n                    <div class=\"flex-1 p-2\">\n                        {{ item.name }}\n                    </div>\n                    <div class=\"w-32 p-2 uppercase\">{{ item.type }}</div>\n                    <div class=\"w-24 flex items-center justify-center\">\n                        <button mat-icon-button (click)=\"editAuthSource(item)\">\n                            <app-icon\n                                [icon]=\"{ class: 'backoffice-edit' }\"\n                            ></app-icon>\n                        </button>\n                        <button\n                            mat-icon-button\n                            (click)=\"deleteAuthSource(item)\"\n                        >\n                            <app-icon\n                                [icon]=\"{ class: 'backoffice-trash' }\"\n                            ></app-icon>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <ng-template #empty_state>\n            <div empty-state>\n                <p i18n=\"@@authTableEmpty\">No authentication sources found</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                height: 100%;\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class DomainAuthenticationComponent {\n    /** List of auth sources associated with the active domain */\n    public readonly auth_sources = this._service.auth_sources;\n    /** Mapping of auth sources to their type */\n    public source_types: HashMap<'oauth' | 'saml' | 'ldap'> = {};\n\n    public readonly newAuthSource = () => this._service.editAuthSource();\n    public readonly editAuthSource = (source) =>\n        this._service.editAuthSource(source);\n    public readonly deleteAuthSource = (source) =>\n        this._service.deleteAuthSource(source);\n\n    public get item(): PlaceDomain {\n        return this._service.active_item as any;\n    }\n\n    constructor(private _service: DomainStateService) {}\n}\n","import { Component } from '@angular/core';\nimport { PlaceDomain } from '@placeos/ts-client';\n\nimport { DomainStateService } from './domain-state.service';\n\n@Component({\n    selector: 'domain-users',\n    template: `\n        <div role=\"table\" *ngIf=\"(users | async)?.length; else empty_state\">\n            <div table-head>\n                <div class=\"w-64 p-2\" i18n=\"@@userTableName\">Name</div>\n                <div class=\"flex-1 p-2\" i18n=\"@@userTableEmail\">Email</div>\n                <div class=\"w-24 p-2\" i18n=\"@@userTableRole\">Role</div>\n            </div>\n            <div table-body>\n                <div table-row *ngFor=\"let item of users | async\">\n                    <div class=\"w-64 p-2 underline\">\n                        <a\n                            [routerLink]=\"['/users', item.id]\"\n                            [matTooltip]=\"item.id\"\n                            matTooltipPosition=\"right\"\n                        >\n                            {{ item.name }}\n                        </a>\n                    </div>\n                    <div class=\"flex-1 p-2 underline\">\n                        <a [href]=\"'mailto:' + item.email\">{{ item.email }}</a>\n                    </div>\n                    <div class=\"w-24 p-2\">\n                        <code [class.text-opacity-20]=\"!item.sys_admin && !item.support\">\n                            {{ item.sys_admin ? 'Admin' : item.support ? 'Support' : 'None' }}\n                        </code>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <ng-template #empty_state>\n            <div class=\"flex flex-col items-center p-8\">\n                <p i18n=\"@@userTableEmpty\">No users associated with domain</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                height: 100%;\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class DomainUsersComponent {\n    public readonly users = this._service.users;\n\n    public get item(): PlaceDomain {\n        return this._service.active_item as any;\n    }\n\n    constructor(private _service: DomainStateService) {}\n}\n","import { Component, OnInit } from '@angular/core';\nimport { FormGroup, FormControl } from '@angular/forms';\n\nimport { PlaceDomain } from '@placeos/ts-client';\n\nimport { BaseClass } from 'apps/backoffice/src/app/common/base.class';\nimport { validateJSONString } from 'apps/backoffice/src/app/common/validation';\nimport { DomainStateService } from './domain-state.service';\n\n@Component({\n    selector: 'app-domain-about',\n    template: `\n        <h3 class=\"text-lg font-medium mb-2\">Settings</h3>\n        <section *ngIf=\"form\" [formGroup]=\"form\">\n            <mat-tab-group [(selectedIndex)]=\"index\">\n                <mat-tab label=\"Config\"> </mat-tab>\n                <mat-tab label=\"Internals\"> </mat-tab>\n            </mat-tab-group>\n            <settings-form-field\n                *ngIf=\"index !== 1\"\n                formControlName=\"config\"\n                lang=\"json\"\n                [readonly]=\"false\"\n            ></settings-form-field>\n            <settings-form-field\n                *ngIf=\"index === 1\"\n                formControlName=\"internals\"\n                lang=\"json\"\n                [readonly]=\"false\"\n            ></settings-form-field>\n        </section>\n    `,\n    styles: [\n        `\n            :host {\n                height: 100%;\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class DomainAboutComponent extends BaseClass implements OnInit {\n    /** Form group for edit domain settings */\n    public form = new FormGroup({\n        config: new FormControl('', [validateJSONString]),\n        internals: new FormControl('', [validateJSONString]),\n    });\n    /** Index of the active tab */\n    public index: number;\n\n    public get item(): PlaceDomain {\n        return this._service.active_item as any;\n    }\n\n    constructor(private _service: DomainStateService) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.subscription(\n            'item',\n            this._service.item.subscribe((_) => this.loadForm())\n        );\n    }\n\n    /** Load form fields for active item */\n    private loadForm(): void {\n        this.form.patchValue({\n            internals: JSON.stringify(this.item.internals, undefined, 4),\n            config: JSON.stringify(this.item.config, undefined, 4),\n        });\n        this.subscription(\n            'form',\n            this.form.valueChanges.subscribe(() => this.saveChanges())\n        );\n    }\n\n    /** Save changes to the form fields */\n    private saveChanges(): void {\n        this.timeout(\n            'save',\n            async () => {\n                if (this.form.valid) {\n                    const domain = new PlaceDomain({\n                        ...this.item,\n                        config: JSON.parse(this.form.value.config),\n                        internals: JSON.parse(this.form.value.internals),\n                    });\n                    this._service.update(domain);\n                }\n            },\n            3000\n        );\n    }\n}\n","import { Component } from '@angular/core';\nimport { extensionsForItem } from '../common/api';\nimport { BaseClass } from '../common/base.class';\nimport { ActiveItemService } from '../common/item.service';\nimport { DomainStateService } from './domain-state.service';\n\n@Component({\n    selector: 'new-domains-view',\n    template: `\n        <div\n            class=\"absolute inset-0 flex items-center divide-y sm:divide-y-0 sm:divide-x divide-gray-300 dark:divide-neutral-600 bg-white dark:bg-neutral-700\"\n        >\n            <sidebar-menu [(open)]=\"open_menu\" class=\"sm:h-full\"></sidebar-menu>\n            <item-sidebar class=\"hidden sm:block\" [route]=\"name\" title=\"Domains\"></item-sidebar>\n            <div class=\"flex-1 w-1/2 h-full relative flex flex-col z-0\">\n                <item-selection class=\"z-20 sm:hidden\" [route]=\"name\" title=\"Domains\">\n                    <button\n                        mat-icon-button\n                        class=\"sm:hidden mr-2\"\n                        (click)=\"open_menu = true\"\n                    >\n                        <app-icon className=\"backoffice-menu\"></app-icon>\n                    </button>\n                </item-selection>\n                <div class=\"flex flex-col flex-1 h-1/2\">\n                    <ng-container *ngIf=\"item?.id\">\n                        <item-details\n                            [can_edit]=\"true\"\n                            [item]=\"item\"\n                            type=\"Domain\"\n                        ></item-details>\n                        <item-tablist\n                            [base]=\"name\"\n                            [tabs]=\"tab_list\"\n                            [scrolled]=\"scroll > 0\"\n                            class=\"z-10\"\n                        ></item-tablist>\n                        <div\n                            #el\n                            class=\"flex-1 h-1/2 w-full overflow-auto p-4 z-0 relative\"\n                            (scroll)=\"scroll = el.scrollTop\"\n                        >\n                            <router-outlet></router-outlet>\n                        </div>\n                    </ng-container>\n                </div>\n                <button\n                    class=\"absolute bottom-2 left-2 sm:-left-9 w-12 h-12 flex items-center justify-center bg-primary dark:bg-pink rounded-lg shadow z-30 text-white\"\n                    matTooltip=\"New domain\"\n                    matTooltipPosition=\"right\"\n                    matRipple\n                    (click)=\"newItem()\"\n                >\n                    <app-icon\n                        [className]=\"'backoffice-plus'\"\n                        class=\"text-3xl\"\n                    ></app-icon>\n                </button>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class DomainsComponent extends BaseClass {\n    public readonly name = 'domains';\n\n    public open_menu = false;\n    public tab_list = [];\n\n    public readonly newItem = () => this._item.create();\n\n    public get item() {\n        return this._service.active_item;\n    }\n\n    public get extensions() {\n        return extensionsForItem(this._service.active_item, this.name);\n    }\n\n    constructor(\n        private _service: DomainStateService,\n        protected _item: ActiveItemService\n    ) {\n        super();\n    }\n\n    public updateTabList(count: Record<string, number>) {\n        this.tab_list = [\n            {\n                id: 'about',\n                name: 'About',\n                icon: { class: 'backoffice-info-with-circle' },\n            },\n            {\n                id: 'applications',\n                name: 'Applications',\n                count: count.applications || 0,\n                icon: { class: 'backoffice-publish' },\n            },\n            {\n                id: 'authentication',\n                name: 'Authentication',\n                count: count.auth_sources || 0,\n                icon: { class: 'backoffice-lock-open' },\n            },\n            {\n                id: 'users',\n                name: 'Users',\n                count: count.users || 0,\n                icon: { class: 'backoffice-users' },\n            },\n        ].concat(this.extensions);\n    }\n\n    public ngOnInit(): void {\n        this.updateTabList({});\n        this.subscription(\n            'item',\n            this._service.counts.subscribe((c) => this.updateTabList(c as any))\n        );\n    }\n}\n","import { Routes } from '@angular/router';\nimport { DomainApplicationsComponent } from './domain-applications.component';\nimport { DomainAuthenticationComponent } from './domain-authentication.component';\nimport { DomainUsersComponent } from './domain-users.component';\nimport { DomainAboutComponent } from './domain-about.component';\nimport { ExtensionOutletComponent } from '../ui/extension-outlet.component';\nimport { DomainsComponent } from './domains.component';\n\nexport const ROUTES: Routes = [\n    {\n        path: ':id',\n        component: DomainsComponent,\n        children: [\n            { path: 'about', component: DomainAboutComponent },\n            { path: 'applications', component: DomainApplicationsComponent },\n            { path: 'authentication', component: DomainAuthenticationComponent },\n            { path: 'users', component: DomainUsersComponent },\n            { path: 'extend/:id', component: ExtensionOutletComponent },\n            { path: '**', redirectTo: 'about' },\n        ],\n    },\n    { path: '**', redirectTo: '-' },\n];\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { RouterModule } from '@angular/router';\n\nimport { ROUTES } from './domains.routes';\n\nimport { DomainApplicationsComponent } from './domain-applications.component';\nimport { DomainAuthenticationComponent } from './domain-authentication.component';\nimport { DomainUsersComponent } from './domain-users.component';\nimport { DomainAboutComponent } from './domain-about.component';\n\nimport { SharedContentModule } from 'apps/backoffice/src/app/ui/ui.module';\nimport { DomainsComponent } from './domains.component';\n\n@NgModule({\n    declarations: [\n        DomainApplicationsComponent,\n        DomainAuthenticationComponent,\n        DomainUsersComponent,\n        DomainAboutComponent,\n        DomainsComponent\n    ],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        RouterModule.forChild(ROUTES),\n        SharedContentModule,\n    ],\n})\nexport class AppDomainsModule {}\n"],"x_google_ignoreList":[]}