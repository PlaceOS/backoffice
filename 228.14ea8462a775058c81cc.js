(self.webpackChunkplaceos=self.webpackChunkplaceos||[]).push([[228],{3228:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AppPlaceModule:()=>un});var i=n(1511),o=n(3695),s=n(6898),a=n(5292),c=n(8194),r=n(5697),l=n(1572),d=n(9983),u=n(5712),m=n(1956),f=n(3609);const g=function(e){return["/admin",e]};function p(e,t){if(1&e&&(l.TgZ(0,"a",5),l._UZ(1,"app-icon",6),l.TgZ(2,"span"),l._uU(3),l.qZA(),l.qZA()),2&e){const e=t.$implicit;l.Q6J("routerLink",l.VKq(3,g,e.id)),l.xp6(1),l.Q6J("icon",e.icon),l.xp6(2),l.Oqu(e.name)}}let h=(()=>{class e extends c.K{constructor(e,t,n){super(),this._settings=e,this._service=t,this._users=n,this.tab_list=[]}get extensions(){return(0,r.fq)(this._service.active_item,"admin")}get dark_mode(){return this._users.dark_mode}updateTabList(){this.tab_list=[{id:"about",name:"About",icon:{class:"backoffice-info"}},{id:"database",name:"Database",icon:{class:"backoffice-database"}},{id:"clusters",name:"Clusters",icon:{class:"backoffice-server"}},{id:"edge",name:"Edges",icon:{class:"backoffice-server"}},{id:"interfaces",name:"Interfaces",icon:{class:"backoffice-browser"}},{id:"brokers",name:"MQTT Brokers",icon:{class:"backoffice-server"}},{id:"staff-api",name:"Staff API",icon:{class:"backoffice-gist"}},{id:"extensions",name:"Extensions",icon:{class:"backoffice-gist"}},{id:"api-keys",name:"API Keys",icon:{class:"backoffice-key"}},{id:"schemas",name:"Custom Schemas",icon:{class:"backoffice-list"}}].concat(this.extensions)}ngOnInit(){this._settings.title="Admin",this.updateTabList()}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(d.g),l.Y36(u.L),l.Y36(m.w))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-engine"]],features:[l.qOj],decls:7,vars:1,consts:[[1,"h-16","p-4","text-2xl","bg-white","border-b","border-gray-400","border-opacity-30","shadow","z-10","dark:text-white","dark:bg-greyer"],[1,"flex","flex-1","z-0","h-1/2","dark:text-white"],[1,"relative","w-64","h-full","bg-white","border-r","border-gray-400","border-opacity-30","shadow","z-10","dark:bg-greyer"],["class","flex items-center space-x-2 my-2 rounded-l-2xl h-8 px-3 ml-3 hover:bg-primary hover:bg-opacity-25","routerLinkActive","active",3,"routerLink",4,"ngFor","ngForOf"],[1,"relative","flex-1","w-1/2","h-full","z-0","bg-white","px-4","dark:text-white","dark:bg-grey"],["routerLinkActive","active",1,"flex","items-center","space-x-2","my-2","rounded-l-2xl","h-8","px-3","ml-3","hover:bg-primary","hover:bg-opacity-25",3,"routerLink"],[3,"icon"]],template:function(e,t){1&e&&(l.TgZ(0,"div",0),l._uU(1," PlaceOS Admin "),l.qZA(),l.TgZ(2,"div",1),l.TgZ(3,"div",2),l.YNc(4,p,4,5,"a",3),l.qZA(),l.TgZ(5,"div",4),l._UZ(6,"router-outlet"),l.qZA(),l.qZA()),2&e&&(l.xp6(4),l.Q6J("ngForOf",t.tab_list))},directives:[i.sg,s.lC,s.yS,s.Od,f.o],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%}.active[_ngcontent-%COMP%]{background-color:#c2185b!important;color:#fff;margin-right:-1px}"]}),e})();var Z=n(8739),v=n(5802);let _=(()=>{class e extends c.K{reindex(e=!0){const t=`${(0,v._ds)()}/reindex${e?"?backfill=true":""}`;return(0,v.v_Q)(t,null).toPromise()}backfill(){const e=`${(0,v._ds)()}/backfill`;return(0,v.v_Q)(e,null).toPromise()}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=l.n5z(e)))(n||e)}}(),e.\u0275prov=l.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var b=n(7439),x=n(5980),A=n(7806);function q(e,t){1&e&&(l.ynx(0),l._uU(1,"Re-index"),l.BQk())}function T(e,t){1&e&&(l.ynx(0),l._uU(1,"Backfill"),l.BQk())}function y(e,t){1&e&&(l.TgZ(0,"div",3),l._UZ(1,"mat-spinner",4),l.qZA())}let w=(()=>{class e{constructor(e){this._engine_service=e}reindex(){this.reindexing=!0,this._engine_service.reindex().then(()=>this.reindexing=!1,e=>{this.reindexing=!1,(0,Z.cB)(`Error reindexing database. Error: ${JSON.stringify(e.response||e.message||e)}`)})}backfill(){this.backfilling=!0,this._engine_service.backfill().then(()=>this.backfilling=!1,e=>{this.backfilling=!1,(0,Z.cB)(`Error reindexing database. Error: ${JSON.stringify(e.response||e.message||e)}`)})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(_))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-database-details"]],decls:18,vars:6,consts:[["mat-button","",3,"disabled","click"],[4,"ngIf","ngIfElse"],["spinner",""],[1,"flex","justify-center","w-full","my-1"],["diameter","32"]],template:function(e,t){if(1&e&&(l.TgZ(0,"mat-card"),l.TgZ(1,"mat-card-content"),l._uU(2," Re-index elasticsearch for the "),l._UZ(3,"br"),l._uU(4,"current state of the database "),l.qZA(),l.TgZ(5,"mat-card-actions"),l.TgZ(6,"button",0),l.NdJ("click",function(){return t.reindex()}),l.YNc(7,q,2,0,"ng-container",1),l.qZA(),l.qZA(),l.qZA(),l.TgZ(8,"mat-card"),l.TgZ(9,"mat-card-content"),l._uU(10," Backfill elasticsearch with the"),l._UZ(11,"br"),l._uU(12," current state of the database "),l.qZA(),l.TgZ(13,"mat-card-actions"),l.TgZ(14,"button",0),l.NdJ("click",function(){return t.backfill()}),l.YNc(15,T,2,0,"ng-container",1),l.qZA(),l.qZA(),l.qZA(),l.YNc(16,y,2,0,"ng-template",null,2,l.W1O)),2&e){const e=l.MAs(17);l.xp6(6),l.Q6J("disabled",t.reindexing),l.xp6(1),l.Q6J("ngIf",!t.reindexing)("ngIfElse",e),l.xp6(7),l.Q6J("disabled",t.backfilling),l.xp6(1),l.Q6J("ngIf",!t.backfilling)("ngIfElse",e)}},directives:[b.a8,b.dn,b.hq,x.lW,i.O5,A.$g],styles:["[_nghost-%COMP%]{padding:1em;display:flex;flex-wrap:wrap}button[_ngcontent-%COMP%]{min-width:10em;margin:.25em}mat-card[_ngcontent-%COMP%]{margin:.5em;text-align:center}"]}),e})();var k=n(9758),U=n(1081),O=n(4312),N=n(4103),I=n(4608);function C(e,t){if(1&e&&(l.TgZ(0,"div",16),l.TgZ(1,"h3",17),l._uU(2),l.qZA(),l.TgZ(3,"div",18),l.TgZ(4,"label",19),l._uU(5,"Commit Hash:"),l.qZA(),l.TgZ(6,"div",20),l._uU(7),l.qZA(),l.qZA(),l.TgZ(8,"div",18),l.TgZ(9,"label",19),l._uU(10,"Version:"),l.qZA(),l.TgZ(11,"div",20),l._uU(12),l.qZA(),l.qZA(),l.TgZ(13,"div",18),l.TgZ(14,"label",19),l._uU(15,"Build time:"),l.qZA(),l.TgZ(16,"div"),l._uU(17),l.qZA(),l.qZA(),l.TgZ(18,"div",21),l.TgZ(19,"label",19),l._uU(20,"Platform:"),l.qZA(),l.TgZ(21,"div",20),l._uU(22),l.qZA(),l.qZA(),l.qZA()),2&e){const e=t.$implicit;l.xp6(2),l.hij(" ",e.service," "),l.xp6(5),l.hij(" ",e.commit," "),l.xp6(5),l.hij(" ",e.version," "),l.xp6(5),l.Oqu(e.build_time),l.xp6(5),l.hij(" ",e.platform_version," ")}}let J=(()=>{class e extends c.K{constructor(e,t){super(),this._users=e,this._dialog=t}get user(){return this._users.user}get backoffice_version(){return(null==k.q?void 0:k.q.tag)||""}get backoffice_hash(){return(null==k.q?void 0:k.q.hash)||""}get backoffice_build(){return O(k.q.time).format("DD MMM YYYY [at] h:mma")}ngOnInit(){this.loadApiDetails()}changelog(e){this._dialog.open(U.n,{data:{changelog:e}})}copy(e,t){(0,N.vQ)(t),(0,Z.QD)(`Copied ${e} to clipboard`)}loadApiDetails(){(0,v.U2M)(`${(0,v._ds)()}/cluster/versions`).toPromise().then(e=>this.api_details=e,e=>(0,Z.cB)(`Error loading API details. Error: ${JSON.stringify(e.response||e.message||e)}`))}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(m.w),l.Y36(I.uw))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-engine-details"]],features:[l.qOj],decls:22,vars:4,consts:function(){let e,t,n,i,o;return e=$localize`:@@backoffice␟f15da484530fe89db8e06a17ee783ba2182ce593␟8046151527921290223:Backoffice`,t=$localize`:@@version␟ca17606ffe979fb5b411861280c33d2ad3e7a216␟6791662619770759914:Version:`,n=$localize`:@@commitHash␟d7f702c34df541537a2a188810a28d361a2cb09e␟8250617165434775274:Commit Hash:`,i=$localize`:@@buildTime␟401b32daa4e71a24498df7b26a72153805508074␟2870652620203683834:Build:`,o=$localize`:@@apiHeader␟e351b40b3869a5c7d19c3d4918cb1ac7aaab95c4␟8942351587754185907:API`,[[1,"text-lg","font-medium"],e,[1,"space-y-2","mb-4"],[1,"flex","flex-col"],["for","version"],t,["name","version",1,"select-all",3,"click"],["for","hash"],n,["name","hash",1,"select-all",3,"click"],["for","build-time"],i,["name","build-time",1,"select-all",3,"click"],o,[1,"flex","flex-wrap","p-2"],["class","bg-white dark:bg-[#424242] rounded shadow m-2 min-w-[40%] flex-1 overflow-hidden",4,"ngFor","ngForOf"],[1,"bg-white","dark:bg-[#424242]","rounded","shadow","m-2","min-w-[40%]","flex-1","overflow-hidden"],[1,"w-full","px-4","py-2","mb-1","border-b","border-gray-200","dark:border-white/20"],[1,"flex","items-center","px-4","py-1","hover:bg-gray-400/20"],[1,"w-24"],[1,"bg-gray-300/60","rounded","p-1","text-xs","mono"],[1,"flex","items-center","px-4","py-1","hover:bg-gray-400/20","mb-1"]]},template:function(e,t){1&e&&(l.TgZ(0,"h3",0),l.SDv(1,1),l.qZA(),l.TgZ(2,"section",2),l.TgZ(3,"div",3),l.TgZ(4,"label",4),l.SDv(5,5),l.qZA(),l.TgZ(6,"div",6),l.NdJ("click",function(){return t.copy("version",t.backoffice_version)}),l._uU(7),l.qZA(),l.qZA(),l.TgZ(8,"div",3),l.TgZ(9,"label",7),l.SDv(10,8),l.qZA(),l.TgZ(11,"div",9),l.NdJ("click",function(){return t.copy("hash",t.backoffice_hash)}),l._uU(12),l.qZA(),l.qZA(),l.TgZ(13,"div",3),l.TgZ(14,"label",10),l.SDv(15,11),l.qZA(),l.TgZ(16,"div",12),l.NdJ("click",function(){return t.copy("build time",t.backoffice_build)}),l._uU(17),l.qZA(),l.qZA(),l.qZA(),l.TgZ(18,"h3",0),l.SDv(19,13),l.qZA(),l.TgZ(20,"section",14),l.YNc(21,C,23,5,"div",15),l.qZA()),2&e&&(l.xp6(7),l.hij(" ",t.backoffice_version," "),l.xp6(5),l.hij(" ",t.backoffice_hash," "),l.xp6(5),l.hij(" ",t.backoffice_build," "),l.xp6(4),l.Q6J("ngForOf",t.api_details))},directives:[i.sg],styles:["[_nghost-%COMP%]{padding:1rem;width:100%;height:100%}"]}),e})();var M=n(3835),Q=n(4019),E=n(4689),P=n(9996),S=n(7727),F=n(8289),$=n(8144);const Y=["chart"];let j=(()=>{class e{constructor(){this.points=[]}get used_memory(){var e;return(0,v.VDv)(1024*((null===(e=this.node)||void 0===e?void 0:e.memory_usage)||0))}get total_memory(){var e;return(0,v.VDv)(1024*((null===(e=this.node)||void 0===e?void 0:e.memory_total)||0))}get memory_percentage(){var e,t;return((null===(e=this.node)||void 0===e?void 0:e.memory_usage)||0)/((null===(t=this.node)||void 0===t?void 0:t.memory_total)||1)*100}ngOnInit(){this.generateCharts()}ngOnChanges(e){e.history&&this.history&&this.generateCharts()}generateCharts(){const e=[...this.history]||[];for(;e.length<12;)e.unshift({});const t=e.slice(Math.max(0,e.length-12)).map((e,t)=>({x:t,y:e.value||0}));this.points=[...t]}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Xpm({type:e,selectors:[["admin-cluster-node"]],viewQuery:function(e,t){if(1&e&&l.Gf(Y,7),2&e){let e;l.iGM(e=l.CRH())&&(t._chart_el=e.first)}},inputs:{node:"node",history:"history"},features:[l.TTD],decls:15,vars:6,consts:function(){let e,t;return e=$localize`:@@cluserMemoryUsed␟815de8480fe5cfeb9901a306873590d38168a754␟3965710386570662641:Memory Used`,t=$localize`:@@clusterCpuUsage␟6e5f806667d8c63b5716b1959c0cf07babd739f1␟3236008470518102616:CPU Usage`,[[1,"mb-2","h-40","w-64"],["basic-line-graph","",3,"points"],[1,"memory-utilisation"],[1,"flex","items-center","space-x-2","p-2"],e,[1,"value"],[1,"flex","items-center","space-x-2","bg-black","bg-opacity-5","rounded","p-2"],t]},template:function(e,t){1&e&&(l.TgZ(0,"h4"),l._uU(1),l.qZA(),l.TgZ(2,"div",0),l._UZ(3,"div",1),l.qZA(),l.TgZ(4,"div",2),l.TgZ(5,"div",3),l.TgZ(6,"label"),l.SDv(7,4),l.qZA(),l.TgZ(8,"div",5),l._uU(9),l.qZA(),l.qZA(),l.TgZ(10,"div",6),l.TgZ(11,"label"),l.SDv(12,7),l.qZA(),l.TgZ(13,"div",5),l._uU(14),l.qZA(),l.qZA(),l.qZA()),2&e&&(l.xp6(1),l.Oqu(null==t.node?null:t.node.hostname),l.xp6(2),l.Q6J("points",t.points),l.xp6(6),l.lnq(" ",t.used_memory," / ",t.total_memory," (",t.memory_percentage.toFixed(2),"%) "),l.xp6(5),l.hij("",null==t.node?null:t.node.total_cpu,"%"))},directives:[$.C],encapsulation:2}),e})();const D=function(){return[]};function L(e,t){if(1&e&&(l.ynx(0),l._UZ(1,"admin-cluster-node",1),l.BQk()),2&e){const e=t.$implicit,n=l.oxw();l.xp6(1),l.Q6J("node",e)("history",n.cpu_history[e.hostname]||l.DdM(2,D))}}let z=(()=>{class e{constructor(){this.cpu_history={}}ngOnChanges(e){e.cluster&&this.cluster&&(this.cluster_nodes=[this.cluster,...this.cluster.edge_nodes],this.cpu_history=this.cpu_history||{})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Xpm({type:e,selectors:[["engine-cluster-item"]],inputs:{cluster:"cluster",cpu_history:"cpu_history"},features:[l.TTD],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"node","history"]],template:function(e,t){1&e&&l.YNc(0,L,2,3,"ng-container",0),2&e&&l.Q6J("ngForOf",t.cluster_nodes)},directives:[i.sg,j],styles:[""]}),e})();var H=n(3049),B=n(3709);const G=function(){return{class:"backoffice-trash"}};function K(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",13),l._UZ(1,"div",14),l.ALo(2,"driverFormat"),l.TgZ(3,"div",8),l._uU(4),l.qZA(),l.TgZ(5,"div",8),l._uU(6),l.qZA(),l.TgZ(7,"div",8),l._uU(8),l.qZA(),l.TgZ(9,"div",15),l.TgZ(10,"button",1),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw().confirmKillProcess(t)}),l._UZ(11,"app-icon",2),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit;l.xp6(1),l.Q6J("innerHTML",l.lcZ(2,5,e.id),l.oJD),l.xp6(3),l.hij(" ",e.cpu_usage.toFixed(2),"% "),l.xp6(2),l.Oqu(e.used_memory),l.xp6(2),l.Oqu(e.module_instances),l.xp6(3),l.Q6J("icon",l.DdM(7,G))}}function W(e,t){1&e&&(l.TgZ(0,"div",16),l.TgZ(1,"p"),l.SDv(2,17),l.qZA(),l.qZA())}const R=function(){return{type:"icon",class:"backoffice-arrow-left"}};let X=(()=>{class e extends c.K{constructor(e){super(),this._dialog=e,this.close=new l.vpe,this.process_list=[],this.column_list=["id","cpu_usage","memory_usage","module_instances","running"]}ngOnInit(){this.loadProcesses(),this.interval("load_tasks",()=>this.loadProcesses(),2e3)}confirmKillProcess(e){const t=this._dialog.open(H.z,Object.assign(Object.assign({},H.t),{data:{title:"Kill process",content:`\n                    <p>Are you sure you want kill the process for "${e.id}"?</p>\n                    <p>The process will be terminated <strong>immediately</strong>.\n                    The process may be restarted after a short while.</p>\n                `,icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("confirm_kill",t.componentInstance.event.subscribe(n=>{"done"===n.reason&&(this.killing=e.id,t.componentInstance.loading="Processing request...",this.killProcess(e).then(()=>{this.killing=null,t.close()},e=>{t.componentInstance.loading=null,this.killing=null,(0,Z.cB)(`Error killing process. Error: ${JSON.stringify(e.response||e.message||e)}`),t.close()}))}))}killProcess(e){return(0,v.qx2)(this.cluster.id,e.id).toPromise()}loadProcesses(){this.loading=!0,(0,v.X8f)(this.cluster.id,{include_status:!0}).subscribe(e=>{this.process_list=e||[],this.loading=!1})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(I.uw))},e.\u0275cmp=l.Xpm({type:e,selectors:[["engine-cluster-task-list"]],inputs:{cluster:"cluster"},outputs:{close:"close"},features:[l.qOj],decls:19,vars:5,consts:function(){let e,t;return e=$localize`:@@clusterHeader␟2837d97a9e0e3c660f026394ec40fe8e4ba4e592␟2012083462068270549: Cluster - ${"\ufffd0\ufffd"}:INTERPOLATION: `,t=$localize`:@@processTableEmpty␟9f96a52f0ede1cccf0177605958427b397bea944␟702517565059377669:No tasks running on cluster`,[[1,"flex","items-center","mb-4"],["mat-icon-button","",3,"click"],[3,"icon"],[1,"text-lg","font-medium"],e,["role","table",1,"h-1/2","flex-1"],["table-head",""],[1,"flex-1","p-2"],[1,"w-24","p-2"],[1,"w-12","p-2"],["table-body",""],["table-row","",4,"ngFor","ngForOf"],["class","flex flex-col items-center p-8",4,"ngIf"],["table-row",""],[1,"flex-1","p-2",3,"innerHTML"],[1,"w-12","flex","items-center","justify-center"],[1,"flex","flex-col","items-center","p-8"],t]},template:function(e,t){1&e&&(l.TgZ(0,"div",0),l.TgZ(1,"button",1),l.NdJ("click",function(){return t.close.emit()}),l._UZ(2,"app-icon",2),l.qZA(),l.TgZ(3,"h3",3),l.SDv(4,4),l.qZA(),l.qZA(),l.TgZ(5,"div",5),l.TgZ(6,"div",6),l.TgZ(7,"div",7),l._uU(8,"Name"),l.qZA(),l.TgZ(9,"div",8),l._uU(10,"CPU %"),l.qZA(),l.TgZ(11,"div",8),l._uU(12,"Memory"),l.qZA(),l.TgZ(13,"div",8),l._uU(14,"Instances"),l.qZA(),l._UZ(15,"div",9),l.qZA(),l.TgZ(16,"div",10),l.YNc(17,K,12,8,"div",11),l.qZA(),l.qZA(),l.YNc(18,W,3,0,"div",12)),2&e&&(l.xp6(2),l.Q6J("icon",l.DdM(4,R)),l.xp6(2),l.pQV(null==t.cluster?null:t.cluster.hostname),l.QtT(4),l.xp6(13),l.Q6J("ngForOf",t.process_list),l.xp6(1),l.Q6J("ngIf",!t.process_list||!t.process_list.length))},directives:[x.lW,f.o,i.sg,i.O5],pipes:[B.X],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;padding:1rem;height:100%;width:100%}"]}),e})();const V=function(){return[]};function ee(e,t){if(1&e){const e=l.EpF();l.ynx(0),l.TgZ(1,"mat-card",4),l.TgZ(2,"mat-card-header"),l.TgZ(3,"mat-card-title",5),l._uU(4),l.qZA(),l.qZA(),l.TgZ(5,"mat-card-content"),l._UZ(6,"engine-cluster-item",6),l.qZA(),l.TgZ(7,"mat-card-actions"),l.TgZ(8,"button",7),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw(3).active_cluster=t}),l.SDv(9,8),l.qZA(),l.qZA(),l.qZA(),l.BQk()}if(2&e){const e=t.$implicit,n=l.oxw(3);l.xp6(4),l.hij("",e.hostname||"Undefined Cluster"," "),l.xp6(2),l.Q6J("cluster",e)("cpu_history",n.cpu_history[e.id]||l.DdM(3,V))}}function te(e,t){if(1&e&&(l.ynx(0),l.YNc(1,ee,10,4,"ng-container",3),l.BQk()),2&e){const e=l.oxw(2);l.xp6(1),l.Q6J("ngForOf",e.cluster_list)}}function ne(e,t){if(1&e&&(l.ynx(0),l.YNc(1,te,2,1,"ng-container",0),l.BQk()),2&e){const e=l.oxw(),t=l.MAs(4);l.xp6(1),l.Q6J("ngIf",!e.active_cluster)("ngIfElse",t)}}const ie=function(){return{class:"backoffice-cross"}};function oe(e,t){1&e&&(l.TgZ(0,"div",9),l._UZ(1,"app-icon",10),l.TgZ(2,"div",11),l.SDv(3,12),l.qZA(),l.qZA()),2&e&&(l.xp6(1),l.Q6J("icon",l.DdM(1,ie)))}function se(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"engine-cluster-task-list",13),l.NdJ("close",function(){return l.CHM(e),l.oxw().active_cluster=null}),l.qZA()}if(2&e){const e=l.oxw();l.Q6J("cluster",e.active_cluster)}}let ae=(()=>{class e extends c.K{constructor(){super(...arguments),this.cluster_list=[],this.cpu_history={},this.clusters$=(0,F.F)(2e3).pipe((0,M.h)(()=>!this.active_cluster),(0,Q.b)(()=>this.loading=!0),(0,E.w)(()=>(0,v.rEJ)({include_status:!0})),(0,P.U)(e=>e.data),(0,S.K)(e=>[]),(0,P.U)(e=>{this.cluster_list=e||[];const t=O().valueOf();this.cluster_list.forEach(e=>{this.cpu_history[e.id]||(this.cpu_history[e.id]={});const n=[e,...e.edge_nodes];for(const i of n)this.cpu_history[e.id][i.hostname]||(this.cpu_history[e.id][i.hostname]=[]),this.cpu_history[e.id][i.hostname].push({id:t,value:i.core_cpu}),this.cpu_history[e.id][i.hostname].length>120&&this.cpu_history[e.id][i.hostname].shift()})}),(0,Q.b)(()=>this.loading=!1))}ngOnInit(){this.subscription("load_cluster",this.clusters$.subscribe())}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=l.n5z(e)))(n||e)}}(),e.\u0275cmp=l.Xpm({type:e,selectors:[["engine-cluster-details"]],features:[l.qOj],decls:5,vars:2,consts:function(){let e,t;return e=$localize`:@@viewClusterProcesses␟98b5b5888e2159cd2cf3ea350a64b6e03d5e7572␟4310237000483500177: View Processes `,t=$localize`:@@clusterListEmpty␟d2439117e1e3b740500ee9adc477711383f33d30␟7110510397716287271: No Cluster details to show `,[[4,"ngIf","ngIfElse"],["empty_state",""],["process_state",""],[4,"ngFor","ngForOf"],[1,"m-2","text-center"],["clas","capitalize"],[3,"cluster","cpu_history"],["mat-button","",3,"click"],e,[1,"absolute","inset-0","flex","flex-col","items-center","p-8","space-y-2"],[1,"text-3xl",3,"icon"],[1,"text"],t,[3,"cluster","close"]]},template:function(e,t){if(1&e&&(l.YNc(0,ne,2,2,"ng-container",0),l.YNc(1,oe,4,2,"ng-template",null,1,l.W1O),l.YNc(3,se,1,1,"ng-template",null,2,l.W1O)),2&e){const e=l.MAs(2);l.Q6J("ngIf",t.cluster_list&&t.cluster_list.length)("ngIfElse",e)}},directives:[i.O5,i.sg,b.a8,b.dk,b.n5,b.dn,z,b.hq,x.lW,f.o,X],styles:["[_nghost-%COMP%]{display:flex;flex-wrap:wrap;height:100%;width:100%}"]}),e})();var ce=n(4762);function re(e,t){if(1&e&&(l.TgZ(0,"div",8),l.TgZ(1,"div",4),l._uU(2),l.qZA(),l.TgZ(3,"div",5),l._uU(4),l.qZA(),l.qZA()),2&e){const e=t.$implicit;l.xp6(2),l.Oqu(e.id),l.xp6(2),l.Oqu(e.name)}}function le(e,t){if(1&e&&(l.TgZ(0,"div",2),l.TgZ(1,"div",3),l.TgZ(2,"div",4),l._uU(3,"Repository"),l.qZA(),l.TgZ(4,"div",5),l._uU(5,"Commit Hash"),l.qZA(),l.qZA(),l.TgZ(6,"div",6),l.YNc(7,re,5,2,"div",7),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(7),l.Q6J("ngForOf",e.interfaces)}}function de(e,t){1&e&&(l.TgZ(0,"div",9),l._UZ(1,"app-icon",10),l.TgZ(2,"p"),l._uU(3,"No interfaces"),l.qZA(),l.qZA())}let ue=(()=>{class e{constructor(){this.interfaces=[]}ngOnInit(){this.loadInterfaces()}loadInterfaces(){return(0,ce.mG)(this,void 0,void 0,function*(){const e=yield(0,v.BmL)().toPromise();this.interfaces=Object.keys(e).map(t=>({id:t,name:e[t]}))})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-interfaces"]],decls:3,vars:2,consts:[["role","table",4,"ngIf","ngIfElse"],["load_state",""],["role","table"],["table-head",""],[1,"flex-1","p-2"],[1,"w-32","p-2"],["table-body",""],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"flex","flex-col","items-center","p-8"],["className","backoffice-cross",1,"mb-4"]],template:function(e,t){if(1&e&&(l.YNc(0,le,8,1,"div",0),l.YNc(1,de,4,0,"ng-template",null,1,l.W1O)),2&e){const e=l.MAs(2);l.Q6J("ngIf",t.interfaces&&t.interfaces.length)("ngIfElse",e)}},directives:[i.O5,i.sg,f.o],styles:["[_nghost-%COMP%]{padding:1rem;width:100%;height:100%}"]}),e})();var me=n(4415);const fe=function(){return{class:"backoffice-edit"}},ge=function(){return{class:"backoffice-trash"}};function pe(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",15),l.TgZ(1,"div",8),l._uU(2),l.qZA(),l.TgZ(3,"div",9),l._uU(4," "),l.SDv(5,16),l._uU(6," "),l.qZA(),l.TgZ(7,"div",10),l._uU(8),l.qZA(),l.TgZ(9,"div",11),l._uU(10),l.qZA(),l.TgZ(11,"div",12),l._uU(12),l.qZA(),l.TgZ(13,"div",12),l._uU(14," "),l.SDv(15,17),l._uU(16," "),l.qZA(),l.TgZ(17,"div",8),l._uU(18),l.ALo(19,"json"),l.qZA(),l.TgZ(20,"div",18),l.TgZ(21,"button",19),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw(2).editBroker(t)}),l._UZ(22,"app-icon",20),l.qZA(),l.TgZ(23,"button",19),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw(2).deleteBroker(t)}),l._UZ(24,"app-icon",20),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit;l.xp6(2),l.Oqu(e.name),l.xp6(3),l.pQV(e.auth_type),l.QtT(5),l.xp6(3),l.Oqu(e.description),l.xp6(2),l.Oqu(e.host),l.xp6(2),l.Oqu(e.port),l.xp6(3),l.pQV(e.tls),l.QtT(15),l.xp6(3),l.Oqu(l.lcZ(19,9,e.filters)),l.xp6(4),l.Q6J("icon",l.DdM(11,fe)),l.xp6(2),l.Q6J("icon",l.DdM(12,ge))}}function he(e,t){if(1&e&&(l.TgZ(0,"div",6),l.TgZ(1,"div",7),l.TgZ(2,"div",8),l._uU(3,"Name"),l.qZA(),l.TgZ(4,"div",9),l._uU(5,"Auth Type"),l.qZA(),l.TgZ(6,"div",10),l._uU(7,"Description"),l.qZA(),l.TgZ(8,"div",11),l._uU(9,"Host"),l.qZA(),l.TgZ(10,"div",12),l._uU(11,"Port"),l.qZA(),l.TgZ(12,"div",12),l._uU(13,"TLS"),l.qZA(),l.TgZ(14,"div",8),l._uU(15,"Filters"),l.qZA(),l._UZ(16,"div",9),l.qZA(),l.TgZ(17,"div",13),l.YNc(18,pe,25,13,"div",14),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(18),l.Q6J("ngForOf",e.brokers)}}function Ze(e,t){1&e&&(l.TgZ(0,"div",21),l.TgZ(1,"p"),l._uU(2,"No Brokers"),l.qZA(),l.qZA())}let ve=(()=>{class e extends c.K{constructor(e){super(),this._dialog=e,this.brokers=[]}ngOnInit(){this.loadBrokers()}newBroker(){const e=this._dialog.open(me.K,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new v.w4u,name:"Broker",save:e=>(0,v.z0G)(e)}});this.subscription("modal_events",e.componentInstance.event.subscribe(e=>{"done"===e.reason&&this.loadBrokers()}))}editBroker(e){const t=this._dialog.open(me.K,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:e,name:"Broker",save:e=>(0,v.VTA)(e.id,e)}});this.subscription("modal_events",t.componentInstance.event.subscribe(e=>{"done"===e.reason&&this.loadBrokers()}))}deleteBroker(e){return(0,ce.mG)(this,void 0,void 0,function*(){if(e){const t=yield(0,N._5)({title:"Delete MQTT Broker",content:"<p>Are you sure you want delete this boker?</p><p>The broker will be deleted <strong>immediately.</strong></p>",icon:{type:"icon",class:"backoffice-trash"}},this._dialog);if(!t)return;t.loading("Deleting broker...");const n=yield(0,v.bws)(e.id).toPromise().catch(e=>e);if(t.close(),n)return(0,Z.cB)(`Error deleting broker. Error: ${JSON.stringify(n.response||n.message||n)}`);(0,Z.t5)(`Successfully deleted broker "${e.name}".`),this.loadBrokers()}})}loadBrokers(){return(0,ce.mG)(this,void 0,void 0,function*(){const e=yield(0,v.zOf)().pipe((0,P.U)(e=>e.data)).toPromise();this.brokers=e})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(I.uw))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-brokers"]],features:[l.qOj],decls:8,vars:2,consts:function(){let e,t;return e=$localize`:␟9990049c96aa81b92ea2ee99bbb20dd3e04a25bd␟4018450922546786571:{VAR_SELECT, select, 0 {Certificate } , 2 {User
                        Password } , other {No Auth }}`,e=l.Zx4(e,{VAR_SELECT:"\ufffd0\ufffd"}),t=$localize`:␟9a505795a50d2999edad754aef444307458115f7␟8318225782441593222:{VAR_SELECT, select, true {Yes } , false {No }}`,t=l.Zx4(t,{VAR_SELECT:"\ufffd0\ufffd"}),[["mat-button","",1,"my-4",3,"click"],[1,"flex","items-center"],["className","backoffice-plus"],[1,"text"],["role","table",4,"ngIf","ngIfElse"],["load_state",""],["role","table"],["table-head",""],[1,"w-32","p-2"],[1,"w-24","p-2"],[1,"flex-1","p-2"],[1,"w-32","p-2","truncate"],[1,"w-16","p-2"],["table-body",""],["table-row","",4,"ngFor","ngForOf"],["table-row",""],e,t,[1,"w-24","p-2","flex","items-center"],["mat-icon-button","",3,"click"],[3,"icon"],[1,"flex","flex-col","items-center"]]},template:function(e,t){if(1&e&&(l.TgZ(0,"button",0),l.NdJ("click",function(){return t.newBroker()}),l.TgZ(1,"div",1),l._UZ(2,"app-icon",2),l.TgZ(3,"div",3),l._uU(4,"Add Broker"),l.qZA(),l.qZA(),l.qZA(),l.YNc(5,he,19,1,"div",4),l.YNc(6,Ze,3,0,"ng-template",null,5,l.W1O)),2&e){const e=l.MAs(7);l.xp6(5),l.Q6J("ngIf",t.brokers&&t.brokers.length)("ngIfElse",e)}},directives:[x.lW,f.o,i.O5,i.sg],pipes:[i.Ts],styles:["[_nghost-%COMP%]{padding:1rem}"]}),e})();var _e=n(3511),be=n(3530),xe=n(1777),Ae=n(6283),qe=n(4786),Te=n(6756),ye=n(1522);const we=function(){return{type:"icon",class:"backoffice-cross"}};function ke(e,t){1&e&&(l.TgZ(0,"button",5),l._UZ(1,"app-icon",6),l.qZA()),2&e&&(l.xp6(1),l.Q6J("icon",l.DdM(1,we)))}function Ue(e,t){if(1&e&&(l.TgZ(0,"mat-option",26),l.TgZ(1,"span",27),l._uU(2),l.qZA(),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e),l.xp6(2),l.Oqu(e)}}function Oe(e,t){1&e&&(l.TgZ(0,"label"),l._uU(1,"Conditions"),l.qZA())}function Ne(e,t){if(1&e&&(l.TgZ(0,"mat-option",26),l.TgZ(1,"span",27),l._uU(2),l.qZA(),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e),l.xp6(2),l.Oqu(e)}}const Ie=function(){return{standalone:!0}},Ce=function(){return{class:"backoffice-cross"}};function Je(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",8),l.TgZ(1,"div",9),l.TgZ(2,"mat-form-field",12),l.TgZ(3,"input",28),l.NdJ("ngModelChange",function(e){return t.$implicit[0]=e}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(4,"div",9),l.TgZ(5,"mat-form-field",12),l.TgZ(6,"mat-select",29),l.NdJ("ngModelChange",function(e){return t.$implicit[1]=e}),l.YNc(7,Ne,3,2,"mat-option",14),l.qZA(),l.qZA(),l.qZA(),l.TgZ(8,"div",9),l.TgZ(9,"mat-form-field",12),l.TgZ(10,"input",30),l.NdJ("ngModelChange",function(e){return t.$implicit[2]=e}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(11,"button",31),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw(2).removeCondition(t)}),l._UZ(12,"app-icon",6),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit,n=l.oxw(2);l.xp6(3),l.Q6J("ngModel",e[0])("ngModelOptions",l.DdM(9,Ie)),l.xp6(3),l.Q6J("ngModel",e[1])("ngModelOptions",l.DdM(10,Ie)),l.xp6(1),l.Q6J("ngForOf",n.condition_ops),l.xp6(3),l.Q6J("disabled","truthy"===e[1]||"falsy"===e[1])("ngModel",e[2])("ngModelOptions",l.DdM(11,Ie)),l.xp6(2),l.Q6J("icon",l.DdM(12,Ce))}}function Me(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",7),l.TgZ(1,"div",8),l.TgZ(2,"div",9),l.TgZ(3,"label",10),l.tHW(4,11),l._UZ(5,"span"),l.N_p(),l.qZA(),l.TgZ(6,"mat-form-field",12),l.TgZ(7,"mat-select",13),l.YNc(8,Ue,3,2,"mat-option",14),l.qZA(),l.qZA(),l.qZA(),l.TgZ(9,"div",9),l.TgZ(10,"label",15),l.tHW(11,16),l._UZ(12,"span"),l.N_p(),l.qZA(),l.TgZ(13,"mat-form-field",12),l._UZ(14,"input",17),l.TgZ(15,"mat-error"),l.SDv(16,18),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(17,"div",9),l.TgZ(18,"label",19),l.tHW(19,20),l._UZ(20,"span"),l.N_p(),l.qZA(),l.TgZ(21,"mat-form-field",12),l._UZ(22,"input",21),l.TgZ(23,"mat-error"),l.SDv(24,22),l.qZA(),l.qZA(),l.qZA(),l.TgZ(25,"div",23),l.YNc(26,Oe,2,0,"label",3),l.YNc(27,Je,13,13,"div",24),l.TgZ(28,"button",25),l.NdJ("click",function(){return l.CHM(e),l.oxw().addCondition()}),l._uU(29,"Add Condition"),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=l.oxw();l.Q6J("formGroup",e.form),l.xp6(8),l.Q6J("ngForOf",e.available_types),l.xp6(18),l.Q6J("ngIf",null==e.form.controls.conditions.value?null:e.form.controls.conditions.value.length),l.xp6(1),l.Q6J("ngForOf",e.form.controls.conditions.value)}}function Qe(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"mat-dialog-actions"),l.TgZ(1,"button",32),l._uU(2,"Cancel"),l.qZA(),l.TgZ(3,"button",33),l.NdJ("click",function(){return l.CHM(e),l.oxw().submit()}),l._uU(4),l.qZA(),l.qZA()}if(2&e){const e=l.oxw();l.xp6(4),l.hij("",e.item?"Save":"Add"," [S]")}}function Ee(e,t){1&e&&(l.TgZ(0,"div",34),l.TgZ(1,"div",35),l.TgZ(2,"div",36),l._UZ(3,"mat-spinner",37),l.qZA(),l.TgZ(4,"div",38),l._uU(5,"Processing request..."),l.qZA(),l.qZA(),l.qZA())}let Pe=(()=>{class e extends c.K{constructor(e,t){super(),this._data=e,this._hotkey=t,this.event=new l.vpe,this.available_types=["admin","systems","modules","zones","drivers","repositories","triggers","users","domains"],this.condition_ops=["includes","equals","truthy","falsy"],this.item=this._data.item,this.loading=!1}ngOnInit(){var e,t,n,i;this.subscription("save",this._hotkey.listen(["KeyS"],()=>this.submit())),this.form=new o.cw({type:new o.NI((null===(e=this.item)||void 0===e?void 0:e.type)||"systems",[o.kI.required]),name:new o.NI((null===(t=this.item)||void 0===t?void 0:t.name)||"",[o.kI.required]),url:new o.NI((null===(n=this.item)||void 0===n?void 0:n.url)||"",[o.kI.required]),conditions:new o.NI((null===(i=this.item)||void 0===i?void 0:i.conditions)||[])})}addCondition(){this.form.controls.conditions.value.push(["","",""])}removeCondition(e){this.form.controls.conditions.setValue(this.form.controls.conditions.value.filter(t=>t!==e))}submit(){if(this.form.markAllAsTouched(),!this.form.valid)return;const e=this.form.value;e.conditions=e.conditions.filter(e=>e[0]&&e[1]),this.event.emit({reason:"done",metadata:e})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(I.WI),l.Y36(xe.t))},e.\u0275cmp=l.Xpm({type:e,selectors:[["extension-modal"]],outputs:{event:"event"},features:[l.qOj],decls:9,vars:5,consts:function(){let e,t,n,i,o,s,a,c,r;return e=$localize`:@@typeLabel␟bf3a1deab2bcaeddfcfd7782ed54db830840d950␟5706127539532094818:Type${"\ufffd#5\ufffd"}:START_TAG_SPAN:*${"\ufffd/#5\ufffd"}:CLOSE_TAG_SPAN:: `,t=$localize`:@@nameLabel␟a6b516b2a07891bc316fc0d40fd572bc7ec46f3e␟346892941642015871:Name${"\ufffd#12\ufffd"}:START_TAG_SPAN:*${"\ufffd/#12\ufffd"}:CLOSE_TAG_SPAN:: `,n=$localize`:@@extensionNamePlaceholder␟d4a3634b658f6ac93604e3078106d79a140b8f7a␟6487826043722252959:Extension Display Name`,i=$localize`:@@nameError␟7a48e7a68431ebbfa25cde40585dd405e42cd1db␟7513538297502205849:A valid name is required`,o=$localize`:@@urlLabel␟7ee18d2358331fdb6eec3d6c2b1f3f4a7a50ec76␟4688120902984071927:URL${"\ufffd#20\ufffd"}:START_TAG_SPAN:*${"\ufffd/#20\ufffd"}:CLOSE_TAG_SPAN:: `,s=$localize`:@@extensionUrlPlaceholder␟1cfc829fdf84ddffc5a47a8938119b912fd251a4␟4436431142729435103:Extension URL`,a=$localize`:@@urlError␟2456d09bc2a34c4c067354efdb9c5783efe6e0b7␟4193103363836374269:A valid URL is required`,c=$localize`:@@conditionPlaceholder␟f545fbb6b587caa70ce7d42cdbb1077844b6d749␟6760598080948557972:Condition Field`,r=$localize`:@@conditionValuePlaceholder␟81bcdbb856d39d2d033c153b3953bb340e883efd␟1069058670263181644:Condition Value`,[["mat-dialog-title",""],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],["class","body",3,"formGroup",4,"ngIf","ngIfElse"],[4,"ngIf"],["load_state",""],["mat-icon-button","","mat-dialog-close",""],[3,"icon"],[1,"body",3,"formGroup"],[1,"fieldset"],[1,"field"],["for","type"],e,["appearance","outline"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],["for","name"],t,["matInput","","name","name","placeholder",n,"formControlName","name"],i,["for","url"],o,["matInput","","name","url","placeholder",s,"formControlName","url"],a,[1,"w-full"],["class","fieldset",4,"ngFor","ngForOf"],["mat-button","",1,"w-full",3,"click"],[3,"value"],[1,"capitalize"],["matInput","","name","url","placeholder",c,3,"ngModel","ngModelOptions","ngModelChange"],["placeholder","Operation",3,"ngModel","ngModelOptions","ngModelChange"],["matInput","","name","value","placeholder",r,3,"disabled","ngModel","ngModelOptions","ngModelChange"],["mat-icon-button","",3,"click"],["mat-button","","mat-dialog-close","",1,"inverse"],["mat-button","","type","submit",3,"click"],[1,"body"],[1,"info-block"],[1,"icon"],["diameter","32"],[1,"text"]]},template:function(e,t){if(1&e&&(l.TgZ(0,"header"),l.TgZ(1,"h3",0),l._uU(2),l.qZA(),l.YNc(3,ke,2,2,"button",1),l.qZA(),l.TgZ(4,"mat-dialog-content"),l.YNc(5,Me,30,4,"div",2),l.qZA(),l.YNc(6,Qe,5,1,"mat-dialog-actions",3),l.YNc(7,Ee,6,0,"ng-template",null,4,l.W1O)),2&e){const e=l.MAs(8);l.xp6(2),l.hij("",t.item?"Edit":"New"," Extension"),l.xp6(1),l.Q6J("ngIf",!t.loading),l.xp6(2),l.Q6J("ngIf",t.form&&!t.loading)("ngIfElse",e),l.xp6(1),l.Q6J("ngIf",!t.loading)}},directives:[I.uh,i.O5,I.xY,x.lW,I.ZT,f.o,o.JL,o.sg,Ae.KE,qe.gD,o.JJ,o.u,i.sg,Te.Nt,o.Fj,Ae.TO,ye.ey,o.On,I.H8,A.$g],styles:[".body[_ngcontent-%COMP%]{flex-direction:column;padding:1em;width:32rem;max-width:calc(100vw - 2rem)}.body[_ngcontent-%COMP%], .icon[_ngcontent-%COMP%]{display:flex;align-items:center}.icon[_ngcontent-%COMP%]{height:1.2em;width:1.2em;justify-content:center;font-size:2em}.content[_ngcontent-%COMP%]{width:16rem;text-align:center;font-size:.8em}.info-block[_ngcontent-%COMP%]{margin:2em 6em}.capitalize[_ngcontent-%COMP%]{text-transform:capitalize}.fieldset[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%}.fieldset[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{width:auto;flex:1;min-width:25%;margin:0 .25em}@media screen and (max-width:720px){.fieldset[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{min-width:20em;margin:0}}.fieldset[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]:first-child{margin-left:0}.fieldset[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]:last-child{margin-right:0}.fieldset[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:.5rem}.field[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;min-width:50%;width:100%}.field[_ngcontent-%COMP%]   div.error[_ngcontent-%COMP%]{position:absolute;bottom:.5em;left:1em;color:var(--error);font-size:.7em;font-weight:500}label[_ngcontent-%COMP%]{font-size:.8em;font-weight:500;margin:.5em 0}label.error[_ngcontent-%COMP%]{color:var(--error)}label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--pending)}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:8em}"]}),e})();const Se=["app-extensions",""];function Fe(e,t){if(1&e&&(l.TgZ(0,"mat-option",17),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e),l.xp6(1),l.hij(" ",e.name," ")}}const $e=function(){return{class:"backoffice-edit"}},Ye=function(){return{class:"backoffice-trash"}};function je(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",18),l.TgZ(1,"div",19),l._uU(2),l.qZA(),l.TgZ(3,"div",12),l._uU(4),l.qZA(),l.TgZ(5,"div",13),l._uU(6),l.qZA(),l.TgZ(7,"div",14),l._uU(8),l.qZA(),l.TgZ(9,"div",20),l.TgZ(10,"button",21),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw(2).editExtension(t)}),l._UZ(11,"app-icon",22),l.qZA(),l.TgZ(12,"button",21),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw(2).removeExtension(t)}),l._UZ(13,"app-icon",22),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit;l.xp6(2),l.hij(" ",e.type," "),l.xp6(2),l.Oqu(e.name),l.xp6(2),l.Oqu(e.url),l.xp6(2),l.hij(" ",e.conditions.length," "),l.xp6(3),l.Q6J("icon",l.DdM(6,$e)),l.xp6(2),l.Q6J("icon",l.DdM(7,Ye))}}function De(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div"),l.TgZ(1,"div",3),l.TgZ(2,"label",4),l._uU(3,"Domain: "),l.qZA(),l.TgZ(4,"mat-form-field",5),l.TgZ(5,"mat-select",6),l.NdJ("ngModelChange",function(t){return l.CHM(e),l.oxw().domain=t})("ngModelChange",function(t){return l.CHM(e),l.oxw().setDomain(t)}),l.YNc(6,Fe,2,2,"mat-option",7),l.qZA(),l.qZA(),l.TgZ(7,"button",8),l.NdJ("click",function(){return l.CHM(e),l.oxw().editExtension()}),l._uU(8," Add Extension "),l.qZA(),l.qZA(),l.TgZ(9,"div",9),l.TgZ(10,"div",10),l.TgZ(11,"div",11),l._uU(12,"Type"),l.qZA(),l.TgZ(13,"div",12),l._uU(14,"Name"),l.qZA(),l.TgZ(15,"div",13),l._uU(16,"URL"),l.qZA(),l.TgZ(17,"div",14),l._uU(18,"Conditions"),l.qZA(),l._UZ(19,"div",11),l.qZA(),l.TgZ(20,"div",15),l.YNc(21,je,14,8,"div",16),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=l.oxw();l.xp6(5),l.Q6J("ngModel",e.domain),l.xp6(1),l.Q6J("ngForOf",e.domain_list),l.xp6(15),l.Q6J("ngForOf",e.extension_list)}}function Le(e,t){if(1&e&&(l.TgZ(0,"div",23),l.TgZ(1,"div",24),l._UZ(2,"mat-spinner",25),l.qZA(),l.TgZ(3,"div",26),l._uU(4),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(2),l.Q6J("diameter",32),l.xp6(2),l.Oqu(e.loading)}}let ze=(()=>{class e{constructor(e){this._dialog=e,this.loading="",this.extension_list=[]}ngOnInit(){return(0,ce.mG)(this,void 0,void 0,function*(){this.loading="Loading domains...",this.domain_list=yield(0,v.R2s)().pipe((0,P.U)(e=>e.data)).toPromise(),this.setDomain(this.domain_list[0]),this.loading=""})}setDomain(e){var t,n;this.domain=e;const i=(null===(n=null===(t=this.domain.config)||void 0===t?void 0:t.backoffice)||void 0===n?void 0:n.extend)||{},o=[];for(const s in i)if(i[s])for(const e in i[s])i[s][e]&&o.push(Object.assign(Object.assign({},i[s][e]),{name:e,type:s}));this.extension_list=o,this.extension_list.sort((e,t)=>e.type.localeCompare(t.type)||e.name.localeCompare(t.name))}editExtension(e){const t=this._dialog.open(Pe,{data:{item:e?JSON.parse(JSON.stringify(e)):void 0}});t.componentInstance.event.pipe((0,be.P)(e=>"done"===e.reason)).subscribe(n=>(0,ce.mG)(this,void 0,void 0,function*(){t.componentInstance.loading=!0,e&&(this.extension_list=this.extension_list.filter(t=>t!==e)),this.extension_list.push(n.metadata),yield this.updateDomain(),t.componentInstance.loading=!1,t.close()}))}removeExtension(e){return(0,ce.mG)(this,void 0,void 0,function*(){const t=this._dialog.open(H.z,{data:{title:"Remove extension",content:`Are you sure you want to remove the extension "${e.name}" from ${e.type}?`,icon:{class:"backoffice-trash"}}});t.componentInstance.event.pipe((0,be.P)(e=>"done"===e.reason)).subscribe(n=>(0,ce.mG)(this,void 0,void 0,function*(){t.componentInstance.loading="Removing extension...",this.extension_list=this.extension_list.filter(t=>t!==e),yield this.updateDomain().catch(e=>(0,Z.cB)(`Error removing extension: ${e}`)),t.componentInstance.loading="",t.close()}))})}updateDomain(){return(0,ce.mG)(this,void 0,void 0,function*(){const e={};for(const i of this.extension_list){e[i.type]||(e[i.type]={});const t=Object.assign({},i);delete t.type,delete t.name,e[i.type][i.name]=t}const t=new v.OeX(Object.assign(Object.assign({},this.domain),{config:Object.assign(Object.assign({},this.domain.config),{backoffice:Object.assign(Object.assign({},this.domain.config.backoffice||{}),{extend:e})})})),n=yield(0,v.gKz)(this.domain.id,t).toPromise();this.setDomain(n)})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(I.uw))},e.\u0275cmp=l.Xpm({type:e,selectors:[["","app-extensions",""]],attrs:Se,decls:5,vars:2,consts:[[1,"text-lg","font-medium","mb-4"],[4,"ngIf","ngIfElse"],["load_state",""],[1,"flex","items-center","space-x-2","mb-4"],["for","type"],["appearance","outline",1,"h-12"],["name","type","placeholder","Select Domain...",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["mat-button","",3,"click"],["role","table"],["table-head",""],[1,"w-24","p-2"],[1,"w-40","p-2"],[1,"flex-1","p-2"],[1,"w-28","p-2"],["table-body",""],["table-row","",4,"ngFor","ngForOf"],[3,"value"],["table-row",""],[1,"w-24","p-2","capitalize"],[1,"w-24","flex","items-center","justify-center"],["mat-icon-button","",3,"click"],[3,"icon"],[1,"info-block"],[1,"icon"],[3,"diameter"],[1,"text"]],template:function(e,t){if(1&e&&(l.TgZ(0,"h2",0),l._uU(1,"Backoffice extensions"),l.qZA(),l.YNc(2,De,22,3,"div",1),l.YNc(3,Le,5,2,"ng-template",null,2,l.W1O)),2&e){const e=l.MAs(4);l.xp6(2),l.Q6J("ngIf",!t.loading)("ngIfElse",e)}},directives:[i.O5,Ae.KE,qe.gD,o.JJ,o.On,i.sg,x.lW,ye.ey,f.o,A.$g],styles:["[_nghost-%COMP%]{padding:1rem;width:100%;height:100%}"]}),e})();var He=n(8512),Be=n(8303);function Ge(e,t){1&e&&(l.TgZ(0,"button",5),l._UZ(1,"app-icon",6),l.qZA())}function Ke(e,t){if(1&e&&l._UZ(0,"input",24),2&e){const e=l.oxw().$implicit,t=l.oxw(3);l.Q6J("formControlName",e.key)("placeholder",t.name_map[e.key]||e.key)}}function We(e,t){if(1&e&&l._UZ(0,"textarea",24),2&e){const e=l.oxw().$implicit,t=l.oxw(3);l.Q6J("formControlName",e.key)("placeholder",t.name_map[e.key]||e.key)}}function Re(e,t){if(1&e&&(l.TgZ(0,"div",19),l.TgZ(1,"label",20),l._uU(2),l.TgZ(3,"span"),l._uU(4,"*"),l.qZA(),l._uU(5,":"),l.qZA(),l.TgZ(6,"mat-form-field",10),l.ynx(7,21),l.YNc(8,Ke,1,2,"input",22),l.YNc(9,We,1,2,"textarea",23),l.BQk(),l.TgZ(10,"mat-error"),l._uU(11),l.qZA(),l.qZA(),l.qZA()),2&e){const e=t.$implicit,n=l.oxw(3);l.xp6(2),l.Oqu(n.name_map[e.key]||e.key),l.xp6(5),l.Q6J("ngSwitch",e.key),l.xp6(2),l.Q6J("ngSwitchCase","signing_key"),l.xp6(2),l.hij("A ",e.key," is required")}}function Xe(e,t){if(1&e&&(l.TgZ(0,"form",17),l.YNc(1,Re,12,4,"div",18),l.ALo(2,"keyvalue"),l.qZA()),2&e){const e=l.oxw(2);l.Q6J("formGroup",e.credentials),l.xp6(1),l.Q6J("ngForOf",l.lcZ(2,2,e.credentials.controls))}}function Ve(e,t){if(1&e&&(l.TgZ(0,"main",7),l.TgZ(1,"div",8),l.TgZ(2,"div",9),l.TgZ(3,"label"),l._uU(4,"Name"),l.TgZ(5,"span"),l._uU(6,"*"),l.qZA(),l._uU(7,":"),l.qZA(),l.TgZ(8,"mat-form-field",10),l._UZ(9,"input",11),l.TgZ(10,"mat-error"),l._uU(11,"A tenant name is required"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(12,"div",9),l.TgZ(13,"label"),l._uU(14,"Conference Type:"),l.qZA(),l.TgZ(15,"mat-form-field",10),l._UZ(16,"input",12),l.qZA(),l.qZA(),l.TgZ(17,"div",9),l.TgZ(18,"label"),l._uU(19,"Platform"),l.TgZ(20,"span"),l._uU(21,"*"),l.qZA(),l._uU(22,":"),l.qZA(),l.TgZ(23,"mat-form-field",10),l.TgZ(24,"mat-select",13),l.TgZ(25,"mat-option",14),l._uU(26,"Google"),l.qZA(),l.TgZ(27,"mat-option",15),l._uU(28,"Office365"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.YNc(29,Xe,3,4,"form",16),l.qZA()),2&e){const e=l.oxw();l.Q6J("formGroup",e.form),l.xp6(29),l.Q6J("ngIf",e.credentials)}}function et(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"footer",25),l.TgZ(1,"button",26),l.NdJ("click",function(){return l.CHM(e),l.oxw().save()}),l._uU(2,"Save"),l.qZA(),l.qZA()}}function tt(e,t){1&e&&(l.TgZ(0,"main",27),l._UZ(1,"mat-spinner",28),l.TgZ(2,"p"),l._uU(3,"Saving staff API tenant..."),l.qZA(),l.qZA()),2&e&&(l.xp6(1),l.Q6J("diameter",48))}const nt={issuer:"Service Account Email",signing_key:"Private Key",sub:"Service User",client_id:"Client ID",client_secret:"Client Secret",domain:"Domain",scopes:"Scopes",user_agent:"User Agent"};let it=(()=>{class e{constructor(e,t){this._data=e,this._dialog_ref=t,this.event=new l.vpe,this.tenant=this._data.tenant,this.domain=this._data.domain,this.loading=!1,this.name_map=nt}get office_form(){var e,t,n,i,s,a;return new o.cw({tenant:new o.NI((null===(t=null===(e=this.tenant)||void 0===e?void 0:e.credentials)||void 0===t?void 0:t.tenant)||"",[o.kI.required]),client_id:new o.NI((null===(i=null===(n=this.tenant)||void 0===n?void 0:n.credentials)||void 0===i?void 0:i.client_id)||"",[o.kI.required]),client_secret:new o.NI((null===(a=null===(s=this.tenant)||void 0===s?void 0:s.credentials)||void 0===a?void 0:a.client_secret)||"",[o.kI.required])})}get google_form(){var e,t,n,i,s,a,c,r,l,d,u,m,f;return new o.cw({issuer:new o.NI((null===(t=null===(e=this.tenant)||void 0===e?void 0:e.credentials)||void 0===t?void 0:t.issue)||"",[o.kI.required]),signing_key:new o.NI((null===(i=null===(n=this.tenant)||void 0===n?void 0:n.credentials)||void 0===i?void 0:i.signing_key)||"",[o.kI.required]),scopes:new o.NI((null===(a=null===(s=this.tenant)||void 0===s?void 0:s.credentials)||void 0===a?void 0:a.scopes)||"",[o.kI.required]),domain:new o.NI((null===(r=null===(c=this.tenant)||void 0===c?void 0:c.credentials)||void 0===r?void 0:r.domain)||(null===(l=this._data.domain)||void 0===l?void 0:l.domain)||"",[o.kI.required]),sub:new o.NI((null===(u=null===(d=this.tenant)||void 0===d?void 0:d.credentials)||void 0===u?void 0:u.sub)||"",[o.kI.required]),user_agent:new o.NI((null===(f=null===(m=this.tenant)||void 0===m?void 0:m.credentials)||void 0===f?void 0:f.user_agent)||"PlaceOS",[o.kI.required])})}get credentials(){var e;return null===(e=this.form)||void 0===e?void 0:e.controls.credentials}ngOnInit(){var e,t,n,i,s;this.form=new o.cw({domain:new o.NI((null===(e=this.domain)||void 0===e?void 0:e.domain)||this.tenant.domain||"localhost"),name:new o.NI((null===(t=this.tenant)||void 0===t?void 0:t.name)||"",[o.kI.required]),platform:new o.NI((null===(n=this.tenant)||void 0===n?void 0:n.platform)||"google",[o.kI.required]),conference_type:new o.NI((null===(i=this.tenant)||void 0===i?void 0:i.conference_type)||""),credentials:"office365"===(null===(s=this.tenant)||void 0===s?void 0:s.platform)?this.office_form:this.google_form}),this.form.controls.platform.valueChanges.subscribe(e=>{this.form.removeControl("credentials"),this.form.addControl("credentials","office365"===e?this.office_form:this.google_form)})}save(){var e;return(0,ce.mG)(this,void 0,void 0,function*(){if(this.form.markAllAsTouched(),!this.form.valid)return;this._dialog_ref.disableClose=!0,this.loading=!0;const t=(null===(e=this.tenant)||void 0===e?void 0:e.id)?(0,v.gzd)(`/api/staff/v1/tenants/${this.tenant.id}`,Object.assign(Object.assign({},this.tenant||{}),this.form.value)):(0,v.v_Q)("/api/staff/v1/tenants",Object.assign(Object.assign({},this.tenant||{}),this.form.value)),n=yield t.toPromise().catch(e=>null);if(this.loading=!1,this._dialog_ref.disableClose=!1,!n)return(0,Z.cB)("Error adding new tenant.");(0,Z.t5)("Successfully added new tenant."),this._dialog_ref.close()})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(I.WI),l.Y36(I.so))},e.\u0275cmp=l.Xpm({type:e,selectors:[["staff-tenant-modal"]],outputs:{event:"event"},decls:9,vars:5,consts:[[1,"flex-1"],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],["class","overflow-auto",3,"formGroup",4,"ngIf","ngIfElse"],["class","p-2 border-t border-gray-200 flex justify-center",4,"ngIf"],["load_state",""],["mat-icon-button","","mat-dialog-close",""],["className","backoffice-cross"],[1,"overflow-auto",3,"formGroup"],[1,"flex","items-center","flex-wrap","space-x-0","sm:space-x-2"],[1,"flex","flex-col","flex-1"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Tenant Name"],["matInput","","formControlName","conference_type","placeholder","Conference Type"],["formControlName","platform"],["value","google"],["value","office365"],[3,"formGroup",4,"ngIf"],[3,"formGroup"],["class","flex flex-col",4,"ngFor","ngForOf"],[1,"flex","flex-col"],[1,"capitalize"],[3,"ngSwitch"],["matInput","",3,"formControlName","placeholder",4,"ngSwitchDefault"],["matInput","",3,"formControlName","placeholder",4,"ngSwitchCase"],["matInput","",3,"formControlName","placeholder"],[1,"p-2","border-t","border-gray-200","flex","justify-center"],["mat-button","",3,"click"],[1,"flex","flex-col","p-8","items-center","justify-center"],[1,"mb-4",3,"diameter"]],template:function(e,t){if(1&e&&(l.TgZ(0,"header"),l.TgZ(1,"h3"),l._uU(2),l.qZA(),l._UZ(3,"div",0),l.YNc(4,Ge,2,0,"button",1),l.qZA(),l.YNc(5,Ve,30,2,"main",2),l.YNc(6,et,3,0,"footer",3),l.YNc(7,tt,4,1,"ng-template",null,4,l.W1O)),2&e){const e=l.MAs(8);l.xp6(2),l.hij("",t.tenant?"Edit":"New"," Tenant"),l.xp6(2),l.Q6J("ngIf",!t.loading),l.xp6(1),l.Q6J("ngIf",!t.loading)("ngIfElse",e),l.xp6(1),l.Q6J("ngIf",!t.loading)}},directives:[i.O5,x.lW,I.ZT,f.o,o.JL,o.sg,Ae.KE,Te.Nt,o.Fj,o.JJ,o.u,Ae.TO,qe.gD,ye.ey,o._Y,i.sg,i.RF,i.ED,i.n9,A.$g],pipes:[i.Nd],styles:["main[_ngcontent-%COMP%]{width:32rem;max-width:calc(100vw - 5rem);max-height:65vh}"]}),e})();function ot(e,t){if(1&e&&(l.TgZ(0,"mat-option",9),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e),l.xp6(1),l.hij(" ",e.name," ")}}function st(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",18),l.TgZ(1,"div",19),l._uU(2),l.qZA(),l.TgZ(3,"div",20),l._uU(4),l.qZA(),l.TgZ(5,"div",21),l.TgZ(6,"button",22),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw(3).editTenant(t)}),l._UZ(7,"app-icon",23),l.qZA(),l.TgZ(8,"button",22),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw(3).removeTenant(t)}),l._UZ(9,"app-icon",24),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit;l.xp6(2),l.Oqu(e.name),l.xp6(2),l.Oqu(e.platform)}}function at(e,t){if(1&e&&(l.TgZ(0,"div",11),l.TgZ(1,"div",12),l.TgZ(2,"div",13),l._uU(3,"Name"),l.qZA(),l.TgZ(4,"div",14),l._uU(5,"Platform"),l.qZA(),l._UZ(6,"div",15),l.qZA(),l.TgZ(7,"div",16),l.YNc(8,st,10,2,"div",17),l.ALo(9,"async"),l.qZA(),l.qZA()),2&e){const e=l.oxw(2);l.xp6(8),l.Q6J("ngForOf",l.lcZ(9,1,e.tenants))}}function ct(e,t){if(1&e&&(l.ynx(0),l.YNc(1,at,10,3,"div",10),l.ALo(2,"async"),l.BQk()),2&e){const e=l.oxw(),t=l.MAs(11);let n;l.xp6(1),l.Q6J("ngIf",null==(n=l.lcZ(2,2,e.tenants))?null:n.length)("ngIfElse",t)}}function rt(e,t){1&e&&(l.TgZ(0,"div",25),l.TgZ(1,"p"),l._uU(2,"No tenants for selected domain"),l.qZA(),l.qZA())}function lt(e,t){if(1&e&&(l.TgZ(0,"div",26),l._UZ(1,"mat-spinner",27),l.TgZ(2,"p"),l._uU(3),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(1),l.Q6J("diameter",48),l.xp6(2),l.Oqu(e.loading)}}let dt=(()=>{class e{constructor(e){this._dialog=e,this.loading="",this.domain=new He.X(null),this.tenants=this.domain.pipe((0,E.w)(()=>(this.loading="Loading tenants for domain...",(0,v.U2M)("/api/staff/v1/tenants"))),(0,S.K)(e=>[]),(0,P.U)(e=>(console.log("No Error"),this.loading="",e.filter(e=>e.domain===this.domain.getValue().domain))),(0,Be.d)())}ngOnInit(){return(0,ce.mG)(this,void 0,void 0,function*(){this.loading="Loading domains...",this.domain_list=yield(0,v.R2s)().pipe((0,P.U)(e=>e.data)).toPromise(),this.domain.next(this.domain_list[0]),this.loading=""})}editTenant(e){this._dialog.open(it,{data:{tenant:e,domain:this.domain.getValue()}}).afterClosed().subscribe(e=>this.domain.next(this.domain.getValue()))}removeTenant(e){return(0,ce.mG)(this,void 0,void 0,function*(){const t=yield(0,N._5)({title:"Remove tenant?",content:`Remove <strong>${e.name}</strong> from this domain?<br>You or your users may lose access to some data.`,icon:{type:"icon",class:"backoffice-trash"}},this._dialog);if(!t||!t.reason)return;t.loading("Removing tenant from domain...");const n=yield(0,v.IVX)(`/api/staff/v1/tenants/${e.id}`).toPromise().catch(t=>{(0,Z.cB)(`Error removing module ${e.id} from domain. Error: ${t.statusText||t.message||t}`)});t.close(),n&&((0,Z.t5)("Successfully removed tenant from domain."),this.domain.next(this.domain.getValue()))})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(I.uw))},e.\u0275cmp=l.Xpm({type:e,selectors:[["staff-api"]],decls:14,vars:6,consts:[[1,"flex","items-center","space-x-2","mb-4"],["for","type"],["appearance","outline",1,"h-12"],["name","type","placeholder","Select Domain...",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["mat-button","",3,"click"],[4,"ngIf","ngIfElse"],["empty_state",""],["load_state",""],[3,"value"],["class","w-full",4,"ngIf","ngIfElse"],[1,"w-full"],["table-head",""],[1,"w-1/2","p-2"],[1,"flex-1","p-2"],[1,"w-24","p-2","h-10"],["table-body",""],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"w-1/2","p-2","truncate"],[1,"flex-1","p-2","truncate"],[1,"w-24","px-2","flex","items-center","justify-end"],["mat-icon-button","",1,"h-10","w-10",3,"click"],["className","backoffice-edit"],["className","backoffice-trash"],[1,"flex","flex-col","items-center","justify-center"],[1,"w-full","flex","flex-col","items-center","justify-center"],[1,"mb-4",3,"diameter"]],template:function(e,t){if(1&e&&(l.TgZ(0,"div",0),l.TgZ(1,"label",1),l._uU(2,"Domain: "),l.qZA(),l.TgZ(3,"mat-form-field",2),l.TgZ(4,"mat-select",3),l.NdJ("ngModelChange",function(e){return t.domain.next(e)}),l.ALo(5,"async"),l.YNc(6,ot,2,2,"mat-option",4),l.qZA(),l.qZA(),l.TgZ(7,"button",5),l.NdJ("click",function(){return t.editTenant()}),l._uU(8,"Add Tenant"),l.qZA(),l.qZA(),l.YNc(9,ct,3,4,"ng-container",6),l.YNc(10,rt,3,0,"ng-template",null,7,l.W1O),l.YNc(12,lt,4,2,"ng-template",null,8,l.W1O)),2&e){const e=l.MAs(13);l.xp6(4),l.Q6J("ngModel",l.lcZ(5,4,t.domain)),l.xp6(2),l.Q6J("ngForOf",t.domain_list),l.xp6(3),l.Q6J("ngIf",!t.loading)("ngIfElse",e)}},directives:[Ae.KE,qe.gD,o.JJ,o.On,i.sg,x.lW,i.O5,ye.ey,f.o,A.$g],pipes:[i.Ov],styles:["[_nghost-%COMP%]{position:relative;height:100%;width:100%;padding:1rem}"]}),e})();var ut=n(878);function mt(e,t){1&e&&(l.TgZ(0,"button",5),l._UZ(1,"app-icon",6),l.qZA())}function ft(e,t){if(1&e&&(l.TgZ(0,"main",7),l.TgZ(1,"div",8),l.TgZ(2,"label"),l._uU(3,"Name"),l.TgZ(4,"span"),l._uU(5,"*"),l.qZA(),l._uU(6,":"),l.qZA(),l.TgZ(7,"mat-form-field",9),l._UZ(8,"input",10),l.TgZ(9,"mat-error"),l._uU(10,"A edge name is required"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(11,"div",8),l.TgZ(12,"label"),l._uU(13,"Description:"),l.qZA(),l.TgZ(14,"mat-form-field",9),l._UZ(15,"textarea",11),l.qZA(),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.Q6J("formGroup",e.form)}}function gt(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"footer",12),l.TgZ(1,"button",13),l.NdJ("click",function(){return l.CHM(e),l.oxw().save()}),l._uU(2,"Save"),l.qZA(),l.qZA()}}function pt(e,t){1&e&&(l.TgZ(0,"main",14),l._UZ(1,"mat-spinner",15),l.TgZ(2,"p"),l._uU(3,"Saving edge..."),l.qZA(),l.qZA()),2&e&&(l.xp6(1),l.Q6J("diameter",48))}let ht=(()=>{class e{constructor(e,t){this._data=e,this._dialog_ref=t,this.event=new l.vpe,this.edge=this._data.edge,this.loading=!1}ngOnInit(){var e,t;this.form=new o.cw({name:new o.NI((null===(e=this.edge)||void 0===e?void 0:e.name)||"",[o.kI.required]),description:new o.NI((null===(t=this.edge)||void 0===t?void 0:t.description)||"")})}save(){return(0,ce.mG)(this,void 0,void 0,function*(){if(this.form.markAllAsTouched(),!this.form.valid)return;this._dialog_ref.disableClose=!0,this.loading=!0;const e=Object.assign(Object.assign({},this.edge),this.form.value),t=e.id?(0,v.sNt)(e.id,e):(0,v.Z_z)(e),n=yield t.toPromise().catch(e=>null);if(this.loading=!1,this._dialog_ref.disableClose=!1,!n)return(0,Z.cB)("Error adding new edge.");(0,Z.t5)("Successfully added new edge."),this._dialog_ref.close()})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(I.WI),l.Y36(I.so))},e.\u0275cmp=l.Xpm({type:e,selectors:[["edge-modal"]],outputs:{event:"event"},decls:9,vars:5,consts:[[1,"flex-1"],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],["class","overflow-auto",3,"formGroup",4,"ngIf","ngIfElse"],["class","p-2 border-t border-gray-200 flex justify-center",4,"ngIf"],["load_state",""],["mat-icon-button","","mat-dialog-close",""],["className","backoffice-cross"],[1,"overflow-auto",3,"formGroup"],[1,"flex","flex-col","flex-1"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Edge Name"],["matInput","","formControlName","description","placeholder","Edge description..."],[1,"p-2","border-t","border-gray-200","flex","justify-center"],["mat-button","",3,"click"],[1,"flex","flex-col","p-8","items-center","justify-center"],[1,"mb-4",3,"diameter"]],template:function(e,t){if(1&e&&(l.TgZ(0,"header"),l.TgZ(1,"h3"),l._uU(2),l.qZA(),l._UZ(3,"div",0),l.YNc(4,mt,2,0,"button",1),l.qZA(),l.YNc(5,ft,16,1,"main",2),l.YNc(6,gt,3,0,"footer",3),l.YNc(7,pt,4,1,"ng-template",null,4,l.W1O)),2&e){const e=l.MAs(8);l.xp6(2),l.hij("",t.edge?"Edit":"New"," Edge"),l.xp6(2),l.Q6J("ngIf",!t.loading),l.xp6(1),l.Q6J("ngIf",!t.loading&&t.form)("ngIfElse",e),l.xp6(1),l.Q6J("ngIf",!t.loading)}},directives:[i.O5,x.lW,I.ZT,f.o,o.JL,o.sg,Ae.KE,Te.Nt,o.Fj,o.JJ,o.u,Ae.TO,A.$g],styles:["main[_ngcontent-%COMP%]{width:32rem;max-width:calc(100vw - 5rem);max-height:65vh}"]}),e})();const Zt=["admin-edge",""];function vt(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",12),l.TgZ(1,"div",13),l._uU(2),l.qZA(),l.TgZ(3,"div",13),l._uU(4),l.qZA(),l.TgZ(5,"div",14),l._uU(6),l.qZA(),l.TgZ(7,"div",15),l.TgZ(8,"button",16),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw(3).token(t)}),l._UZ(9,"app-icon",17),l.qZA(),l.TgZ(10,"button",16),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw(3).edit(t)}),l._UZ(11,"app-icon",18),l.qZA(),l.TgZ(12,"button",16),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw(3).remove(t)}),l._UZ(13,"app-icon",19),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit;l.xp6(2),l.Oqu(e.id),l.xp6(2),l.Oqu(e.name),l.xp6(2),l.Oqu(e.description)}}function _t(e,t){if(1&e&&(l.TgZ(0,"div",5),l.TgZ(1,"div",6),l.TgZ(2,"div",7),l._uU(3,"id"),l.qZA(),l.TgZ(4,"div",7),l._uU(5,"Name"),l.qZA(),l.TgZ(6,"div",8),l._uU(7,"description"),l.qZA(),l._UZ(8,"div",9),l.qZA(),l.TgZ(9,"div",10),l.YNc(10,vt,14,3,"div",11),l.ALo(11,"async"),l.qZA(),l.qZA()),2&e){const e=l.oxw(2);l.xp6(10),l.Q6J("ngForOf",l.lcZ(11,1,e.edges))}}function bt(e,t){if(1&e&&(l.ynx(0),l.YNc(1,_t,12,3,"div",4),l.ALo(2,"async"),l.BQk()),2&e){const e=l.oxw(),t=l.MAs(4);let n;l.xp6(1),l.Q6J("ngIf",null==(n=l.lcZ(2,2,e.edges))?null:n.length)("ngIfElse",t)}}function xt(e,t){1&e&&(l.TgZ(0,"div",20),l.TgZ(1,"p"),l._uU(2,"No edges"),l.qZA(),l.qZA())}function At(e,t){if(1&e&&(l.TgZ(0,"div",21),l._UZ(1,"mat-spinner",22),l.TgZ(2,"p"),l._uU(3),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(1),l.Q6J("diameter",48),l.xp6(2),l.Oqu(e.loading)}}let qt=(()=>{class e{constructor(e){this._dialog=e,this.loading="",this._change=new He.X(!1),this.edges=this._change.pipe((0,E.w)(e=>(this.loading="Loading Edges...",(0,v.KQ8)())),(0,S.K)(e=>(0,ut.of)({})),(0,P.U)(e=>(this.loading="",(null==e?void 0:e.data)||[])),(0,Be.d)()),this.token=e=>(0,ce.mG)(this,void 0,void 0,function*(){const t=yield(0,v.HLJ)(e.id).toPromise();(0,N.vQ)(t.token),(0,Z.QD)("Token copied to clickboard.")}),this.edit=e=>(0,ce.mG)(this,void 0,void 0,function*(){return this._dialog.open(ht,{data:{edge:e}})}),this.remove=e=>(0,ce.mG)(this,void 0,void 0,function*(){const t=yield(0,N._5)({title:"Remove edge?",content:`Remove <strong>${e.name}</strong>?<br>You or your users may lose access to some data.`,icon:{type:"icon",class:"backoffice-trash"}},this._dialog);if(!t)return;t.loading("Removing edge...");const n=yield(0,v.eAF)(e.id).toPromise().catch(e=>e);if(t.close(),n)return(0,Z.cB)(`Error removing edge. Error: ${n.statusText||n.message||n}`);(0,Z.t5)("Successfully removed Edge."),this._change.next(!this._change.getValue())})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(I.uw))},e.\u0275cmp=l.Xpm({type:e,selectors:[["","admin-edge",""]],attrs:Zt,decls:7,vars:2,consts:[["mat-button","",1,"w-full","sm:w-32","mb-4",3,"click"],[4,"ngIf","ngIfElse"],["empty_state",""],["load_state",""],["class","w-full",4,"ngIf","ngIfElse"],[1,"w-full"],["table-head",""],[1,"w-32","p-2"],[1,"flex-1","p-2"],[1,"w-32","p-2","h-10"],["table-body",""],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"w-32","p-2","truncate"],[1,"flex-1","p-2","truncate"],[1,"w-32","px-2","flex","items-center","justify-end"],["mat-icon-button","",1,"h-10","w-10",3,"click"],["className","backoffice-key"],["className","backoffice-edit"],["className","backoffice-trash"],[1,"flex","flex-col","items-center","justify-center"],[1,"w-full","flex","flex-col","items-center","justify-center"],[1,"mb-4",3,"diameter"]],template:function(e,t){if(1&e&&(l.TgZ(0,"button",0),l.NdJ("click",function(){return t.edit()}),l._uU(1,"Add New Edge"),l.qZA(),l.YNc(2,bt,3,4,"ng-container",1),l.YNc(3,xt,3,0,"ng-template",null,2,l.W1O),l.YNc(5,At,4,2,"ng-template",null,3,l.W1O)),2&e){const e=l.MAs(6);l.xp6(2),l.Q6J("ngIf",!t.loading)("ngIfElse",e)}},directives:[x.lW,i.O5,i.sg,f.o,A.$g],pipes:[i.Ov],styles:["[_nghost-%COMP%]{padding:1rem;height:100%;width:100%;min-height:10rem}"]}),e})();var Tt=n(7486),yt=n(6402);function wt(e,t){if(1&e&&(l.TgZ(0,"mat-option",13),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e),l.xp6(1),l.hij(" ",e.name," ")}}function kt(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",14),l.TgZ(1,"div",1),l.TgZ(2,"label",2),l._uU(3,"Schema Name: "),l.qZA(),l.TgZ(4,"mat-form-field",3),l.TgZ(5,"input",15),l.NdJ("ngModelChange",function(t){return l.CHM(e),l.oxw().schema_copy.name=t}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(6,"button",8),l.NdJ("click",function(){return l.CHM(e),l.oxw().saveSchema()}),l._uU(7," Save Schema "),l.qZA(),l.qZA()}if(2&e){const e=l.oxw();l.xp6(5),l.Q6J("ngModel",e.schema_copy.name)}}function Ut(e,t){if(1&e){const e=l.EpF();l.ynx(0),l.TgZ(1,"settings-form-field",16),l.NdJ("ngModelChange",function(t){return l.CHM(e),l.oxw().schema_copy.schema=t}),l.qZA(),l.BQk()}if(2&e){const e=l.oxw();l.xp6(1),l.Q6J("ngModel",e.schema_copy.schema)("readonly",!1)}}function Ot(e,t){1&e&&(l.TgZ(0,"div",17),l.TgZ(1,"p",18),l._uU(2,"Select a schema to edit"),l.qZA(),l.qZA())}let Nt=(()=>{class e{constructor(e){this._state=e,this.schema_list=this._state.schemas.pipe((0,Be.d)(1))}copySchema(){this.active_schema&&(this.schema_copy=JSON.parse(JSON.stringify(this.active_schema)))}newSchema(){return(0,ce.mG)(this,void 0,void 0,function*(){this.active_schema={name:"New Schema",schema:"{}"},this.copySchema()})}saveSchema(){this._state.saveSchema(this.schema_copy),this.active_schema=null,this.schema_copy=null}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(Tt.O))},e.\u0275cmp=l.Xpm({type:e,selectors:[["admin-schemas"]],decls:18,vars:7,consts:[[1,"flex","items-center","space-x-2","my-4"],[1,"flex","flex-col"],["for","type"],["appearance","outline",1,"h-12"],["name","type","placeholder","Select Schema...",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"click"],[1,"italic","font-sans"],["mat-button","",1,"mt-6",3,"click"],["class","flex items-center space-x-2 mb-4",4,"ngIf"],[1,"relative","flex-1","h-1/2"],[4,"ngIf","ngIfElse"],["empty_state",""],[3,"value"],[1,"flex","items-center","space-x-2","mb-4"],["matInput","",3,"ngModel","ngModelChange"],["lang","json",3,"ngModel","readonly","ngModelChange"],[1,"absolute","inset-0","flex","items-center","justify-center"],[1,"p-8"]],template:function(e,t){if(1&e&&(l.TgZ(0,"div",0),l.TgZ(1,"div",1),l.TgZ(2,"label",2),l._uU(3,"Schema: "),l.qZA(),l.TgZ(4,"mat-form-field",3),l.TgZ(5,"mat-select",4),l.NdJ("ngModelChange",function(e){return t.active_schema=e})("ngModelChange",function(){return t.copySchema()}),l.YNc(6,wt,2,2,"mat-option",5),l.ALo(7,"async"),l.TgZ(8,"mat-option",6),l.NdJ("click",function(e){return t.newSchema(),e.preventDefault()}),l.TgZ(9,"span",7),l._uU(10,"New Schema"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(11,"button",8),l.NdJ("click",function(){return t.newSchema()}),l._uU(12," Add Schema "),l.qZA(),l.qZA(),l.YNc(13,kt,8,1,"div",9),l.TgZ(14,"div",10),l.YNc(15,Ut,2,2,"ng-container",11),l.qZA(),l.YNc(16,Ot,3,0,"ng-template",null,12,l.W1O)),2&e){const e=l.MAs(17);l.xp6(5),l.Q6J("ngModel",t.active_schema),l.xp6(1),l.Q6J("ngForOf",l.lcZ(7,5,t.schema_list)),l.xp6(7),l.Q6J("ngIf",t.schema_copy),l.xp6(2),l.Q6J("ngIf",t.schema_copy)("ngIfElse",e)}},directives:[Ae.KE,qe.gD,o.JJ,o.On,i.sg,ye.ey,x.lW,i.O5,Te.Nt,o.Fj,yt.x],pipes:[i.Ov],styles:["[_nghost-%COMP%]{position:absolute;top:0;left:1rem;right:1rem;bottom:0;display:flex;flex-direction:column}"]}),e})();var It=n(611),Ct=n(3080),Jt=n(5090),Mt=n(6280);function Qt(e){(0,Mt.Z)(1,arguments);var t=(0,Jt.Z)(e),n=t.getTime();return n}function Et(e){return(0,Mt.Z)(1,arguments),Math.floor(Qt(e)/1e3)}class Pt{constructor(e){this.id=e.id||"",this.name=e.name||"",this.user_id=e.user_id||"",this.authority_id=e.authority_id||"",this.description=e.description||"",this.permissions=e.permissions||"user",this.created_at=e.created_at||Et(new Date),this.updated_at=e.updated_at||Et(new Date),this.secret=e.secret,this.scopes=e.scopes||[]}}var St=n(5842),Ft=n(4530),$t=n(33),Yt=n(4468),jt=n(8055);const Dt=["input"];function Lt(e,t){1&e&&(l.TgZ(0,"button",5),l._UZ(1,"app-icon",6),l.qZA())}function zt(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"mat-chip",31),l.NdJ("removed",function(){l.CHM(e);const t=l.oxw(2);return t.removeScope(t.tag)}),l._uU(1),l._UZ(2,"app-icon",32),l.qZA()}if(2&e){const e=t.$implicit;l.Q6J("selectable",!0)("removable",!0),l.xp6(1),l.hij(" ",e," ")}}function Ht(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"button",33),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw(2).form.patchValue({user_id:t.id})}),l.ALo(1,"async"),l._uU(2),l.qZA()}if(2&e){const e=t.$implicit,n=l.oxw(2);let i;l.ekj("text-primary",(null==(i=l.lcZ(1,3,n.active_user))?null:i.id)===e.id),l.xp6(2),l.hij(" ",e.name," ")}}const Bt=function(){return{standalone:!0}};function Gt(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"main",7),l.TgZ(1,"div",8),l.TgZ(2,"label",9),l._uU(3,"Name"),l.qZA(),l.TgZ(4,"mat-form-field",10),l._UZ(5,"input",11),l.qZA(),l.qZA(),l.TgZ(6,"div",8),l.TgZ(7,"label",9),l._uU(8,"Description"),l.qZA(),l.TgZ(9,"mat-form-field",10),l._UZ(10,"textarea",12),l.qZA(),l.qZA(),l.TgZ(11,"div",8),l.TgZ(12,"label",13),l._uU(13,"Scopes"),l.qZA(),l.TgZ(14,"mat-form-field",10),l.TgZ(15,"mat-chip-list",14,15),l.YNc(17,zt,3,3,"mat-chip",16),l.TgZ(18,"input",17),l.NdJ("matChipInputTokenEnd",function(t){return l.CHM(e),l.oxw().addScope(t)}),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(19,"div",8),l.TgZ(20,"label",18),l._uU(21,"User"),l.TgZ(22,"span"),l._uU(23,"*"),l.qZA(),l.qZA(),l.TgZ(24,"an-action-field",19),l.NdJ("click",function(){return l.CHM(e),l.oxw().focusInput()}),l.TgZ(25,"div"),l.ALo(26,"async"),l._uU(27),l.ALo(28,"async"),l.qZA(),l.qZA(),l.TgZ(29,"mat-menu",null,20),l.TgZ(31,"mat-form-field",21),l.NdJ("click",function(e){return e.preventDefault(),e.stopPropagation()}),l.TgZ(32,"input",22,23),l.NdJ("ngModelChange",function(t){return l.CHM(e),l.oxw().search_str.next(t)}),l.ALo(34,"async"),l.qZA(),l.qZA(),l.YNc(35,Ht,3,5,"button",24),l.ALo(36,"slice"),l.ALo(37,"async"),l.qZA(),l.qZA(),l.TgZ(38,"div",8),l.TgZ(39,"label",25),l._uU(40,"Permissions"),l.qZA(),l.TgZ(41,"mat-form-field",10),l.TgZ(42,"mat-select",26),l.TgZ(43,"mat-option",27),l._uU(44,"None"),l.qZA(),l.TgZ(45,"mat-option",28),l._uU(46,"User"),l.qZA(),l.TgZ(47,"mat-option",29),l._uU(48,"Support"),l.qZA(),l.TgZ(49,"mat-option",30),l._uU(50,"Admin"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=l.MAs(16),t=l.MAs(30),n=l.oxw();let i;l.Q6J("formGroup",n.form),l.xp6(17),l.Q6J("ngForOf",n.scope_list),l.xp6(1),l.Q6J("matChipInputFor",e)("matChipInputSeparatorKeyCodes",n.separators)("matChipInputAddOnBlur",!0),l.xp6(6),l.Q6J("matMenuTriggerFor",t),l.xp6(1),l.ekj("opacity-30",!l.lcZ(26,13,n.active_user)),l.xp6(2),l.hij(" ",(null==(i=l.lcZ(28,15,n.active_user))?null:i.name)||"Select user"," "),l.xp6(5),l.Q6J("ngModel",l.lcZ(34,17,n.search_str))("ngModelOptions",l.DdM(25,Bt)),l.xp6(3),l.Q6J("ngForOf",l.Dn7(36,19,l.lcZ(37,23,n.filtered_users),0,10)),l.xp6(8),l.Q6J("value",null)}}function Kt(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"footer",34),l.TgZ(1,"button",35),l.NdJ("click",function(){return l.CHM(e),l.oxw().save()}),l._uU(2,"Save"),l.qZA(),l.qZA()}}function Wt(e,t){if(1&e&&(l.TgZ(0,"main",36),l._UZ(1,"mat-spinner",37),l.TgZ(2,"p"),l._uU(3),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(1),l.Q6J("diameter",32),l.xp6(2),l.Oqu(e.loading)}}let Rt=(()=>{class e{constructor(e){this._service=e,this.event=new l.vpe,this.form=new o.cw({name:new o.NI("",[o.kI.required]),user_id:new o.NI("",[o.kI.required]),description:new o.NI(""),scopes:new o.NI([]),permissions:new o.NI("")}),this.search_str=new He.X(""),this.users=(0,Ct.aj)([this._service.users,this.form.valueChanges]).pipe((0,P.U)(([e,{permissions:t}])=>"admin"===t?e.filter(e=>e.sys_admin):"support"===t?e.filter(e=>e.support||e.sys_admin):e.sort((e,t)=>{var n;return null===(n=e.name)||void 0===n?void 0:n.localeCompare(t.name)}))),this.filtered_users=(0,Ct.aj)([this.users,this.search_str]).pipe((0,P.U)(([e,t])=>e.filter(e=>e.name.toLowerCase().includes(t.toLowerCase())||e.email.toLowerCase().includes(t.toLowerCase())))),this.active_user=(0,Ct.aj)([this.form.valueChanges,this.users]).pipe((0,P.U)(([{user_id:e},t])=>t.find(t=>t.id===e))),this.separators=[St.K5,St.OC,St.L_],this.focusInput=()=>setTimeout(()=>{var e,t;return null===(t=null===(e=this._input_el)||void 0===e?void 0:e.nativeElement)||void 0===t?void 0:t.focus()},100),this.addScope=e=>(0,Ft.Z)(this.form.controls.scopes,e),this.removeScope=e=>(0,Ft.i)(this.form.controls.scopes,e),setTimeout(()=>this.form.patchValue({permissions:null}),100)}get scope_list(){return this.form.controls.scopes.value}save(){this.form.markAllAsTouched(),this.form.valid&&this.event.emit({reason:"done",metadata:this.form.value})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(Xt))},e.\u0275cmp=l.Xpm({type:e,selectors:[["api-key-modal"]],viewQuery:function(e,t){if(1&e&&l.Gf(Dt,5),2&e){let e;l.iGM(e=l.CRH())&&(t._input_el=e.first)}},outputs:{event:"event"},decls:8,vars:4,consts:function(){let e;return e=$localize`:@@apiScopePlaceholder␟312125edb94a1ac433d530e4ec51212da69819d9␟4303954101435613129:Scopes...`,[[1,"h-12","flex","items-center","justify-between","p-2"],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],["class","w-[32rem] max-w-[calc(100vw-2rem)]",3,"formGroup",4,"ngIf","ngIfElse"],["class","p-2 flex items-center justify-center border-t border-gray-100",4,"ngIf"],["load_state",""],["mat-icon-button","","mat-dialog-close",""],["className","backoffice-cross"],[1,"w-[32rem]","max-w-[calc(100vw-2rem)]",3,"formGroup"],[1,"flex","flex-col"],["for","name"],["appearance","outline"],["name","name","formControlName","name","placeholder","Name","matInput",""],["name","description","formControlName","description","placeholder","Description","matInput",""],["for","scope"],["aria-label","Scopes"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],["placeholder",e,3,"matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],["for","user"],["yPosition","below",1,"mb-8",3,"matMenuTriggerFor","click"],["menu","matMenu"],["appearance","outline",1,"px-2","h-12",3,"click"],["matInput","","placeholder","Search users...",3,"ngModel","ngModelOptions","ngModelChange"],["input",""],["mat-menu-item","",3,"text-primary","click",4,"ngFor","ngForOf"],["for","permissions"],["name","permissions","formControlName","permissions","placeholder","None"],[3,"value"],["value","user"],["value","support"],["value","admin"],[3,"selectable","removable","removed"],["matChipRemove","","className","backoffice-cross"],["mat-menu-item","",3,"click"],[1,"p-2","flex","items-center","justify-center","border-t","border-gray-100"],["mat-button","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","space-y-2","p-8","w-[24rem]","h-64"],[3,"diameter"]]},template:function(e,t){if(1&e&&(l.TgZ(0,"header",0),l.TgZ(1,"h2"),l._uU(2,"New API Key"),l.qZA(),l.YNc(3,Lt,2,0,"button",1),l.qZA(),l.YNc(4,Gt,51,26,"main",2),l.YNc(5,Kt,3,0,"footer",3),l.YNc(6,Wt,4,2,"ng-template",null,4,l.W1O)),2&e){const e=l.MAs(7);l.xp6(3),l.Q6J("ngIf",!t.loading),l.xp6(1),l.Q6J("ngIf",!t.loading&&t.form)("ngIfElse",e),l.xp6(1),l.Q6J("ngIf",!t.loading)}},directives:[i.O5,x.lW,I.ZT,f.o,o.JL,o.sg,Ae.KE,o.Fj,Te.Nt,o.JJ,o.u,$t.qn,i.sg,$t.oH,Yt.s,jt.p6,jt.VK,o.On,qe.gD,ye.ey,$t.HS,$t.qH,jt.OP,A.$g],pipes:[i.Ov,i.OU],styles:[""]}),e})(),Xt=(()=>{class e{constructor(e){this._dialog=e,this._domain=new He.X(null),this._last_key=new He.X(null),this._change=new He.X(0),this.last_key=this._last_key.asObservable(),this.active_domain=this._domain.asObservable(),this.available_domains=(0,v.R2s)({limit:500}).pipe((0,P.U)(e=>e.data),(0,Be.d)(1)),this.available_keys=(0,Ct.aj)([this._domain,this._change]).pipe((0,E.w)(([e])=>e?(0,v.IOR)({query_params:{authority_id:e.id},fn:e=>new Pt(e),path:"api_keys"}).pipe((0,P.U)(e=>e.data)):(0,ut.of)([])),(0,Be.d)(1)),this.users=(0,Ct.aj)([this._domain,this._change]).pipe((0,E.w)(([e])=>e?(0,v.E4d)({authority_id:e.id}).pipe((0,P.U)(e=>e.data)):(0,ut.of)([])),(0,Be.d)(1))}setDomain(e){this._domain.next(e)}newKey(){return(0,ce.mG)(this,void 0,void 0,function*(){const e=this._dialog.open(Rt),t=yield Promise.race([e.componentInstance.event.pipe((0,be.P)(e=>"done"===e.reason)).toPromise(),e.afterClosed().toPromise()]);if("done"!==(null==t?void 0:t.reason))return;e.componentInstance.loading="Creating new API key...";const n=this._domain.getValue(),i=yield(0,v.Ue8)({query_params:{},fn:e=>new Pt(e),path:"api_keys",form_data:Object.assign(Object.assign({},t.metadata),{authority_id:n.id})}).toPromise().catch(t=>{throw e.close(),(0,Z.cB)(t),t});this._last_key.next(i),this._change.next(Date.now()),(0,Z.t5)("Successfully created new API key."),e.close()})}removeKey(e){return(0,ce.mG)(this,void 0,void 0,function*(){const t=yield(0,N._5)({title:"Remove API Key",content:"Are you sure you wish to remove this API key?\n                    Removing this key may result in applications using this key to stop working.",icon:{content:"delete"}},this._dialog);"done"===(null==t?void 0:t.reason)&&(t.loading("Removing API key..."),yield(0,v.OdJ)({id:e.id,query_params:{},path:"api_keys"}).toPromise(),t.close(),(0,Z.t5)("Successfully removed API key."))})}}return e.\u0275fac=function(t){return new(t||e)(l.LFG(I.uw))},e.\u0275prov=l.Yz7({token:e,factory:e.\u0275fac}),e})();class Vt{constructor(e,t){this._document=t;const n=this._textarea=this._document.createElement("textarea"),i=n.style;i.position="fixed",i.top=i.opacity="0",i.left="-999em",n.setAttribute("aria-hidden","true"),n.value=e,this._document.body.appendChild(n)}copy(){const e=this._textarea;let t=!1;try{if(e){const n=this._document.activeElement;e.select(),e.setSelectionRange(0,e.value.length),t=this._document.execCommand("copy"),n&&n.focus()}}catch(n){}return t}destroy(){const e=this._textarea;e&&(e.parentNode&&e.parentNode.removeChild(e),this._textarea=void 0)}}let en=(()=>{class e{constructor(e){this._document=e}copy(e){const t=this.beginCopy(e),n=t.copy();return t.destroy(),n}beginCopy(e){return new Vt(e,this._document)}}return e.\u0275fac=function(t){return new(t||e)(l.LFG(i.K0))},e.\u0275prov=l.Yz7({factory:function(){return new e(l.LFG(i.K0))},token:e,providedIn:"root"}),e})();var tn=n(6529);function nn(e,t){if(1&e&&(l.TgZ(0,"mat-option",10),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e),l.xp6(1),l.hij(" ",e.name," ")}}function on(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",11),l.TgZ(1,"div",12),l.TgZ(2,"label",13),l._uU(3),l.ALo(4,"async"),l.qZA(),l.qZA(),l.TgZ(5,"div",14),l.TgZ(6,"div",15),l.NdJ("click",function(){return l.CHM(e),l.oxw().copyKey()}),l._uU(7),l.ALo(8,"async"),l.ALo(9,"async"),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=l.oxw();let t,n;l.xp6(3),l.hij(" Last API Key Details (",(null==(t=l.lcZ(4,3,e.last_key))?null:t.name)||"Unanamed API Key",") "),l.xp6(4),l.AsE(" ",(null==(n=l.lcZ(8,5,e.last_key))?null:n.id)||"no",".",(null==(n=l.lcZ(9,7,e.last_key))?null:n.secret)||"Key"," ")}}function sn(e,t){if(1&e&&(l.TgZ(0,"span",30),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.xp6(1),l.hij(" ",e," ")}}function an(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",25),l.TgZ(1,"div",18),l._uU(2),l.qZA(),l.TgZ(3,"div",19),l._uU(4),l.qZA(),l.TgZ(5,"div",20),l.YNc(6,sn,2,1,"span",26),l.qZA(),l.TgZ(7,"div",21),l._uU(8),l.qZA(),l.TgZ(9,"div",18),l._uU(10),l.ALo(11,"dateFrom"),l.qZA(),l.TgZ(12,"div",27),l.TgZ(13,"button",28),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw(2).deleteBroker(t)}),l._UZ(14,"app-icon",29),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit;l.xp6(2),l.Oqu(e.name),l.xp6(2),l.Oqu(e.description),l.xp6(2),l.Q6J("ngForOf",e.scopes),l.xp6(2),l.Oqu(e.permissions||"None"),l.xp6(2),l.hij(" ",l.lcZ(11,5,1e3*e.created_at)," ")}}function cn(e,t){if(1&e&&(l.TgZ(0,"div",16),l.TgZ(1,"div",17),l.TgZ(2,"div",18),l._uU(3,"Name"),l.qZA(),l.TgZ(4,"div",19),l._uU(5,"Description"),l.qZA(),l.TgZ(6,"div",20),l._uU(7,"Scopes"),l.qZA(),l.TgZ(8,"div",21),l._uU(9,"Permissions"),l.qZA(),l.TgZ(10,"div",18),l._uU(11,"Created"),l.qZA(),l._UZ(12,"div",22),l.qZA(),l.TgZ(13,"div",23),l.YNc(14,an,15,7,"div",24),l.ALo(15,"async"),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(14),l.Q6J("ngForOf",l.lcZ(15,1,e.key_list))}}function rn(e,t){1&e&&(l.TgZ(0,"div",31),l.TgZ(1,"p"),l._uU(2,"No API Keys"),l.qZA(),l.qZA())}const ln=[{path:"",component:h,canActivate:[a.w],children:[{path:"about",component:J},{path:"database",component:w},{path:"clusters",component:ae},{path:"interfaces",component:ue},{path:"brokers",component:ve},{path:"edge",component:qt},{path:"extensions",component:ze},{path:"staff-api",component:dt},{path:"schemas",component:Nt},{path:"api-keys",component:(()=>{class e{constructor(e,t){this._service=e,this._clipboard=t,this.domain=this._service.active_domain,this.domain_list=this._service.available_domains,this.key_list=this._service.available_keys,this.last_key=this._service.last_key,this.setDomain=e=>this._service.setDomain(e),this.newKey=()=>this._service.newKey()}copyKey(){return(0,ce.mG)(this,void 0,void 0,function*(){const e=yield this.last_key.pipe((0,It.q)(1)).toPromise();e&&(this._clipboard.copy(`${e.id}.${e.secret}`),(0,Z.QD)("Copied API key to clipboard."))})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(Xt),l.Y36(en))},e.\u0275cmp=l.Xpm({type:e,selectors:[["admin-api-keys"]],decls:18,vars:16,consts:[[1,"flex","items-start","space-x-2","m-4"],[1,"flex","flex-col","space-y-1"],["for","type"],["appearance","outline",1,"h-12"],["name","type","placeholder","Select Domain...",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["mat-button","",1,"mt-8","min-w-[8rem]",3,"disabled","click"],["class","rounded shadow border border-gray-100 min-w-[24rem]",4,"ngIf"],["role","table",4,"ngIf","ngIfElse"],["load_state",""],[3,"value"],[1,"rounded","shadow","border","border-gray-100","min-w-[24rem]"],[1,"border-b","px-2","pb-1","border-gray-200","!w-full"],[1,"p-0","m-0"],[1,"p-2"],[1,"select-all","text-xs","opacity-60","mono","break-words","cursor-pointer",3,"click"],["role","table"],["table-head",""],[1,"w-32","p-2"],[1,"flex-1","p-2"],[1,"w-32","p-2","truncate"],[1,"w-28","p-2"],[1,"w-16","p-2"],["table-body",""],["table-row","",4,"ngFor","ngForOf"],["table-row",""],["class","m-1 px-2 py-1 bg-gray-400 rounded text-xs text-white",4,"ngFor","ngForOf"],[1,"w-16","p-2","flex","items-center"],["mat-icon-button","",3,"click"],["className","backoffice-trash"],[1,"m-1","px-2","py-1","bg-gray-400","rounded","text-xs","text-white"],[1,"flex","flex-col","items-center"]],template:function(e,t){if(1&e&&(l.TgZ(0,"div",0),l.TgZ(1,"div",1),l.TgZ(2,"label",2),l._uU(3,"Domain: "),l.qZA(),l.TgZ(4,"mat-form-field",3),l.TgZ(5,"mat-select",4),l.NdJ("ngModelChange",function(e){return t.setDomain(e)}),l.ALo(6,"async"),l.YNc(7,nn,2,2,"mat-option",5),l.ALo(8,"async"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(9,"button",6),l.NdJ("click",function(){return t.newKey()}),l.ALo(10,"async"),l._uU(11," Add API Key "),l.qZA(),l.YNc(12,on,10,9,"div",7),l.ALo(13,"async"),l.qZA(),l.YNc(14,cn,16,3,"div",8),l.ALo(15,"async"),l.YNc(16,rn,3,0,"ng-template",null,9,l.W1O)),2&e){const e=l.MAs(17);let n;l.xp6(5),l.Q6J("ngModel",l.lcZ(6,6,t.domain)),l.xp6(2),l.Q6J("ngForOf",l.lcZ(8,8,t.domain_list)),l.xp6(2),l.Q6J("disabled",!l.lcZ(10,10,t.domain)),l.xp6(3),l.Q6J("ngIf",l.lcZ(13,12,t.last_key)),l.xp6(2),l.Q6J("ngIf",null==(n=l.lcZ(15,14,t.key_list))?null:n.length)("ngIfElse",e)}},directives:[Ae.KE,qe.gD,o.JJ,o.On,i.sg,x.lW,i.O5,ye.ey,f.o],pipes:[i.Ov,tn.R],styles:[""]}),e})()},{path:"extend/:id",component:_e.z},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:""}];var dn=n(7561);let un=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=l.oAB({type:e}),e.\u0275inj=l.cJS({providers:[Xt],imports:[[i.ez,o.u5,o.UX,s.Bz.forChild(ln),dn.X]]}),e})()},8289:(e,t,n)=>{"use strict";n.d(t,{F:()=>a});var i=n(8318),o=n(8569),s=n(2293);function a(e=0,t=o.P){return(!(0,s.k)(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=o.P),new i.y(n=>(n.add(t.schedule(c,e,{subscriber:n,counter:0,period:e})),n))}function c(e){const{subscriber:t,counter:n,period:i}=e;t.next(n),this.schedule({subscriber:t,counter:n+1,period:i},i)}}}]);
//# sourceMappingURL=228.14ea8462a775058c81cc.js.map