(self.webpackChunkplaceos=self.webpackChunkplaceos||[]).push([[222],{9222:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AppDriversModule:()=>te});var o=i(1511),n=i(3695),r=i(6898),s=i(4762),l=i(5546),c=i(5712),a=i(8194),d=i(5697),u=i(1572),m=i(7096),f=i(6478);let p=(()=>{class e extends a.K{constructor(e){super(),this._service=e,this.name="drivers",this.show_options=this._service.show_options,this.tab_list=[]}get extensions(){return(0,d.fq)(this._service.active_item,this.name)}updateTabList(){this.tab_list=[{id:"about",name:"About",icon:{class:"backoffice-info-with-circle"}},{id:"modules",name:"Modules",count:this.device_count,icon:{class:"backoffice-tablet"}}].concat(this.extensions)}ngOnInit(){this.subscription("item",this._service.item.subscribe(e=>{this.loadValues(e),this.updateTabList()})),this.updateTabList()}loadValues(e){return(0,s.mG)(this,void 0,void 0,function*(){if(!e)return;const t={offset:0,limit:1,driver_id:e.id};this.device_count=(yield(0,l.Ne_)(t).toPromise()).total})}}return e.\u0275fac=function(t){return new(t||e)(u.Y36(c.L))},e.\u0275cmp=u.Xpm({type:e,selectors:[["app-drivers"]],features:[u.qOj],decls:3,vars:1,consts:[[1,"flex-1","flex-col","sm:flex-row","flex","h-full","w-full","relative"],["heading","Drivers","name","drivers",1,"absolute","top-0","left-0","h-12","w-full","sm:h-full","sm:static"],["name","driver","route","drivers",1,"flex-1","relative","mt-12","sm:mt-0","w-full","sm:w-1/2",3,"tabs"]],template:function(e,t){1&e&&(u.TgZ(0,"div",0),u._UZ(1,"sidebar",1),u._UZ(2,"item-display",2),u.qZA()),2&e&&(u.xp6(2),u.Q6J("tabs",t.tab_list))},directives:[m.k,f.s],styles:["sidebar[_ngcontent-%COMP%]{transition:height .3s}@media screen and (min-width:640px){sidebar[_ngcontent-%COMP%]{width:20em!important}}"]}),e})();var v=i(8512),g=i(3835),Z=i(4689),h=i(7727),_=i(5012),b=i(2628),A=i(4019),T=i(9996),q=i(8303),x=i(4103),w=i(8739),y=i(5646),L=i(4608);let N=(()=>{class e{constructor(e,t){this._state=e,this._dialog=t,this._loading=new v.X(!1),this._last_error=new v.X(null),this.item=this._state.item,this.loading=this._loading.asObservable(),this.last_error=this._last_error.asObservable(),this.is_compiled=this.item.pipe((0,g.h)(e=>!!e&&e instanceof l.CbG),(0,Z.w)(e=>(0,l.J_X)(e.id)),(0,h.K)(e=>(0,s.mG)(this,void 0,void 0,function*(){const t=yield null==e?void 0:e.json();if(this._last_error.next((null==t?void 0:t.compilation_output)||e),console.log("Driver Error:",t),!(null==t?void 0:t.compilation_output))throw e})),(0,_.a)((0,b.g)(1e3)),(0,A.b)(e=>e?this._last_error.next(null):"")),this.modules=this.item.pipe((0,Z.w)(e=>(0,s.mG)(this,void 0,void 0,function*(){this._loading.next(!0);const t=yield(0,l.Ne_)({driver_id:e.id}).toPromise();return this._loading.next(!1),t})),(0,T.U)(e=>e.data),(0,q.d)()),this.item.subscribe(()=>this._last_error.next(null))}get active_item(){return this._state.active_item}viewError(){const e=this._last_error.getValue();e&&this._dialog.open(y.a,{data:{title:"Driver Compilation Error",content:e}})}recompileDriver(){return(0,s.mG)(this,void 0,void 0,function*(){const e=yield(0,x._5)({title:"Recompile Driver",content:"<p>Are you sure you want recompile this driver?</p><p>New driver code will be loaded and device settings will be updated.</p>",icon:{type:"icon",class:"backoffice-cycle"}},this._dialog);if(!e||!e.reason)return e.close();e.loading("Recompiling driver...");const t=yield(0,l.qEr)(this._state.active_item.id).toPromise().catch(e=>null);if(e.close(),!t)return(0,w.cB)("Failed to recompiled driver.");(0,w.t5)("Successfully recompiled driver.")})}removeModule(e){return(0,s.mG)(this,void 0,void 0,function*(){const t=yield(0,x._5)({title:"Remove module?",content:`Remove ${e.driver_id}?<br>All associated data be deleted immediatedly.`,icon:{type:"icon",class:"backoffice-trash"}},this._dialog);if(!t||!t.reason)return;const i=yield(0,l.zed)(this.active_item.id,e.id).toPromise().catch(t=>{(0,w.cB)(`Error removing module ${e.id}. Error: ${t.statusText||t.message||t}`)});t.close(),i&&(this._state.replaceItem(i),(0,w.t5)("Successfully removed module."))})}}return e.\u0275fac=function(t){return new(t||e)(u.LFG(c.L),u.LFG(L.uw))},e.\u0275prov=u.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var D=i(5980),O=i(7806),$=i(9441),C=i(6529);function U(e,t){if(1&e&&(u.TgZ(0,"div",2),u.TgZ(1,"label"),u.SDv(2,21),u.qZA(),u.TgZ(3,"div",4),u._uU(4),u.qZA(),u.qZA()),2&e){const e=u.oxw();u.xp6(4),u.Oqu(e.item.default_uri)}}function I(e,t){if(1&e&&(u.TgZ(0,"div",2),u.TgZ(1,"label"),u.SDv(2,22),u.qZA(),u.TgZ(3,"div",4),u._uU(4),u.qZA(),u.qZA()),2&e){const e=u.oxw();u.xp6(4),u.Oqu(e.item.default_port)}}function S(e,t){1&e&&u._UZ(0,"mat-spinner",23)}function k(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"button",14),u.NdJ("click",function(){return u.CHM(e),u.oxw().viewErrors()}),u._uU(1," View Errors "),u.qZA()}}function J(e,t){if(1&e&&(u.TgZ(0,"section"),u._UZ(1,"a-settings-form",24),u.qZA()),2&e){const e=u.oxw();u.xp6(1),u.Q6J("merge",!0)("id",e.item.id)("settings",e.item.settings)}}function M(e,t){1&e&&(u.TgZ(0,"div",25),u._UZ(1,"mat-spinner",26),u.TgZ(2,"p"),u.SDv(3,27),u.qZA(),u.qZA())}const E=function(e){return["/repositories",e,"about"]};let z=(()=>{class e{constructor(e){this._service=e,this.compiled=this._service.is_compiled,this.compilation_error=this._service.last_error,this.recompileDriver=()=>this._service.recompileDriver(),this.viewErrors=()=>this._service.viewError()}get item(){return this._service.active_item||{}}}return e.\u0275fac=function(t){return new(t||e)(u.Y36(N))},e.\u0275cmp=u.Xpm({type:e,selectors:[["driver-about"]],decls:55,vars:26,consts:function(){let e,t,i,o,n,r,s,l,c,a,d,u;return e=$localize`:@@driverDetailsCompiled␟cf381ca16eaabe3374d51e9f94f2218500c4fa4e␟9153697548218950089:Compiled:`,t=$localize`:@@driverDetailsCommit␟9550d280606a1dc85aa6687e6375c8c3edfa14ac␟2338640606551983669:Repository:`,i=$localize`:@@driverDetailsCommit␟fd8aae50a9e4449f1ca02dd094975918d9a5667b␟1255418805683509654:Commit:`,o=$localize`:@@driverDetailsFileName␟38b21a77c169dc1d573d1959b82ee0d1bc2382a4␟3153886573188541985:File Name:`,n=$localize`:@@driverDetailsModuleName␟30503cc4139d9b80b7ee428e70c83f93018643c3␟2852585380255004131:Module Name:`,r=$localize`:@@driverCreatedAtLabel␟a5ed099ffc9e96f6970df843289ade8a7d20ab9f␟1616250945945379783:Created:`,s=$localize`:@@driverUpdatedAtLabel␟f94240161f912dbd8758b858877cddeab80f36cb␟1116759395536210856:Updated:`,l=$localize`:@@driverReloadAction␟9e4193ff8bc8eb566c2a631f96b9c93ac4d22a4e␟5398060262188177679: Recompile Driver `,c=$localize`:@@settingsLabel␟5ba97a3f90a79c4d7720b941ae416c8c84337e38␟180274732945114229: Settings `,a=$localize`:@@driverDefaultURILabel␟aaf77b7baecf340df6c6e20f4016289f440c390e␟2755927892619874934:Default URI:`,d=$localize`:@@driverDefaultPortLabel␟708739a9f194ca4078bfdeed2db588d855c042b8␟8341926293707687932:Default Port Number:`,u=$localize`:@@driverLoadingLabel␟07c312791623a62194aaf1b64cf77ac60427ba34␟1421066576333999335:Loading driver settings...`,[[1,"mb-4","space-y-2"],["class","flex items-center space-x-2",4,"ngIf"],[1,"flex","items-center","space-x-2"],e,[1,"value"],["diameter","24",4,"ngIf"],["mat-button","",3,"click",4,"ngIf"],t,[1,"underline",3,"routerLink"],i,o,n,r,s,["mat-button","",3,"click"],l,[1,"my-4"],[1,"font-medium","text-lg"],c,[4,"ngIf","ngIfElse"],["load_state",""],a,d,["diameter","24"],[3,"merge","id","settings"],[1,"flex","flex-col","items-center","justify-center"],["diameter","48",1,"mb-4"],u]},template:function(e,t){if(1&e&&(u.TgZ(0,"section",0),u.YNc(1,U,5,1,"div",1),u.YNc(2,I,5,1,"div",1),u.TgZ(3,"div",2),u.TgZ(4,"label"),u.SDv(5,3),u.qZA(),u.TgZ(6,"div",4),u._uU(7),u.ALo(8,"async"),u.qZA(),u.YNc(9,S,1,0,"mat-spinner",5),u.ALo(10,"async"),u.YNc(11,k,2,0,"button",6),u.ALo(12,"async"),u.qZA(),u.TgZ(13,"div",2),u.TgZ(14,"label"),u.SDv(15,7),u.qZA(),u.TgZ(16,"div",4),u.TgZ(17,"a",8),u._uU(18),u.qZA(),u.qZA(),u.qZA(),u.TgZ(19,"div",2),u.TgZ(20,"label"),u.SDv(21,9),u.qZA(),u.TgZ(22,"div",4),u._uU(23),u.qZA(),u.qZA(),u.TgZ(24,"div",2),u.TgZ(25,"label"),u.SDv(26,10),u.qZA(),u.TgZ(27,"div",4),u._uU(28),u.qZA(),u.qZA(),u.TgZ(29,"div",2),u.TgZ(30,"label"),u.SDv(31,11),u.qZA(),u.TgZ(32,"div",4),u._uU(33),u.qZA(),u.qZA(),u.TgZ(34,"div",2),u.TgZ(35,"label"),u.SDv(36,12),u.qZA(),u.TgZ(37,"div",4),u._uU(38),u.ALo(39,"dateFrom"),u.qZA(),u.qZA(),u.TgZ(40,"div",2),u.TgZ(41,"label"),u.SDv(42,13),u.qZA(),u.TgZ(43,"div",4),u._uU(44),u.ALo(45,"dateFrom"),u.qZA(),u.qZA(),u.qZA(),u.TgZ(46,"section"),u.TgZ(47,"button",14),u.NdJ("click",function(){return t.recompileDriver()}),u.SDv(48,15),u.qZA(),u.qZA(),u._UZ(49,"hr",16),u.TgZ(50,"header",17),u.SDv(51,18),u.qZA(),u.YNc(52,J,2,3,"section",19),u.YNc(53,M,4,0,"ng-template",null,20,u.W1O)),2&e){const e=u.MAs(54);u.xp6(1),u.Q6J("ngIf",t.item.default_uri),u.xp6(1),u.Q6J("ngIf",t.item.default_port),u.xp6(5),u.hij(" ",u.lcZ(8,14,t.compiled)?"true":"false"," "),u.xp6(2),u.Q6J("ngIf",!u.lcZ(10,16,t.compiled)),u.xp6(2),u.Q6J("ngIf",u.lcZ(12,18,t.compilation_error)),u.xp6(6),u.Q6J("routerLink",u.VKq(24,E,t.item.repository_id)),u.xp6(1),u.hij(" ",t.item.repository_id,""),u.xp6(5),u.Oqu(t.item.commit),u.xp6(5),u.Oqu(t.item.file_name),u.xp6(5),u.Oqu(null==t.item?null:t.item.module_name),u.xp6(5),u.Oqu(u.lcZ(39,20,1e3*t.item.created_at)),u.xp6(6),u.Oqu(u.lcZ(45,22,1e3*t.item.updated_at)),u.xp6(8),u.Q6J("ngIf",t.item.settings)("ngIfElse",e)}},directives:[o.O5,r.yS,D.lW,O.$g,$.v],pipes:[o.Ov,C.R],styles:["[_nghost-%COMP%]{padding:1rem;height:100%;width:100%}"]}),e})();var Q=i(3080),F=i(6283),P=i(3609),Y=i(6756),R=i(5204);function j(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"i",27),u.NdJ("modelChange",function(t){return u.CHM(e),u.oxw().$implicit.connected=t}),u.qZA()}if(2&e){const e=u.oxw().$implicit;u.Q6J("model",e.connected)("sys",e.system.id)("mod",e)}}const K=function(e){return["/modules",e]},V=function(e){return["/systems",e]};function G(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",16),u.TgZ(1,"div",17),u.YNc(2,j,1,3,"i",18),u._UZ(3,"div",19),u.qZA(),u.TgZ(4,"div",20),u.tHW(5,21),u._UZ(6,"a",22),u.N_p(),u.qZA(),u.TgZ(7,"div",23),u.tHW(8,24),u._UZ(9,"a",22),u.N_p(),u.qZA(),u.TgZ(10,"div",9),u.TgZ(11,"button",25),u.NdJ("click",function(){const t=u.CHM(e).$implicit;return u.oxw(2).removeModule(t)}),u._UZ(12,"app-icon",26),u.qZA(),u.qZA(),u.qZA()}if(2&e){const e=t.$implicit;u.xp6(2),u.Q6J("ngIf",e.system),u.xp6(1),u.ekj("bg-error",e.running&&!e.connected)("bg-success",e.running&&e.connected),u.xp6(3),u.Q6J("routerLink",u.VKq(9,K,e.id)),u.pQV(e.custom_name||e.name),u.QtT(5),u.xp6(3),u.Q6J("routerLink",u.VKq(11,V,null==e.system?null:e.system.id)),u.pQV(null==e.system?null:e.system.name),u.QtT(8)}}function X(e,t){if(1&e&&(u.TgZ(0,"div",7),u.TgZ(1,"div",8),u.TgZ(2,"div",9),u._uU(3,"State"),u.qZA(),u.TgZ(4,"div",10),u.SDv(5,11),u.qZA(),u.TgZ(6,"div",12),u.SDv(7,13),u.qZA(),u._UZ(8,"div",9),u.qZA(),u.TgZ(9,"div",14),u.YNc(10,G,13,13,"div",15),u.ALo(11,"async"),u.qZA(),u.qZA()),2&e){const e=u.oxw();u.xp6(10),u.Q6J("ngForOf",u.lcZ(11,1,e.modules))}}function W(e,t){1&e&&(u.TgZ(0,"div",28),u._UZ(1,"mat-spinner",29),u.TgZ(2,"p"),u._uU(3,"Loading modules..."),u.qZA(),u.qZA()),2&e&&(u.xp6(1),u.Q6J("diameter",48))}function H(e,t){1&e&&(u.TgZ(0,"div",28),u.TgZ(1,"p"),u._uU(2,"No modules with driver"),u.qZA(),u.qZA())}const B=[{path:":id",component:p,children:[{path:"about",component:z},{path:"modules",component:(()=>{class e extends a.K{constructor(e){super(),this._service=e,this.filter$=new v.X(""),this.loading=this._service.loading,this.item=this._service.item,this.modules=(0,Q.aj)([this.filter$,this._service.modules]).pipe((0,T.U)(e=>{const[t,i]=e,o=t.toLowerCase();return t?i.filter(e=>e.name.toLowerCase().includes(o)||e.custom_name.toLowerCase().includes(o)):i})),this.removeModule=e=>this._service.removeModule(e)}}return e.\u0275fac=function(t){return new(t||e)(u.Y36(N))},e.\u0275cmp=u.Xpm({type:e,selectors:[["driver-devices"]],features:[u.qOj],decls:11,vars:5,consts:function(){let e,t,i,o;return e=$localize`:@@nameLabel␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,t=$localize`:@@triggerCountLabel␟cd367617089caee7c1b256e62dc858a8e1d6ebaa␟8627481566428528640: System `,i=$localize`:@@nameLabel␟bd6c739af47a911fc716b91fef6e9be600cd414a␟5610024539333668683:${"\ufffd#6\ufffd"}:START_LINK: ${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd/#6\ufffd"}:CLOSE_LINK:`,o=$localize`:@@triggerCountLabel␟ae1f743f09222b6e5286353943f21c01e58e2296␟2244782107666441480:${"\ufffd#9\ufffd"}:START_LINK: ${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd/#9\ufffd"}:CLOSE_LINK:`,[[1,"flex","items-center","mb-4"],["appearance","outline",1,"h-12","flex-1"],["matPrefix","","className","backoffice-magnifying-glass text-xl mr-2"],["matInput","","placeholder","Filter triggers...",1,"rounded-none",3,"ngModel","ngModelChange"],["role","table","class","overflow-x-auto",4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],["role","table",1,"overflow-x-auto"],["table-head",""],[1,"w-12","p-2"],["flex","",1,"flex-1","p-2"],e,[1,"w-48","p-2"],t,["table-body","",1,"overflow-y-auto"],["table-row","",4,"ngFor","ngForOf"],["table-row",""],[1,"w-12","p-2","flex","items-center","justify-center"],["binding","","bind","connected",3,"model","sys","mod","modelChange",4,"ngIf"],[1,"h-2","w-2","rounded-full","bg-black"],["flex","",1,"flex-1","p-2","underline"],i,[3,"routerLink"],[1,"w-48","p-2","underline"],o,["mat-icon-button","",3,"click"],["className","backoffice-trash"],["binding","","bind","connected",3,"model","sys","mod","modelChange"],[1,"flex","flex-col","items-center","p-8","mx-auto"],[1,"mb-4",3,"diameter"]]},template:function(e,t){if(1&e&&(u.TgZ(0,"section",0),u.TgZ(1,"mat-form-field",1),u._UZ(2,"app-icon",2),u.TgZ(3,"input",3),u.NdJ("ngModelChange",function(e){return t.filter$.next(e)}),u.qZA(),u.qZA(),u.qZA(),u.TgZ(4,"section"),u.YNc(5,X,12,3,"div",4),u.ALo(6,"async"),u.qZA(),u.YNc(7,W,4,1,"ng-template",null,5,u.W1O),u.YNc(9,H,3,0,"ng-template",null,6,u.W1O)),2&e){const e=u.MAs(10);let i;u.xp6(3),u.Q6J("ngModel",""),u.xp6(2),u.Q6J("ngIf",null==(i=u.lcZ(6,3,t.modules))?null:i.length)("ngIfElse",e)}},directives:[F.KE,P.o,F.qo,Y.Nt,n.Fj,n.JJ,n.On,o.O5,o.sg,r.yS,D.lW,R.D,O.$g],pipes:[o.Ov],styles:["[_nghost-%COMP%]{padding:1rem;height:100%;width:100%}[role=table][_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;min-width:28rem}"]}),e})()},{path:"extend/:id",component:i(3511).z},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:"-"}];var ee=i(7561);let te=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=u.oAB({type:e}),e.\u0275inj=u.cJS({imports:[[o.ez,n.u5,r.Bz.forChild(B),ee.X]]}),e})()}}]);